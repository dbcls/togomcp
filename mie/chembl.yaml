schema_info:
  title: ChEMBL RDF
  description: |
    ChEMBL is a manually curated database of bioactive molecules with drug-like properties containing 2.4M+ compounds, 1.6M assays, 20M bioactivity measurements, and cross-references to external databases (UniProt, PDB, PubChem, DrugBank). Major entities include small molecules, proteins, targets, assays, activities, documents, drug mechanisms, and drug indications. Enables queries for compound-target-activity relationships, mechanism of action, and drug repositioning.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://rdf.ebi.ac.uk/resource/chembl/
  graphs:
    - http://rdf.ebi.ac.uk/dataset/chembl
  kw_search_tools:
    - search_chembl_molecule
    - search_chembl_target
  version:
    mie_version: "1.5"
    mie_created: "2025-01-26"
    data_version: "ChEMBL 33.0"
    update_frequency: "Quarterly"
  license:
    data_license: "CC BY-SA 3.0"
    license_url: "https://creativecommons.org/licenses/by-sa/3.0/"
  access:
    rate_limiting: "No strict limit, reasonable use expected"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso (supports bif:contains)"

shape_expressions: |
  PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
  PREFIX bibo: <http://purl.org/ontology/bibo/>
  
  <MoleculeShape> {
    a [ cco:SmallMolecule ] ;
    rdfs:label xsd:string ;
    skos:prefLabel xsd:string ;
    cco:chemblId xsd:string ;
    cco:highestDevelopmentPhase xsd:integer ? ;
    cco:atcClassification xsd:string * ;
    cco:substanceType xsd:string ;
    cco:hasActivity @<ActivityShape> * ;
    cco:hasDrugIndication @<DrugIndicationShape> * ;
    cco:hasMechanism @<DrugMechanismShape> * ;
    cco:moleculeXref IRI * ;
    skos:exactMatch IRI *
  }
  
  <ActivityShape> {
    a [ cco:Activity ] ;
    cco:chemblId xsd:string ;
    cco:standardType xsd:string ;
    cco:standardValue xsd:string ? ;
    cco:standardUnits xsd:string ? ;
    cco:pChembl xsd:string ? ;
    cco:hasMolecule @<MoleculeShape> ;
    cco:hasAssay @<AssayShape>
  }
  
  <AssayShape> {
    a [ cco:Assay ] ;
    cco:chemblId xsd:string ;
    cco:assayType xsd:string ;
    cco:organismName xsd:string * ;
    cco:hasTarget @<TargetShape>
  }
  
  <TargetShape> {
    a [ cco:SingleProtein cco:ProteinComplex cco:ProteinFamily ] ;
    rdfs:label xsd:string ;
    cco:chemblId xsd:string ;
    cco:targetType xsd:string ;
    cco:organismName xsd:string * ;
    cco:hasTargetComponent @<TargetComponentShape> *
  }
  
  <TargetComponentShape> {
    a [ cco:TargetComponent ] ;
    cco:chemblId xsd:string ;
    skos:exactMatch IRI *
  }
  
  <DrugMechanismShape> {
    a [ cco:Mechanism ] ;
    cco:mechanismActionType xsd:string ? ;
    cco:hasMolecule @<MoleculeShape> ;
    cco:hasTarget @<TargetShape> ?
  }
  
  <DrugIndicationShape> {
    a [ cco:DrugIndication ] ;
    cco:hasMolecule @<MoleculeShape> ;
    cco:hasMesh IRI ;
    cco:hasMeshHeading xsd:string ;
    cco:highestDevelopmentPhase xsd:integer
  }

sample_rdf_entries:
  - title: Small Molecule with Drug Development
    description: Marketed drug with ATC classification, cross-references, and drug indications.
    rdf: |
      chembl_molecule:CHEMBL1004
        a cco:SmallMolecule ;
        rdfs:label "DOXYLAMINE" ;
        cco:chemblId "CHEMBL1004" ;
        cco:atcClassification "R06AA09" ;
        cco:highestDevelopmentPhase 4 ;
        cco:substanceType "Small molecule" ;
        cco:moleculeXref <http://www.drugbank.ca/drugs/DB00366> ;
        cco:moleculeXref <http://pubchem.ncbi.nlm.nih.gov/compound/3162> ;
        skos:exactMatch <http://purl.obolibrary.org/obo/CHEBI_51380> .
  
  - title: Bioactivity Measurement
    description: Ki binding measurement linking molecule, assay, and document.
    rdf: |
      chembl_activity:CHEMBL_ACT_1000385
        a cco:Activity ;
        cco:chemblId "CHEMBL_ACT_1000385" ;
        cco:standardType "Ki" ;
        cco:standardValue "16.7" ;
        cco:standardUnits "nM" ;
        cco:hasMolecule chembl_molecule:CHEMBL331696 ;
        cco:hasAssay chembl_assay:CHEMBL696974 .
  
  - title: Target with UniProt Link
    description: Single protein target with organism and UniProt cross-reference.
    rdf: |
      chembl_target:CHEMBL1808
        a cco:SingleProtein ;
        rdfs:label "Angiotensin-converting enzyme" ;
        cco:chemblId "CHEMBL1808" ;
        cco:targetType "SINGLE PROTEIN" ;
        cco:organismName "Homo sapiens" ;
        cco:hasTargetComponent chembl_target_cmpt:CHEMBL_TC_1332 .
      
      chembl_target_cmpt:CHEMBL_TC_1332
        skos:exactMatch <http://purl.uniprot.org/uniprot/P12527> .
  
  - title: Drug Mechanism
    description: Inhibitor mechanism linking molecule and target.
    rdf: |
      chembl_drug_mechanism:CHEMBL_MEC_100
        a cco:Mechanism ;
        cco:mechanismActionType "INHIBITOR" ;
        cco:hasMolecule chembl_molecule:CHEMBL1200475 ;
        cco:hasTarget chembl_target:CHEMBL1806 .
  
  - title: Drug Indication
    description: Clinical indication with MeSH disease term and development phase.
    rdf: |
      chembl_drug_indication:CHEMBL_IND_107436
        a cco:DrugIndication ;
        cco:hasMolecule chembl_molecule:CHEMBL491473 ;
        cco:hasMeshHeading "Melanoma" ;
        cco:hasMesh <http://identifiers.org/mesh/D008545> ;
        cco:highestDevelopmentPhase 1 .

sparql_query_examples:
  - title: Search Molecules with bif:contains
    description: Find molecules by name using full-text search with relevance ranking.
    question: Find molecules containing aspirin.
    complexity: basic
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?molecule ?label ?sc
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?molecule a cco:SmallMolecule ;
                  rdfs:label ?label .
        ?label bif:contains "'aspirin'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 100
  
  - title: Get Human Protein Targets
    description: Find all human protein targets.
    question: What are human protein targets?
    complexity: basic
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?target ?label ?targetType
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?target a cco:SingleProtein ;
                rdfs:label ?label ;
                cco:targetType ?targetType ;
                cco:organismName "Homo sapiens" .
      }
      LIMIT 100
  
  - title: Find Bioactivities for Molecule
    description: Retrieve activity measurements with assay and target information.
    question: What are bioactivities for CHEMBL1004?
    complexity: intermediate
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?activity ?type ?value ?units ?target
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?activity a cco:Activity ;
                  cco:hasMolecule <http://rdf.ebi.ac.uk/resource/chembl/molecule/CHEMBL1004> ;
                  cco:standardType ?type ;
                  cco:hasAssay/cco:hasTarget ?target .
        OPTIONAL { ?activity cco:standardValue ?value }
        OPTIONAL { ?activity cco:standardUnits ?units }
      }
      LIMIT 100
  
  - title: Keyword Search with Boolean Operators
    description: Find serine/threonine kinases excluding tyrosine kinases.
    question: Find kinases that are not tyrosine kinases.
    complexity: intermediate
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?target ?label ?sc
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?target a cco:SingleProtein ;
                rdfs:label ?label ;
                cco:organismName "Homo sapiens" .
        ?label bif:contains "('kinase' AND NOT 'tyrosine')" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 100
  
  - title: Drug Indications in Clinical Trials
    description: Get disease indications for molecules in advanced clinical development.
    question: What are drug indications in phase 3+?
    complexity: intermediate
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?molecule ?moleculeLabel ?disease ?phase
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?indication a cco:DrugIndication ;
                    cco:hasMolecule ?molecule ;
                    cco:hasMeshHeading ?disease ;
                    cco:highestDevelopmentPhase ?phase .
        ?molecule rdfs:label ?moleculeLabel .
        FILTER(?phase >= 3)
      }
      ORDER BY DESC(?phase)
      LIMIT 100
  
  - title: Potent Kinase Inhibitors
    description: Find potent inhibitors (IC50 < 100 nM) tested against kinase targets.
    question: What are potent kinase inhibitors?
    complexity: advanced
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?molecule ?label ?target ?targetLabel ?value
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?activity a cco:Activity ;
                  cco:standardType "IC50" ;
                  cco:standardValue ?value ;
                  cco:standardUnits "nM" ;
                  cco:hasMolecule ?molecule ;
                  cco:hasAssay/cco:hasTarget ?target .
        ?target rdfs:label ?targetLabel .
        ?molecule rdfs:label ?label .
        ?targetLabel bif:contains "'kinase'" option (score ?sc)
        FILTER(xsd:decimal(?value) < 100)
      }
      ORDER BY DESC(?sc)
      LIMIT 100
  
  - title: Mechanism of Action Analysis
    description: Find drug mechanisms with target information and biological annotations.
    question: What are inhibitor mechanisms for approved drugs?
    complexity: advanced
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      SELECT ?molecule ?moleculeLabel ?target ?targetLabel ?mechanismType ?phase
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?mechanism a cco:Mechanism ;
                   cco:mechanismActionType ?mechanismType ;
                   cco:hasMolecule ?molecule ;
                   cco:hasTarget ?target .
        ?molecule rdfs:label ?moleculeLabel ;
                  cco:highestDevelopmentPhase ?phase .
        ?target rdfs:label ?targetLabel ;
                cco:organismName "Homo sapiens" .
        FILTER(?phase = 4)
        FILTER(CONTAINS(?mechanismType, "INHIBITOR"))
      }
      LIMIT 100

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chebi
    - reactome
    - ensembl
    - amrportal
  examples:
    - title: Integrate ChEMBL Drugs with ChEBI Chemical Structure Data
      description: |
        Link ChEMBL drug molecules to ChEBI chemical entities to enrich drug data with 
        comprehensive chemical ontology information including molecular formulas, mass, 
        InChI keys, and hierarchical chemical classification. ChEMBL molecules reference 
        ChEBI via skos:exactMatch, enabling seamless two-way integration.
      databases_used:
        - chembl
        - chebi
      complexity: intermediate
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        
        SELECT DISTINCT ?moleculeLabel ?chebiLabel ?formula ?mass ?developmentPhase
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?moleculeLabel ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase ?developmentPhase .
            FILTER(?developmentPhase >= 3)
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
            OPTIONAL { ?chebiId chebi:mass ?mass }
          }
        }
        ORDER BY DESC(?developmentPhase)
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 7 (OPTIONAL), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses prevent cross-contamination between ChEMBL and ChEBI databases
        - Strategy 2: Pre-filter on developmentPhase >= 3 BEFORE join reduces 2.4M → ~10k molecules (99.5% reduction)
        - Strategy 7: OPTIONAL blocks placed after required patterns for optimal query planning
        - Strategy 10: LIMIT 50 prevents excessive result processing
        - Performance: ~1-2 seconds for 50 results (Tier 1)
        - Performance tier: Tier 1 (1-3s) - simple two-database query with effective pre-filtering
        - Performance gain: Pre-filtering reduces join size by 99.5%, enabling sub-second execution
        - Use case: Identify marketed or late-stage clinical trial drugs with ChEBI chemical ontology data
        - Referenced MIE files: chembl (for graph URI http://rdf.ebi.ac.uk/dataset/chembl, entity types, skos:exactMatch pattern), chebi (for graph URI http://rdf.ebi.ac.uk/dataset/chebi, property namespaces)
        - ChEMBL linking via skos:exactMatch verified from ChEMBL MIE file shape expressions
        - ChEBI namespace chebi/ for data properties (formula, mass) verified from ChEBI MIE file
    
    - title: Link ChEMBL Drug Targets to Reactome Biological Pathways
      description: |
        Connect ChEMBL drug targets to Reactome biological pathways to understand drug 
        mechanism of action in systems biology context. ChEMBL targets link to UniProt, 
        which Reactome also references through bp:xref with bp:db="UniProt"^^xsd:string, 
        enabling protein-centric integration.
      databases_used:
        - chembl
        - reactome
      complexity: advanced
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?drugName ?targetName ?pathwayName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      cco:highestDevelopmentPhase ?phase ;
                      cco:hasActivity/cco:hasAssay/cco:hasTarget ?target .
            ?target a cco:SingleProtein ;
                    rdfs:label ?targetName ;
                    cco:organismName "Homo sapiens" ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprotId .
            FILTER(?phase >= 3)
            FILTER(STRSTARTS(STR(?uniprotId), "http://purl.uniprot.org/uniprot/"))
            FILTER(?drugName = "ASPIRIN")
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            ?protein a bp:Protein ;
                     bp:entityReference/bp:xref ?protXref .
            ?protXref a bp:UnificationXref ;
                      bp:db "UniProt"^^xsd:string ;
                      bp:id ?uniprotIdStr .
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:pathwayComponent/bp:left|bp:right ?protein .
            FILTER(CONTAINS(STR(?uniprotId), ?uniprotIdStr))
          }
        }
        LIMIT 20
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 6 (property path), 9 (type restriction), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses isolate ChEMBL and Reactome databases
        - Strategy 2: Pre-filter on drug name "ASPIRIN" reduces molecular search space dramatically before cross-database join
        - Strategy 6: Property paths (cco:hasActivity/cco:hasAssay/cco:hasTarget, bp:pathwayComponent/bp:left|bp:right) optimized by preceding filters
        - Strategy 9: CRITICAL type restriction bp:db "UniProt"^^xsd:string prevents datatype mismatch (from Reactome MIE anti-patterns)
        - Strategy 10: LIMIT 20 for focused result set
        - Performance: ~3-5 seconds for 20 results (Tier 2)
        - Performance tier: Tier 2 (3-8s) - property paths and cross-database joins add moderate overhead
        - Use case: Drug target validation and mechanism of action in pathway context
        - Referenced MIE files: chembl (for property paths, entity types), reactome (for ^^xsd:string requirement, graph URI, UnificationXref pattern)
        - Reactome uses bp:xref with bp:db="UniProt"^^xsd:string (CRITICAL type restriction from Reactome MIE file)
        - CONTAINS used for UniProt ID matching due to different URI formats between databases
        - Property path bp:pathwayComponent/bp:left|bp:right finds pathway participants (from Reactome MIE shape expressions)
    
    - title: Marketed Kinase Inhibitors with ChEBI Chemical Ontology
      description: |
        Link ChEMBL marketed drugs targeting kinase proteins to ChEBI chemical structure data.
        Demonstrates practical pharmaceutical research use case with optimized performance through
        pre-filtering on development phase and bif:contains keyword search. Simplified from
        three-way integration to ensure reliable performance.
      databases_used:
        - chembl
        - chebi
      complexity: advanced
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        
        SELECT DISTINCT ?drugName ?chebiLabel ?formula ?targetName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase 4 ;
                      cco:hasActivity/cco:hasAssay/cco:hasTarget ?target .
            ?target a cco:SingleProtein ;
                    rdfs:label ?targetName .
            ?targetName bif:contains "'kinase'" option (score ?sc)
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 10
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 6 (property path), 7 (OPTIONAL), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses prevent cross-contamination between databases
        - Strategy 2: Double pre-filtering: (a) developmentPhase = 4 for marketed drugs only (2.4M → ~8k), (b) kinase keyword filter with bif:contains (~8k → hundreds)
        - Strategy 4: bif:contains for efficient kinase target search with relevance scoring
        - Strategy 6: Property path cco:hasActivity/cco:hasAssay/cco:hasTarget optimized by preceding filters
        - Strategy 7: OPTIONAL for formula field as not all ChEBI entities have molecular data
        - Strategy 10: LIMIT 10 for focused result set
        - Performance: ~2-3 seconds for 10 results (Tier 1)
        - Performance tier: Tier 1 (1-3s) - aggressive pre-filtering enables fast execution despite property paths
        - Performance gain: Filtering on phase=4 (2.4M → ~8k) + kinase filter (~8k → hundreds) = >99.9% reduction before ChEBI join
        - Use case: Identify FDA-approved kinase inhibitors (e.g., Imatinib, Sorafenib, Sunitinib) with chemical structures for drug discovery
        - Referenced MIE files: chembl (for property paths, entity types, development phase filter), chebi (for namespace, OPTIONAL pattern)
        - Property path pattern verified from ChEMBL MIE file sparql_query_examples
        - bif:contains usage follows ChEMBL MIE file optimization recommendations
        - Simplified from three-way join to ensure reliable performance (three-way Reactome integration may timeout)

cross_references:
  - pattern: cco:moleculeXref
    description: |
      Molecules link to external databases via cco:moleculeXref using database-specific URI patterns.
    databases:
      chemical:
        - PubChem (2.2M+)
        - ZINC (1.2M+)
        - ChEBI (35k)
      drug:
        - DrugBank (8.4k)
        - FDA SRS (32k)
        - HMDB (12k)
      research:
        - LINCS (16k)
        - SureChEMBL (540k)
        - Wikipedia
    sparql: |
      SELECT ?molecule ?xref
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?molecule a cco:SmallMolecule ;
                  cco:moleculeXref ?xref .
        FILTER(STRSTARTS(STR(?xref), "http://www.drugbank.ca/"))
      } LIMIT 100
  
  - pattern: skos:exactMatch
    description: |
      Target components link to UniProt proteins for sequence and functional data.
    databases:
      protein:
        - UniProt (11k)
        - Ensembl
        - PDB (64k)
    sparql: |
      SELECT ?targetComponent ?uniprot
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?targetComponent a cco:TargetComponent ;
                         skos:exactMatch ?uniprot .
        FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/"))
      } LIMIT 100
  
  - pattern: cco:hasMesh / cco:hasEFO
    description: |
      Drug indications link to MeSH and EFO disease ontologies.
    databases:
      disease:
        - MeSH (51k indications)
        - EFO (subset)
    sparql: |
      SELECT ?indication ?mesh ?meshHeading ?efo
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?indication a cco:DrugIndication ;
                    cco:hasMesh ?mesh ;
                    cco:hasMeshHeading ?meshHeading .
        OPTIONAL { ?indication cco:hasEFO ?efo }
      } LIMIT 100
  
  - pattern: bibo:pmid
    description: |
      Documents link to PubMed for literature tracking.
    databases:
      literature:
        - PubMed (88k docs)
        - DOI
    sparql: |
      SELECT ?document ?pmid ?doi
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?document a cco:Document ;
                  bibo:pmid ?pmid .
        OPTIONAL { ?document bibo:doi ?doi }
      } LIMIT 100
  
  - pattern: cco:taxonomy
    description: |
      NCBI Taxonomy links for organism information on targets, assays, and cell lines.
    databases:
      taxonomy:
        - NCBI Taxonomy
    sparql: |
      SELECT ?target ?organism ?taxonomy
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?target a cco:SingleProtein ;
                cco:organismName ?organism ;
                cco:taxonomy ?taxonomy .
      } LIMIT 100

architectural_notes:
  schema_design:
    - Molecule-Activity-Assay-Target core model for bioactivity measurements
    - TargetComponent bridges Targets to UniProt identifiers
    - Drug mechanisms separate molecular interactions from bioactivities
    - Hierarchical protein classification using SKOS
  performance:
    - Always specify FROM graph clause
    - Use bif:contains for keyword searches (faster than FILTER/REGEX)
    - Boolean operators in bif:contains work efficiently (AND, OR, NOT)
    - Filter on development phase, assay type, or activity type well-indexed
    - Start with specific target types (cco:SingleProtein)
    - "Cross-database query optimization: Use explicit GRAPH clauses (Strategy 1)"
    - "Pre-filter within GRAPH blocks before joins (Strategy 2) - 10-100x speedup"
    - "Use bif:contains for text search (Strategy 4) - enables relevance ranking"
    - "Optimize property paths (Strategy 6) - apply filters before path traversal"
  data_integration:
    - UniProt mappings via TargetComponent for protein data
    - PubChem/DrugBank/ChEBI for chemical structure enrichment
    - MeSH/EFO for disease ontology queries
    - NCBI Taxonomy for organism-specific filtering
    - Cross-database queries with co-located databases (ChEBI, Reactome) on EBI endpoint
    - ChEBI integration via skos:exactMatch for chemical ontology
    - Reactome integration via UniProt bridge for pathway context
    - "Expected performance: Tier 1 (1-3s) for ChEBI joins with pre-filtering, Tier 2 (3-8s) for Reactome joins with property paths"
  data_quality:
    - Not all molecules have chemical descriptors
    - Activity values may lack units - always check cco:standardUnits
    - Some targets lack UniProt mappings (non-human organisms)
    - Development phase most complete for marketed drugs

data_statistics:
  total_molecules: 2400000
  total_activities: 20000000
  total_assays: 1600000
  total_targets: 13000
  coverage:
    molecules_with_activities: "~80%"
    targets_with_uniprot: "~85%"
    activities_with_standard_values: "~70%"
    molecules_with_pubchem: "~90%"
  cardinality:
    avg_activities_per_molecule: 8.5
    avg_assays_per_target: 120
    avg_xrefs_per_molecule: 4.2
  performance_characteristics:
    - "Simple lookups: <1s for 100 results"
    - "Activity queries with filters: 2-5s"
    - "bif:contains keyword search: very fast"
    - "Cross-database queries (ChEBI): 1-2s (Tier 1)"
    - "Cross-database queries (Reactome): 3-5s (Tier 2)"
    - "Optimization gain: Pre-filtering reduces join size by 99.5%"

anti_patterns:
  - title: FILTER/REGEX vs bif:contains
    problem: FILTER/REGEX is slow and not optimized for large text searches.
    wrong_sparql: |
      SELECT ?molecule ?label
      WHERE {
        ?molecule a cco:SmallMolecule ;
                  rdfs:label ?label .
        FILTER(REGEX(?label, "kinase", "i"))
      }
    correct_sparql: |
      SELECT ?molecule ?label ?sc
      WHERE {
        ?molecule a cco:SmallMolecule ;
                  rdfs:label ?label .
        ?label bif:contains "'kinase'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
    explanation: "Use bif:contains for Virtuoso-optimized full-text search with relevance ranking and Boolean operators (Strategy 4)."
  
  - title: Forgetting Activity Units
    problem: Comparing activity values without checking units leads to incorrect conclusions.
    wrong_sparql: |
      SELECT ?molecule ?value
      WHERE {
        ?activity cco:hasMolecule ?molecule ;
                  cco:standardValue ?value .
        FILTER(xsd:decimal(?value) < 100)
      }
    correct_sparql: |
      SELECT ?molecule ?value ?units
      WHERE {
        ?activity cco:hasMolecule ?molecule ;
                  cco:standardValue ?value ;
                  cco:standardUnits ?units .
        FILTER(xsd:decimal(?value) < 100 && ?units = "nM")
      }
    explanation: Always filter by cco:standardUnits when comparing activity values (nM, uM, %, etc.).
  
  - title: Cross-Database Query Without Pre-Filtering (Strategy 2)
    problem: Filtering after join causes timeout by processing millions of intermediate results.
    wrong_sparql: |
      # BAD: Filter after join
      WHERE {
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?molecule a cco:SmallMolecule ;
                    skos:exactMatch ?chebiId ;
                    cco:highestDevelopmentPhase ?phase .
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
          ?chebiId a owl:Class ;
                   rdfs:label ?label .
        }
        FILTER(?phase >= 3)  # Too late!
      }
    correct_sparql: |
      # GOOD: Filter before join (Strategy 2)
      WHERE {
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?molecule a cco:SmallMolecule ;
                    skos:exactMatch ?chebiId ;
                    cco:highestDevelopmentPhase ?phase .
          FILTER(?phase >= 3)  # Early filtering!
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
          ?chebiId a owl:Class ;
                   rdfs:label ?label .
        }
      }
    explanation: "Pre-filtering in source database (Strategy 2) reduces intermediate results by 99.5% (2.4M → ~10k) before cross-database join, improving performance from timeout to 1-2 seconds"

common_errors:
  - error: Query timeout
    causes:
      - Missing FROM clause or GRAPH specification
      - Using FILTER/REGEX instead of bif:contains
      - Missing LIMIT clause
    solutions:
      - Always include FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      - Use bif:contains for text searches
      - Add type constraints before text filtering
      - Use LIMIT appropriately (100-10000)
  
  - error: Empty results for cross-references
    causes:
      - Incorrect URI pattern for external database
      - Querying wrong entity type
    solutions:
      - Check sample data for exact URI patterns
      - Use STRSTARTS for URI matching
      - Verify entity type supports cross-reference property
      - Use OPTIONAL for cross-references that may not exist
  
  - error: Incorrect activity comparisons
    causes:
      - Comparing without checking standardType
      - Missing units check (mixing nM and uM)
      - Not handling NULL values
    solutions:
      - Always filter by cco:standardType (IC50, EC50, Ki)
      - Include cco:standardUnits in WHERE and filter
      - Use OPTIONAL with FILTER for numeric values
      - Consider cco:pChembl for normalized comparison
  
  - error: Cross-database query timeout or empty results
    causes:
      - Missing ^^xsd:string type restriction for Reactome bp:db comparisons
      - Incorrect graph URIs from co-located databases
      - Missing pre-filtering (Strategy 2) - processing millions of rows
      - Property path + bif:contains incompatibility (Strategy 4)
    solutions:
      - Always use ^^xsd:string for bp:db comparisons in Reactome queries (Strategy 9)
      - Verify graph URIs match schema_info.graphs in co-database MIE files
      - Apply restrictive FILTER within source GRAPH clause before join (Strategy 2)
      - Use CONTAINS for UniProt ID matching due to different URI formats
      - Split property paths when using bif:contains (Strategy 4)
      - Add LIMIT to every query level (Strategy 10)
    example_fix: |
      # BEFORE (times out):
      WHERE {
        GRAPH <chembl> { ?mol skos:exactMatch ?chebi }
        GRAPH <chebi> { ?chebi rdfs:label ?label }
        FILTER(?phase >= 3)
      }
      
      # AFTER (completes in 1-2s):
      WHERE {
        GRAPH <chembl> {
          ?mol skos:exactMatch ?chebi ;
               cco:highestDevelopmentPhase ?phase .
          FILTER(?phase >= 3)  # Early filter!
        }
        GRAPH <chebi> { ?chebi rdfs:label ?label }
      }
      LIMIT 100
