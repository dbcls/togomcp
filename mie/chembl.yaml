schema_info:
  title: ChEMBL RDF
  description: |
    Manually curated database of bioactive molecules with drug-like properties containing 1.9M compounds, 1.7M assays, 21M bioactivity measurements, and comprehensive drug development data. 
    Major entities include small molecules, proteins, targets, assays, activities, documents, drug mechanisms, and drug indications. 
    Enables queries for compound-target-activity relationships, mechanism of action, drug repositioning, and pharmaceutical research.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://rdf.ebi.ac.uk/resource/chembl/
  graphs:
    - http://rdf.ebi.ac.uk/dataset/chembl
  kw_search_tools:
    - search_chembl_molecule
    - search_chembl_target
    - search_mesh_descriptor
  version:
    mie_version: "2.2"
    mie_created: "2025-02-09"
    data_version: "ChEMBL 33.0"
    update_frequency: "Quarterly"
  license:
    data_license: "CC BY-SA 3.0"
    license_url: "https://creativecommons.org/licenses/by-sa/3.0/"
  access:
    rate_limiting: "No strict limit, reasonable use expected"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso (supports bif:contains)"

shape_expressions: |
  PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
  PREFIX bibo: <http://purl.org/ontology/bibo/>
  
  <MoleculeShape> {
    a [ cco:SmallMolecule ] ;
    rdfs:label xsd:string ;
    skos:prefLabel xsd:string ;
    cco:chemblId xsd:string ;
    cco:highestDevelopmentPhase xsd:integer ? ;
    cco:atcClassification xsd:string * ;
    cco:substanceType xsd:string ;
    cco:hasActivity @<ActivityShape> * ;
    cco:hasDrugIndication @<DrugIndicationShape> * ;
    cco:hasMechanism @<DrugMechanismShape> * ;
    cco:moleculeXref IRI * ;
    skos:exactMatch IRI *
  }
  
  <ActivityShape> {
    a [ cco:Activity ] ;
    cco:chemblId xsd:string ;
    cco:standardType xsd:string ;
    cco:standardValue xsd:string ? ;
    cco:standardUnits xsd:string ? ;
    cco:pChembl xsd:string ? ;
    cco:hasMolecule @<MoleculeShape> ;
    cco:hasAssay @<AssayShape>
  }
  
  <AssayShape> {
    a [ cco:Assay ] ;
    cco:chemblId xsd:string ;
    cco:assayType xsd:string ;
    cco:organismName xsd:string * ;
    cco:hasTarget @<TargetShape>
  }
  
  <TargetShape> {
    a [ cco:SingleProtein cco:ProteinComplex cco:ProteinFamily ] ;
    rdfs:label xsd:string ;
    cco:chemblId xsd:string ;
    cco:targetType xsd:string ;
    cco:organismName xsd:string * ;
    cco:taxonomy IRI * ;
    cco:hasProteinClassification IRI * ;
    cco:hasTargetComponent @<TargetComponentShape> *
  }
  
  <TargetComponentShape> {
    a [ cco:TargetComponent ] ;
    cco:chemblId xsd:string ;
    skos:exactMatch IRI *
  }
  
  <ProteinClassificationShape> {
    a [ cco:ProteinClassification ] ;
    rdfs:label xsd:string ;
    rdfs:subClassOf IRI ?
  }
  
  <DrugMechanismShape> {
    a [ cco:Mechanism ] ;
    cco:mechanismActionType xsd:string ? ;
    cco:hasMolecule @<MoleculeShape> ;
    cco:hasTarget @<TargetShape> ?
  }
  
  <DrugIndicationShape> {
    a [ cco:DrugIndication ] ;
    cco:hasMolecule @<MoleculeShape> ;
    cco:hasMesh IRI ;
    cco:hasMeshHeading xsd:string ;
    cco:hasEFO IRI ? ;
    cco:hasEFOName xsd:string ? ;
    cco:highestDevelopmentPhase xsd:integer
  }

sample_rdf_entries:
  - title: Small Molecule with Drug Development
    description: Marketed drug with ATC classification, cross-references, and drug indications.
    rdf: |
      chembl_molecule:CHEMBL1004
        a cco:SmallMolecule ;
        rdfs:label "DOXYLAMINE" ;
        cco:chemblId "CHEMBL1004" ;
        cco:atcClassification "R06AA09" ;
        cco:highestDevelopmentPhase 4 ;
        cco:substanceType "Small molecule" ;
        cco:moleculeXref <http://www.drugbank.ca/drugs/DB00366> ;
        cco:moleculeXref <http://pubchem.ncbi.nlm.nih.gov/compound/3162> ;
        skos:exactMatch <http://purl.obolibrary.org/obo/CHEBI_51380> .

  - title: Bioactivity Measurement
    description: Ki binding measurement linking molecule, assay, and document.
    rdf: |
      chembl_activity:CHEMBL_ACT_1000385
        a cco:Activity ;
        cco:chemblId "CHEMBL_ACT_1000385" ;
        cco:standardType "Ki" ;
        cco:standardValue "16.7" ;
        cco:standardUnits "nM" ;
        cco:hasMolecule chembl_molecule:CHEMBL331696 ;
        cco:hasAssay chembl_assay:CHEMBL696974 .

  - title: Target with Protein Classification and Taxonomy
    description: Single protein target with organism taxonomy IRI, protein classification, and UniProt link.
    rdf: |
      chembl_target:CHEMBL1808
        a cco:SingleProtein ;
        rdfs:label "Angiotensin-converting enzyme" ;
        cco:chemblId "CHEMBL1808" ;
        cco:targetType "SINGLE PROTEIN" ;
        cco:organismName "Homo sapiens" ;
        cco:taxonomy <http://identifiers.org/taxonomy/9606> ;
        cco:hasProteinClassification <http://rdf.ebi.ac.uk/resource/chembl/protclass/CHEMBL_PC_6> ;
        cco:hasTargetComponent chembl_target_cmpt:CHEMBL_TC_1332 .
      
      chembl_target_cmpt:CHEMBL_TC_1332
        skos:exactMatch <http://purl.uniprot.org/uniprot/P12527> .

  - title: Drug Mechanism
    description: Inhibitor mechanism linking molecule and target.
    rdf: |
      chembl_drug_mechanism:CHEMBL_MEC_100
        a cco:Mechanism ;
        cco:mechanismActionType "INHIBITOR" ;
        cco:hasMolecule chembl_molecule:CHEMBL1200475 ;
        cco:hasTarget chembl_target:CHEMBL1806 .

  - title: Drug Indication with MeSH and EFO
    description: Clinical indication with MeSH disease descriptor IRI, EFO ontology reference, and development phase.
    rdf: |
      chembl_drug_indication:CHEMBL_IND_107436
        a cco:DrugIndication ;
        cco:hasMolecule chembl_molecule:CHEMBL491473 ;
        cco:hasMesh <http://identifiers.org/mesh/D008545> ;
        cco:hasMeshHeading "Melanoma" ;
        cco:hasEFO <http://www.ebi.ac.uk/efo/EFO_0000756> ;
        cco:hasEFOName "melanoma" ;
        cco:highestDevelopmentPhase 1 .

sparql_query_examples:
  - title: Get Human Protein Kinases Using Specific Classification IRI
    description: Find human protein kinase targets using specific protein classification IRI and taxonomy IRI. Demonstrates proper use of structured IRIs instead of text search.
    question: How many human protein kinase targets are in ChEMBL?
    complexity: basic
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use specific IRIs: CHEMBL_PC_1100 for protein kinase, 9606 for human
      SELECT ?target ?label (COUNT(DISTINCT ?assay) as ?assayCount)
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?target a cco:SingleProtein ;
                rdfs:label ?label ;
                cco:hasProteinClassification <http://rdf.ebi.ac.uk/resource/chembl/protclass/CHEMBL_PC_1100> ;
                cco:taxonomy <http://identifiers.org/taxonomy/9606> .
        OPTIONAL { ?assay cco:hasTarget ?target }
      }
      GROUP BY ?target ?label
      ORDER BY DESC(?assayCount)
      LIMIT 50

  - title: Find IC50 Activities for Multiple Targets Using VALUES
    description: Retrieve IC50 measurements for specific targets. Uses VALUES with target IRIs and typed predicate (cco:standardType).
    question: What are IC50 measurements for EGFR and VEGFR2?
    complexity: basic
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use VALUES with specific target IRIs and typed predicate
      SELECT ?targetLabel ?molecule ?moleculeLabel ?value ?units
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        VALUES ?target {
          <http://rdf.ebi.ac.uk/resource/chembl/target/CHEMBL203>  # EGFR
          <http://rdf.ebi.ac.uk/resource/chembl/target/CHEMBL279>  # VEGFR2
        }
        ?target rdfs:label ?targetLabel .
        ?activity a cco:Activity ;
                  cco:standardType "IC50" ;
                  cco:standardValue ?value ;
                  cco:standardUnits ?units ;
                  cco:hasMolecule ?molecule ;
                  cco:hasAssay/cco:hasTarget ?target .
        ?molecule rdfs:label ?moleculeLabel .
        FILTER(xsd:decimal(?value) < 100)
      }
      ORDER BY ?targetLabel xsd:decimal(?value)
      LIMIT 100

  - title: Get Binding Assays by Assay Type Predicate
    description: Find binding assays for human targets using typed predicates. Demonstrates filtering by assay type and organism without text search.
    question: What are binding assays against human targets?
    complexity: intermediate
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use typed predicates: cco:assayType, cco:organismName
      SELECT ?assay ?target ?targetLabel (COUNT(?activity) as ?activityCount)
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?assay a cco:Assay ;
               cco:assayType "Binding" ;
               cco:hasTarget ?target ;
               cco:organismName "Homo sapiens" .
        ?target a cco:SingleProtein ;
                rdfs:label ?targetLabel .
        OPTIONAL { ?activity cco:hasAssay ?assay }
      }
      GROUP BY ?assay ?target ?targetLabel
      ORDER BY DESC(?activityCount)
      LIMIT 100

  - title: Find Drugs for Specific Diseases Using MeSH Descriptor IRIs
    description: Query approved and late-stage drugs for specific cancers using MeSH descriptor IRIs. Demonstrates integration with MeSH disease ontology using specific IRIs instead of text search on disease names.
    question: What are approved drugs for melanoma, lung cancer, and breast cancer?
    complexity: intermediate
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use specific MeSH descriptor IRIs (find via search_mesh_descriptor or exploratory query)
      SELECT DISTINCT ?molecule ?moleculeLabel ?meshHeading ?phase
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        VALUES ?mesh {
          <http://identifiers.org/mesh/D008545>  # Melanoma
          <http://identifiers.org/mesh/D002289>  # Carcinoma, Non-Small-Cell Lung
          <http://identifiers.org/mesh/D001943>  # Breast Neoplasms
        }
        ?indication a cco:DrugIndication ;
                    cco:hasMesh ?mesh ;
                    cco:hasMeshHeading ?meshHeading ;
                    cco:highestDevelopmentPhase ?phase ;
                    cco:hasMolecule ?molecule .
        ?molecule rdfs:label ?moleculeLabel .
        FILTER(?phase >= 3)
      }
      ORDER BY ?meshHeading DESC(?phase)
      LIMIT 100

  - title: Find Activities by Specific Molecule IRI
    description: Retrieve all bioactivity measurements for a specific molecule using its IRI. Shows comprehensive activity profile with assay and target information.
    question: What are all bioactivities for aspirin (CHEMBL25)?
    complexity: intermediate
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use specific molecule IRI
      SELECT ?activity ?standardType ?value ?units ?target ?targetLabel
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?activity a cco:Activity ;
                  cco:hasMolecule <http://rdf.ebi.ac.uk/resource/chembl/molecule/CHEMBL25> ;
                  cco:standardType ?standardType ;
                  cco:hasAssay/cco:hasTarget ?target .
        ?target rdfs:label ?targetLabel .
        OPTIONAL { ?activity cco:standardValue ?value }
        OPTIONAL { ?activity cco:standardUnits ?units }
      }
      ORDER BY ?standardType xsd:decimal(?value)
      LIMIT 100

  - title: Mechanism of Action for Approved Drugs
    description: Analyze drug mechanisms with target information for marketed drugs. Uses typed predicates and filtering for comprehensive mechanism analysis.
    question: What are inhibitor mechanisms for FDA-approved drugs?
    complexity: advanced
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use typed predicates: phase, mechanismActionType, targetType, organismName
      SELECT ?molecule ?moleculeLabel ?target ?targetLabel ?mechanismType ?phase
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?mechanism a cco:Mechanism ;
                   cco:mechanismActionType ?mechanismType ;
                   cco:hasMolecule ?molecule ;
                   cco:hasTarget ?target .
        ?molecule rdfs:label ?moleculeLabel ;
                  cco:highestDevelopmentPhase ?phase .
        ?target rdfs:label ?targetLabel ;
                cco:targetType "SINGLE PROTEIN" ;
                cco:organismName "Homo sapiens" .
        FILTER(?phase = 4)
        FILTER(CONTAINS(?mechanismType, "INHIBITOR"))
      }
      ORDER BY ?moleculeLabel
      LIMIT 100

  - title: Alzheimer's Disease Drug Targets and Mechanisms
    description: Complex query integrating drug indications (via MeSH IRI), mechanisms of action, and target information for Alzheimer's disease therapeutics. Demonstrates advanced multi-entity integration using structured IRIs throughout.
    question: What are the mechanisms and targets of drugs in development for Alzheimer's disease?
    complexity: advanced
    sparql: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      
      # Use specific MeSH IRI for Alzheimer's disease (D000544)
      SELECT DISTINCT ?molecule ?moleculeLabel ?target ?targetLabel ?mechanismType ?phase
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?indication a cco:DrugIndication ;
                    cco:hasMesh <http://identifiers.org/mesh/D000544> ;
                    cco:highestDevelopmentPhase ?phase ;
                    cco:hasMolecule ?molecule .
        ?molecule rdfs:label ?moleculeLabel .
        
        # Link to mechanisms and targets
        OPTIONAL {
          ?mechanism a cco:Mechanism ;
                     cco:hasMolecule ?molecule ;
                     cco:mechanismActionType ?mechanismType ;
                     cco:hasTarget ?target .
          ?target a cco:SingleProtein ;
                  rdfs:label ?targetLabel ;
                  cco:organismName "Homo sapiens" .
        }
        
        FILTER(?phase >= 2)
      }
      ORDER BY DESC(?phase) ?moleculeLabel
      LIMIT 100

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chebi
    - reactome
    - ensembl
    - amrportal
  examples:
    - title: Integrate ChEMBL Drugs with ChEBI Chemical Structure Data
      description: |
        Link ChEMBL drug molecules to ChEBI chemical entities to enrich drug data with comprehensive chemical ontology information including molecular formulas, mass, InChI keys, and hierarchical classification. 
        ChEMBL molecules reference ChEBI via skos:exactMatch, enabling seamless two-way integration.
      databases_used:
        - chembl
        - chebi
      complexity: intermediate
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        
        SELECT DISTINCT ?moleculeLabel ?chebiLabel ?formula ?mass ?developmentPhase
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?moleculeLabel ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase ?developmentPhase .
            FILTER(?developmentPhase >= 3)
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
            OPTIONAL { ?chebiId chebi:mass ?mass }
          }
        }
        ORDER BY DESC(?developmentPhase)
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter phase≥3), 7 (OPTIONAL), 10 (LIMIT)
        - Pre-filtering reduces 1.9M→~10k molecules (99.5% reduction) before join
        - Performance: ~1-2s (Tier 1)
        - Use case: Identify marketed/late-stage drugs with ChEBI ontology data
        - MIE refs: chembl (graph, skos:exactMatch), chebi (graph, namespace)

    - title: Link ChEMBL Drug Targets to Reactome Biological Pathways
      description: |
        Connect ChEMBL drug targets to Reactome biological pathways to understand drug mechanism of action in systems biology context. 
        ChEMBL targets link to UniProt, which Reactome also references through bp:xref with bp:db="UniProt"^^xsd:string, enabling protein-centric integration.
      databases_used:
        - chembl
        - reactome
      complexity: advanced
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?drugName ?targetName ?pathwayName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      cco:highestDevelopmentPhase ?phase ;
                      cco:hasActivity/cco:hasAssay/cco:hasTarget ?target .
            ?target a cco:SingleProtein ;
                    rdfs:label ?targetName ;
                    cco:organismName "Homo sapiens" ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprotId .
            FILTER(?phase >= 3)
            FILTER(STRSTARTS(STR(?uniprotId), "http://purl.uniprot.org/uniprot/"))
            FILTER(?drugName = "ASPIRIN")
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            ?protein a bp:Protein ;
                     bp:entityReference/bp:xref ?protXref .
            ?protXref a bp:UnificationXref ;
                      bp:db "UniProt"^^xsd:string ;
                      bp:id ?uniprotIdStr .
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:pathwayComponent/bp:left|bp:right ?protein .
            FILTER(CONTAINS(STR(?uniprotId), ?uniprotIdStr))
          }
        }
        LIMIT 20
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 6 (property path), 9 (^^xsd:string), 10 (LIMIT)
        - Pre-filter on drug name reduces molecular search before cross-database join
        - ^^xsd:string CRITICAL for bp:db (from Reactome MIE anti-patterns)
        - Performance: ~3-5s (Tier 2) - property paths add overhead
        - Use case: Drug target validation and mechanism of action in pathway context
        - MIE refs: chembl (property paths, entity types), reactome (^^xsd:string, UnificationXref)

    - title: Marketed Kinase Inhibitors with ChEBI Chemical Ontology
      description: |
        Link ChEMBL marketed drugs targeting kinase proteins to ChEBI chemical structure data. 
        Demonstrates pharmaceutical research use case with optimized performance through pre-filtering on development phase and protein classification IRI.
      databases_used:
        - chembl
        - chebi
      complexity: advanced
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        
        SELECT DISTINCT ?drugName ?chebiLabel ?formula ?targetName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase 4 ;
                      cco:hasActivity/cco:hasAssay/cco:hasTarget ?target .
            ?target a cco:SingleProtein ;
                    rdfs:label ?targetName ;
                    cco:hasProteinClassification <http://rdf.ebi.ac.uk/resource/chembl/protclass/CHEMBL_PC_1100> .
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
          }
        }
        ORDER BY ?drugName
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (double pre-filter with IRI), 6 (property path), 7 (OPTIONAL), 10 (LIMIT)
        - Double filter: phase=4 (1.9M→~8k) + kinase IRI (~8k→hundreds) = >99.9% reduction
        - Performance: ~2-3s (Tier 1) - aggressive filtering enables fast execution
        - Use case: Find FDA-approved kinase inhibitors (Imatinib, Sorafenib, etc.)
        - Uses protein classification IRI instead of text search
        - MIE refs: chembl (property paths, phase filter, classification IRI), chebi (namespace, OPTIONAL)

cross_references:
  - pattern: cco:moleculeXref
    description: |
      Molecules link to external databases via cco:moleculeXref using database-specific URI patterns.
    databases:
      chemical:
        - "PubChem (2.2M+)"
        - "ZINC (1.2M+)"
        - "ChEBI (35k)"
      drug:
        - "DrugBank (8.4k)"
        - "FDA SRS (32k)"
        - "HMDB (12k)"
      research:
        - "LINCS (16k)"
        - "SureChEMBL (540k)"
        - "Wikipedia"
    sparql: |
      SELECT ?molecule ?xref
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?molecule a cco:SmallMolecule ;
                  cco:moleculeXref ?xref .
        FILTER(STRSTARTS(STR(?xref), "http://www.drugbank.ca/"))
      } LIMIT 100

  - pattern: skos:exactMatch
    description: |
      Target components link to UniProt proteins for sequence and functional data.
    databases:
      protein:
        - "UniProt (11k)"
        - "Ensembl"
        - "PDB (64k)"
    sparql: |
      SELECT ?targetComponent ?uniprot
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?targetComponent a cco:TargetComponent ;
                         skos:exactMatch ?uniprot .
        FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/"))
      } LIMIT 100

  - pattern: cco:taxonomy
    description: |
      NCBI Taxonomy IRIs link targets, assays, and cell lines to organism information. Two IRI formats are used: identifiers.org and NCBI browser URLs.
    databases:
      taxonomy:
        - "NCBI Taxonomy"
    sparql: |
      SELECT ?target ?organism ?taxonomy
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?target a cco:SingleProtein ;
                cco:organismName ?organism ;
                cco:taxonomy ?taxonomy .
        FILTER(STRSTARTS(STR(?taxonomy), "http://identifiers.org/taxonomy/"))
      } LIMIT 100

  - pattern: cco:hasMesh / cco:hasEFO
    description: |
      Drug indications link to MeSH disease descriptors and EFO ontology terms via specific IRIs. 
      All 55,442 drug indications include MeSH descriptor IRIs in the format http://identifiers.org/mesh/[ID] (e.g., D008545 for Melanoma, D000544 for Alzheimer's Disease).
      This enables precise disease-based queries using MeSH's controlled vocabulary instead of free-text disease name search.
      Use exploratory query or external MeSH browser to find descriptor IRIs, then query with specific IRIs for comprehensive disease-drug relationships.
    databases:
      disease:
        - "MeSH descriptors (55k indications, 100% coverage)"
        - "EFO ontology terms (55k indications, 99.7% coverage)"
    sparql: |
      SELECT ?indication ?mesh ?meshHeading ?efo ?efoName ?phase
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?indication a cco:DrugIndication ;
                    cco:hasMesh ?mesh ;
                    cco:hasMeshHeading ?meshHeading ;
                    cco:highestDevelopmentPhase ?phase .
        OPTIONAL { 
          ?indication cco:hasEFO ?efo ;
                      cco:hasEFOName ?efoName 
        }
        # Example: Filter by specific MeSH descriptor IRIs
        FILTER(?mesh IN (
          <http://identifiers.org/mesh/D008545>,  # Melanoma
          <http://identifiers.org/mesh/D000544>   # Alzheimer's Disease
        ))
      } LIMIT 100

  - pattern: bibo:pmid
    description: |
      Documents link to PubMed for literature tracking and citation management.
    databases:
      literature:
        - "PubMed (88k docs)"
        - "DOI"
    sparql: |
      SELECT ?document ?pmid ?doi
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE {
        ?document a cco:Document ;
                  bibo:pmid ?pmid .
        OPTIONAL { ?document bibo:doi ?doi }
      } LIMIT 100

architectural_notes:
  query_strategy:
    - "Exploratory: Use search_chembl_molecule() and search_chembl_target() to find examples (20-100 results)"
    - "MeSH IRIs: Use exploratory SPARQL to find disease descriptor IRIs (FILTER(CONTAINS(LCASE(?meshHeading), 'disease_term')))"
    - "Extract structured data: From examples, identify protein classification IRIs (CHEMBL_PC_*), taxonomy IRIs (9606 for human), MeSH IRIs (D008545 for melanoma, D000544 for Alzheimer's), activity types (IC50, Ki), target types"
    - "Comprehensive: Use extracted IRIs in VALUES or direct predicates for complete dataset queries"
    - "Protein classification: Use cco:hasProteinClassification with specific IRIs (e.g., CHEMBL_PC_1100 for protein kinase)"
    - "Organism filtering: Use cco:taxonomy with specific IRIs (e.g., http://identifiers.org/taxonomy/9606 for human)"
    - "Disease filtering: Use cco:hasMesh with specific MeSH descriptor IRIs (e.g., http://identifiers.org/mesh/D008545 for melanoma)"
    - "Activity filtering: Use typed predicates cco:standardType (IC50, Ki, EC50, etc.) and cco:standardUnits (nM, uM)"
    - "Text search: Use bif:contains ONLY for genuinely unstructured text (comments) when no structured alternative exists (extremely rare)"
    - "Priority: Specific IRIs > VALUES with IRIs > Typed predicates > Graph navigation > bif:contains > NEVER use FILTER(CONTAINS())"
  
  schema_design:
    - "Molecule-Activity-Assay-Target core model for bioactivity measurements"
    - "TargetComponent bridges Targets to UniProt identifiers"
    - "Hierarchical protein classification using cco:ProteinClassification with rdfs:subClassOf"
    - "Taxonomy IRIs link to NCBI Taxonomy (two formats: identifiers.org and NCBI browser)"
    - "MeSH descriptor IRIs link drug indications to controlled disease vocabulary (100% coverage)"
    - "EFO ontology IRIs provide additional disease classification (99.7% coverage)"
    - "Drug mechanisms separate molecular interactions from bioactivities"
    - "Development phases (0-4) track drug approval status"
    - "CRITICAL: Use protein classification IRIs instead of text search on labels"
    - "CRITICAL: Use MeSH descriptor IRIs instead of text search on disease names"
  
  performance:
    - "Always specify FROM graph clause"
    - "Use specific IRIs for fast lookups (protein classifications, taxonomy, MeSH descriptors, etc.)"
    - "Use bif:contains for keyword searches in unstructured text (faster than FILTER/REGEX, but avoid when IRIs available)"
    - "Boolean operators in bif:contains work efficiently (AND, OR, NOT)"
    - "Filter on development phase, assay type, or activity type (well-indexed)"
    - "MeSH IRI filters are fast and precise (100% coverage on indications)"
    - "Start with specific target types (cco:SingleProtein) before expanding"
    - "Cross-DB: GRAPH clauses (Strategy 1), pre-filter (Strategy 2), IRIs over text (Strategy 4)"
  
  data_integration:
    - "UniProt mappings via TargetComponent for protein data"
    - "PubChem/DrugBank/ChEBI for chemical structure enrichment via skos:exactMatch"
    - "MeSH descriptor IRIs for precise disease-based drug queries (55k indications, 100% coverage)"
    - "EFO ontology for additional disease classification (99.7% coverage)"
    - "NCBI Taxonomy IRIs for organism-specific filtering (prefer over text search)"
    - "Protein classification IRIs for protein family queries (prefer over text search)"
    - "Cross-database queries with ChEBI (Tier 1, 1-3s) and Reactome (Tier 2, 3-8s) on EBI endpoint"
  
  data_quality:
    - "Not all molecules have chemical descriptors"
    - "Activity values may lack units - always check cco:standardUnits"
    - "Some targets lack UniProt mappings (non-human organisms)"
    - "Development phase most complete for marketed drugs"
    - "Protein classification available for ~36% of targets (~34k of 9.4k single proteins)"
    - "Taxonomy IRIs exist in two formats - check both"
    - "MeSH descriptors: 100% coverage (55,442/55,442 indications)"
    - "EFO terms: 99.7% coverage (55,271/55,442 indications)"

data_statistics:
  total_molecules: 1920809
  verified_date: "2025-02-09"
  verification_query: |
    PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
    SELECT (COUNT(DISTINCT ?molecule) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/chembl>
    WHERE { ?molecule a cco:SmallMolecule . }
  
  total_activities: 21123501
  total_assays: 1740546
  total_targets: 10454
  total_documents: 92120
  total_mechanisms: 7330
  total_indications: 55442
  
  human_protein_kinases: 423
  human_protein_kinases_verified_date: "2025-02-09"
  human_protein_kinases_verification_query: |
    PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
    SELECT (COUNT(DISTINCT ?target) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/chembl>
    WHERE {
      ?target a cco:SingleProtein ;
              cco:hasProteinClassification <http://rdf.ebi.ac.uk/resource/chembl/protclass/CHEMBL_PC_1100> ;
              cco:organismName "Homo sapiens" .
    }
  
  alzheimers_drug_indications: 290
  alzheimers_verified_date: "2025-02-09"
  alzheimers_mesh_iri: "http://identifiers.org/mesh/D000544"
  alzheimers_verification_query: |
    PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
    SELECT (COUNT(?indication) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/chembl>
    WHERE {
      ?indication a cco:DrugIndication ;
                  cco:hasMesh <http://identifiers.org/mesh/D000544> .
    }
  
  coverage:
    targets_with_uniprot: "100%"
    verified_date: "2025-02-09"
    scope: "Single protein targets with target component links"
    
    activities_with_standard_values: "92.4%"
    calculation: "19,519,773 / 21,123,501"
    verification_query: |
      PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
      SELECT (COUNT(?activity) as ?with_value)
      FROM <http://rdf.ebi.ac.uk/dataset/chembl>
      WHERE { ?activity a cco:Activity ; cco:standardValue ?value . }
    
    targets_with_protein_classification: "~36%"
    calculation: "34,256 classifications / ~9,432 single proteins"
    scope: "Many targets have multiple classification levels"
    
    indications_with_mesh: "100%"
    calculation: "55,442 / 55,442"
    verified_date: "2025-02-09"
    
    indications_with_efo: "99.7%"
    calculation: "55,271 / 55,442"
    verified_date: "2025-02-09"
  
  performance_characteristics:
    - "Simple lookups by IRI: <1s for 100 results"
    - "Activity queries with typed predicate filters: 1-3s"
    - "Protein classification IRI queries: 1-2s"
    - "MeSH descriptor IRI queries: 1-2s"
    - "Cross-DB queries (ChEBI): 1-3s (Tier 1) with pre-filtering"
    - "Cross-DB queries (Reactome): 3-8s (Tier 2) with property paths"
    - "Optimization gain: Pre-filtering + IRIs reduce join size by 99.5%"
  
  staleness_warning: "Quarterly updates - verify data freshness for time-sensitive research"

anti_patterns:
  - title: "Text Search When Protein Classification IRI Exists"
    problem: "Using bif:contains to search target labels for 'kinase' when specific protein classification IRIs exist."
    wrong_sparql: |
      # Slow: Text search through target labels
      SELECT ?target ?label
      WHERE {
        ?target a cco:SingleProtein ;
                rdfs:label ?label .
        ?label bif:contains "'kinase'"
      }
    correct_sparql: |
      # Fast: Use specific protein classification IRI
      SELECT ?target ?label
      WHERE {
        ?target a cco:SingleProtein ;
                rdfs:label ?label ;
                cco:hasProteinClassification <http://rdf.ebi.ac.uk/resource/chembl/protclass/CHEMBL_PC_1100> .
      }
    explanation: "Use search_chembl_target() to find examples, inspect to find CHEMBL_PC_1100, then query ALL kinases with that IRI. Text search is slower and less precise."
  
  - title: "Text Search When MeSH Descriptor IRI Exists"
    problem: "Using text search on disease names when specific MeSH descriptor IRIs are available."
    wrong_sparql: |
      # Slow and imprecise: Text search on disease names
      SELECT ?molecule ?disease
      WHERE {
        ?indication cco:hasMeshHeading ?disease ;
                    cco:hasMolecule ?molecule .
        FILTER(CONTAINS(LCASE(?disease), "alzheimer"))
      }
    correct_sparql: |
      # Fast and precise: Use specific MeSH descriptor IRI
      SELECT ?molecule ?disease
      WHERE {
        ?indication cco:hasMesh <http://identifiers.org/mesh/D000544> ;
                    cco:hasMeshHeading ?disease ;
                    cco:hasMolecule ?molecule .
      }
    explanation: "Use exploratory SPARQL to find MeSH IRI (D000544 for Alzheimer's disease), then query with specific IRI. 100% of indications have MeSH IRIs."
  
  - title: "Text Search When Taxonomy IRI Exists"
    problem: "Using text search on organism names when specific taxonomy IRIs are available."
    wrong_sparql: |
      # Slow: Text search on organism name
      SELECT ?target ?organism
      WHERE {
        ?target cco:organismName ?organism .
        FILTER(CONTAINS(?organism, "sapiens"))
      }
    correct_sparql: |
      # Fast: Use specific taxonomy IRI
      SELECT ?target ?organism
      WHERE {
        ?target cco:organismName ?organism ;
                cco:taxonomy <http://identifiers.org/taxonomy/9606> .
      }
    explanation: "Taxonomy IRIs (9606 for human, 10090 for mouse, etc.) provide fast, unambiguous organism filtering."
  
  - title: "Forgetting Activity Units"
    problem: "Comparing activity values without checking units leads to incorrect conclusions."
    wrong_sparql: |
      # WRONG: Mixing units
      SELECT ?molecule ?value
      WHERE {
        ?activity cco:hasMolecule ?molecule ;
                  cco:standardValue ?value .
        FILTER(xsd:decimal(?value) < 100)
      }
    correct_sparql: |
      # CORRECT: Filter by units
      SELECT ?molecule ?value ?units
      WHERE {
        ?activity cco:hasMolecule ?molecule ;
                  cco:standardValue ?value ;
                  cco:standardUnits ?units .
        FILTER(xsd:decimal(?value) < 100 && ?units = "nM")
      }
    explanation: "Always filter by cco:standardUnits when comparing activity values (nM, uM, %, etc.). Different units represent vastly different potencies."

common_errors:
  - error: "Query timeout"
    causes:
      - "Missing FROM clause or GRAPH specification"
      - "Using text search when specific IRIs available"
      - "Missing LIMIT clause"
    solutions:
      - "Always include FROM <http://rdf.ebi.ac.uk/dataset/chembl>"
      - "Use protein classification IRIs instead of text search on labels"
      - "Use MeSH descriptor IRIs instead of text search on disease names"
      - "Use taxonomy IRIs instead of text search on organism names"
      - "Add type constraints before filtering"
      - "Use LIMIT appropriately (100-10000)"
  
  - error: "Empty results for disease queries"
    causes:
      - "Using text search on disease names instead of MeSH IRIs"
      - "Incorrect MeSH descriptor IRI format"
    solutions:
      - "Use exploratory SPARQL with FILTER(CONTAINS(LCASE(?meshHeading), 'disease_name')) to find MeSH IRIs"
      - "Extract MeSH descriptor IRIs from examples (format: http://identifiers.org/mesh/[ID])"
      - "Query with cco:hasMesh and specific IRIs"
      - "100% of drug indications have MeSH descriptors"
  
  - error: "Empty results for protein queries"
    causes:
      - "Using text search instead of protein classification IRIs"
      - "Incorrect protein classification IRI"
    solutions:
      - "Use search_chembl_target() to find examples"
      - "Inspect examples to extract protein classification IRIs"
      - "Query with cco:hasProteinClassification and specific IRIs"
      - "Check CHEMBL_PC_* hierarchy (CHEMBL_PC_1100 for protein kinase, CHEMBL_PC_6 for kinase)"
  
  - error: "Empty results for cross-references"
    causes:
      - "Incorrect URI pattern for external database"
      - "Querying wrong entity type"
    solutions:
      - "Check sample data for exact URI patterns"
      - "Use STRSTARTS for URI matching"
      - "Verify entity type supports cross-reference property"
      - "Use OPTIONAL for cross-references that may not exist"
  
  - error: "Incorrect activity comparisons"
    causes:
      - "Comparing without checking standardType"
      - "Missing units check (mixing nM and uM)"
      - "Not handling NULL values"
    solutions:
      - "Always filter by cco:standardType (IC50, EC50, Ki)"
      - "Include cco:standardUnits in WHERE and filter"
      - "Use OPTIONAL with FILTER for numeric values"
      - "Consider cco:pChembl for normalized comparison"
  
  - error: "Cross-database query timeout or empty results"
    causes:
      - "Missing ^^xsd:string for Reactome bp:db comparisons"
      - "Incorrect graph URIs from co-located databases"
      - "Missing pre-filtering (Strategy 2)"
      - "Using text search instead of specific IRIs"
    solutions:
      - "Always use ^^xsd:string for Reactome bp:db (Strategy 9)"
      - "Verify graph URIs from co-database MIE files"
      - "Apply FILTER within source GRAPH before join (Strategy 2)"
      - "Use protein classification IRIs instead of bif:contains"
      - "Use MeSH descriptor IRIs instead of text search"
      - "Use CONTAINS for UniProt ID matching (different URI formats)"
      - "Add LIMIT to every query level (Strategy 10)"
    example_fix: |
      # BEFORE (times out):
      WHERE {
        GRAPH <chembl> {
          ?indication cco:hasMolecule ?mol ;
                      cco:hasMeshHeading ?disease .
          FILTER(CONTAINS(?disease, "alzheimer"))  # SLOW
        }
        GRAPH <chebi> { ?mol skos:exactMatch ?chebi }
      }
      
      # AFTER (1-2s):
      WHERE {
        GRAPH <chembl> {
          ?indication cco:hasMesh <http://identifiers.org/mesh/D000544> ;  # Use MeSH IRI
                      cco:hasMolecule ?mol ;
                      cco:highestDevelopmentPhase ?phase .
          ?mol skos:exactMatch ?chebi .
          FILTER(?phase >= 3)  # Pre-filter
        }
        GRAPH <chebi> { ?chebi a owl:Class }
      }
      LIMIT 100
