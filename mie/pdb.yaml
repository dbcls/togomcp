schema_info:
  title: Protein Data Bank (PDB)
  description: |
    The PDB RDF database contains 3D structural data for biological macromolecules
    (proteins, nucleic acids, complexes) derived from X-ray crystallography, NMR,
    and cryo-EM. Contains 245K+ entries with experimental methods, structural
    coordinates, resolution data, sequences, biological assemblies, and cross-references
    to UniProt, EMDB, GenBank, and publications.
  endpoint: https://rdfportal.org/pdb/sparql
  base_uri: http://rdf.wwpdb.org/pdb/
  graphs:
    - http://rdfportal.org/dataset/pdbj
    - http://rdf.wwpdb.org/schema/pdbx-v50.owl
  kw_search_tools:
    - search_pdb_entity
  version:
    mie_version: "3.1"
    mie_created: "2025-02-10"
    data_version: "Current"
    update_frequency: "Weekly"
  license:
    data_license: "Public Domain (CC0)"
    license_url: "https://www.wwpdb.org/policy"
  access:
    rate_limiting: "Reasonable use"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  
  <Datablock> {
    a [ pdbx:datablock ] ;
    pdbx:has_entryCategory @<EntryCategory> ;
    pdbx:has_entityCategory @<EntityCategory> * ;
    pdbx:has_entity_polyCategory @<EntityPolyCategory> * ;
    pdbx:has_exptlCategory @<ExptlCategory> + ;
    pdbx:has_refineCategory @<RefineCategory> * ;
    pdbx:has_struct_refCategory @<StructRefCategory> * ;
    pdbx:has_database_2Category @<Database2Category> * ;
    pdbx:has_citationCategory @<CitationCategory> * ;
    pdbx:has_structCategory @<StructCategory> ;
    pdbx:has_struct_keywordsCategory @<StructKeywordsCategory> * ;
    pdbx:has_entity_src_genCategory @<EntitySrcGenCategory> * ;
    pdbx:has_softwareCategory @<SoftwareCategory> *
  }
  
  <Entry> {
    a [ pdbx:entry ] ;
    pdbx:entry.id xsd:string ;
    pdbx:of_datablock IRI
  }
  
  <Entity> {
    a [ pdbx:entity ] ;
    pdbx:entity.id xsd:string ;
    pdbx:entity.type [ "polymer" "non-polymer" "water" "branched" ] ;
    pdbx:entity.pdbx_description xsd:string ? ;
    pdbx:entity.formula_weight xsd:decimal ? ;
    pdbx:referenced_by_entity_poly IRI * ;
    pdbx:referenced_by_struct_ref IRI * ;
    pdbx:of_datablock IRI
  }
  
  <EntityPoly> {
    a [ pdbx:entity_poly ] ;
    pdbx:entity_poly.type xsd:string ;
    pdbx:entity_poly.pdbx_seq_one_letter_code xsd:string ? ;
    pdbx:reference_to_entity IRI ;
    pdbx:of_datablock IRI
  }
  
  <EntitySrcGen> {
    a [ pdbx:entity_src_gen ] ;
    pdbx:link_to_taxonomy_source IRI ? ;
    pdbx:entity_src_gen.pdbx_gene_src_scientific_name xsd:string ? ;
    pdbx:of_datablock IRI
  }
  
  <Exptl> {
    a [ pdbx:exptl ] ;
    pdbx:exptl.method xsd:string ;
    pdbx:reference_to_entry IRI ;
    pdbx:of_datablock IRI
  }
  
  <Refine> {
    a [ pdbx:refine ] ;
    pdbx:refine.ls_d_res_high xsd:decimal ? ;
    pdbx:refine.ls_R_factor_R_work xsd:decimal ? ;
    pdbx:refine.ls_R_factor_R_free xsd:decimal ? ;
    pdbx:reference_to_entry IRI ;
    pdbx:of_datablock IRI
  }
  
  <StructRef> {
    a [ pdbx:struct_ref ] ;
    pdbx:struct_ref.db_name xsd:string ;
    pdbx:struct_ref.pdbx_db_accession xsd:string ? ;
    pdbx:link_to_uniprot IRI ? ;
    pdbx:reference_to_entity IRI * ;
    pdbx:of_datablock IRI
  }
  
  <Software> {
    a [ pdbx:software ] ;
    pdbx:software.name xsd:string ;
    pdbx:software.classification xsd:string ;
    pdbx:of_datablock IRI
  }

sample_rdf_entries:
  - title: High-Resolution X-Ray Protein Structure
    description: Ultra-high resolution crambin structure with refinement statistics.
    rdf: |
      @prefix pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#> .
      @prefix pdb: <http://rdf.wwpdb.org/pdb/> .
      
      pdb:3NIR a pdbx:datablock ;
        pdbx:has_refineCategory pdb:3NIR/refineCategory .
      
      pdb:3NIR/refine/3NIR,X-RAY_DIFFRACTION a pdbx:refine ;
        pdbx:refine.ls_d_res_high "0.48"^^xsd:decimal ;
        pdbx:refine.ls_R_factor_R_work "0.127"^^xsd:decimal ;
        pdbx:refine.ls_R_factor_R_free "0.139"^^xsd:decimal .
  
  - title: Human Protein with Taxonomy IRI
    description: Human protein kinase linked to taxonomy ID 9606.
    rdf: |
      @prefix pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#> .
      @prefix pdb: <http://rdf.wwpdb.org/pdb/> .
      
      pdb:1ATP/entity_src_gen/1 a pdbx:entity_src_gen ;
        pdbx:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> ;
        pdbx:entity_src_gen.pdbx_gene_src_scientific_name "Homo sapiens" .
  
  - title: Protein with UniProt Cross-Reference
    description: Pyruvate kinase linked to UniProt P07378.
    rdf: |
      @prefix pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#> .
      @prefix pdb: <http://rdf.wwpdb.org/pdb/> .
      
      pdb:16PK/struct_ref/1 a pdbx:struct_ref ;
        pdbx:struct_ref.db_name "UNP" ;
        pdbx:struct_ref.pdbx_db_accession "P07378" ;
        pdbx:link_to_uniprot <http://purl.uniprot.org/uniprot/P07378> .
  
  - title: Cryo-EM Structure
    description: Electron microscopy structure using controlled method value.
    rdf: |
      @prefix pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#> .
      @prefix pdb: <http://rdf.wwpdb.org/pdb/> .
      
      pdb:8A2Z/exptl/1 a pdbx:exptl ;
        pdbx:exptl.method "ELECTRON MICROSCOPY" .
      
      pdb:8A2Z/database_2/1 a pdbx:database_2 ;
        pdbx:database_2.database_id "EMDB" ;
        pdbx:database_2.database_code "EMD-15109" .
  
  - title: Polymer Entity
    description: Protein polymer entity with controlled type value.
    rdf: |
      @prefix pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#> .
      @prefix pdb: <http://rdf.wwpdb.org/pdb/> .
      
      pdb:1ATP/entity/1 a pdbx:entity ;
        pdbx:entity.id "1" ;
        pdbx:entity.type "polymer" ;
        pdbx:entity.pdbx_description "cAMP-dependent protein kinase" ;
        pdbx:referenced_by_entity_poly pdb:1ATP/entity_poly/1 .

sparql_query_examples:
  - title: Find Structures by Specific Organism
    description: Query human structures using taxonomy IRI (not text search).
    question: How many human protein structures are in PDB?
    complexity: basic
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      # Use specific taxonomy IRI for human
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_entity_src_genCategory/pdbx:has_entity_src_gen ?src .
        ?src pdbx:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
      }
  
  - title: Query by Specific Experimental Method
    description: Use controlled method values instead of text search.
    question: Find cryo-EM structures with EMDB links
    complexity: basic
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      # Use specific experimental method value
      SELECT ?entry_id ?emdb_code
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        
        # Controlled method value - no text search needed
        ?entry pdbx:has_exptlCategory/pdbx:has_exptl/pdbx:exptl.method "ELECTRON MICROSCOPY" ;
               pdbx:has_database_2Category/pdbx:has_database_2 ?db .
        
        ?db pdbx:database_2.database_id "EMDB" ;
            pdbx:database_2.database_code ?emdb_code .
      }
      LIMIT 20
  
  - title: Compare Multiple Experimental Methods
    description: Use VALUES with specific method strings for efficient multi-method queries.
    question: What is the resolution distribution across X-ray, NMR, and cryo-EM?
    complexity: intermediate
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Use VALUES with specific controlled method values
      SELECT ?method 
             (COUNT(?entry) as ?total_structures)
             (AVG(xsd:decimal(?resolution)) as ?avg_resolution)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        VALUES ?method { 
          "X-RAY DIFFRACTION" 
          "ELECTRON MICROSCOPY" 
          "SOLUTION NMR" 
        }
        
        ?entry a pdbx:datablock ;
               pdbx:has_exptlCategory/pdbx:has_exptl/pdbx:exptl.method ?method .
        
        OPTIONAL {
          ?entry pdbx:has_refineCategory/pdbx:has_refine ?refine .
          ?refine pdbx:refine.ls_d_res_high ?resolution .
          FILTER(xsd:decimal(?resolution) > 0 && xsd:decimal(?resolution) < 10)
        }
      }
      GROUP BY ?method
      ORDER BY ?method
  
  - title: Analyze Software Usage by Classification
    description: Query using controlled software classification values.
    question: What refinement software is most commonly used?
    complexity: intermediate
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      # Use specific classification value - no text search
      SELECT ?software_name (COUNT(?entry) as ?usage_count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_softwareCategory/pdbx:has_software ?sw .
        
        ?sw pdbx:software.name ?software_name ;
            pdbx:software.classification "refinement" .
      }
      GROUP BY ?software_name
      ORDER BY DESC(?usage_count)
      LIMIT 15
  
  - title: Search Keywords Using Text Filter
    description: Use FILTER(CONTAINS()) for free-text keyword searches when needed.
    question: Find kinase structures by keywords
    complexity: intermediate
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      SELECT ?entry_id ?keywords ?title
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        
        ?entry pdbx:has_struct_keywordsCategory/pdbx:has_struct_keywords ?kw ;
               pdbx:has_structCategory/pdbx:has_struct ?struct .
        
        ?kw pdbx:struct_keywords.pdbx_keywords ?keywords .
        ?struct pdbx:struct.title ?title .
        
        # Text search justified: Checked MIE schema - struct_keywords.pdbx_keywords
        # contains unstructured free-text with no controlled vocabulary.
        # No classification predicates available for keyword content.
        # Virtuoso backend: could use bif:contains, but FILTER works reliably.
        FILTER(CONTAINS(LCASE(?keywords), "kinase"))
      }
      LIMIT 20
  
  - title: Multi-Organism Comparison
    description: Use VALUES with multiple taxonomy IRIs for efficient organism filtering.
    question: Compare structure counts across human, mouse, and E. coli
    complexity: advanced
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      # Use VALUES with specific taxonomy IRIs
      SELECT ?organism_name (COUNT(DISTINCT ?entry) as ?structure_count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        VALUES (?taxonomy_iri ?organism_name) {
          (<http://purl.uniprot.org/taxonomy/9606> "Homo sapiens")
          (<http://purl.uniprot.org/taxonomy/10090> "Mus musculus")
          (<http://purl.uniprot.org/taxonomy/562> "Escherichia coli")
        }
        
        ?entry a pdbx:datablock ;
               pdbx:has_entity_src_genCategory/pdbx:has_entity_src_gen ?src .
        
        ?src pdbx:link_to_taxonomy_source ?taxonomy_iri .
      }
      GROUP BY ?organism_name
      ORDER BY DESC(?structure_count)
  
  - title: Comprehensive Quality Analysis by Organism and Method
    description: Combine specific IRIs and controlled values for complex analytical queries.
    question: What are the highest quality human protein structures by method?
    complexity: advanced
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?entry_id ?method ?resolution ?r_work ?year ?title
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        
        # Use specific taxonomy IRI for human
        ?entry pdbx:has_entity_src_genCategory/pdbx:has_entity_src_gen ?src ;
               pdbx:has_exptlCategory/pdbx:has_exptl ?exptl ;
               pdbx:has_refineCategory/pdbx:has_refine ?refine ;
               pdbx:has_structCategory/pdbx:has_struct ?struct ;
               pdbx:has_citationCategory/pdbx:has_citation ?citation .
        
        ?src pdbx:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
        
        ?exptl pdbx:exptl.method ?method .
        ?refine pdbx:refine.ls_d_res_high ?resolution ;
                pdbx:refine.ls_R_factor_R_work ?r_work .
        ?struct pdbx:struct.title ?title .
        ?citation pdbx:citation.year ?year .
        
        # Quality filters using numeric comparisons
        FILTER(xsd:decimal(?resolution) > 0 && xsd:decimal(?resolution) < 2.0)
        FILTER(xsd:decimal(?r_work) > 0 && xsd:decimal(?r_work) < 0.20)
        FILTER(xsd:integer(?year) >= 2020)
      }
      ORDER BY xsd:decimal(?resolution)
      LIMIT 20

cross_database_queries:
  shared_endpoint: none
  co_located_databases: []
  note: |
    PDB operates on a standalone endpoint (https://rdfportal.org/pdb/sparql) and does not
    share an endpoint with other databases in the RDF Portal ecosystem. Therefore, direct
    cross-database SPARQL queries within a single query are not applicable.
    
    However, PDB data can be integrated with other databases using:
    1. UniProt cross-references via pdbx:link_to_uniprot IRIs
    2. Taxonomy links via pdbx:link_to_taxonomy_source IRIs  
    3. Sequential queries: Query PDB for identifiers, then use togoid_convertId or
       query target databases separately with the extracted IDs.
    
    Example workflow for cross-database integration:
    - Query PDB for structures → extract UniProt accessions
    - Use togoid_convertId("P12345,P67890", "uniprot,chembl_target")
    - Query ChEMBL separately with converted IDs

cross_references:
  - pattern: pdbx:struct_ref
    description: |
      Sequence database links via db_name and pdbx_db_accession properties.
      UniProt is most common (~77% of entries). UNP = UniProt, GB = GenBank.
      Use pdbx:link_to_uniprot IRI for direct links.
    databases:
      Protein:
        - "UNP (UniProt): 352K refs, ~77% entries"
        - "PIR: 131 refs"
      Nucleotide:
        - "GB (GenBank): 5.9K refs"
        - "EMBL: 84 refs"
        - "REF (RefSeq): 49 refs"
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      SELECT ?entry_id ?db_name ?db_accession ?uniprot_iri
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        
        ?entry pdbx:has_struct_refCategory/pdbx:has_struct_ref ?ref .
        ?ref pdbx:struct_ref.db_name ?db_name ;
             pdbx:struct_ref.pdbx_db_accession ?db_accession .
        
        OPTIONAL { ?ref pdbx:link_to_uniprot ?uniprot_iri }
        FILTER(?db_name = "UNP")
      }
      LIMIT 30
  
  - pattern: pdbx:link_to_taxonomy_source
    description: |
      Direct taxonomy IRIs linking to UniProt taxonomy database.
      Use for organism-specific queries. Human (9606) is most common (~81K entity sources).
    databases:
      Taxonomy:
        - "Human (9606): 81K entity_src_gen records (58K unique entries)"
        - "Mouse (10090): 10K entity_src_gen records"
        - "E. coli K-12 (83333): 5K entity_src_gen records"
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      SELECT ?entry_id ?taxonomy_iri ?organism_name
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        
        ?entry pdbx:has_entity_src_genCategory/pdbx:has_entity_src_gen ?src .
        ?src pdbx:link_to_taxonomy_source ?taxonomy_iri ;
             pdbx:entity_src_gen.pdbx_gene_src_scientific_name ?organism_name .
      }
      LIMIT 30
  
  - pattern: pdbx:database_2
    description: |
      External database links via database_id and database_code.
      All entries have PDB and WWPDB identifiers. EMDB links for cryo-EM structures.
    databases:
      WWPDB:
        - "PDB: 100%"
        - "WWPDB: 100%"
      Structure:
        - "EMDB: ~6%"
        - "BMRB: ~3%"
    sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      
      SELECT ?entry_id ?db_id ?db_code
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        
        ?entry pdbx:has_database_2Category/pdbx:has_database_2 ?db .
        ?db pdbx:database_2.database_id ?db_id ;
            pdbx:database_2.database_code ?db_code .
        FILTER(?db_id IN ("EMDB", "BMRB"))
      }
      LIMIT 30

architectural_notes:
  query_strategy:
    - "MANDATORY: Get MIE file FIRST before writing comprehensive queries"
    - "Exploratory: Use search_pdb_entity(db='pdb', query='keyword') to find examples"
    - "Comprehensive: Use specific experimental method strings (e.g., 'X-RAY DIFFRACTION')"
    - "Organism filtering: Use taxonomy IRIs (e.g., <http://purl.uniprot.org/taxonomy/9606> for human)"
    - "Entity filtering: Use controlled type values ('polymer', 'non-polymer', 'water', 'branched')"
    - "Software queries: Use controlled classification values ('refinement', 'data collection', etc.)"
    - "Text search: Use FILTER(CONTAINS(LCASE())) for keywords/titles (unstructured free text)"
    - "Numeric comparisons: Always use xsd:decimal() for resolution, R-factors, cell parameters"
    - "Priority: Specific IRIs/values > VALUES > Controlled predicates > Text search (rare)"
  
  schema_design:
    - "PDBx/mmCIF ontology with Category-Item design pattern"
    - "Datablock root (pdbx:datablock) with has_*Category properties"
    - "Major categories: entity, exptl, refine, struct_ref, database_2, citation, struct"
    - "Bidirectional references via reference_to_* and referenced_by_*"
    - "Controlled vocabularies for experimental methods, entity types, software classifications"
    - "Taxonomy IRIs link to UniProt taxonomy database"
  
  performance:
    - "Filter by pdbx:datablock type first"
    - "Use specific values in WHERE clause (experimental methods, entity types, etc.)"
    - "Use VALUES for multiple controlled values (methods, organisms, etc.)"
    - "Use FILTER(CONTAINS()) only for truly unstructured text (keywords, titles)"
    - "Use xsd:decimal() with range filters for numeric data"
    - "Add LIMIT 20-100 for interactive queries"
    - "Category traversal pattern (has_*Category/has_*) is efficient"
  
  data_integration:
    - "UniProt for protein sequences (~77% via struct_ref.db_name = 'UNP')"
    - "Taxonomy IRIs for organism identification (~33% via link_to_taxonomy_source)"
    - "EMDB for cryo-EM density maps (~6% via database_2.database_id = 'EMDB')"
    - "DOI/PubMed for publications (~75%/73%)"
  
  data_quality:
    - "Resolution/R-factors only for crystallographic and some cryo-EM structures"
    - "NMR structures lack resolution data - use OPTIONAL"
    - "Cell/symmetry data only for crystallographic methods"
    - "Always validate numeric data with range filters"

data_statistics:
  total_entries: 245833
  verified_date: "2025-02-10"
  verification_method: "Direct count of pdbx:datablock instances"
  verification_query: |
    SELECT (COUNT(DISTINCT ?entry) as ?total)
    FROM <http://rdfportal.org/dataset/pdbj>
    WHERE { ?entry a pdbx:datablock }
  
  experimental_methods:
    xray: "71.2% (174,904 structures)"
    em: "6.1% (15,032 structures)"
    nmr: "5.7% (13,902 structures)"
    verification_query: |
      SELECT ?method (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_exptlCategory/pdbx:has_exptl ?exptl .
        ?exptl pdbx:exptl.method ?method .
      }
      GROUP BY ?method
  
  entity_types:
    polymer: "418,171 entities"
    non_polymer: "367,744 entities"
    water: "162,843 entities"
    branched: "18,329 entities"
  
  coverage:
    uniprot_references: "77.1% (189,677 entries have UNP references)"
    taxonomy_links: "33.1% (81,392 entity_src_gen records across 58,331 unique entries)"
    keywords: "83.1% (204,307 entries have keywords)"
    verification_methodology: |
      UNP refs: 352,114 struct_ref with db_name='UNP' across entries
      Taxonomy: 81,392 entity_src_gen records with link_to_taxonomy_source
      (Note: Multiple entity_src_gen per entry possible, so count > unique entries)
  
  organism_distribution:
    human_9606: "81,392 entity_src_gen records (58,331 unique entries)"
    mouse_10090: "10,208 entity_src_gen records"
    ecoli_562: "9,906 entity_src_gen records"
    verification_query: |
      # Count unique entries with human taxonomy
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_entity_src_genCategory/pdbx:has_entity_src_gen ?src .
        ?src pdbx:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
      }
  
  performance_characteristics:
    - "Specific IRI/value queries: <1s"
    - "Numeric filter queries: <2s"
    - "Text search with FILTER(CONTAINS()): 3-8s"
    - "Cross-category joins: 2-5s"
    - "Complex analytical queries: 5-15s"
  
  staleness_warning: "Database updates weekly; statistics accurate as of 2025-02-10"

anti_patterns:
  - title: "Skipping Schema Check Before Using Text Search"
    problem: "Using FILTER(CONTAINS()) without first checking MIE schema for structured alternatives."
    wrong_sparql: |
      # Wrong: No schema checked, immediately uses text search
      SELECT (COUNT(?entry) as ?count)
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_exptlCategory/pdbx:has_exptl ?exptl .
        ?exptl pdbx:exptl.method ?method .
        FILTER(CONTAINS(?method, "X-RAY"))
      }
    correct_sparql: |
      # Correct workflow:
      # 1. get_MIE_file("pdb") → examined shape_expressions
      # 2. Found: pdbx:exptl.method has controlled vocabulary
      # 3. search_pdb_entity to verify values: "X-RAY DIFFRACTION"
      # 4. Use exact controlled value:
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_exptlCategory/pdbx:has_exptl ?exptl .
        ?exptl pdbx:exptl.method "X-RAY DIFFRACTION" .
      }
    explanation: |
      MANDATORY workflow for comprehensive queries:
      1. Get MIE file and examine entity Shape
      2. Check for: controlled values, taxonomy IRIs, classification predicates
      3. Use search tools to find example entities if needed
      4. Inspect examples to confirm available structured properties
      5. Only use text search if NO structured alternative exists
      
      In PDB: experimental methods, entity types, software classifications, organism taxonomy
      are all structured - text search should be RARE (only for keywords/titles).
  
  - title: "Text Search When Specific Value Exists"
    problem: "Using FILTER(CONTAINS()) for experimental method when controlled value available."
    wrong_sparql: |
      # Slow: Text search on method
      ?exptl pdbx:exptl.method ?method .
      FILTER(CONTAINS(?method, "X-RAY"))
    correct_sparql: |
      # Fast: Use specific controlled value
      ?exptl pdbx:exptl.method "X-RAY DIFFRACTION" .
    explanation: |
      Experimental methods are controlled values:
      "X-RAY DIFFRACTION", "ELECTRON MICROSCOPY", "SOLUTION NMR", etc.
      Always use exact values instead of text search.
  
  - title: "Text Search for Organism When Taxonomy IRI Available"
    problem: "Searching organism names as text instead of using taxonomy IRIs."
    wrong_sparql: |
      # Slow: Text search on scientific name
      ?src pdbx:entity_src_gen.pdbx_gene_src_scientific_name ?name .
      FILTER(CONTAINS(?name, "Homo sapiens"))
    correct_sparql: |
      # Fast: Use specific taxonomy IRI
      ?src pdbx:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
    explanation: |
      Taxonomy IRIs are available for ~33% of entries.
      Top organisms: Human (9606), Mouse (10090), E. coli (562).
      Use taxonomy IRI for reliable organism filtering.
  
  - title: "Circular Reasoning with Search Results"
    problem: "Using search API results directly in comprehensive queries."
    wrong_sparql: |
      # Wrong: Only queries the 20 kinases found by search
      VALUES ?entry_id { "8QCD" "8Q77" ... }  # From search_pdb_entity
      SELECT (COUNT(?entry) as ?count)
      WHERE {
        ?entry a pdbx:datablock .
        BIND(STRAFTER(str(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
      }
    correct_sparql: |
      # Correct: Use FILTER(CONTAINS()) to query all matching structures
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbx:datablock ;
               pdbx:has_struct_keywordsCategory/pdbx:has_struct_keywords ?kw .
        ?kw pdbx:struct_keywords.pdbx_keywords ?keywords .
        FILTER(CONTAINS(LCASE(?keywords), "kinase"))
      }
    explanation: |
      Use search_pdb_entity to FIND patterns and keywords, not to get comprehensive lists.
      For comprehensive queries, use text search or specific controlled values.

common_errors:
  - error: "Empty results when querying specific organisms"
    causes:
      - "Using text search on organism name instead of taxonomy IRI"
      - "Taxonomy IRIs only present for ~33% of entries"
    solutions:
      - "Use taxonomy IRI: <http://purl.uniprot.org/taxonomy/9606> for human"
      - "Check if entry has link_to_taxonomy_source before filtering"
      - "Use OPTIONAL for taxonomy links if querying all entries"
    example_fix: |
      # Use taxonomy IRI, not text search
      ?src pdbx:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
  
  - error: "Slow keyword/title searches"
    causes:
      - "Not specifying FROM graph clause"
      - "Not using LIMIT for exploratory queries"
    solutions:
      - "Add FROM <http://rdfportal.org/dataset/pdbj> clause"
      - "Add LIMIT for interactive queries"
      - "Use search_pdb_entity for initial exploration, then SPARQL for comprehensive analysis"
    example_fix: |
      # Add FROM clause and LIMIT
      FROM <http://rdfportal.org/dataset/pdbj>
      ...
      LIMIT 20
  
  - error: "Type conversion errors for resolution/R-factors"
    causes:
      - "Comparing numeric strings without xsd:decimal() casting"
      - "Not filtering invalid or missing values"
    solutions:
      - "Always use xsd:decimal() for numeric comparisons"
      - "Add range filters to exclude invalid values: > 0 && < 10"
      - "Use OPTIONAL for method-specific properties"
    example_fix: |
      # Always use xsd:decimal() with range checks
      FILTER(xsd:decimal(?resolution) > 0 && xsd:decimal(?resolution) < 2.0)