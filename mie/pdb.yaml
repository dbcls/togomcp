schema_info:
  title: Protein Data Bank (PDB)
  description: |
    The PDB RDF database contains 3D structural data for biological macromolecules
    (proteins, nucleic acids, complexes) derived from X-ray crystallography, NMR,
    and cryo-EM. Contains 248K+ entries with experimental methods, structural
    coordinates, resolution data, sequences, biological assemblies, and cross-references
    to UniProt, EMDB, GenBank, and publications.
  endpoint: https://rdfportal.org/pdb/sparql
  base_uri: http://rdf.wwpdb.org/pdb/
  graphs:
    - http://rdfportal.org/dataset/pdbj
    - http://rdf.wwpdb.org/schema/pdbx-v50.owl
  kw_search_tools:
    - search_pdb_entity
  version:
    mie_version: "4.0"
    mie_created: "2025-02-21"
    data_version: Current
    update_frequency: Weekly
  license:
    data_license: Public Domain (CC0)
    license_url: https://www.wwpdb.org/policy
  access:
    rate_limiting: Reasonable use
    max_query_timeout: 60 seconds
    backend: Virtuoso

shape_expressions: |
  PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
  PREFIX pdb:  <http://rdf.wwpdb.org/pdb/>
  PREFIX xsd:  <http://www.w3.org/2001/XMLSchema#>
  PREFIX dct:  <http://purl.org/dc/terms/>
  PREFIX dc:   <http://purl.org/dc/elements/1.1/>

  # ⚠️ CRITICAL NAMESPACE NOTE:
  # The ontology prefix changed from the old pdbx-v50.owl# to:
  #   pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
  # All predicates and class names use this new IRI base.

  <Datablock> {
    a [ pdbo:datablock ] ;
    dct:identifier xsd:string ;               # e.g. "1ATP"
    dc:title xsd:string ;
    pdbo:datablockName xsd:string ;
    pdbo:link_to_pdbml IRI ;
    pdbo:link_to_vrpt IRI ;                   # VRPT validation report
    rdfs:seeAlso IRI ;                        # PDBj, PDBe, RCSB links
    owl:sameAs IRI ;                          # lowercase variant IRI
    pdbo:has_entityCategory @<EntityCategory> * ;
    pdbo:has_exptlCategory @<ExptlCategory> + ;
    pdbo:has_refineCategory @<RefineCategory> * ;
    pdbo:has_struct_refCategory @<StructRefCategory> * ;
    pdbo:has_entity_src_genCategory @<EntitySrcGenCategory> * ;
    pdbo:has_database_2Category @<Database2Category> * ;
    pdbo:has_citationCategory @<CitationCategory> * ;
    pdbo:has_structCategory @<StructCategory> ;
    pdbo:has_struct_keywordsCategory @<StructKeywordsCategory> * ;
    pdbo:has_softwareCategory @<SoftwareCategory> *
  }

  <Entity> {
    a [ pdbo:entity ] ;
    pdbo:entity.id xsd:string ;
    pdbo:entity.type [ "polymer" "non-polymer" "water" "branched" ] ;
    pdbo:entity.pdbx_description xsd:string ? ;
    pdbo:entity.formula_weight xsd:decimal ? ;
    pdbo:reference_to_entity IRI * ;
    pdbo:of_datablock IRI
  }

  <EntityPoly> {
    a [ pdbo:entity_poly ] ;
    pdbo:entity_poly.type xsd:string ;
    pdbo:entity_poly.pdbx_seq_one_letter_code xsd:string ? ;
    pdbo:reference_to_entity IRI ;
    pdbo:of_datablock IRI
  }

  <EntitySrcGen> {
    a [ pdbo:entity_src_gen ] ;
    pdbo:link_to_taxonomy_source IRI ? ;      # <http://purl.uniprot.org/taxonomy/NCBI_TAXON_ID>
    rdfs:seeAlso IRI ? ;                      # <http://identifiers.org/taxonomy/NCBI_TAXON_ID>
    pdbo:entity_src_gen.pdbx_gene_src_scientific_name xsd:string ? ;
    pdbo:entity_src_gen.pdbx_gene_src_ncbi_taxonomy_id xsd:string ? ;
    pdbo:of_datablock IRI
  }

  <Exptl> {
    a [ pdbo:exptl ] ;
    pdbo:exptl.method xsd:string ;            # controlled: "X-RAY DIFFRACTION", "ELECTRON MICROSCOPY", "SOLUTION NMR", etc.
    pdbo:reference_to_entry IRI ;
    pdbo:of_datablock IRI
  }

  <Refine> {
    a [ pdbo:refine ] ;
    pdbo:refine.ls_d_res_high xsd:decimal ? ;
    pdbo:refine.ls_R_factor_R_work xsd:decimal ? ;
    pdbo:refine.ls_R_factor_R_free xsd:decimal ? ;
    pdbo:reference_to_entry IRI ;
    pdbo:of_datablock IRI
  }

  <StructRef> {
    a [ pdbo:struct_ref ] ;
    pdbo:struct_ref.db_name xsd:string ;      # "UNP", "GB", "EMBL", etc.
    pdbo:struct_ref.pdbx_db_accession xsd:string ? ;
    pdbo:link_to_uniprot IRI ? ;              # <http://purl.uniprot.org/uniprot/ACCESSION>
    rdfs:seeAlso IRI ? ;                      # <http://identifiers.org/uniprot/ACCESSION>
    pdbo:reference_to_entity IRI * ;
    pdbo:of_datablock IRI
  }

  <ChemComp> {
    a [ pdbo:chem_comp ] ;
    pdbo:chem_comp.id xsd:string ;
    pdbo:chem_comp.name xsd:string ;
    pdbo:chem_comp.type xsd:string ;
    pdbo:chem_comp.formula xsd:string ;
    pdbo:chem_comp.formula_weight xsd:decimal ?
  }

  <Software> {
    a [ pdbo:software ] ;
    pdbo:software.name xsd:string ;
    pdbo:software.classification xsd:string ; # controlled: "refinement", "data collection", "data reduction", etc.
    pdbo:of_datablock IRI
  }

sample_rdf_entries:
  - title: PDB Entry Root (datablock)
    description: Root datablock for 1ATP with metadata and external links.
    rdf: |
      @prefix pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#> .
      @prefix pdb:  <http://rdf.wwpdb.org/pdb/> .
      @prefix dct:  <http://purl.org/dc/terms/> .
      @prefix dc:   <http://purl.org/dc/elements/1.1/> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

      pdb:1ATP a pdbo:datablock ;
        dct:identifier "1ATP" ;
        dc:title "2.2 angstrom refined crystal structure of the catalytic subunit of cAMP-dependent protein kinase" ;
        rdfs:seeAlso <http://www.rcsb.org/pdb/structure/1ATP> ;
        pdbo:link_to_vrpt <http://rdf.wwpdb.org/vrpt/1ATP> .

  - title: Experimental Method (exptl)
    description: Controlled method value for a cryo-EM structure.
    rdf: |
      @prefix pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#> .
      @prefix pdb:  <http://rdf.wwpdb.org/pdb/> .

      pdb:10FM/exptl/1 a pdbo:exptl ;
        pdbo:exptl.method "ELECTRON MICROSCOPY" ;
        pdbo:of_datablock pdb:10FM .

  - title: Organism Source (entity_src_gen)
    description: Source organism linked to UniProt taxonomy IRI.
    rdf: |
      @prefix pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#> .
      @prefix pdb:  <http://rdf.wwpdb.org/pdb/> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

      pdb:1ATP/entity_src_gen/1,1 a pdbo:entity_src_gen ;
        pdbo:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/10090> ;
        pdbo:entity_src_gen.pdbx_gene_src_scientific_name "Mus musculus" ;
        pdbo:entity_src_gen.pdbx_gene_src_ncbi_taxonomy_id "10090" ;
        pdbo:of_datablock pdb:1ATP .

  - title: UniProt Cross-Reference (struct_ref)
    description: Sequence cross-reference to UniProt with direct link IRI.
    rdf: |
      @prefix pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#> .
      @prefix pdb:  <http://rdf.wwpdb.org/pdb/> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

      pdb:1ATP/struct_ref/1 a pdbo:struct_ref ;
        pdbo:struct_ref.db_name "UNP" ;
        pdbo:struct_ref.pdbx_db_accession "P05132" ;
        pdbo:link_to_uniprot <http://purl.uniprot.org/uniprot/P05132> ;
        rdfs:seeAlso <http://identifiers.org/uniprot/P05132> ;
        pdbo:of_datablock pdb:1ATP .

  - title: Refinement Statistics (refine)
    description: X-ray refinement quality data with resolution and R-factor.
    rdf: |
      @prefix pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#> .
      @prefix pdb:  <http://rdf.wwpdb.org/pdb/> .
      @prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .

      pdb:1ATP/refine/1 a pdbo:refine ;
        pdbo:refine.ls_d_res_high 2.2 ;
        pdbo:refine.ls_R_factor_R_work 0.177 ;
        pdbo:of_datablock pdb:1ATP .

sparql_query_examples:
  - title: Count Total PDB Structures
    description: Count all PDB structural entries (excluding chemical component datablocks).
    question: How many structures are currently in PDB?
    complexity: basic
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>

      SELECT (COUNT(DISTINCT ?entry) as ?total)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
      }

  - title: Find Structures by Organism Using Taxonomy IRI
    description: Use specific taxonomy IRI for organism filtering — never text search on scientific name.
    question: How many human protein structures are in PDB?
    complexity: basic
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>

      # Use specific taxonomy IRI for human (9606)
      # pdbo:link_to_taxonomy_source points to <http://purl.uniprot.org/taxonomy/NCBI_TAXON_ID>
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        ?entry pdbo:has_entity_src_genCategory/pdbo:has_entity_src_gen ?src .
        ?src pdbo:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
      }

  - title: Query by Experimental Method (Controlled Vocabulary)
    description: Use exact controlled method strings — no text search needed for method filtering.
    question: Find cryo-EM structures with their EMDB links.
    complexity: intermediate
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      PREFIX dct:  <http://purl.org/dc/terms/>

      # Controlled method values: "X-RAY DIFFRACTION", "ELECTRON MICROSCOPY",
      # "SOLUTION NMR", "NEUTRON DIFFRACTION", "SOLID-STATE NMR", etc.
      SELECT ?entry_id ?emdb_code
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        dct:identifier ?entry_id .
        BIND(STRAFTER(STR(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        ?entry pdbo:has_exptlCategory/pdbo:has_exptl/pdbo:exptl.method "ELECTRON MICROSCOPY" ;
               pdbo:has_database_2Category/pdbo:has_database_2 ?db .
        ?db pdbo:database_2.database_id "EMDB" ;
            pdbo:database_2.database_code ?emdb_code .
      }
      LIMIT 20

  - title: Compare Structure Counts Across Multiple Organisms
    description: Use VALUES with multiple taxonomy IRIs for efficient multi-organism comparison.
    question: Compare structure counts for human, mouse, and E. coli.
    complexity: intermediate
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>

      # VALUES with specific taxonomy IRIs — comprehensive and fast
      SELECT ?organism_name (COUNT(DISTINCT ?entry) as ?structure_count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        VALUES (?taxonomy_iri ?organism_name) {
          (<http://purl.uniprot.org/taxonomy/9606>  "Homo sapiens")
          (<http://purl.uniprot.org/taxonomy/10090> "Mus musculus")
          (<http://purl.uniprot.org/taxonomy/562>   "Escherichia coli")
        }
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        ?entry pdbo:has_entity_src_genCategory/pdbo:has_entity_src_gen ?src .
        ?src pdbo:link_to_taxonomy_source ?taxonomy_iri .
      }
      GROUP BY ?organism_name
      ORDER BY DESC(?structure_count)

  - title: Method Distribution with Resolution Statistics
    description: Use VALUES with controlled method strings for aggregate analytics.
    question: What is the resolution distribution across X-ray, NMR, and cryo-EM?
    complexity: intermediate
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      PREFIX xsd:  <http://www.w3.org/2001/XMLSchema#>

      SELECT ?method
             (COUNT(DISTINCT ?entry) as ?total_structures)
             (AVG(?res_val) as ?avg_resolution)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        VALUES ?method {
          "X-RAY DIFFRACTION"
          "ELECTRON MICROSCOPY"
          "SOLUTION NMR"
        }
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        ?entry pdbo:has_exptlCategory/pdbo:has_exptl/pdbo:exptl.method ?method .
        OPTIONAL {
          ?entry pdbo:has_refineCategory/pdbo:has_refine ?refine .
          ?refine pdbo:refine.ls_d_res_high ?res_val .
          FILTER(?res_val > 0 && ?res_val < 10)
        }
      }
      GROUP BY ?method
      ORDER BY ?method

  - title: UniProt Cross-Reference Lookup
    description: Find PDB structures linked to a specific UniProt protein via structured link predicate.
    question: Which PDB structures are linked to UniProt protein P05132?
    complexity: advanced
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      PREFIX dct:  <http://purl.org/dc/terms/>

      # Use pdbo:link_to_uniprot with the purl.uniprot.org IRI — not text search
      SELECT ?entry_id ?resolution ?method
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        BIND(STRAFTER(STR(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        ?entry pdbo:has_struct_refCategory/pdbo:has_struct_ref ?ref .
        ?ref pdbo:link_to_uniprot <http://purl.uniprot.org/uniprot/P05132> .
        OPTIONAL {
          ?entry pdbo:has_exptlCategory/pdbo:has_exptl/pdbo:exptl.method ?method .
        }
        OPTIONAL {
          ?entry pdbo:has_refineCategory/pdbo:has_refine/pdbo:refine.ls_d_res_high ?resolution .
        }
      }
      LIMIT 20

  - title: Keyword Search in Free-Text Fields
    description: Text search for keyword-based discovery — justified because struct_keywords.pdbx_keywords is unstructured free text with no controlled vocabulary.
    question: Find kinase structures using keyword search.
    complexity: advanced
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      PREFIX dc:   <http://purl.org/dc/elements/1.1/>

      SELECT ?entry_id ?keywords ?title
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        BIND(STRAFTER(STR(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        ?entry pdbo:has_struct_keywordsCategory/pdbo:has_struct_keywords ?kw .
        ?kw pdbo:struct_keywords.pdbx_keywords ?keywords .
        ?entry dc:title ?title .
        # Text search justified: struct_keywords.pdbx_keywords is unstructured free text.
        # No classification IRI or controlled vocabulary exists for keyword content.
        # Virtuoso backend — bif:contains preferred but FILTER works reliably here.
        FILTER(CONTAINS(LCASE(?keywords), "kinase"))
      }
      LIMIT 20

cross_database_queries:
  shared_endpoint: none
  co_located_databases: []
  note: |
    PDB operates on a standalone endpoint (https://rdfportal.org/pdb/sparql) and does
    not share an endpoint with any other database in the RDF Portal ecosystem.
    Direct cross-database SPARQL joins are therefore not possible.

    Cross-database integration workflows:
    1. UniProt: Query PDB for struct_ref with pdbo:link_to_uniprot IRIs, then query
       https://rdfportal.org/sib/sparql with those UniProt accessions.
    2. Taxonomy: pdbo:link_to_taxonomy_source links to <http://purl.uniprot.org/taxonomy/TAXON_ID>;
       use togoid_convertId("pdb,uniprot") to bridge IDs across endpoints.
    3. Sequential: Query PDB → extract identifiers → togoid_convertId → query target DB.

cross_references:
  - pattern: pdbo:link_to_uniprot
    description: |
      Direct UniProt protein IRI link from struct_ref nodes.
      Points to <http://purl.uniprot.org/uniprot/ACCESSION>.
      rdfs:seeAlso also present with <http://identifiers.org/uniprot/ACCESSION> form.
    databases:
      Protein:
        - "UNP (UniProt): ~77% of entries (struct_ref.db_name = 'UNP')"
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>

      SELECT ?entry_id ?uniprot_iri ?accession
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        BIND(STRAFTER(STR(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        ?entry pdbo:has_struct_refCategory/pdbo:has_struct_ref ?ref .
        ?ref pdbo:struct_ref.db_name "UNP" ;
             pdbo:struct_ref.pdbx_db_accession ?accession ;
             pdbo:link_to_uniprot ?uniprot_iri .
      }
      LIMIT 30

  - pattern: pdbo:link_to_taxonomy_source
    description: |
      Taxonomy IRI link from entity_src_gen nodes.
      Points to <http://purl.uniprot.org/taxonomy/NCBI_TAXON_ID>.
      rdfs:seeAlso also provides <http://identifiers.org/taxonomy/NCBI_TAXON_ID>.
    databases:
      Taxonomy:
        - "Human (9606): ~73,850 unique entries"
        - "Mouse (10090): ~10,000 entries"
        - "E. coli (562/83333): ~5,000 entries"
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>

      SELECT ?entry_id ?taxonomy_iri ?organism_name
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        BIND(STRAFTER(STR(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        ?entry pdbo:has_entity_src_genCategory/pdbo:has_entity_src_gen ?src .
        ?src pdbo:link_to_taxonomy_source ?taxonomy_iri ;
             pdbo:entity_src_gen.pdbx_gene_src_scientific_name ?organism_name .
      }
      LIMIT 30

  - pattern: pdbo:database_2
    description: |
      External database links via database_2.database_id and database_2.database_code.
      All entries have PDB/WWPDB codes. EMDB codes for cryo-EM. BMRB for NMR.
    databases:
      External:
        - "EMDB: ~13% of entries (cryo-EM structures)"
        - "BMRB: ~3% of entries (NMR structures)"
    sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>

      SELECT ?entry_id ?db_id ?db_code
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        BIND(STRAFTER(STR(?entry), "http://rdf.wwpdb.org/pdb/") AS ?entry_id)
        ?entry pdbo:has_database_2Category/pdbo:has_database_2 ?db .
        ?db pdbo:database_2.database_id ?db_id ;
            pdbo:database_2.database_code ?db_code .
        FILTER(?db_id IN ("EMDB", "BMRB"))
      }
      LIMIT 30

architectural_notes:
  query_strategy:
    - "MANDATORY: Call get_MIE_file('pdb') before writing any SPARQL query"
    - "NAMESPACE: Use pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#> — the old pdbx-v50.owl# prefix returns 0 results"
    - "PDB ENTRIES ONLY: Add FILTER(STRSTARTS(STR(?entry), 'http://rdf.wwpdb.org/pdb/')) to exclude chemical component (cc/) datablocks"
    - "Organism: Use pdbo:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/TAXON_ID> — not text search on scientific name"
    - "UniProt: Use pdbo:link_to_uniprot <http://purl.uniprot.org/uniprot/ACCESSION> for direct cross-reference"
    - "Method: Use controlled string values e.g. 'X-RAY DIFFRACTION', 'ELECTRON MICROSCOPY', 'SOLUTION NMR'"
    - "Numerics: Always cast with xsd:decimal() and add range FILTER for resolution, R-factors"
    - "Text search: Only for struct_keywords.pdbx_keywords or dc:title — both are unstructured free text"
    - "Priority: Taxonomy IRIs > UniProt IRIs > Controlled values > VALUES block > Text search"

  schema_design:
    - "PDBx/mmCIF ontology with Category-Item design: datablock → has_*Category → has_* → items"
    - "New namespace pdbx-with-vrptx-v50.owl# replaces old pdbx-v50.owl# — all predicates changed"
    - "Two datablock populations: PDB entries (pdb:XXXX) and chemical components (cc:XXX)"
    - "Cross-references use both pdbo:link_to_* IRIs and rdfs:seeAlso identifiers.org IRIs"
    - "VRPT validation reports accessible via pdbo:link_to_vrpt"

  performance:
    - "Always include FROM <http://rdfportal.org/dataset/pdbj> graph clause"
    - "Filter ?entry by pdb:// prefix to restrict to structural entries only"
    - "Use specific values in WHERE (method strings, taxonomy IRIs) before optional joins"
    - "Numeric range FILTER(>0 && <10) prevents xsd:decimal conversion errors"
    - "Add LIMIT 20–100 for exploratory queries; omit for verified aggregate queries"

  data_integration:
    - "UniProt: ~77% of entries via struct_ref.db_name='UNP' + pdbo:link_to_uniprot"
    - "Taxonomy: ~50% of entries via entity_src_gen + pdbo:link_to_taxonomy_source"
    - "EMDB: ~13% via database_2.database_id='EMDB' (cryo-EM structures)"
    - "TogoID route pdb→uniprot available for cross-endpoint integration"

  data_quality:
    - "Resolution/R-factors present only for X-ray and some cryo-EM; use OPTIONAL for NMR"
    - "Chemical component datablocks (cc:/) must be excluded for structural statistics"
    - "Multiple entity_src_gen per entry possible; COUNT(DISTINCT ?entry) to avoid overcounting"

data_statistics:
  total_entries: 248874
  verified_date: "2025-02-21"
  verification_method: "Count of pdbx:datablock with pdb:// IRI prefix"
  verification_query: |
    PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
    SELECT (COUNT(DISTINCT ?entry) as ?total)
    FROM <http://rdfportal.org/dataset/pdbj>
    WHERE {
      ?entry a pdbo:datablock .
      FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
    }
  staleness_warning: Database updates weekly; run verification query for current count.

  experimental_methods:
    xray: "201,879 structures (81.1%)"
    em: "31,766 structures (12.8%)"
    solution_nmr: "14,594 structures (5.9%)"
    other: "electron crystallography 275, neutron diffraction 259, solid-state NMR 195"
    verification_query: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      SELECT ?method (COUNT(DISTINCT ?entry) as ?cnt)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        ?entry pdbo:has_exptlCategory/pdbo:has_exptl ?exptl .
        ?exptl pdbo:exptl.method ?method .
      }
      GROUP BY ?method ORDER BY DESC(?cnt)

  organism_distribution:
    human_9606: "73,850 unique PDB entries"
    mouse_10090: "~10,000 entries"
    ecoli_562: "~5,000 entries"
    verification_query: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        ?entry pdbo:has_entity_src_genCategory/pdbo:has_entity_src_gen ?src .
        ?src pdbo:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
      }

  cross_references:
    uniprot_link_to_uniprot: "1,197,753 struct_ref nodes with pdbo:link_to_uniprot"
    taxonomy_link_to_taxonomy_source: "531,746 entity_src_gen nodes with pdbo:link_to_taxonomy_source"

anti_patterns:
  - title: "Using the OLD pdbx-v50.owl# Namespace"
    problem: "The old pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#> namespace returns 0 results."
    wrong_sparql: |
      PREFIX pdbx: <http://rdf.wwpdb.org/schema/pdbx-v50.owl#>
      SELECT (COUNT(?entry) as ?n)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE { ?entry a pdbx:datablock }
      # Returns 0 — namespace no longer active
    correct_sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      SELECT (COUNT(DISTINCT ?entry) as ?n)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE { ?entry a pdbo:datablock .
              FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/")) }
      # Returns ~248,874
    explanation: "The ontology namespace changed from pdbx-v50.owl# to pdbx-with-vrptx-v50.owl#. Always use the new pdbo: prefix."

  - title: "Not Filtering Chemical Component Datablocks"
    problem: "Total datablock count (~548K) includes chemical components (cc:/) in addition to structural entries (~248K)."
    wrong_sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      SELECT (COUNT(?entry) as ?n)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE { ?entry a pdbo:datablock }
      # Returns ~548,180 — inflated by ~299K cc: datablocks
    correct_sparql: |
      PREFIX pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>
      SELECT (COUNT(DISTINCT ?entry) as ?n)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE { ?entry a pdbo:datablock .
              FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/")) }
    explanation: "Always add FILTER(STRSTARTS(STR(?entry), 'http://rdf.wwpdb.org/pdb/')) when counting or querying structural entries."

  - title: "Text Search for Organism When Taxonomy IRI Available"
    problem: "Using FILTER(CONTAINS()) on scientific name text instead of the direct taxonomy IRI predicate."
    wrong_sparql: |
      # Slow and incomplete: text search on organism name
      ?src pdbo:entity_src_gen.pdbx_gene_src_scientific_name ?name .
      FILTER(CONTAINS(?name, "Homo sapiens"))
    correct_sparql: |
      # Fast and precise: specific taxonomy IRI
      ?src pdbo:link_to_taxonomy_source <http://purl.uniprot.org/taxonomy/9606> .
    explanation: "pdbo:link_to_taxonomy_source with UniProt taxonomy IRIs is the structured property for organism filtering."

  - title: "Circular Reasoning with Search API Results"
    problem: "Using search_pdb_entity result IDs in VALUES for aggregate counts — only counts what was found, not the full dataset."
    wrong_sparql: |
      # Wrong: VALUES populated from search results
      VALUES ?entry { pdb:8QCD pdb:8Q77 ... }  # Only 20 from search_pdb_entity
      SELECT (COUNT(?entry) as ?count) WHERE { ... }
    correct_sparql: |
      # Correct: use the keyword FILTER on the full dataset
      # (After checking MIE schema: struct_keywords is unstructured free text
      #  with no classification IRI, so text search is justified here)
      SELECT (COUNT(DISTINCT ?entry) as ?count)
      FROM <http://rdfportal.org/dataset/pdbj>
      WHERE {
        ?entry a pdbo:datablock .
        FILTER(STRSTARTS(STR(?entry), "http://rdf.wwpdb.org/pdb/"))
        ?entry pdbo:has_struct_keywordsCategory/pdbo:has_struct_keywords ?kw .
        ?kw pdbo:struct_keywords.pdbx_keywords ?kw_text .
        FILTER(CONTAINS(LCASE(?kw_text), "kinase"))
      }
    explanation: "Use search_pdb_entity to find patterns and inspect schema; use SPARQL on the full dataset for comprehensive counts."

common_errors:
  - error: "Zero results for all queries"
    causes:
      - "Using old pdbx-v50.owl# namespace (most common root cause)"
      - "Missing FROM <http://rdfportal.org/dataset/pdbj> graph clause"
    solutions:
      - "Switch to pdbo: <http://rdf.wwpdb.org/schema/pdbx-with-vrptx-v50.owl#>"
      - "Always include FROM <http://rdfportal.org/dataset/pdbj>"

  - error: "Inflated entry counts (~548K instead of ~248K)"
    causes:
      - "Not filtering out chemical component datablocks (cc:/ IRIs)"
    solutions:
      - "Add FILTER(STRSTARTS(STR(?entry), 'http://rdf.wwpdb.org/pdb/')) to restrict to structural entries"

  - error: "Type conversion errors for resolution or R-factor comparisons"
    causes:
      - "Numeric fields stored as xsd:decimal but compared without casting"
    solutions:
      - "Always use range FILTER: FILTER(?res_val > 0 && ?res_val < 10)"
      - "Use OPTIONAL for method-specific numeric fields (NMR lacks resolution)"
