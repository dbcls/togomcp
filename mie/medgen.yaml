schema_info:
  title: MedGen (Medical Genetics)
  description: |
    NCBI's portal for medical conditions with genetic components, containing 233,939 clinical concepts 
    (diseases, phenotypes, findings). Integrates data from OMIM, Orphanet, HPO, and MONDO with 
    terminology mappings and relationship tracking. Relationships stored in MGREL entities, attributes 
    in MGSAT (blank nodes), cross-references via MGCONSO, and provenance via RDF reification.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://www.ncbi.nlm.nih.gov/medgen/
  graphs:
    - http://rdfportal.org/dataset/medgen
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "2.0"
    mie_created: "2025-02-09"
    data_version: "Current NCBI release"
    update_frequency: "Monthly"
  license:
    data_license: "Public Domain (NCBI Data)"
    license_url: "https://www.ncbi.nlm.nih.gov/home/about/policies/"
  access:
    rate_limiting: "100 queries/min (RDF Portal limit)"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX mo: <http://med2rdf/ontology/medgen#>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX sty: <http://purl.bioontology.org/ontology/STY/>
  
  <ConceptIDShape> {
    a [ mo:ConceptID ] ;
    dct:identifier xsd:string ;
    rdfs:label xsd:string + ;
    mo:sty IRI ;
    skos:definition xsd:string ? ;
    mo:name BNode ;
    mo:mgdef BNode ? ;
    mo:mgconso BNode + ;
    mo:mgsat BNode +
  }
  
  <MGRELShape> {
    a [ mo:MGREL ] ;
    dct:identifier xsd:string ;
    mo:cui1 @<ConceptIDShape> ;
    mo:aui1 xsd:string ;
    mo:cui2 @<ConceptIDShape> ;
    mo:aui2 xsd:string ;
    dct:source IRI ;
    mo:suppress IRI ? ;
    mo:rela xsd:string
  }
  
  <MGSATShape> {
    a [ mo:MGSAT ] ;
    mo:atui xsd:string ;
    mo:cui @<ConceptIDShape> ;
    mo:atn xsd:string ;
    mo:atv xsd:string ;
    dct:source IRI
  }
  
  <MGCONSOShape> {
    rdfs:seeAlso IRI + ;
    mo:aui xsd:string ;
    mo:lat xsd:string ;
    mo:ts IRI ;
    mo:tty xsd:string ;
    dct:source IRI
  }
  
  <ReificationStatementShape> {
    a [ rdf:Statement ] ;
    rdf:subject IRI ;
    rdf:predicate IRI ;
    rdf:object IRI ;
    dct:source IRI ;
    mo:sty IRI ? ;
    rdfs:comment xsd:string ?
  }

sample_rdf_entries:
  - title: Core Disease Concept - Diabetes Mellitus
    description: Disease concept with identifier, labels, semantic type, and definition.
    rdf: |
      @prefix mo: <http://med2rdf/ontology/medgen#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix skos: <http://www.w3.org/2004/02/skos/core#> .
      @prefix sty: <http://purl.bioontology.org/ontology/STY/> .
      
      <http://www.ncbi.nlm.nih.gov/medgen/C0011849> a mo:ConceptID ;
          dct:identifier "C0011849" ;
          rdfs:label "Diabetes mellitus"@en ;
          mo:sty sty:T047 ;
          skos:definition "A metabolic disorder characterized by..."@en ;
          mo:mgconso [
              rdfs:seeAlso <http://id.nlm.nih.gov/mesh/D003920> ;
              rdfs:seeAlso <http://purl.obolibrary.org/obo/MONDO_0005015>
          ] .

  - title: Relationship Record (MGREL) - Disease Manifestation
    description: Relationship between disease and phenotypic finding with source attribution.
    rdf: |
      @prefix mo: <http://med2rdf/ontology/medgen#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      
      [] a mo:MGREL ;
          dct:identifier "R001234567" ;
          mo:cui1 <http://www.ncbi.nlm.nih.gov/medgen/C0011849> ;
          mo:aui1 "A0123456" ;
          mo:cui2 <http://www.ncbi.nlm.nih.gov/medgen/C0020456> ;
          mo:aui2 "A0789012" ;
          mo:rela "has_manifestation" ;
          dct:source <http://id.nlm.nih.gov/mesh/vocab> .

  - title: Terminology Mapping (MGCONSO)
    description: Maps concepts to MeSH, MONDO, HPO, and OMIM using rdfs:seeAlso.
    rdf: |
      @prefix mo: <http://med2rdf/ontology/medgen#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      
      <http://www.ncbi.nlm.nih.gov/medgen/C0011849> mo:mgconso [
          rdfs:seeAlso <http://identifiers.org/mim/222100> ;
          rdfs:seeAlso <http://id.nlm.nih.gov/mesh/D003920> ;
          rdfs:seeAlso <http://purl.obolibrary.org/obo/MONDO_0005015> ;
          rdfs:seeAlso <http://purl.obolibrary.org/obo/HP_0000819>
      ] .

  - title: Attribute Record (MGSAT) - Blank Node Structure
    description: Attributes like inheritance patterns stored as blank nodes linked via mo:mgsat.
    rdf: |
      @prefix mo: <http://med2rdf/ontology/medgen#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      
      [] a mo:MGSAT ;
          mo:atui "AT0123456" ;
          mo:cui <http://www.ncbi.nlm.nih.gov/medgen/C0000744> ;
          mo:atn "INHERITANCE" ;
          mo:atv "Autosomal recessive" ;
          dct:source <http://id.nlm.nih.gov/mesh/vocab> .

  - title: RDF Reification for Relationship Provenance
    description: Tracks source attribution and semantic type for relationships using RDF reification.
    rdf: |
      @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
      @prefix mo: <http://med2rdf/ontology/medgen#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      @prefix sty: <http://purl.bioontology.org/ontology/STY/> .
      
      [] a rdf:Statement ;
          rdf:subject <http://www.ncbi.nlm.nih.gov/medgen/C0011849> ;
          rdf:predicate mo:manifestation_of ;
          rdf:object <http://www.ncbi.nlm.nih.gov/medgen/C0020456> ;
          dct:source <http://id.nlm.nih.gov/mesh/vocab> ;
          mo:sty sty:T047 .

sparql_query_examples:
  - title: Basic - Find Concept by Specific Identifier
    description: Retrieve basic information for a MedGen concept using its CUI.
    question: What is the basic information for MedGen concept C0011849 (Diabetes mellitus)?
    complexity: basic
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      
      # Uses specific concept identifier (IRI-based query)
      SELECT ?concept ?identifier ?label ?sty ?definition
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        VALUES ?identifier { "C0011849" }
        ?concept a mo:ConceptID ;
            dct:identifier ?identifier ;
            rdfs:label ?label ;
            mo:sty ?sty .
        OPTIONAL { ?concept skos:definition ?definition }
      }
      LIMIT 10

  - title: Basic - Count Concepts by Specific Semantic Types
    description: Count clinical concepts by UMLS semantic type using specific type IRIs.
    question: How many disease concepts (T047) and neoplastic concepts (T191) are in MedGen?
    complexity: basic
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX sty: <http://purl.bioontology.org/ontology/STY/>
      
      # Uses specific semantic type IRIs (VALUES with multiple IRIs)
      SELECT ?sty (COUNT(?concept) as ?count)
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        VALUES ?sty { 
          sty:T047  # Disease or Syndrome
          sty:T191  # Neoplastic Process
          sty:T033  # Finding
        }
        ?concept a mo:ConceptID ;
            mo:sty ?sty .
      }
      GROUP BY ?sty
      ORDER BY DESC(?count)

  - title: Intermediate - Find Related Concepts via Specific Relationship Types
    description: Navigate hierarchical and manifestation relationships using typed predicates.
    question: What are the parent diseases and manifestations for a specific disease?
    complexity: intermediate
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      # Uses specific relationship type values (typed predicates)
      SELECT ?disease ?disease_label ?rel_type ?related ?related_label
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        VALUES ?disease_cui { "C0011849" }
        ?disease a mo:ConceptID ;
            dct:identifier ?disease_cui ;
            rdfs:label ?disease_label .
        ?rel a mo:MGREL ;
            mo:cui1 ?disease ;
            mo:cui2 ?related ;
            mo:rela ?rel_type .
        ?related rdfs:label ?related_label .
        # Filter to specific relationship types
        VALUES ?rel_type { "isa" "inverse_isa" "has_manifestation" }
        FILTER(?disease != ?related)
      }
      LIMIT 50

  - title: Intermediate - Retrieve External Database Cross-References
    description: Get cross-references to MONDO, MeSH, and OMIM for specific concepts.
    question: What external database identifiers link to diabetes mellitus (C0011849)?
    complexity: intermediate
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      # Uses specific concept and graph navigation (blank node traversal)
      SELECT DISTINCT ?concept ?identifier ?external_db
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        VALUES ?identifier { "C0011849" }
        ?concept a mo:ConceptID ;
            dct:identifier ?identifier ;
            mo:mgconso ?bn .
        ?bn rdfs:seeAlso ?external_db .
      }
      LIMIT 50

  - title: Intermediate - Search Concepts by Keyword (bif:contains)
    description: Full-text search for disease concepts using indexed text search.
    question: Find all MedGen concepts related to cardiovascular diseases.
    complexity: intermediate
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      # Text search using bif:contains (indexed, Virtuoso backend)
      # Used because searching unstructured free-text labels
      SELECT ?concept ?identifier ?label
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?concept a mo:ConceptID ;
            rdfs:label ?label ;
            dct:identifier ?identifier .
        # bif:contains for efficient full-text search
        ?label bif:contains "'cardiovascular' OR 'heart' OR 'cardiac'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 50

  - title: Advanced - Disease Hierarchy Navigation via MGREL
    description: Navigate disease hierarchies to find parent and child concepts through "isa" relationships.
    question: What are all the parent and child diseases in the hierarchy for Type 2 diabetes (C0011860)?
    complexity: advanced
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      # Complex hierarchical navigation with specific relationship types
      SELECT ?concept ?label ?direction ?related ?related_label
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        VALUES ?concept_cui { "C0011860" }
        ?concept a mo:ConceptID ;
            dct:identifier ?concept_cui ;
            rdfs:label ?label .
        ?rel a mo:MGREL ;
            mo:cui1 ?concept ;
            mo:cui2 ?related ;
            mo:rela ?rel_type .
        ?related rdfs:label ?related_label .
        # Bind direction based on relationship type
        BIND(
          IF(?rel_type = "isa", "parent",
          IF(?rel_type = "inverse_isa", "child", "other"))
          AS ?direction
        )
        FILTER(?rel_type = "isa" || ?rel_type = "inverse_isa")
        FILTER(?concept != ?related)
      }
      LIMIT 100

  - title: Advanced - Disease-Phenotype Network Analysis
    description: Analyze disease-phenotype manifestation networks for multiple diseases.
    question: For common diseases (diabetes, hypertension, cancer), what are their phenotypic manifestations?
    complexity: advanced
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX sty: <http://purl.bioontology.org/ontology/STY/>
      
      # Multi-concept phenotype network with semantic type filtering
      SELECT DISTINCT ?disease ?disease_label ?phenotype ?phenotype_label ?pheno_type
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        # Multiple disease concepts
        VALUES ?disease_cui { "C0011849" "C0020538" "C0006826" }
        ?disease a mo:ConceptID ;
            dct:identifier ?disease_cui ;
            rdfs:label ?disease_label .
        ?rel a mo:MGREL ;
            mo:cui1 ?disease ;
            mo:cui2 ?phenotype ;
            mo:rela "has_manifestation" .
        ?phenotype rdfs:label ?phenotype_label ;
            mo:sty ?pheno_type .
        # Filter to specific phenotype types
        FILTER(?pheno_type IN (sty:T033, sty:T184))
        FILTER(?disease != ?phenotype)
      }
      LIMIT 100

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - clinvar
    - pubmed
    - pubtator
    - ncbigene
  examples:
    - title: Link Genetic Diseases to Associated Variants (ClinVar)
      description: |
        Integrates MedGen disease concepts with ClinVar variant data for variant interpretation. 
        Handles namespace differences through URI conversion (www.ncbi.nlm.nih.gov → ncbi.nlm.nih.gov).
      databases_used:
        - medgen
        - clinvar
      complexity: intermediate
      sparql: |
        PREFIX mo: <http://med2rdf/ontology/medgen#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        
        SELECT ?medgen_cui ?medgen_label ?variant_label ?var_type ?significance
        WHERE {
          GRAPH <http://rdfportal.org/dataset/medgen> {
            VALUES ?medgen_cui { "C0011849" "C0020538" }
            ?medgen_concept a mo:ConceptID ;
                            dct:identifier ?medgen_cui ;
                            rdfs:label ?medgen_label .
            BIND(IRI(REPLACE(STR(?medgen_concept), "www.ncbi", "ncbi")) AS ?cv_medgen_uri)
          }
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?disease a med2rdf:Disease ;
                     dct:references ?ref .
            ?ref rdfs:seeAlso ?cv_medgen_uri .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?variant_label ;
                     cvo:variation_type ?var_type ;
                     med2rdf:disease ?disease ;
                     cvo:classified_record ?classrec .
            ?classrec cvo:classifications ?classi .
            ?classi cvo:germline_classification ?germ .
            ?germ cvo:description ?significance .
          }
        }
        LIMIT 20
      notes: |
        - Optimization Strategies: 1 (GRAPH), 3 (VALUES), 4 (split paths), 5 (URI conversion)
        - URI conversion required: MedGen uses www.ncbi.nlm.nih.gov, ClinVar uses ncbi.nlm.nih.gov
        - VALUES pre-filter reduces search space by 99.9%+ (from 233K to 2 concepts)
        - Property paths split to prevent timeouts (cvo:classified_record → cvo:classifications → ...)
        - Performance: ~3-5s (Tier 2)
        - Referenced MIE files: medgen, clinvar

    - title: Link Diseases to Associated Genes (NCBI Gene)
      description: |
        Connects MedGen disease concepts to associated genes via NCBI Gene database.
      databases_used:
        - medgen
        - ncbigene
      complexity: intermediate
      sparql: |
        PREFIX mo: <http://med2rdf/ontology/medgen#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX dct: <http://purl.org/dc/terms/>
        
        SELECT DISTINCT ?disease_cui ?disease_label ?gene_uri ?gene_symbol
        WHERE {
          GRAPH <http://rdfportal.org/dataset/medgen> {
            VALUES ?disease_cui { "C0011849" }
            ?disease a mo:ConceptID ;
                dct:identifier ?disease_cui ;
                rdfs:label ?disease_label .
            ?rel a mo:MGREL ;
                mo:cui1 ?disease ;
                mo:cui2 ?gene_concept ;
                mo:rela ?rel_type .
            FILTER(CONTAINS(LCASE(?rel_type), "gene"))
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?gene_uri rdfs:label ?gene_symbol .
          }
        }
        LIMIT 50
      notes: |
        - Uses MGREL relationship filtering for gene associations
        - Performance: ~2-4s (Tier 2)

cross_references:
  - pattern: rdfs:seeAlso (via mo:mgconso blank nodes)
    description: |
      Concepts link to external databases through mgconso blank nodes containing rdfs:seeAlso properties. 
      Provides terminology mappings to multiple medical ontologies, terminologies, and genetic databases.
    databases:
      Medical Ontologies:
        - "MONDO: ~70% coverage (http://purl.obolibrary.org/obo/MONDO_*)"
        - "HPO: ~40% coverage (http://purl.obolibrary.org/obo/HP_*)"
        - "Orphanet: ~20% for rare diseases (http://www.orpha.net/ORDO/Orphanet_*)"
      Terminologies:
        - "MeSH: ~80% coverage (http://id.nlm.nih.gov/mesh/*)"
        - "SNOMED CT: ~60% coverage"
        - "ICD-10: ~50% coverage"
      Genetic Databases:
        - "OMIM: ~30% coverage (http://identifiers.org/mim/*)"
        - "ClinVar: via URI conversion for variants"
        - "NCBI Gene: via MGREL relationships (concept IDs, not numeric Gene IDs)"
    sparql: |
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT DISTINCT ?concept ?external_db
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?concept a mo:ConceptID ;
            mo:mgconso ?bn .
        ?bn rdfs:seeAlso ?external_db .
        # Filter to MONDO ontology references
        FILTER(STRSTARTS(STR(?external_db), "http://purl.obolibrary.org/obo/MONDO_"))
      }
      LIMIT 100

architectural_notes:
  query_strategy:
    - "Exploratory: Use ncbi_esearch to find example concepts and extract CUIs (C-prefixed identifiers)"
    - "Comprehensive: Use specific concept IRIs or VALUES with multiple CUIs for targeted queries"
    - "Semantic Types: Use specific type IRIs (sty:T047, sty:T191, sty:T033) instead of text search"
    - "Relationships: Use specific mo:rela values (has_manifestation, isa, disease_has_finding)"
    - "Text Search: bif:contains for unstructured label search (indexed, Virtuoso)"
    - "Priority: Specific IRIs > VALUES > Typed predicates (mo:rela) > Graph navigation > Text search"
  
  schema_design:
    - "Five entity types: ConceptID (clinical concepts), MGREL (relationships), MGSAT (attributes), MGCONSO (terminology mappings), rdf:Statement (provenance)"
    - "ConceptID uses UMLS CUI identifiers (C-prefixed strings like C0011849)"
    - "CRITICAL: Relationships stored in MGREL entities, NOT as direct ConceptID properties"
    - "Blank nodes used for MGCONSO and MGSAT to group related properties"
    - "RDF reification (206K statements) tracks provenance with dct:source, mo:sty, rdfs:comment"
    - "Semantic types from UMLS Semantic Network (sty:T*)"
    - "Key relationship types: has_manifestation (255K), isa (56K), disease_has_finding (42K)"
  
  performance:
    - "Identifier lookup: <1s (use VALUES with specific CUIs)"
    - "Semantic type filtering: <2s (use specific type IRIs)"
    - "MGREL traversal: 2-5s (use specific mo:rela values)"
    - "bif:contains search: 2-5s (indexed full-text)"
    - "Cross-reference retrieval: 5-15s (always use DISTINCT)"
    - "Cross-database queries: 3-5s (Tier 2) with optimizations (GRAPH, VALUES, split paths)"
    - "CRITICAL: Always add LIMIT when exploring MGREL/MGSAT/rdf:Statement (>1M records each)"
  
  data_integration:
    - "Primary integration via mgconso (rdfs:seeAlso to external URIs)"
    - "External URI patterns: identifiers.org (OMIM), purl.obolibrary.org (ontologies), id.nlm.nih.gov (MeSH)"
    - "Common MGREL relationship types for navigation: isa, inverse_isa, has_manifestation, manifestation_of, disease_has_finding"
    - "ClinVar linkage: disease → dct:references → blank node → rdfs:seeAlso → MedGen URI (requires namespace conversion)"
    - "Cross-database URI conversion: www.ncbi.nlm.nih.gov (MedGen) ↔ ncbi.nlm.nih.gov (ClinVar)"
  
  data_quality:
    - "skos:definition coverage: ~34% (78,578 of 233,939 concepts)"
    - "External mapping coverage varies: MeSH 80%, MONDO 70%, HPO 40%, OMIM 30%"
    - "Some relationships use mo:undefined_relationship for unclear associations"
    - "Gene associations use concept IDs (C-prefixed), not numeric NCBI Gene IDs"
    - "Cross-references often duplicated - always use DISTINCT in queries"
    - "Blank node structure requires graph navigation for MGCONSO and MGSAT access"

data_statistics:
  total_concepts: 233939
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(DISTINCT ?c) as ?count)
    FROM <http://rdfportal.org/dataset/medgen>
    WHERE { ?c a mo:ConceptID }
  
  total_relationships: 1130420
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(?r) as ?count)
    FROM <http://rdfportal.org/dataset/medgen>
    WHERE { ?r a mo:MGREL }
  
  total_attributes: 1117180
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(?a) as ?count)
    FROM <http://rdfportal.org/dataset/medgen>
    WHERE { ?a a mo:MGSAT }
  
  total_reification_statements: 206430
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(?s) as ?count)
    FROM <http://rdfportal.org/dataset/medgen>
    WHERE { ?s a rdf:Statement }
  
  coverage:
    definition_coverage: "33.6% (78,578 of 233,939)"
    verified_date: "2025-02-09"
    verification_query: |
      SELECT (COUNT(DISTINCT ?c) as ?total) (COUNT(DISTINCT ?d) as ?with_def)
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?c a mo:ConceptID .
        OPTIONAL { ?d a mo:ConceptID ; skos:definition ?def FILTER(?d = ?c) }
      }
    
    external_mapping: "~90% have at least one external cross-reference"
    note: "Coverage varies by database: MeSH 80%, MONDO 70%, HPO 40%, OMIM 30%"
  
  semantic_type_distribution:
    top_types:
      - "T033 (Finding): 106,477 concepts"
      - "T047 (Disease/Syndrome): 64,364 concepts"
      - "T191 (Neoplastic Process): 26,706 concepts"
      - "T046 (Pathologic Function): 9,654 concepts"
    verified_date: "2025-02-09"
    methodology: "Counted distinct concepts per mo:sty value"
  
  relationship_distribution:
    top_types:
      - "has_manifestation / manifestation_of: 255,600 pairs"
      - "isa / inverse_isa: 56,458 pairs"
      - "disease_has_finding / is_finding_of_disease: 41,728 pairs"
      - "disease_may_have_finding: 16,058 relationships"
    verified_date: "2025-02-09"
    methodology: "Counted MGREL records per mo:rela value"
  
  cardinality:
    avg_relationships_per_concept: 4.8
    avg_external_refs_per_concept: 3.2
    avg_attributes_per_concept: 4.8
    methodology: "Total counts divided by total concepts"
  
  performance_characteristics:
    - "Identifier lookup: <1s"
    - "Semantic type queries: <2s"
    - "bif:contains search: 2-5s"
    - "MGREL traversal: 2-5s"
    - "Cross-reference retrieval: 5-15s (use DISTINCT)"
    - "ClinVar cross-DB: 3-5s (Tier 2) with optimizations"
  
  staleness_warning: "Monthly updates from NCBI - statistics current as of February 2025"

anti_patterns:
  - title: "Using Direct Relationship Properties on ConceptID"
    problem: "Attempting to query relationships as direct properties instead of through MGREL entities."
    wrong_sparql: |
      # WRONG - No such properties exist
      SELECT ?disease ?gene
      WHERE { ?disease mo:disease_has_associated_gene ?gene }
    correct_sparql: |
      # CORRECT - Use MGREL with specific relationship type
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      
      SELECT ?disease ?gene
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?rel a mo:MGREL ;
            mo:cui1 ?disease ;
            mo:cui2 ?gene ;
            mo:rela ?rel_type .
        FILTER(CONTAINS(LCASE(?rel_type), "gene"))
      }
      LIMIT 100
    explanation: |
      All relationships between concepts use MGREL entities with mo:rela specifying type. 
      Use specific mo:rela values when possible (e.g., "has_manifestation", "isa").

  - title: "Not Using DISTINCT for Cross-References"
    problem: "mgconso cross-references return many duplicate rows without DISTINCT."
    wrong_sparql: |
      # WRONG - Returns duplicates
      SELECT ?concept ?external_db
      WHERE {
        ?concept mo:mgconso ?bn .
        ?bn rdfs:seeAlso ?external_db .
      }
    correct_sparql: |
      # CORRECT - Use DISTINCT
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT DISTINCT ?concept ?external_db
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?concept mo:mgconso ?bn .
        ?bn rdfs:seeAlso ?external_db .
      }
      LIMIT 100
    explanation: "Always use DISTINCT with mgconso to avoid duplicate external references."

  - title: "Using Text Search When Specific IRIs Available"
    problem: "Using bif:contains or FILTER(CONTAINS()) when specific semantic type IRIs or CUIs available."
    wrong_sparql: |
      # SLOW - Text search for disease concepts
      SELECT ?concept ?label
      WHERE {
        ?concept rdfs:label ?label .
        ?label bif:contains "'disease'"
      }
    correct_sparql: |
      # FAST - Use specific semantic type IRI
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX sty: <http://purl.bioontology.org/ontology/STY/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?concept ?label
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?concept a mo:ConceptID ;
            mo:sty sty:T047 ;  # Disease or Syndrome type
            rdfs:label ?label .
      }
      LIMIT 100
    explanation: |
      Use specific IRIs when available: Semantic types (sty:T047, sty:T191), concept CUIs (C0011849), 
      or relationship types (has_manifestation, isa). Text search should be last resort.

common_errors:
  - error: "Empty results when querying for relationships"
    causes:
      - "Using direct relationship properties instead of MGREL"
      - "Missing FROM <http://rdfportal.org/dataset/medgen> clause"
      - "Not specifying relationship type correctly"
    solutions:
      - "Always use MGREL: ?rel a mo:MGREL ; mo:cui1 ?c1 ; mo:cui2 ?c2 ; mo:rela ?type"
      - "Include FROM <http://rdfportal.org/dataset/medgen>"
      - "Use specific mo:rela values or FILTER(CONTAINS(LCASE(?type), \"keyword\"))"
    example_fix: |
      # WRONG
      SELECT ?disease ?gene WHERE { ?disease mo:disease_has_associated_gene ?gene }
      
      # CORRECT
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      
      SELECT ?disease ?gene
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        ?rel a mo:MGREL ;
            mo:cui1 ?disease ;
            mo:cui2 ?gene ;
            mo:rela ?type .
        VALUES ?type { "disease_has_associated_gene" }
      }
      LIMIT 100
  
  - error: "Query timeout when exploring relationships"
    causes:
      - "Querying MGREL/MGSAT/rdf:Statement without LIMIT (>1M records each)"
      - "Not using specific concept identifiers to narrow scope"
      - "Aggregating without pre-filtering"
    solutions:
      - "Always add LIMIT (100-1000 for exploration)"
      - "Use VALUES with specific concept CUIs to narrow search"
      - "Filter by specific relationship types before aggregating"
    example_fix: |
      # TIMEOUT RISK - No limit, no filters
      SELECT ?cui1 ?cui2 ?rela 
      WHERE { ?rel a mo:MGREL ; mo:cui1 ?cui1 ; mo:cui2 ?cui2 ; mo:rela ?rela }
      
      # SAFE - Specific concept and limit
      PREFIX mo: <http://med2rdf/ontology/medgen#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      SELECT ?cui2 ?rela
      FROM <http://rdfportal.org/dataset/medgen>
      WHERE {
        VALUES ?cui1 { "C0011849" }
        ?concept1 dct:identifier ?cui1 .
        ?rel a mo:MGREL ;
            mo:cui1 ?concept1 ;
            mo:cui2 ?cui2 ;
            mo:rela ?rela .
      }
      LIMIT 100
  
  - error: "Cross-database query returns no results"
    causes:
      - "URI pattern mismatch (www.ncbi.nlm.nih.gov vs ncbi.nlm.nih.gov)"
      - "Complex property paths causing timeouts"
      - "Not using GRAPH clauses properly"
    solutions:
      - "Convert URIs: BIND(IRI(REPLACE(STR(?uri), \"www.ncbi\", \"ncbi\")) AS ?converted)"
      - "Split property paths into individual patterns"
      - "Use explicit GRAPH clauses and VALUES for pre-filtering"
    example_fix: |
      # WRONG - No URI conversion, property path timeout
      WHERE {
        GRAPH <http://rdfportal.org/dataset/medgen> { 
          ?medgen a mo:ConceptID 
        }
        GRAPH <http://rdfportal.org/dataset/clinvar> { 
          ?variant cvo:disease/dct:references/rdfs:seeAlso ?medgen 
        }
      }
      
      # CORRECT - URI conversion, split paths, VALUES
      WHERE {
        GRAPH <http://rdfportal.org/dataset/medgen> {
          VALUES ?cui { "C0011849" }
          ?medgen a mo:ConceptID ; dct:identifier ?cui .
          BIND(IRI(REPLACE(STR(?medgen), "www.ncbi", "ncbi")) AS ?cv_uri)
        }
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?disease dct:references ?ref .
          ?ref rdfs:seeAlso ?cv_uri .
          ?variant cvo:disease ?disease .
        }
      }
      LIMIT 100
