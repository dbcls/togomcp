schema_info:
  title: AMR Portal RDF Database
  description: |
    Antimicrobial resistance surveillance data from NCBI Pathogen Detection, PATRIC, and CABBAGE.
    1.7M phenotypic test results and 1.1M genotypic AMR features from bacterial isolates worldwide.
    Entity types: PhenotypeMeasurement (resistance tests with MIC/disk diffusion), GenotypeFeature (AMR genes/mutations).
    Applications: resistance patterns, genotype-phenotype correlation, geographic surveillance, temporal trends.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://example.org/ebiamr#
  graphs:
    - http://rdfportal.org/dataset/amrportal
  kw_search_tools:
    - sparql
  version:
    mie_version: "1.6"
    mie_created: "2025-02-03"
    data_version: Current as of 2025
    update_frequency: Irregular updates
  license:
    data_license: Public domain (NCBI/EBI)
    license_url: https://www.ebi.ac.uk/about/terms-of-use
  access:
    rate_limiting: Standard SPARQL limits
    max_query_timeout: 60 seconds
    backend: Virtuoso

shape_expressions: |
  PREFIX amr: <http://example.org/ebiamr#>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX obo: <http://purl.obolibrary.org/obo/>

  <PhenotypeShape> {
    a [ amr:PhenotypeMeasurement ] ;
    amr:organism xsd:string ;
    amr:species xsd:string ;
    amr:genus xsd:string ;
    amr:antibioticName xsd:string ;
    amr:antibioticOntologyId IRI ? ;
    amr:resistancePhenotype xsd:string ;
    amr:bioSample IRI ;
    amr:assemblyId IRI ? ;
    amr:sraAccession IRI ? ;
    amr:country xsd:string ? ;
    amr:geographicalRegion xsd:string ? ;
    amr:isoCountryCode xsd:string ? ;
    amr:collectionYear xsd:integer ? ;
    amr:isolateId xsd:string ? ;
    amr:isolationSource xsd:string ? ;
    amr:host xsd:string ? ;
    amr:laboratoryTypingMethod xsd:string ? ;
    amr:astStandard xsd:string ? ;
    amr:measurementValue xsd:string ? ;
    amr:measurementSign xsd:string ? ;
    amr:measurementUnits xsd:string ? ;
    dct:references IRI *
  }

  <GenotypeShape> {
    a [ amr:GenotypeFeature ] ;
    amr:organism xsd:string ;
    amr:species xsd:string ;
    amr:genus xsd:string ;
    amr:amrClass xsd:string ;
    amr:amrSubclass xsd:string ? ;
    amr:amrElementSymbol xsd:string ;
    amr:geneSymbol xsd:string ;
    amr:bioSample IRI ;
    amr:assemblyId IRI ;
    amr:elementType xsd:string ;
    amr:region xsd:string ;
    amr:regionStart xsd:integer ;
    amr:regionEnd xsd:integer ;
    amr:strand xsd:string ;
    amr:evidenceType xsd:string ? ;
    amr:evidenceAccession xsd:string ? ;
    amr:antibioticName xsd:string ? ;
    obo:RO_0002162 IRI
  }

sample_rdf_entries:
  - title: Phenotypic AMR Measurement
    description: Susceptibility test for trimethoprim-sulfamethoxazole in S. pneumoniae from Thailand.
    rdf: |
      @prefix amr: <http://example.org/ebiamr#> .

      [] a amr:PhenotypeMeasurement ;
        amr:organism "Streptococcus pneumoniae" ;
        amr:antibioticName "trimethoprim-sulfamethoxazole" ;
        amr:antibioticOntologyId <http://purl.obolibrary.org/obo/ARO_3004024> ;
        amr:resistancePhenotype "susceptible" ;
        amr:bioSample <https://identifiers.org/biosample/SAMEA1028830> ;
        amr:country "Thailand" ;
        amr:collectionYear 2010 ;
        amr:laboratoryTypingMethod "disk diffusion" ;
        amr:astStandard "CLSI" .

  - title: Genotypic AMR Feature
    description: Efflux pump norM in N. gonorrhoeae with genomic coordinates.
    rdf: |
      @prefix amr: <http://example.org/ebiamr#> .
      @prefix obo: <http://purl.obolibrary.org/obo/> .

      [] a amr:GenotypeFeature ;
        amr:organism "Neisseria gonorrhoeae" ;
        amr:amrClass "EFFLUX" ;
        amr:amrElementSymbol "norM" ;
        amr:geneSymbol "mdtK" ;
        amr:bioSample <https://identifiers.org/biosample/SAMEA104147270> ;
        amr:region "ERZ25089697.1" ;
        amr:regionStart 136650 ;
        amr:regionEnd 138029 ;
        amr:strand "-" ;
        amr:evidenceType "HMM" ;
        obo:RO_0002162 <http://identifiers.org/taxonomy/485> .

  - title: Quantitative MIC Measurement
    description: Meropenem MIC test in K. pneumoniae showing resistance.
    rdf: |
      @prefix amr: <http://example.org/ebiamr#> .

      [] a amr:PhenotypeMeasurement ;
        amr:organism "Klebsiella pneumoniae" ;
        amr:antibioticName "meropenem" ;
        amr:resistancePhenotype "resistant" ;
        amr:laboratoryTypingMethod "broth dilution" ;
        amr:measurementValue "16" ;
        amr:measurementSign ">=" ;
        amr:measurementUnits "mg/L" .

  - title: Geographic Metadata
    description: Complete geographic hierarchy for E. coli ciprofloxacin resistance.
    rdf: |
      @prefix amr: <http://example.org/ebiamr#> .

      [] a amr:PhenotypeMeasurement ;
        amr:organism "Escherichia coli" ;
        amr:antibioticName "ciprofloxacin" ;
        amr:resistancePhenotype "resistant" ;
        amr:country "United States of America" ;
        amr:geographicalRegion "Americas" ;
        amr:isoCountryCode "USA" ;
        amr:collectionYear 2020 ;
        amr:isolationSource "urine" ;
        amr:host "Homo sapiens" .

  - title: Linked Phenotype-Genotype
    description: A. baumannii isolate with both resistance phenotype and AMR gene via shared bioSample.
    rdf: |
      @prefix amr: <http://example.org/ebiamr#> .
      @prefix obo: <http://purl.obolibrary.org/obo/> .

      [] a amr:PhenotypeMeasurement ;
        amr:organism "Acinetobacter baumannii" ;
        amr:antibioticName "amikacin" ;
        amr:resistancePhenotype "resistant" ;
        amr:bioSample <https://identifiers.org/biosample/SAMEA1569508> ;
        amr:country "Viet Nam" .

      [] a amr:GenotypeFeature ;
        amr:organism "Acinetobacter baumannii" ;
        amr:amrClass "MACROLIDE/STREPTOGRAMIN" ;
        amr:amrElementSymbol "msr(E)" ;
        amr:bioSample <https://identifiers.org/biosample/SAMEA1569508> ;
        obo:RO_0002162 <http://identifiers.org/taxonomy/470> .

sparql_query_examples:
  - title: Keyword search using bif:contains
    description: Find resistance data for E. coli efficiently.
    question: What resistance data exists for E. coli?
    complexity: basic
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>

      SELECT ?organism ?antibiotic ?phenotype
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:PhenotypeMeasurement ;
           amr:organism ?organism ;
           amr:antibioticName ?antibiotic ;
           amr:resistancePhenotype ?phenotype .
        ?organism bif:contains "'Escherichia'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 10

  - title: Filter by resistance phenotype
    description: Count resistant isolates by antibiotic.
    question: Which antibiotics show resistance in Salmonella?
    complexity: basic
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>

      SELECT ?antibiotic (COUNT(*) as ?count)
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:PhenotypeMeasurement ;
           amr:organism "Salmonella enterica" ;
           amr:antibioticName ?antibiotic ;
           amr:resistancePhenotype "resistant" .
      }
      GROUP BY ?antibiotic
      ORDER BY DESC(?count)
      LIMIT 20

  - title: Geographic distribution analysis
    description: Analyze ciprofloxacin resistance by country and region.
    question: Which countries have ciprofloxacin resistance?
    complexity: intermediate
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>

      SELECT ?country ?region (COUNT(*) as ?total)
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:PhenotypeMeasurement ;
           amr:antibioticName "ciprofloxacin" ;
           amr:resistancePhenotype "resistant" ;
           amr:country ?country ;
           amr:geographicalRegion ?region .
      }
      GROUP BY ?country ?region
      ORDER BY DESC(?total)
      LIMIT 20

  - title: AMR gene class distribution
    description: Most common AMR classes by species with taxonomy links.
    question: What AMR gene classes occur in different bacteria?
    complexity: intermediate
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>
      PREFIX obo: <http://purl.obolibrary.org/obo/>

      SELECT ?amrClass ?species (COUNT(*) as ?count)
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:GenotypeFeature ;
           amr:amrClass ?amrClass ;
           amr:species ?species ;
           obo:RO_0002162 ?taxon .
      }
      GROUP BY ?amrClass ?species
      ORDER BY DESC(?count)
      LIMIT 20

  - title: Temporal trend analysis
    description: Track ciprofloxacin resistance over time.
    question: How has ciprofloxacin resistance changed?
    complexity: intermediate
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>

      SELECT ?year (COUNT(*) as ?total)
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:PhenotypeMeasurement ;
           amr:antibioticName "ciprofloxacin" ;
           amr:collectionYear ?year ;
           amr:resistancePhenotype "resistant" .
        FILTER(?year >= 2010 && ?year <= 2023)
      }
      GROUP BY ?year
      ORDER BY ?year

  - title: Genotype-phenotype linking
    description: Find beta-lactam genes in carbapenem-resistant isolates.
    question: Which beta-lactam genes occur with carbapenem resistance?
    complexity: advanced
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>

      SELECT DISTINCT ?geneSymbol ?amrClass ?bioSample
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?pheno a amr:PhenotypeMeasurement ;
               amr:bioSample ?bioSample ;
               amr:antibioticName "meropenem" ;
               amr:resistancePhenotype "resistant" .
        
        ?geno a amr:GenotypeFeature ;
              amr:bioSample ?bioSample ;
              amr:geneSymbol ?geneSymbol ;
              amr:amrClass ?amrClass .
        FILTER(CONTAINS(?amrClass, "BETA-LACTAM"))
      }
      LIMIT 50

  - title: Multi-drug resistance profiling
    description: Find isolates resistant to 3+ antibiotics.
    question: Which isolates show multi-drug resistance?
    complexity: advanced
    sparql: |
      PREFIX amr: <http://example.org/ebiamr#>

      SELECT ?bioSample ?organism 
             (COUNT(DISTINCT ?ab) as ?resistantDrugs)
             (SAMPLE(?country) as ?loc)
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:PhenotypeMeasurement ;
           amr:bioSample ?bioSample ;
           amr:organism ?organism ;
           amr:antibioticName ?ab ;
           amr:resistancePhenotype "resistant" .
        OPTIONAL { ?s amr:country ?country }
      }
      GROUP BY ?bioSample ?organism
      HAVING (COUNT(DISTINCT ?ab) >= 3)
      ORDER BY DESC(?resistantDrugs)
      LIMIT 20

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chembl
    - chebi
    - reactome
    - ensembl
  examples:
    - title: Link AMR data to ChEMBL compounds
      description: |
        Integrate resistance data with ChEMBL compound properties using reverse join (small→large).
        Start with specific ChEMBL molecules then join to AMR Portal.
      databases_used:
        - amrportal
        - chembl
      complexity: intermediate
      sparql: |
        PREFIX amr: <http://example.org/ebiamr#>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

        SELECT ?chemblLabel ?antibioticName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            VALUES ?chemblLabel { "CIPROFLOXACIN" "AMPICILLIN" "GENTAMICIN" }
            ?mol a cco:SmallMolecule ;
                 rdfs:label ?chemblLabel .
          }
          BIND(LCASE(?chemblLabel) AS ?antibioticName)
          GRAPH <http://rdfportal.org/dataset/amrportal> {
            ?m a amr:PhenotypeMeasurement ;
               amr:antibioticName ?antibioticName .
          }
        }
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (reverse join), 10 (LIMIT)
        - Performance: ~1-2s (Tier 1)
        - Start ChEMBL (3 molecules) → join AMR (1.7M)
        - Use LCASE for name matching
        - MIE files referenced: chembl, amrportal

    - title: Two-stage aggregation with ChEMBL
      description: |
        Optimal pattern: aggregate in AMR first, then join results to ChEMBL.
        Stage 1: 1.7M→3 rows. Stage 2: 3 rows join trivially.
      databases_used:
        - amrportal
        - chembl
      complexity: advanced
      sparql: |
        # STAGE 1: Aggregate in AMR (5s)
        PREFIX amr: <http://example.org/ebiamr#>
        SELECT ?antibiotic (COUNT(*) as ?resistant)
        FROM <http://rdfportal.org/dataset/amrportal>
        WHERE {
          ?s a amr:PhenotypeMeasurement ;
             amr:antibioticName ?antibiotic ;
             amr:resistancePhenotype "resistant" .
          FILTER(?antibiotic IN ("ciprofloxacin", "ampicillin"))
        }
        GROUP BY ?antibiotic

        # STAGE 2: Join to ChEMBL (1s)
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        SELECT ?antibiotic ?resistant ?chemblLabel
        WHERE {
          VALUES (?antibiotic ?resistant) {
            ("ampicillin" 21660) ("ciprofloxacin" 21368)
          }
          ?mol a cco:SmallMolecule ;
               rdfs:label ?chemblLabel .
          FILTER(LCASE(?chemblLabel) = ?antibiotic)
        }
      notes: |
        - NEVER aggregate across GRAPHs
        - Total: ~6s (5s + 1s) vs timeout
        - Reduces 1.7M→3 rows before join
        - MIE files referenced: amrportal, chembl

    - title: Geographic patterns with ChEBI enrichment
      description: |
        Analyze regional resistance with chemical ontology data.
        Pre-filter geography before cross-database join.
      databases_used:
        - amrportal
        - chembl
      complexity: intermediate
      sparql: |
        PREFIX amr: <http://example.org/ebiamr#>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>

        SELECT ?region ?antibiotic 
               (COUNT(*) as ?total)
        WHERE {
          GRAPH <http://rdfportal.org/dataset/amrportal> {
            ?m a amr:PhenotypeMeasurement ;
               amr:antibioticName ?antibiotic ;
               amr:geographicalRegion ?region ;
               amr:resistancePhenotype "resistant" .
            FILTER(?region = "Americas" && ?antibiotic = "ciprofloxacin")
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?mol a cco:SmallMolecule ;
                 rdfs:label ?label .
            FILTER(LCASE(?label) = ?antibiotic)
          }
        }
        GROUP BY ?region ?antibiotic
        LIMIT 20
      notes: |
        - Filter region+antibiotic BEFORE join
        - Performance: ~3-5s (Tier 2)
        - Geographic filter reduces dataset
        - MIE files referenced: amrportal, chembl

cross_references:
  - pattern: amr:bioSample
    description: Links to NCBI BioSample for metadata; primary key for phenotype-genotype linking.
    databases:
      sequence_archives:
        - "BioSample: 170,958 samples"
    sparql: |
      SELECT DISTINCT ?bioSample
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE { ?s amr:bioSample ?bioSample }
      LIMIT 100

  - pattern: amr:sraAccession / amr:assemblyId
    description: Links to SRA and INSDC genome assemblies.
    databases:
      sequence_archives:
        - "SRA: ~870K accessions"
        - "INSDC: ~890K assemblies"
    sparql: |
      SELECT DISTINCT ?sra ?assembly
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE { 
        ?s amr:sraAccession ?sra .
        OPTIONAL { ?s amr:assemblyId ?assembly }
      }
      LIMIT 100

  - pattern: dct:references
    description: Citations to PubMed literature.
    databases:
      literature:
        - "PubMed: Multiple publications"
    sparql: |
      SELECT DISTINCT ?pubmed
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE { ?s dct:references ?pubmed }
      LIMIT 100

  - pattern: amr:antibioticOntologyId
    description: Links to ARO for standardized antibiotic terms.
    databases:
      ontologies:
        - "ARO: CARD antibiotic classifications"
    sparql: |
      SELECT DISTINCT ?aro ?antibiotic
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s amr:antibioticName ?antibiotic ;
           amr:antibioticOntologyId ?aro .
      }
      LIMIT 100

  - pattern: obo:RO_0002162
    description: Links genotypes to NCBI Taxonomy.
    databases:
      taxonomy:
        - "NCBI Taxonomy: All genotype features"
    sparql: |
      SELECT DISTINCT ?taxon ?organism
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE {
        ?s a amr:GenotypeFeature ;
           amr:organism ?organism ;
           obo:RO_0002162 ?taxon .
      }
      LIMIT 100

architectural_notes:
  schema_design:
    - Two entities: PhenotypeMeasurement (1.7M), GenotypeFeature (1.1M)
    - Blank nodes for all measurements
    - BioSample links phenotype↔genotype
    - Geographic hierarchy (region→subregion→country→ISO)
    - 92 collection years (1911-2025)
  performance:
    - Large dataset requires careful queries
    - CRITICAL: Organism+phenotype filter causes timeout - use two-stage
    - Use LIMIT for exploration
    - Filter single antibiotic before aggregation
    - Geographic/temporal filters help
    - bif:contains for keyword search
    - SAMPLE() for representative data
    - "Cross-DB: reverse join (ChEMBL→AMR) or two-stage aggregation"
    - NEVER aggregate across GRAPHs
  data_integration:
    - Links: BioSample, SRA, INSDC, PubMed, ARO, Taxonomy
    - Phenotype-genotype via bioSample
    - Co-located: chembl, chebi, reactome, ensembl (EBI endpoint)
    - ChEMBL via antibiotic name matching
    - Two-stage pattern for analytics
  data_quality:
    - Controlled vocabulary for phenotypes
    - Inconsistent capitalization in isolation sources
    - 16% lack full geography
    - 19.5% lack resistance phenotype
    - Lab methods: 56% broth dilution, 8% agar, 7% disk

data_statistics:
  total_phenotypes: 1714486
  total_genotypes: 1164007
  unique_biosamples: 170958
  verified_date: "2025-02-03"
  verification_query: |
    PREFIX amr: <http://example.org/ebiamr#>
    SELECT (COUNT(DISTINCT ?b) as ?count)
    FROM <http://rdfportal.org/dataset/amrportal>
    WHERE { ?s amr:bioSample ?b }

  coverage:
    phenotype_with_country: 83.9% (1,438,018)
    phenotype_with_year: 78.4% (1,343,508)
    genotype_with_antibiotic: 78.5% (913,209)
    verification_query: |
      SELECT (COUNT(*) as ?total) (COUNT(?c) as ?withCountry)
      WHERE { ?s a amr:PhenotypeMeasurement . OPTIONAL { ?s amr:country ?c }}

  resistance_distribution:
    susceptible: 60.7% (1,040,897)
    resistant: 17.7% (302,729)
    intermediate: 2.1% (35,332)
    missing: 19.5%

  cardinality:
    avg_phenotypes_per_biosample: 10.0
    avg_genotypes_per_biosample: 6.8
    countries: 153

  performance:
    - "Single antibiotic: <5s"
    - "Aggregations without filters: 5-10s"
    - "Organism+phenotype: timeout (use two-stage)"
    - "Cross-DB reverse join: 1-2s"
    - "Two-stage aggregation: ~6s"

  staleness_warning: Irregular updates; stats verified 2025-02-03

anti_patterns:
  - title: Cross-DB aggregation causes timeout
    problem: Aggregating across GRAPHs with filters creates massive intermediate results.
    wrong_sparql: |
      # BAD: Aggregates across GRAPHs
      SELECT ?ab (COUNT(?m) as ?count)
      WHERE {
        GRAPH <amr> { ?m amr:antibioticName ?ab ; amr:resistancePhenotype "resistant" }
        GRAPH <chembl> { ?mol rdfs:label ?label FILTER(LCASE(?label) = ?ab) }
      }
      GROUP BY ?ab
    correct_sparql: |
      # GOOD: Two-stage (aggregate first, then join)
      # Stage 1: Aggregate in AMR
      SELECT ?ab (COUNT(*) as ?count)
      FROM <amr>
      WHERE { ?m amr:antibioticName ?ab ; amr:resistancePhenotype "resistant" }
      GROUP BY ?ab

      # Stage 2: Join results
      SELECT ?ab ?count ?mol
      WHERE {
        VALUES (?ab ?count) { ("ciprofloxacin" 21368) }
        ?mol rdfs:label ?label FILTER(LCASE(?label) = ?ab)
      }
    explanation: Aggregate within single database first (1.7M→few rows), then join. Never aggregate across GRAPHs.

  - title: Large-to-small join order (slow)
    problem: Starting with large AMR dataset creates 100K+ rows before join.
    wrong_sparql: |
      WHERE {
        GRAPH <amr> { ?m amr:antibioticName ?ab ; amr:organism "E. coli" }
        GRAPH <chembl> { ?mol rdfs:label ?label FILTER(LCASE(?label) = ?ab) }
      }
    correct_sparql: |
      WHERE {
        GRAPH <chembl> {
          VALUES ?label { "CIPROFLOXACIN" "AMPICILLIN" }
          ?mol a cco:SmallMolecule ; rdfs:label ?label .
        }
        BIND(LCASE(?label) AS ?ab)
        GRAPH <amr> { ?m amr:antibioticName ?ab }
      }
    explanation: Start small (ChEMBL 3 molecules) then join large (AMR 1.7M). Reverse join order.

  - title: Missing LIMIT or graph filter
    problem: Broad aggregations without selective filters timeout.
    wrong_sparql: |
      SELECT ?ab (COUNT(*) as ?c)
      WHERE { ?s a amr:PhenotypeMeasurement ; amr:antibioticName ?ab }
      GROUP BY ?ab
    correct_sparql: |
      SELECT ?ab (COUNT(*) as ?c)
      FROM <http://rdfportal.org/dataset/amrportal>
      WHERE { ?s a amr:PhenotypeMeasurement ; amr:antibioticName ?ab }
      GROUP BY ?ab
      LIMIT 50
    explanation: Always use FROM clause and LIMIT. Add antibiotic or geographic filters for broad queries.

common_errors:
  - error: Query timeout
    causes:
      - No LIMIT on exploration
      - Organism+phenotype combined filter
      - Multiple phenotype↔genotype JOINs
      - Cross-GRAPH aggregation
    solutions:
      - Add LIMIT 100 initially
      - Two-stage aggregation pattern
      - Single antibiotic filter
      - Geographic/temporal filters
      - "Cross-DB: reverse join (small→large)"
      - SAMPLE() for representative data
    example_fix: |
      # Timeout: organism+phenotype
      WHERE { ?s amr:organism ?o ; amr:resistancePhenotype "resistant" }

      # Works: add geographic filter
      WHERE {
        ?s amr:organism ?o ;
           amr:geographicalRegion "Asia" ;
           amr:resistancePhenotype "resistant" .
      }
      LIMIT 50

  - error: Empty results from text matching
    causes:
      - Case sensitivity
      - Spelling variations
      - ChEMBL uppercase vs AMR lowercase
    solutions:
      - Use bif:contains for flexible matching
      - Check actual values with DISTINCT first
      - Use LCASE() for cross-DB matching
      - BIND(LCASE()) for normalization
    example_fix: |
      # May fail: exact match
      FILTER(?source = "stool")

      # Better: keyword search
      ?source bif:contains "'stool'" option (score ?sc)

      # Cross-DB: normalize case
      FILTER(LCASE(?chemblLabel) = ?antibioticName)

  - error: Incomplete genotype-phenotype links
    causes:
      - Not all biosamples have both types
      - Only 65% phenotypes have genotypes
      - Only 78.5% genotypes have antibiotics
    solutions:
      - Check coverage before complex joins
      - Use specific bioSample filters
      - Verify with COUNT queries first
      - LIMIT to test linkage patterns
    example_fix: |
      # Verify linkage first
      SELECT ?b (COUNT(?p) as ?pCount) (COUNT(?g) as ?gCount)
      WHERE {
        ?p a amr:PhenotypeMeasurement ; amr:bioSample ?b .
        ?g a amr:GenotypeFeature ; amr:bioSample ?b .
      }
      GROUP BY ?b
      LIMIT 10
