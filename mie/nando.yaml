schema_info:
  title: NANDO (Nanbyo Data)
  description: |
    NANDO is an ontology for Japanese intractable (rare) diseases with 2,777 disease classes in hierarchical taxonomy. Focuses on designated intractable diseases eligible for government support programs. Includes multilingual labels (English, Japanese kanji, hiragana), notification numbers, descriptions, and cross-references to MONDO and external resources (KEGG, government documents).
  endpoint: https://rdfportal.org/primary/sparql
  base_uri: http://nanbyodata.jp/ontology/
  graphs:
    - http://nanbyodata.jp/ontology/nando
  kw_search_tools:
    - OLS4:searchClasses
  version:
    mie_version: "1.3"
    mie_created: "2025-01-01"
    mie_updated: "2025-02-04"
    data_version: "Current release"
    update_frequency: "Quarterly"
  license:
    data_license: "CC BY 4.0"
    license_url: "https://creativecommons.org/licenses/by/4.0/"
  access:
    rate_limiting: "100 queries/min"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX obo: <http://purl.obolibrary.org/obo/>
  PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
  PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
  
  <DiseaseShape> {
    a [ owl:Class ] ;
    rdfs:label xsd:string + ;
    dct:identifier xsd:string ;
    skos:prefLabel xsd:string ;
    nando:hasNotificationNumber xsd:string ? ;
    dct:source IRI ? ;
    rdfs:seeAlso IRI * ;
    skos:closeMatch IRI * ;
    skos:altLabel xsd:string * ;
    dct:description xsd:string ? ;
    rdfs:subClassOf IRI * ;
    owl:deprecated xsd:integer ?
  }

sample_rdf_entries:
  - title: Designated Intractable Disease with Full Metadata
    description: Spinal and bulbar muscular atrophy (Kennedy disease) with trilingual labels, notification number, and cross-references.
    rdf: |
      @prefix nando: <http://nanbyodata.jp/ontology/NANDO_> .
      @prefix owl: <http://www.w3.org/2002/07/owl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      @prefix skos: <http://www.w3.org/2004/02/skos/core#> .
      
      nando:1200001 a owl:Class ;
        dct:identifier "NANDO:1200001" ;
        nando:hasNotificationNumber "1" ;
        rdfs:label "Spinal and bulbar muscular atrophy"@en ;
        rdfs:label "球脊髄性筋萎縮症"@ja ;
        rdfs:label "きゅうせきずいせいきんいしゅくしょう"@ja-hira ;
        skos:prefLabel "球脊髄性筋萎縮症"@ja ;
        skos:altLabel "Kennedy disease"@en, "SBMA"@en ;
        dct:description "通常成人男性に発症する、遺伝性下位運動ニューロン疾患である。"@ja ;
        rdfs:subClassOf nando:1100001 ;
        skos:closeMatch <http://purl.obolibrary.org/obo/MONDO_0010735> ;
        rdfs:seeAlso <https://www.kegg.jp/dbget-bin/www_bget?ds_ja:H00455> .

  - title: Disease Category (Parent Class)
    description: Neuromuscular disease category serving as parent class in NANDO hierarchy.
    rdf: |
      @prefix nando: <http://nanbyodata.jp/ontology/NANDO_> .
      @prefix owl: <http://www.w3.org/2002/07/owl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix skos: <http://www.w3.org/2004/02/skos/core#> .
      
      nando:1100001 a owl:Class ;
        rdfs:label "Neuromuscular disease"@en ;
        rdfs:label "神経・筋疾患"@ja ;
        skos:prefLabel "神経・筋疾患"@ja ;
        rdfs:subClassOf nando:1000001 ;
        skos:closeMatch <http://purl.obolibrary.org/obo/MONDO_0019056> .

  - title: Disease with Multiple MONDO Mappings
    description: Metabolic disease category with one-to-many MONDO cross-references.
    rdf: |
      @prefix nando: <http://nanbyodata.jp/ontology/NANDO_> .
      @prefix owl: <http://www.w3.org/2002/07/owl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix skos: <http://www.w3.org/2004/02/skos/core#> .
      
      nando:1100002 a owl:Class ;
        rdfs:label "Metabolic disease"@en ;
        rdfs:label "代謝系疾患"@ja ;
        skos:prefLabel "代謝系疾患"@ja ;
        rdfs:subClassOf nando:1000001 ;
        skos:closeMatch <http://purl.obolibrary.org/obo/MONDO_0004955> ;
        skos:closeMatch <http://purl.obolibrary.org/obo/MONDO_0005066> .

  - title: Disease with External Documentation Links
    description: Parkinson's disease with comprehensive external references to government documents, patient resources, and KEGG.
    rdf: |
      @prefix nando: <http://nanbyodata.jp/ontology/NANDO_> .
      @prefix owl: <http://www.w3.org/2002/07/owl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      @prefix skos: <http://www.w3.org/2004/02/skos/core#> .
      
      nando:1200010 a owl:Class ;
        nando:hasNotificationNumber "6" ;
        rdfs:label "Parkinson's disease"@en ;
        rdfs:label "パーキンソン病"@ja ;
        skos:prefLabel "パーキンソン病"@ja ;
        skos:altLabel "PD"@en, "Parkinson disease"@en ;
        rdfs:subClassOf nando:1100001 ;
        skos:closeMatch <http://purl.obolibrary.org/obo/MONDO_0005180> ;
        rdfs:seeAlso <https://www.kegg.jp/dbget-bin/www_bget?ds_ja:H00057> ;
        dct:source <https://www.nanbyou.or.jp/wp-content/uploads/upload_files/File/006-201804-kojin.pdf> .

  - title: Root Ontology Class
    description: Top-level intractable disease class at root of NANDO taxonomy.
    rdf: |
      @prefix nando: <http://nanbyodata.jp/ontology/NANDO_> .
      @prefix owl: <http://www.w3.org/2002/07/owl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      
      nando:0000001 a owl:Class ;
        rdfs:label "Intractable disease"@en ;
        rdfs:label "難病"@ja ;
        rdfs:label "なんびょう"@ja-hira ;
        rdfs:subClassOf owl:Thing .

sparql_query_examples:
  - title: Find diseases by keyword
    description: Search diseases using full-text indexing on English labels.
    question: Find diseases related to Parkinson's
    complexity: basic
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      SELECT ?disease ?label ?identifier
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 rdfs:label ?label ;
                 dct:identifier ?identifier .
        ?label bif:contains "'Parkinson*'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 20

  - title: List disease categories
    description: Retrieve top-level categories with multilingual labels.
    question: What are the main disease categories?
    complexity: basic
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
      
      SELECT ?category ?en_label ?ja_label
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?category a owl:Class ;
                  rdfs:subClassOf nando:1000001 ;
                  rdfs:label ?en_label ;
                  rdfs:label ?ja_label .
        FILTER(LANG(?en_label) = "en")
        FILTER(LANG(?ja_label) = "ja" && !REGEX(STR(?ja_label), "^[ぁ-ん]+$"))
      }
      ORDER BY ?en_label

  - title: Get MONDO cross-references
    description: Find diseases mapped to MONDO Disease Ontology for international harmonization.
    question: Which diseases have MONDO mappings?
    complexity: intermediate
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      
      SELECT ?disease ?label ?mondo_id
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 rdfs:label ?label ;
                 skos:closeMatch ?mondo_id .
        FILTER(STRSTARTS(STR(?mondo_id), "http://purl.obolibrary.org/obo/MONDO_"))
        FILTER(LANG(?label) = "en")
      }
      LIMIT 50

  - title: Find designated diseases
    description: Retrieve diseases eligible for Japanese government support with notification numbers.
    question: List designated intractable diseases with official numbers
    complexity: intermediate
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
      
      SELECT ?disease ?prefLabel ?en_label ?notif_num
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 skos:prefLabel ?prefLabel ;
                 nando:hasNotificationNumber ?notif_num .
        OPTIONAL {
          ?disease rdfs:label ?en_label .
          FILTER(LANG(?en_label) = "en")
        }
      }
      ORDER BY xsd:integer(?notif_num)
      LIMIT 50

  - title: Navigate disease hierarchy
    description: Show parent-child relationships within disease categories.
    question: What diseases are under a specific category?
    complexity: intermediate
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
      
      SELECT ?parent_label ?child ?child_label
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?child rdfs:subClassOf ?parent ;
               rdfs:label ?child_label ;
               a owl:Class .
        ?parent rdfs:label ?parent_label ;
                a owl:Class .
        FILTER(LANG(?child_label) = "en" && LANG(?parent_label) = "en")
        FILTER(?parent = nando:1100001)
      }
      ORDER BY ?child_label

  - title: Complex multi-filter search
    description: Advanced query combining keywords, external links, and multilingual labels.
    question: Find neuromuscular diseases with KEGG and MONDO links
    complexity: advanced
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
      
      SELECT ?disease ?identifier ?en_label ?ja_label ?kegg ?mondo
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 rdfs:subClassOf+ nando:1100001 ;
                 dct:identifier ?identifier ;
                 rdfs:label ?en_label ;
                 rdfs:label ?ja_label ;
                 rdfs:seeAlso ?kegg .
        OPTIONAL {
          ?disease skos:closeMatch ?mondo .
          FILTER(STRSTARTS(STR(?mondo), "http://purl.obolibrary.org/obo/MONDO_"))
        }
        FILTER(LANG(?en_label) = "en")
        FILTER(LANG(?ja_label) = "ja" && !REGEX(STR(?ja_label), "^[ぁ-ん]+$"))
        FILTER(CONTAINS(STR(?kegg), "kegg.jp"))
      }
      ORDER BY ?identifier
      LIMIT 30

  - title: Statistical aggregation
    description: Count diseases per category with representative examples.
    question: How many diseases in each category?
    complexity: advanced
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
      
      SELECT ?category ?category_label (COUNT(DISTINCT ?disease) as ?count)
             (GROUP_CONCAT(DISTINCT ?example; separator="; ") as ?examples)
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?category a owl:Class ;
                  rdfs:subClassOf nando:1000001 ;
                  rdfs:label ?category_label .
        ?disease rdfs:subClassOf ?category ;
                 rdfs:label ?example ;
                 a owl:Class .
        FILTER(LANG(?category_label) = "en")
        FILTER(LANG(?example) = "en")
      }
      GROUP BY ?category ?category_label
      ORDER BY DESC(?count)

cross_database_queries:
  shared_endpoint: primary
  co_located_databases:
    - mesh
    - go
    - taxonomy
    - mondo
    - bacdive
    - mediadive
  mie_files_consulted:
    - mesh (meshv:TopicalDescriptor, bif:contains, graph URI)
    - go (owl:Class, oboinowl:hasOBONamespace, STR() restriction, graph URI)
  examples:
    - title: Link NANDO to MeSH Subject Headings
      description: |
        Integrate Japanese rare diseases with MeSH medical terminology for literature connection.
        Enables Japanese researchers to link designated intractable diseases with PubMed-indexed literature.
      databases_used:
        - nando
        - mesh
      complexity: intermediate
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
        
        SELECT ?nandoDisease ?nandoLabel ?meshTerm ?meshLabel
        WHERE {
          GRAPH <http://nanbyodata.jp/ontology/nando> {
            ?nandoDisease a owl:Class ;
              rdfs:label ?nandoLabel .
            FILTER(LANG(?nandoLabel) = "en")
            ?nandoLabel bif:contains "'parkinson'" option (score ?sc1)
          }
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshTerm a meshv:TopicalDescriptor ;
              rdfs:label ?meshLabel .
            ?meshLabel bif:contains "'parkinson'" option (score ?sc2)
          }
        }
        ORDER BY DESC(?sc1)
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 10 (LIMIT)
        - Pre-filtering: NANDO 2,777 → ~10, MeSH 869K → ~20 (99.6% reduction)
        - Performance: ~1-2s (Tier 1)
        - Uses meshv:TopicalDescriptor from MeSH MIE file
        - Graph URIs from both MIE files
        - No direct semantic links, keyword-based integration

    - title: Connect NANDO to GO Biological Processes
      description: |
        Bridge rare disease classification with biological process annotations.
        Supports molecular mechanism research for intractable diseases using systems biology approaches.
      databases_used:
        - nando
        - go
      complexity: intermediate
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX oboinowl: <http://www.geneontology.org/formats/oboInOwl#>
        
        SELECT ?nandoDisease ?nandoLabel ?goTerm ?goLabel
        WHERE {
          GRAPH <http://nanbyodata.jp/ontology/nando> {
            ?nandoDisease a owl:Class ;
              rdfs:label ?nandoLabel .
            FILTER(LANG(?nandoLabel) = "en")
            FILTER(CONTAINS(LCASE(?nandoLabel), "metabolic"))
          }
          
          GRAPH <http://rdfportal.org/ontology/go> {
            ?goTerm a owl:Class ;
              rdfs:label ?goLabel ;
              oboinowl:hasOBONamespace ?goNamespace .
            FILTER(STRSTARTS(STR(?goTerm), "http://purl.obolibrary.org/obo/GO_"))
            FILTER(CONTAINS(LCASE(?goLabel), "metabolic"))
            FILTER(STR(?goNamespace) = "biological_process")
          }
        }
        LIMIT 15
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 9 (STR type), 10 (LIMIT)
        - Pre-filtering: NANDO 2,777 → ~50, GO 48K → ~1K (98%+ reduction)
        - Performance: ~2-3s (Tier 1)
        - Uses oboinowl:hasOBONamespace from GO MIE file
        - STR() required for namespace comparison (Strategy 9)
        - Graph URIs from both MIE files
        - CONTAINS for cross-database stability

    - title: Three-way Integration (NANDO-MeSH-GO)
      description: |
        Comprehensive integration linking rare diseases, clinical terminology, and molecular mechanisms.
        Creates semantic triangle for multifaceted rare disease research combining Japanese disease classification, literature indexing, and biological processes.
      databases_used:
        - nando
        - mesh
        - go
      complexity: advanced
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
        PREFIX oboinowl: <http://www.geneontology.org/formats/oboInOwl#>
        
        SELECT DISTINCT ?nandoLabel ?meshLabel ?goLabel
        WHERE {
          GRAPH <http://nanbyodata.jp/ontology/nando> {
            ?nandoDisease a owl:Class ;
              rdfs:label ?nandoLabel .
            FILTER(LANG(?nandoLabel) = "en")
            FILTER(CONTAINS(LCASE(?nandoLabel), "immune"))
          }
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshTerm a meshv:TopicalDescriptor ;
              rdfs:label ?meshLabel .
            FILTER(CONTAINS(LCASE(?meshLabel), "immune"))
          }
          
          GRAPH <http://rdfportal.org/ontology/go> {
            ?goTerm a owl:Class ;
              rdfs:label ?goLabel ;
              oboinowl:hasOBONamespace ?goNamespace .
            FILTER(STRSTARTS(STR(?goTerm), "http://purl.obolibrary.org/obo/GO_"))
            FILTER(CONTAINS(LCASE(?goLabel), "immune"))
            FILTER(STR(?goNamespace) = "biological_process")
          }
        }
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 9 (STR type), 10 (LIMIT)
        - Pre-filtering: NANDO 2,777 → ~50, MeSH 869K → ~200, GO 48K → ~100 (99.8%+ reduction)
        - Performance: ~3-5s (Tier 2)
        - Three-way queries use CONTAINS (not bif:contains) for stability
        - Complex GO filters cause 400 errors in three-way context
        - Use case: Exploratory research across clinical and molecular data

cross_references:
  - pattern: skos:closeMatch
    description: |
      Links to MONDO Disease Ontology for international harmonization. 2,150 diseases have MONDO mappings (77% coverage).
    databases:
      disease_ontologies:
        - "MONDO: 2,150 mappings for international disease alignment"
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      
      SELECT ?disease ?mondo
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 skos:closeMatch ?mondo .
        FILTER(STRSTARTS(STR(?mondo), "http://purl.obolibrary.org/obo/MONDO_"))
      }
      LIMIT 100

  - pattern: rdfs:seeAlso
    description: |
      External references to KEGG Disease (519 links), government documents (MHLW), patient portals (Nanbyou.or.jp), and clinical databases.
    databases:
      molecular_databases:
        - "KEGG Disease: 519 links for pathway/gene associations"
      government_resources:
        - "MHLW: Official designation documents (.docx)"
      patient_resources:
        - "Nanbyou.or.jp: Patient information and support"
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?disease ?external_ref
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 rdfs:seeAlso ?external_ref .
        FILTER(CONTAINS(STR(?external_ref), "kegg.jp") || 
               CONTAINS(STR(?external_ref), "mhlw.go.jp") ||
               CONTAINS(STR(?external_ref), "nanbyou.or.jp"))
      }
      LIMIT 100

  - pattern: dct:source
    description: |
      Source documentation linking to official government PDFs with diagnostic criteria and clinical management. 1,211 diseases have source references (44% coverage).
    databases:
      documentation:
        - "Nanbyou.or.jp: 1,211 source PDFs with clinical guidelines"
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      SELECT ?disease ?source_doc
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ;
                 dct:source ?source_doc .
      }
      LIMIT 100

architectural_notes:
  schema_design:
    - "Hierarchical: owl:Thing → Intractable disease → Disease categories (11xxxxx) → Specific diseases (12xxxxx)"
    - Multilingual labels with language tags (@en, @ja, @ja-hira)
    - Root class NANDO:0000001 as top-level concept
  performance:
    - Use bif:contains for keywords (10-100x faster than REGEX)
    - Language filtering: FILTER(LANG(?label) = 'en') is efficient
    - Cross-reference: STRSTARTS filtering on URI patterns
    - Cross-DB pre-filtering (Strategy 2) reduces joins by 99%+
    - bif:contains (Strategy 4) provides 10-100x speedup
  data_integration:
    - MONDO mappings via skos:closeMatch (77% coverage)
    - KEGG links provide molecular context (19% coverage)
    - Government documents contain diagnostic criteria
    - Shares 'primary' endpoint with mesh, go, taxonomy, mondo, bacdive, mediadive
    - Cross-DB via keyword matching (no direct semantic links)
  data_quality:
    - All 2,777 diseases have identifier, rdfs:label, skos:prefLabel
    - 88% have notification numbers
    - 77% have MONDO mappings
    - 44% have descriptions
    - Hiragana pattern: ^[ぁ-ん]+$

data_statistics:
  total_diseases: 2777
  verified_date: "2025-02-04"
  verification_query: |
    PREFIX owl: <http://www.w3.org/2002/07/owl#>
    SELECT (COUNT(DISTINCT ?disease) as ?total)
    FROM <http://nanbyodata.jp/ontology/nando>
    WHERE {
      ?disease a owl:Class .
      FILTER(STRSTARTS(STR(?disease), "http://nanbyodata.jp/ontology/NANDO_"))
    }
  
  coverage:
    designated_diseases: "88% (2,454/2,777)"
    mondo_mappings: "77% (2,150/2,777)"
    kegg_links: "19% (519/2,777)"
    descriptions: "44% (1,211/2,777)"
    verification_queries: |
      # Designated diseases
      PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
      SELECT (COUNT(?d) as ?count)
      WHERE { ?d nando:hasNotificationNumber ?n }
      
      # MONDO mappings
      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
      SELECT (COUNT(?d) as ?count)
      WHERE {
        ?d skos:closeMatch ?m .
        FILTER(STRSTARTS(STR(?m), "http://purl.obolibrary.org/obo/MONDO_"))
      }
  
  cardinality:
    avg_labels_per_disease: 3.0
    avg_external_refs_per_disease: 2.2
    methodology: "Sampled 100 diseases and calculated averages"
  
  performance_characteristics:
    - "Basic keyword searches: <1s"
    - "Hierarchical queries: 1-3s"
    - "Multi-join cross-references: 2-5s"
    - "bif:contains searches: <500ms"
    - "Cross-DB (2-way): 1-3s (Tier 1)"
    - "Cross-DB (3-way): 3-5s (Tier 2)"
    - "Pre-filtering gain: 99%+ reduction in join size"

anti_patterns:
  - title: Using REGEX instead of bif:contains
    problem: REGEX is slow and lacks relevance ranking
    wrong_sparql: |
      SELECT ?disease ?label
      WHERE {
        ?disease rdfs:label ?label .
        FILTER(REGEX(?label, "Parkinson", "i"))
      }
    correct_sparql: |
      SELECT ?disease ?label
      WHERE {
        ?disease rdfs:label ?label .
        ?label bif:contains "'Parkinson*'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
    explanation: bif:contains uses full-text indexing (Strategy 4) for 10-100x speedup with relevance scoring.

  - title: Not filtering language tags
    problem: Returns all language variants creating duplicates
    wrong_sparql: |
      SELECT ?disease ?label
      WHERE {
        ?disease a owl:Class ;
                 rdfs:label ?label .
      }
    correct_sparql: |
      SELECT ?disease ?en_label ?ja_label
      WHERE {
        ?disease a owl:Class ;
                 rdfs:label ?en_label ;
                 rdfs:label ?ja_label .
        FILTER(LANG(?en_label) = "en")
        FILTER(LANG(?ja_label) = "ja" && !REGEX(STR(?ja_label), "^[ぁ-ん]+$"))
      }
    explanation: Explicit language filtering separates English, kanji, and hiragana labels.

  - title: Cross-DB query without pre-filtering
    problem: Filtering after join causes timeout processing millions of rows
    wrong_sparql: |
      WHERE {
        GRAPH <http://nanbyodata.jp/ontology/nando> {
          ?d a owl:Class ; rdfs:label ?l .
        }
        GRAPH <http://id.nlm.nih.gov/mesh> {
          ?m a meshv:TopicalDescriptor ; rdfs:label ?ml .
        }
        FILTER(CONTAINS(?l, "parkinson"))
      }
    correct_sparql: |
      WHERE {
        GRAPH <http://nanbyodata.jp/ontology/nando> {
          ?d a owl:Class ; rdfs:label ?l .
          FILTER(LANG(?l) = "en")
          ?l bif:contains "'parkinson'" option (score ?sc)
        }
        GRAPH <http://id.nlm.nih.gov/mesh> {
          ?m a meshv:TopicalDescriptor ; rdfs:label ?ml .
          ?ml bif:contains "'parkinson'"
        }
      }
      LIMIT 10
    explanation: Strategy 2 pre-filtering (NANDO 2,777 → ~10, MeSH 869K → ~20) reduces join from 2.4M to ~200 combinations (99.99% reduction).

common_errors:
  - error: Empty result set
    causes:
      - Missing graph in FROM clause
      - Wrong language tag filter
    solutions:
      - Always include FROM <http://nanbyodata.jp/ontology/nando>
      - Use FILTER(LANG(?label) = "en") for English
    example_fix: |
      # Wrong
      SELECT ?disease ?label
      WHERE { ?disease rdfs:label ?label . }
      
      # Correct
      SELECT ?disease ?label
      FROM <http://nanbyodata.jp/ontology/nando>
      WHERE {
        ?disease a owl:Class ; rdfs:label ?label .
        FILTER(LANG(?label) = "en")
      }

  - error: Query timeout on MONDO queries
    causes:
      - Not using STRSTARTS filter early
      - Missing LIMIT clause
    solutions:
      - Apply STRSTARTS filter before join
      - Always add LIMIT for exploratory queries
    example_fix: |
      # Slow - filters after join
      WHERE {
        ?disease skos:closeMatch ?mondo ; rdfs:label ?label .
        FILTER(STRSTARTS(STR(?mondo), "http://purl.obolibrary.org/obo/MONDO_"))
      }
      
      # Fast - filters before join
      WHERE {
        ?disease a owl:Class ; rdfs:label ?label .
        ?disease skos:closeMatch ?mondo .
        FILTER(STRSTARTS(STR(?mondo), "http://purl.obolibrary.org/obo/MONDO_"))
      }
      LIMIT 100

  - error: Cannot distinguish kanji from hiragana
    causes:
      - Both use @ja tag
      - Not using regex pattern
    solutions:
      - Hiragana: FILTER(REGEX(STR(?label), "^[ぁ-ん]+$"))
      - Kanji: FILTER(LANG(?label) = "ja" && !REGEX(STR(?label), "^[ぁ-ん]+$"))
    example_fix: |
      SELECT ?disease ?en ?ja_kanji ?ja_hira
      WHERE {
        ?disease a owl:Class .
        OPTIONAL { ?disease rdfs:label ?en . FILTER(LANG(?en) = "en") }
        OPTIONAL {
          ?disease rdfs:label ?ja_kanji .
          FILTER(LANG(?ja_kanji) = "ja" && !REGEX(STR(?ja_kanji), "^[ぁ-ん]+$"))
        }
        OPTIONAL {
          ?disease rdfs:label ?ja_hira .
          FILTER(REGEX(STR(?ja_hira), "^[ぁ-ん]+$"))
        }
      }

  - error: Cross-DB timeout or empty results
    causes:
      - Missing pre-filtering (Strategy 2)
      - Wrong graph URIs from co-database
      - Missing STR() for GO namespace (Strategy 9)
    solutions:
      - Read co-database MIE files first
      - Apply FILTER within source GRAPH clause
      - Use STR() for GO namespace: FILTER(STR(?ns) = "biological_process")
      - Test each GRAPH independently
    example_fix: |
      # Wrong - no pre-filtering
      GRAPH <http://nanbyodata.jp/ontology/nando> { ?d ?p ?o }
      GRAPH <http://id.nlm.nih.gov/mesh> { ?m ?p2 ?d }
      
      # Correct - pre-filter (Strategy 2)
      GRAPH <http://nanbyodata.jp/ontology/nando> {
        ?d a owl:Class ; rdfs:label ?l .
        ?l bif:contains "'parkinson'" option (score ?sc)
      }
      GRAPH <http://id.nlm.nih.gov/mesh> {
        ?m a meshv:TopicalDescriptor ; rdfs:label ?ml .
        ?ml bif:contains "'parkinson'"
      }
      LIMIT 10
