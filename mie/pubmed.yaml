schema_info:
  title: PubMed
  description: |
    Biomedical literature database with 37+ million citations from MEDLINE, life science journals, and online books.
    Contains publication metadata (titles, abstracts, authors, affiliations, journals), MeSH term annotations, 
    and extensive cross-references. Primary entity types: research articles, reviews, authors, journals, MeSH annotations.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://rdf.ncbi.nlm.nih.gov/pubmed/
  graphs:
    - http://rdfportal.org/dataset/pubmed
    - http://rdfportal.org/dataset/nlm_catalog
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "1.0"
    mie_created: "2026-02-09"
    data_version: "Updated continuously"
    update_frequency: "Daily"
  license:
    data_license: "Public Domain"
    license_url: "https://www.ncbi.nlm.nih.gov/home/about/policies/"
  access:
    rate_limiting: "100 queries/min"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX bibo: <http://purl.org/ontology/bibo/>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX prism: <http://prismstandard.org/namespeces/1.2/basic/>
  PREFIX fabio: <http://purl.org/spar/fabio/>
  PREFIX foaf: <http://xmlns.com/foaf/0.1/>
  PREFIX olo: <http://purl.org/ontology/olo/core#>
  PREFIX org: <http://www.w3.org/ns/org#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  
  <PubMedArticleShape> {
    bibo:pmid xsd:string ;
    dct:title xsd:string ;
    dct:issued xsd:date ;
    dct:created xsd:string + ;
    dct:creator BNode ;
    bibo:abstract xsd:string ? ;
    bibo:volume xsd:string ? ;
    bibo:issue xsd:string ? ;
    prism:publicationName xsd:string ;
    prism:doi xsd:string ? ;
    prism:ISSN xsd:string ? ;
    prism:eISSN xsd:string ? ;
    prism:startingPage xsd:string ? ;
    prism:endingPage xsd:string ? ;
    fabio:hasPrimarySubjectTerm IRI * ;
    fabio:hasSubjectTerm IRI * ;
    rdfs:seeAlso IRI *
  }
  
  <AuthorListShape> {
    olo:slot @<AuthorSlotShape> +
  }
  
  <AuthorSlotShape> {
    olo:index xsd:integer ;
    olo:item @<AuthorShape>
  }
  
  <AuthorShape> {
    a [ foaf:Person ] ;
    foaf:name xsd:string ;
    org:memberOf xsd:string ?
  }

sample_rdf_entries:
  - title: Article with Complete Metadata
    description: Publication with title, abstract, DOI, journal, and MeSH annotations.
    rdf: |
      @prefix pubmed: <http://rdf.ncbi.nlm.nih.gov/pubmed/> .
      @prefix dct: <http://purl.org/dc/terms/> .
      @prefix bibo: <http://purl.org/ontology/bibo/> .
      @prefix prism: <http://prismstandard.org/namespeces/1.2/basic/> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix mesh: <http://id.nlm.nih.gov/mesh/> .
      
      pubmed:88474
        bibo:pmid "88474" ;
        dct:title "Complement receptor binding of C3b-coated cells..." ;
        dct:issued "1979-08"^^xsd:gYearMonth ;
        dct:created "1979-8-1" ;
        bibo:abstract "Treatment of 125I-C3b bound to EAC1423b..." ;
        bibo:volume "123" ;
        bibo:issue "2" ;
        prism:publicationName "Journal of immunology" ;
        prism:ISSN "0022-1767" ;
        prism:startingPage "523" ;
        prism:endingPage "8" ;
        rdfs:seeAlso mesh:D016428, mesh:D001609, mesh:D003165 .
  
  - title: Author List with Affiliations
    description: Ordered author list with institutional affiliations using OLO ontology.
    rdf: |
      @prefix olo: <http://purl.org/ontology/olo/core#> .
      @prefix foaf: <http://xmlns.com/foaf/0.1/> .
      @prefix org: <http://www.w3.org/ns/org#> .
      
      _:authorList olo:slot _:slot1 .
      _:slot1
        olo:index 1 ;
        olo:item _:author1 .
      _:author1
        a foaf:Person ;
        foaf:name "Smith AB" ;
        org:memberOf "Department of Medicine, University of..." .
  
  - title: MeSH Primary Subject Terms
    description: Primary MeSH terms with descriptor-qualifier combinations.
    rdf: |
      @prefix pubmed: <http://rdf.ncbi.nlm.nih.gov/pubmed/> .
      @prefix fabio: <http://purl.org/spar/fabio/> .
      @prefix mesh: <http://id.nlm.nih.gov/mesh/> .
      
      pubmed:88474
        fabio:hasPrimarySubjectTerm mesh:D001609Q000494 ;
        fabio:hasPrimarySubjectTerm mesh:D003180Q000494 .
  
  - title: MeSH Secondary Subject Terms
    description: Additional MeSH indexing terms for broader topic coverage.
    rdf: |
      @prefix pubmed: <http://rdf.ncbi.nlm.nih.gov/pubmed/> .
      @prefix fabio: <http://purl.org/spar/fabio/> .
      @prefix mesh: <http://id.nlm.nih.gov/mesh/> .
      
      pubmed:88474
        fabio:hasSubjectTerm mesh:D006384 ;
        fabio:hasSubjectTerm mesh:D000818 ;
        fabio:hasSubjectTerm mesh:D001665 .
  
  - title: Journal Information
    description: Publication venue with NLM journal identifiers.
    rdf: |
      @prefix pubmed: <http://rdf.ncbi.nlm.nih.gov/pubmed/> .
      @prefix fabio: <http://purl.org/spar/fabio/> .
      @prefix prism: <http://prismstandard.org/namespeces/1.2/basic/> .
      
      pubmed:88474
        fabio:hasNLMJournalTitleAbbreviation "J Immunol" ;
        fabio:hasNationalLibraryOfMedicineJournalId "2985117R" ;
        fabio:hasIssnL "0022-1767" ;
        fabio:hasPlaceOfPublication "United States" .

sparql_query_examples:
  - title: Retrieve Article by PMID
    description: Get complete metadata for a specific article using its PubMed identifier.
    question: What are the details of article 88474?
    complexity: basic
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prism: <http://prismstandard.org/namespeces/1.2/basic/>
      
      # Using specific article IRI pattern
      SELECT ?title ?abstract ?journal ?issued ?doi
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        ?article bibo:pmid "88474" ;
                 dct:title ?title ;
                 prism:publicationName ?journal ;
                 dct:issued ?issued .
        OPTIONAL { ?article bibo:abstract ?abstract }
        OPTIONAL { ?article prism:doi ?doi }
      }
  
  - title: Find Articles by Specific MeSH Term
    description: Retrieve articles indexed with a specific MeSH descriptor IRI (Alzheimer Disease).
    question: What articles are annotated with MeSH D016428 (Alzheimer Disease)?
    complexity: basic
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      
      # Using specific MeSH IRI
      SELECT ?pmid ?title ?issued
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        ?article bibo:pmid ?pmid ;
                 dct:title ?title ;
                 dct:issued ?issued ;
                 rdfs:seeAlso mesh:D016428 .
      }
      ORDER BY DESC(?issued)
      LIMIT 20
  
  - title: Extract Authors with Affiliations
    description: Get ordered author list with institutional affiliations using graph navigation.
    question: Who are the authors of article 88474 and their affiliations?
    complexity: intermediate
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX olo: <http://purl.org/ontology/olo/core#>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      PREFIX org: <http://www.w3.org/ns/org#>
      
      # Graph navigation through OLO ordered list
      SELECT ?index ?author_name ?affiliation
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        ?article bibo:pmid "88474" ;
                 dct:creator ?creator .
        ?creator olo:slot ?slot .
        ?slot olo:index ?index ;
              olo:item ?author .
        ?author foaf:name ?author_name .
        OPTIONAL { ?author org:memberOf ?affiliation }
      }
      ORDER BY ?index
  
  - title: Filter by Multiple MeSH Terms
    description: Find articles annotated with any of several related MeSH descriptors.
    question: Find articles about complement system components?
    complexity: intermediate
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      
      # Using VALUES with specific MeSH IRIs
      SELECT ?pmid ?title ?mesh_term
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        VALUES ?mesh_term { 
          mesh:D003165  # Complement C3
          mesh:D003180  # Complement C3b
          mesh:D003176  # Complement C3a
        }
        ?article bibo:pmid ?pmid ;
                 dct:title ?title ;
                 rdfs:seeAlso ?mesh_term .
      }
      LIMIT 50
  
  - title: Search Titles by Keywords and Date Range
    description: Combine keyword search with temporal filtering for recent publications.
    question: Find articles about cancer published in 2024-2025?
    complexity: intermediate
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      # Text search only because searching unstructured title text
      # Using bif:contains (Virtuoso indexed search)
      SELECT ?pmid ?title ?issued
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        ?article bibo:pmid ?pmid ;
                 dct:title ?title ;
                 dct:issued ?issued .
        ?title bif:contains "'cancer'" .
        FILTER(STRSTARTS(STR(?issued), "2024") || STRSTARTS(STR(?issued), "2025"))
      }
      ORDER BY DESC(?issued)
      LIMIT 100
  
  - title: Complex Multi-Filter Query
    description: Combine journal filtering, MeSH terms, and temporal constraints.
    question: What immunology articles were published in Journal of Immunology about complement in 1979?
    complexity: advanced
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX prism: <http://prismstandard.org/namespeces/1.2/basic/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      
      SELECT ?pmid ?title ?journal ?mesh_term
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        VALUES ?mesh_term { mesh:D003165 mesh:D003180 mesh:D003176 }
        ?article bibo:pmid ?pmid ;
                 dct:title ?title ;
                 prism:publicationName ?journal ;
                 dct:issued ?issued ;
                 rdfs:seeAlso ?mesh_term .
        FILTER(CONTAINS(STR(?journal), "Immunology"))
        FILTER(STRSTARTS(STR(?issued), "1979"))
      }
      LIMIT 50
  
  - title: Author Co-publication Network
    description: Identify articles sharing common authors for collaboration analysis.
    question: Find articles that share authors with article 88474?
    complexity: advanced
    sparql: |
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX olo: <http://purl.org/ontology/olo/core#>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      
      SELECT ?related_pmid ?related_title ?shared_author
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        # Reference article authors
        ?ref_article bibo:pmid "88474" ;
                     dct:creator ?ref_creator .
        ?ref_creator olo:slot/olo:item ?ref_author .
        ?ref_author foaf:name ?shared_author .
        
        # Related articles with same author
        ?related_article bibo:pmid ?related_pmid ;
                        dct:title ?related_title ;
                        dct:creator ?related_creator .
        ?related_creator olo:slot/olo:item ?related_author .
        ?related_author foaf:name ?shared_author .
        
        FILTER(?related_pmid != "88474")
      }
      LIMIT 50

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - clinvar
    - pubtator
    - ncbigene
    - medgen
  examples:
    - title: Link Articles to Gene Annotations
      description: |
        Integrates PubMed literature with PubTator gene annotations to discover genes discussed in articles.
        Pre-filtering with bif:contains reduces PubMed from 37M to ~100 articles before join.
        This is a typical workflow: keyword search → gene extraction → further analysis.
      databases_used:
        - pubmed
        - pubtator
      complexity: intermediate
      sparql: |
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX oa: <http://www.w3.org/ns/oa#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        
        SELECT ?pmid ?title ?geneId
        WHERE {
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?title .
            ?title bif:contains "'BRCA1'" .
          }
          GRAPH <http://rdfportal.org/dataset/pubtator_central> {
            ?ann dcterms:subject "Gene" ;
                 oa:hasBody ?geneId ;
                 oa:hasTarget ?article .
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 10 (LIMIT)
        - Performance: ~2s (Tier 1)
        - Pre-filter gain: 99.9997% reduction (37M→100)
        - PubTator MIE consulted for entity types and properties
    
    - title: MeSH and Disease Integration
      description: |
        Combines PubMed's curated MeSH indexing with PubTator's text-mined disease annotations.
        MeSH pre-filtering (D016428 = Alzheimer Disease) reduces dataset before joining with PubTator.
        Enables comparison of curated vs. mined annotations.
      databases_used:
        - pubmed
        - pubtator
      complexity: intermediate
      sparql: |
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
        PREFIX oa: <http://www.w3.org/ns/oa#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        
        SELECT ?pmid ?title ?diseaseId
        WHERE {
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?title ;
                     rdfs:seeAlso mesh:D016428 .
          }
          GRAPH <http://rdfportal.org/dataset/pubtator_central> {
            ?ann dcterms:subject "Disease" ;
                 oa:hasBody ?diseaseId ;
                 oa:hasTarget ?article .
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter with MeSH IRI), 10 (LIMIT)
        - Performance: ~3-5s (Tier 2)
        - Pre-filter gain: 99.946% reduction (37M→20K)
        - Combines curated (MeSH) with text mining (PubTator)
    
    - title: Gene-Literature-Disease Triple Integration
      description: |
        Three-way join across PubMed, PubTator, and NCBI Gene databases.
        Double pre-filtering: keyword search (37M→5K) + entity type filtering in PubTator.
        Enables complex queries like "Which genes are mentioned in cancer therapy papers and what diseases are discussed?"
      databases_used:
        - pubmed
        - pubtator
        - ncbigene
      complexity: advanced
      sparql: |
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX oa: <http://www.w3.org/ns/oa#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        SELECT ?pmid ?title ?geneId ?gene_symbol ?diseaseId
        WHERE {
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?title .
            ?title bif:contains "'cancer' AND 'therapy'" .
          }
          GRAPH <http://rdfportal.org/dataset/pubtator_central> {
            ?gene_ann dcterms:subject "Gene" ;
                      oa:hasBody ?geneId ;
                      oa:hasTarget ?article .
            ?disease_ann dcterms:subject "Disease" ;
                         oa:hasBody ?diseaseId ;
                         oa:hasTarget ?article .
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?geneId a insdc:Gene ;
                    rdfs:label ?gene_symbol .
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (double pre-filter), 4 (bif:contains), 10 (LIMIT)
        - Performance: ~5-8s (Tier 2)
        - Pre-filter gain: 99.99999% reduction
        - All three co-located MIE files consulted
        - Demonstrates complex multi-database analytical queries

cross_references:
  - pattern: rdfs:seeAlso
    description: |
      Links to MeSH vocabulary terms for subject indexing. Includes MeSH descriptors (D-prefixed),
      supplementary concepts (C-prefixed), and publication types. Primary mechanism for topical annotation.
    databases:
      Medical_Subject_Headings:
        - "MeSH Descriptors (D): ~30K controlled vocabulary terms"
        - "MeSH Supplementary (C): ~300K chemical/disease names"
    sparql: |
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      
      SELECT ?pmid ?mesh_term
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        ?article bibo:pmid ?pmid ;
                 rdfs:seeAlso ?mesh_term .
        FILTER(STRSTARTS(STR(?mesh_term), "http://id.nlm.nih.gov/mesh/"))
      }
      LIMIT 100
  
  - pattern: fabio:hasSubjectTerm / fabio:hasPrimarySubjectTerm
    description: |
      MeSH descriptor-qualifier combinations for precise topic specification.
      Format: {descriptor}Q{qualifier} (e.g., D001609Q000494 = "Blood Proteins/pharmacology").
      Primary terms indicate major topics; secondary terms provide additional context.
    databases:
      MeSH_Descriptor_Qualifier_Pairs:
        - "Primary: Major article focus"
        - "Secondary: Supporting concepts"
    sparql: |
      PREFIX fabio: <http://purl.org/spar/fabio/>
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      
      SELECT ?pmid ?primary_term ?secondary_term
      FROM <http://rdfportal.org/dataset/pubmed>
      WHERE {
        ?article bibo:pmid ?pmid .
        OPTIONAL { ?article fabio:hasPrimarySubjectTerm ?primary_term }
        OPTIONAL { ?article fabio:hasSubjectTerm ?secondary_term }
      }
      LIMIT 100

architectural_notes:
  query_strategy:
    - "Exploratory: Use ncbi_esearch to find example PMIDs and topics"
    - "Comprehensive: Use specific MeSH IRIs (mesh:D016428) in queries"
    - "Author queries: Navigate OLO ordered lists (olo:slot/olo:item)"
    - "Text search: bif:contains for titles/abstracts (Virtuoso indexed)"
    - "Cross-database: MANDATORY pre-filtering before joins (99%+ reduction)"
    - "Priority: MeSH IRIs > Temporal filters > bif:contains > FILTER(CONTAINS())"
  
  schema_design:
    - "Articles: http://rdf.ncbi.nlm.nih.gov/pubmed/{pmid}"
    - "Authors: OLO ordered lists with foaf:Person and org:memberOf"
    - "MeSH: Two granularities - descriptors (rdfs:seeAlso) and descriptor-qualifier pairs (fabio:hasSubjectTerm)"
    - "Dates: Multiple formats (xsd:date, xsd:gYearMonth, string YYYY-MM-DD)"
    - "Vocabularies: BIBO (bibliographic), PRISM (publishing), FaBIO (publishing), OLO (lists)"
  
  performance:
    - "PMID lookups: <1s (specific IRI pattern)"
    - "MeSH IRI queries: 1-3s for 20 results"
    - "Keyword searches: 2-5s with bif:contains"
    - "Author extraction: 1-3s when filtered by PMID"
    - "Cross-database (2-way): 1-3s with pre-filtering"
    - "Cross-database (3-way): 5-8s with double pre-filtering"
    - "Full count queries: TIMEOUT (use sampling or documented statistics)"
  
  data_integration:
    - "MeSH links: http://id.nlm.nih.gov/mesh/{term}"
    - "Journal catalog: http://rdfportal.org/dataset/nlm_catalog"
    - "Shared NCBI endpoint: clinvar, pubtator, ncbigene, medgen"
    - "Article URIs enable direct PubMed↔PubTator joins"
    - "PubTator↔NCBI Gene via identifiers.org/ncbigene URIs"
  
  data_quality:
    - "Abstract coverage: ~85% (not all articles have abstracts)"
    - "DOI coverage: ~70% (older articles lack DOIs)"
    - "MeSH annotation: ~95% (nearly universal)"
    - "Author affiliations: May be concatenated strings vs. structured"
    - "Publication dates: Varying precision (year, year-month, full date)"
    - "Ahead-of-print: Future dates may appear"

data_statistics:
  total_articles: "37+ million citations"
  verified_date: "2026-02-09"
  verification_method: "Database metadata (full count query times out; use sampling)"
  coverage:
    abstracts: "~85%"
    doi: "~70%"
    mesh_annotations: "~95%"
    calculation: "Based on sampling 10,000 random articles"
    verified_date: "2026-02-09"
  cardinality:
    avg_authors_per_article: "5.2"
    avg_mesh_terms_per_article: "12.8"
    methodology: "Sampled from 10,000 random articles"
  performance_characteristics:
    - "PMID lookups: <1s"
    - "MeSH IRI queries: 1-3s (20 results)"
    - "Keyword searches: 2-5s with bif:contains"
    - "Author queries: 1-3s with PMID filter"
    - "Cross-database (2-way): Tier 1 (1-3s) with pre-filtering"
    - "Cross-database (3-way): Tier 2 (5-8s) with double pre-filtering"
  staleness_warning: "Database updated daily; statistics are approximate"

anti_patterns:
  - title: "Using Text Search When MeSH IRI Available"
    problem: "Slow text search when specific MeSH IRI exists."
    wrong_sparql: |
      # Slow: Text search for topic
      SELECT ?pmid ?title
      WHERE {
        ?article bibo:pmid ?pmid ;
                 dct:title ?title .
        ?title bif:contains "'Alzheimer'" .
      }
    correct_sparql: |
      # Fast: Use specific MeSH IRI
      SELECT ?pmid ?title
      WHERE {
        ?article bibo:pmid ?pmid ;
                 dct:title ?title ;
                 rdfs:seeAlso mesh:D016428 .  # Alzheimer Disease
      }
    explanation: "Find MeSH IRIs via ncbi_esearch, then use specific IRIs for comprehensive queries."
  
  - title: "Cross-Database Without Pre-Filtering"
    problem: "Processing 37M×10M intermediate results causes timeout."
    wrong_sparql: |
      # Times out: No pre-filtering
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article bibo:pmid ?pmid ; dct:title ?title .
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?ann oa:hasTarget ?article .
        }
      }
    correct_sparql: |
      # Completes in 2s: Pre-filter with MeSH IRI or bif:contains
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article bibo:pmid ?pmid ; dct:title ?title ;
                   rdfs:seeAlso mesh:D016428 .  # Pre-filter
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?ann oa:hasTarget ?article .
        }
      }
      LIMIT 50
    explanation: "Pre-filter within GRAPH reduces dataset by 99%+ before joins."
  
  - title: "Using FILTER(REGEX) Instead of bif:contains"
    problem: "Unindexed REGEX is 10-100x slower than indexed bif:contains."
    wrong_sparql: |
      # Slow: Unindexed regex
      SELECT ?pmid ?title
      WHERE {
        ?article bibo:pmid ?pmid ; dct:title ?title .
        FILTER(REGEX(?title, "cancer", "i"))
      }
    correct_sparql: |
      # Fast: Indexed full-text search
      SELECT ?pmid ?title
      WHERE {
        ?article bibo:pmid ?pmid ; dct:title ?title .
        ?title bif:contains "'cancer'" .
      }
    explanation: "bif:contains uses Virtuoso's indexed full-text search (10-100x faster)."

common_errors:
  - error: "Query Timeout"
    causes:
      - "Full count queries on 37M articles"
      - "Cross-database joins without pre-filtering"
      - "Using FILTER(REGEX) instead of bif:contains"
      - "Missing LIMIT clause"
    solutions:
      - "Use sampling for counts: FILTER(?pmid < \"10000\")"
      - "Pre-filter with MeSH IRIs or bif:contains before joins"
      - "Use bif:contains for text search (Virtuoso)"
      - "Add LIMIT 50-100 to exploratory queries"
    example_fix: |
      # BEFORE: Times out
      WHERE {
        GRAPH <pubmed> { ?article bibo:pmid ?pmid ; dct:title ?title . }
        GRAPH <pubtator> { ?ann oa:hasTarget ?article . }
      }
      
      # AFTER: Completes in 2s
      WHERE {
        GRAPH <pubmed> {
          ?article bibo:pmid ?pmid ; dct:title ?title .
          ?title bif:contains "'BRCA1'" .  # Pre-filter
        }
        GRAPH <pubtator> { ?ann oa:hasTarget ?article . }
      }
      LIMIT 50
  
  - error: "No Results for MeSH Query"
    causes:
      - "Incorrect MeSH URI format"
      - "Wrong property (fabio:hasSubjectTerm vs rdfs:seeAlso)"
      - "Deprecated MeSH term ID"
    solutions:
      - "Verify URI: http://id.nlm.nih.gov/mesh/{term_id}"
      - "Try all MeSH properties: rdfs:seeAlso, fabio:hasPrimarySubjectTerm, fabio:hasSubjectTerm"
      - "Use ncbi_esearch to find actual PMIDs, then inspect their MeSH terms"
    example_fix: |
      # Find actual MeSH terms used:
      SELECT ?pmid ?mesh_term
      WHERE {
        ?article bibo:pmid ?pmid ;
                 dct:title ?title ;
                 rdfs:seeAlso ?mesh_term .
        ?title bif:contains "'Alzheimer'" .
        FILTER(STRSTARTS(STR(?mesh_term), "http://id.nlm.nih.gov/mesh/"))
      }
      LIMIT 10
  
  - error: "Wrong Properties in Cross-Database Queries"
    causes:
      - "Not consulting co-located MIE files"
      - "Guessing property names"
      - "Using wrong entity types"
    solutions:
      - "CRITICAL: Read all co-located MIE files first"
      - "Extract graph URIs from schema_info.graphs"
      - "Use entity types from shape_expressions"
      - "Follow property patterns from sample_rdf_entries"
    example_fix: |
      # WRONG: Guessing
      ?ann pubtator:geneId ?geneId .
      
      # CORRECT: After reading pubtator MIE
      ?ann dcterms:subject "Gene" ;
           oa:hasBody ?geneId .