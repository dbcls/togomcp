schema_info:
  title: PubTator Central RDF
  description: |
    PubTator Central provides biomedical entity annotations extracted from PubMed literature through text mining and manual curation. Contains Disease and Gene annotations linked to PubMed articles using MeSH disease identifiers and NCBI Gene IDs. Each annotation records mention frequency within articles. Annotation sources include automated PubTator3, curated ClinVar, and dbSNP data.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://purl.jp/bio/10/pubtator-central/
  graphs:
    - http://rdfportal.org/dataset/pubtator_central
    - http://rdfportal.org/dataset/pubmed
  kw_search_tools:
    - sparql
  version:
    mie_version: "2.0"
    mie_created: "2026-02-10"
    data_version: "PubTator Central 2024"
    update_frequency: "Regularly updated"
  license:
    data_license: "Public Domain"
    license_url: "https://www.ncbi.nlm.nih.gov/home/about/policies/"
  access:
    rate_limiting: "Reasonable use policy"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX oa: <http://www.w3.org/ns/oa#>
  PREFIX dcterms: <http://purl.org/dc/terms/>
  PREFIX pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#>
  
  <DiseaseAnnotationShape> {
    a [ oa:Annotation ] ;
    dcterms:subject [ "Disease" ] ;
    oa:hasBody IRI ;
    oa:hasTarget IRI ;
    pubtator:annotation_count xsd:integer ;
    dcterms:source xsd:string ?
  }
  
  <GeneAnnotationShape> {
    a [ oa:Annotation ] ;
    dcterms:subject [ "Gene" ] ;
    oa:hasBody IRI ;
    oa:hasTarget IRI ;
    pubtator:annotation_count xsd:integer ;
    dcterms:source xsd:string ?
  }

sample_rdf_entries:
  - title: Disease Annotation
    description: Disease annotation linking MeSH D056486 (Fecal Incontinence) to PubMed article 18935170.
    rdf: |
      @prefix oa: <http://www.w3.org/ns/oa#> .
      @prefix dcterms: <http://purl.org/dc/terms/> .
      @prefix pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#> .
      
      <http://purl.jp/bio/10/pubtator-central/Disease/20000000>
        a oa:Annotation ;
        dcterms:subject "Disease" ;
        oa:hasBody <http://identifiers.org/mesh/D056486> ;
        oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/18935170> ;
        pubtator:annotation_count 1 .
  
  - title: Gene Annotation
    description: Gene annotation linking NCBI Gene 11820 to PubMed article 16821116.
    rdf: |
      @prefix oa: <http://www.w3.org/ns/oa#> .
      @prefix dcterms: <http://purl.org/dc/terms/> .
      @prefix pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#> .
      
      <http://purl.jp/bio/10/pubtator-central/Gene/5452014>
        a oa:Annotation ;
        dcterms:subject "Gene" ;
        oa:hasBody <http://identifiers.org/ncbigene/11820> ;
        oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/16821116> ;
        pubtator:annotation_count 1 .
  
  - title: High-Frequency Annotation
    description: Gene annotation with multiple mentions (9 occurrences) within a single article.
    rdf: |
      @prefix oa: <http://www.w3.org/ns/oa#> .
      @prefix dcterms: <http://purl.org/dc/terms/> .
      @prefix pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#> .
      
      <http://purl.jp/bio/10/pubtator-central/Gene/3895582>
        a oa:Annotation ;
        dcterms:subject "Gene" ;
        oa:hasBody <http://identifiers.org/ncbigene/28964> ;
        oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/15383276> ;
        pubtator:annotation_count 9 .
  
  - title: Multiple Disease Annotations
    description: Article with multiple disease annotations including D001724 (Birth Weight) and D003920 (Diabetes Mellitus).
    rdf: |
      @prefix oa: <http://www.w3.org/ns/oa#> .
      @prefix dcterms: <http://purl.org/dc/terms/> .
      @prefix pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#> .
      
      <http://purl.jp/bio/10/pubtator-central/Disease/20000001>
        a oa:Annotation ;
        dcterms:subject "Disease" ;
        oa:hasBody <http://identifiers.org/mesh/D001724> ;
        oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/18935173> ;
        pubtator:annotation_count 1 .
      
      <http://purl.jp/bio/10/pubtator-central/Disease/20000003>
        a oa:Annotation ;
        dcterms:subject "Disease" ;
        oa:hasBody <http://identifiers.org/mesh/D003920> ;
        oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/18935173> ;
        pubtator:annotation_count 2 .
  
  - title: Annotation with Source Attribution
    description: Annotation with dcterms:source indicating provenance from PubTator3 automated text mining.
    rdf: |
      @prefix oa: <http://www.w3.org/ns/oa#> .
      @prefix dcterms: <http://purl.org/dc/terms/> .
      @prefix pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#> .
      
      []
        a oa:Annotation ;
        dcterms:subject "Disease" ;
        dcterms:source "PubTator3" ;
        oa:hasBody <http://identifiers.org/mesh/D003920> ;
        oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/18935175> ;
        pubtator:annotation_count 2 .

sparql_query_examples:
  - title: Find diseases mentioned in a specific article
    description: Retrieve all disease annotations for a given PubMed article using its specific IRI.
    question: What diseases are annotated in PubMed article 18935173?
    complexity: basic
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Strategy: Direct lookup using specific PubMed article IRI
      # Uses oa:hasTarget predicate to filter by article
      SELECT ?disease ?diseaseId
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?disease a oa:Annotation ;
                 dcterms:subject "Disease" ;
                 oa:hasBody ?diseaseId ;
                 oa:hasTarget <http://rdf.ncbi.nlm.nih.gov/pubmed/18935173> .
      }
  
  - title: Find all annotations for a specific disease
    description: Retrieve PubMed articles mentioning diabetes mellitus using its specific MeSH IRI.
    question: Which papers mention Diabetes Mellitus (MeSH:D003920)?
    complexity: basic
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Strategy: Direct lookup using specific MeSH disease IRI
      # Efficient: Uses oa:hasBody predicate to filter by disease
      SELECT ?annotation ?article
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?annotation a oa:Annotation ;
                    dcterms:subject "Disease" ;
                    oa:hasBody <http://identifiers.org/mesh/D003920> ;
                    oa:hasTarget ?article .
      }
      LIMIT 100
  
  - title: Find gene-disease co-mentions
    description: Identify articles with both gene and disease annotations using typed predicates.
    question: Which papers mention both genes and diseases?
    complexity: intermediate
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Strategy: Join using typed predicates (dcterms:subject)
      # Filters by entity type: "Gene" and "Disease"
      SELECT DISTINCT ?article ?geneId ?diseaseId
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?geneAnn dcterms:subject "Gene" ;
                 oa:hasBody ?geneId ;
                 oa:hasTarget ?article .
        ?diseaseAnn dcterms:subject "Disease" ;
                    oa:hasBody ?diseaseId ;
                    oa:hasTarget ?article .
      }
      LIMIT 100
  
  - title: Find annotations with multiple mentions
    description: Retrieve disease annotations appearing multiple times within articles using property-based filtering.
    question: Which diseases have high mention frequency in articles?
    complexity: intermediate
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      PREFIX pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#>
      
      # Strategy: Property-based filtering with annotation_count
      # Uses FILTER on integer property for threshold
      SELECT ?annotation ?diseaseId ?article ?count
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?annotation dcterms:subject "Disease" ;
                    oa:hasBody ?diseaseId ;
                    oa:hasTarget ?article ;
                    pubtator:annotation_count ?count .
        FILTER(?count > 5)
      }
      ORDER BY DESC(?count)
      LIMIT 100
  
  - title: Find genes frequently associated with a disease
    description: Aggregate gene-disease co-occurrences across literature using specific disease IRI.
    question: What genes are commonly mentioned with Alzheimer Disease?
    complexity: intermediate
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Strategy: Aggregation with specific MeSH IRI for Alzheimer (D000544)
      # Pre-filters to disease before aggregation for efficiency
      SELECT ?geneId (COUNT(DISTINCT ?article) AS ?cooccurrence)
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?geneAnn dcterms:subject "Gene" ;
                 oa:hasBody ?geneId ;
                 oa:hasTarget ?article .
        ?diseaseAnn dcterms:subject "Disease" ;
                    oa:hasBody <http://identifiers.org/mesh/D000544> ;
                    oa:hasTarget ?article .
      }
      GROUP BY ?geneId
      ORDER BY DESC(?cooccurrence)
      LIMIT 50
  
  - title: Search disease annotations by article keyword
    description: Find disease annotations in cancer-related articles using text search on PubMed titles.
    question: Find disease annotations in papers about cancer research.
    complexity: advanced
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      PREFIX bibo: <http://purl.org/ontology/bibo/>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      # Text search justified - bif:contains Gate Check completed:
      # 1. Checked MIE schema: Article titles are unstructured text fields
      # 2. No controlled vocabulary for title content
      # 3. Inspected PubMed graph: Only free-text dct:title property available
      # 4. Therefore: bif:contains necessary for keyword search in titles
      #
      # Strategy: Pre-filter PubMed articles with bif:contains BEFORE join
      # Reduces 37M articles to ~100 before joining with PubTator annotations
      SELECT ?annotation ?diseaseId ?article ?title
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article bibo:pmid ?pmid ;
                   dct:title ?title .
          ?title bif:contains "'cancer'" .
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?annotation dcterms:subject "Disease" ;
                      oa:hasBody ?diseaseId ;
                      oa:hasTarget ?article .
        }
      }
      LIMIT 100
  
  - title: Analyze disease annotation diversity
    description: Identify articles with diverse disease coverage by counting distinct disease annotations per article.
    question: Which articles mention the most diverse set of diseases?
    complexity: advanced
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Strategy: Aggregation with HAVING clause for filtering
      # Groups by article and counts distinct diseases
      # WARNING: May timeout on large datasets - use with appropriate thresholds
      SELECT ?article (COUNT(DISTINCT ?diseaseId) AS ?disease_diversity)
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?annotation dcterms:subject "Disease" ;
                    oa:hasBody ?diseaseId ;
                    oa:hasTarget ?article .
      }
      GROUP BY ?article
      HAVING (COUNT(DISTINCT ?diseaseId) > 10)
      ORDER BY DESC(?disease_diversity)
      LIMIT 50

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - clinvar
    - pubmed
    - ncbigene
    - medgen
  mie_files_consulted:
    - PubMed (graph structure, bif:contains patterns)
    - NCBI Gene (entity types, property predicates)
  examples:
    - title: Link PubTator annotations to PubMed metadata
      description: |
        Integrates PubTator gene annotations with PubMed article metadata for comprehensive research context.
        
        Linking strategy:
        - PubTator: Uses oa:hasTarget predicate linking to PubMed article IRIs
        - PubMed: Article IRIs match directly (http://rdf.ncbi.nlm.nih.gov/pubmed/)
        - Pre-filtering with bif:contains reduces 37M PubMed articles to ~100 before joining
      databases_used:
        - pubtator
        - pubmed
      complexity: intermediate
      sparql: |
        PREFIX oa: <http://www.w3.org/ns/oa#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX pubtator: <http://purl.jp/bio/10/pubtator-central/ontology#>
        
        # Strategy: Pre-filter PubMed with bif:contains BEFORE join
        SELECT ?pmid ?title ?geneId ?count
        WHERE {
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?title .
            ?title bif:contains "'BRCA1' AND 'cancer'" .
          }
          GRAPH <http://rdfportal.org/dataset/pubtator_central> {
            ?ann dcterms:subject "Gene" ;
                 oa:hasBody ?geneId ;
                 oa:hasTarget ?article ;
                 pubtator:annotation_count ?count .
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (explicit GRAPH), 2 (pre-filter with bif:contains), 10 (LIMIT)
        - Performance: Tier 1 (~2-3s)
        - Pre-filtering reduces dataset by 99.9997% before join
    
    - title: Enrich gene annotations with NCBI Gene metadata
      description: |
        Three-way integration linking PubTator annotations to PubMed articles and NCBI Gene database for comprehensive gene information.
        
        Linking strategy:
        - PubTator → NCBI Gene: Uses oa:hasBody linking to identifiers.org/ncbigene IRIs
        - PubTator → PubMed: Uses oa:hasTarget linking to PubMed article IRIs
        - Double pre-filtering on both PubMed and PubTator reduces join complexity
      databases_used:
        - pubtator
        - pubmed
        - ncbigene
      complexity: advanced
      sparql: |
        PREFIX oa: <http://www.w3.org/ns/oa#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        # Strategy: Double pre-filter before three-way join
        SELECT ?pmid ?title ?geneId ?gene_symbol ?gene_desc
        WHERE {
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?title .
            ?title bif:contains "'Alzheimer' AND 'genetics'" .
          }
          GRAPH <http://rdfportal.org/dataset/pubtator_central> {
            ?ann dcterms:subject "Gene" ;
                 oa:hasBody ?geneId ;
                 oa:hasTarget ?article .
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?geneId a insdc:Gene ;
                    rdfs:label ?gene_symbol .
            OPTIONAL { ?geneId dct:description ?gene_desc }
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (explicit GRAPH), 2 (double pre-filter), 7 (OPTIONAL ordering), 10 (LIMIT)
        - Performance: Tier 2 (~5-8s)
        - OPTIONAL for gene_desc placed after required patterns for optimization
    
    - title: Discover disease-gene associations from literature
      description: |
        Aggregates gene-disease co-mentions across literature for association discovery.
        
        Linking strategy:
        - PubTator: Co-occurrence via shared oa:hasTarget (same article)
        - PubTator → NCBI Gene: Direct IRI matching via oa:hasBody
        - Pre-filters to specific disease before aggregation for optimal performance
      databases_used:
        - pubtator
        - ncbigene
      complexity: advanced
      sparql: |
        PREFIX oa: <http://www.w3.org/ns/oa#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        # Strategy: Pre-filter to specific disease before aggregation
        SELECT ?diseaseId ?geneId ?gene_symbol (COUNT(DISTINCT ?article) AS ?cooccurrence)
        WHERE {
          GRAPH <http://rdfportal.org/dataset/pubtator_central> {
            ?diseaseAnn dcterms:subject "Disease" ;
                        oa:hasBody ?diseaseId ;
                        oa:hasTarget ?article .
            FILTER(?diseaseId = <http://identifiers.org/mesh/D003920>)
            ?geneAnn dcterms:subject "Gene" ;
                     oa:hasBody ?geneId ;
                     oa:hasTarget ?article .
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?geneId a insdc:Gene ;
                    rdfs:label ?gene_symbol .
          }
        }
        GROUP BY ?diseaseId ?geneId ?gene_symbol
        ORDER BY DESC(?cooccurrence)
        LIMIT 50
      notes: |
        - Strategies: 1 (explicit GRAPH), 2 (disease pre-filter), 10 (LIMIT)
        - Performance: Tier 2 (~5-10s)
        - Pre-filtering to specific disease reduces dataset by ~98% before aggregation

cross_references:
  - pattern: oa:hasBody with identifiers.org
    description: |
      PubTator uses identifiers.org URIs for standardized cross-database linking.
      Disease annotations link to MeSH vocabulary, gene annotations to NCBI Gene database.
    databases:
      diseases:
        - "MeSH: Complete disease coverage via http://identifiers.org/mesh/"
      genes:
        - "NCBI Gene: Complete gene coverage via http://identifiers.org/ncbigene/"
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      SELECT ?annotation ?entityType ?externalId
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?annotation a oa:Annotation ;
                    dcterms:subject ?entityType ;
                    oa:hasBody ?externalId .
      }
      LIMIT 100
  
  - pattern: oa:hasTarget to PubMed
    description: |
      All annotations link to PubMed articles using NCBI's standard RDF URIs.
      Enables seamless integration with PubMed graph for article metadata.
    databases:
      literature:
        - "PubMed: All annotations target PubMed articles via http://rdf.ncbi.nlm.nih.gov/pubmed/"
    sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      
      SELECT DISTINCT ?pubmedArticle
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?ann oa:hasTarget ?pubmedArticle .
        FILTER(STRSTARTS(STR(?pubmedArticle), "http://rdf.ncbi.nlm.nih.gov/pubmed/"))
      }
      LIMIT 100

architectural_notes:
  query_strategy:
    - "Exploratory: Use SPARQL with LIMIT to discover annotation patterns and extract specific IRIs"
    - "Comprehensive: Use specific MeSH and NCBI Gene IRIs for targeted queries"
    - "Entity filtering: Use dcterms:subject typed predicate ('Disease' or 'Gene')"
    - "Text search: bif:contains ONLY when searching PubMed article titles/abstracts (unstructured text)"
    - "Priority: Specific IRIs (MeSH, Gene) > Typed predicates (dcterms:subject) > Text search (bif:contains)"
  
  schema_design:
    - "Uses Web Annotation Ontology (oa:Annotation) as core pattern"
    - "Star schema: annotations connect entities (MeSH diseases, NCBI genes) to PubMed articles"
    - "Entity types distinguished by dcterms:subject literal values ('Disease', 'Gene')"
    - "Mention frequency tracked via pubtator:annotation_count integer property"
    - "Provenance: Optional dcterms:source indicates annotation source (only 1.59% of annotations)"
  
  performance:
    - "Simple lookups by annotation ID: <1s"
    - "Entity-specific queries with LIMIT: 1-3s"
    - "Cross-database queries require explicit GRAPH statements"
    - "Pre-filtering with bif:contains reduces 37M articles to ~100 (99.9997% reduction)"
    - "Always use LIMIT to prevent timeouts on large result sets"
    - "Aggregations benefit from pre-filtering to specific diseases/genes"
  
  cross_database_optimization:
    - "MANDATORY: Read co-located database MIE files before creating cross-database queries"
    - "Strategy 1: Always use explicit GRAPH statements for each database"
    - "Strategy 2: Pre-filter within GRAPH clauses before joins (critical for performance)"
    - "Strategy 4: Use bif:contains on text fields (article titles) for 10-100x speedup vs FILTER"
    - "Strategy 7: Place OPTIONAL patterns after all required patterns"
    - "Strategy 10: Always include LIMIT to prevent timeouts"
    - "Performance tiers: Tier 1 (1-3s) two-way joins, Tier 2 (5-10s) three-way joins/aggregations"
  
  data_integration:
    - "identifiers.org URIs enable direct linking to MeSH and NCBI Gene databases"
    - "PubMed URIs follow NCBI RDF conventions for seamless cross-database queries"
    - "Shares NCBI endpoint with ClinVar, PubMed, NCBI Gene, and MedGen"
    - "Gene annotations use identifiers.org/ncbigene directly compatible with NCBI Gene RDF"
  
  data_quality:
    - "Only 1.59% of annotations include dcterms:source provenance"
    - "Annotation counts represent frequency within individual articles, not corpus-wide"
    - "Database focuses on Disease and Gene entity types (no other types currently)"
    - "Blank node annotations used for entries with provenance information"

data_statistics:
  total_annotations: 238227596
  verified_date: "2026-02-10"
  verification_query: |
    SELECT (COUNT(*) as ?total)
    FROM <http://rdfportal.org/dataset/pubtator_central>
    WHERE { ?ann a <http://www.w3.org/ns/oa#Annotation> . }
  
  entity_types:
    disease: "Majority of annotations (exact count times out on GROUP BY)"
    gene: "Substantial coverage (exact count times out on GROUP BY)"
    methodology: "Confirmed via sampling - no other entity types observed"
  
  provenance_coverage:
    with_source: "1.59%"
    total_with_source: 3797080
    sources:
      PubTator3: 2230751
      ClinVar: 1243727
      dbSNP: 305145
      dbGAP: 17457
    calculation: "3,797,080 / 238,227,596 = 0.0159"
    verified_date: "2026-02-10"
    verification_query: |
      SELECT ?source (COUNT(*) as ?count)
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE { ?ann <http://purl.org/dc/terms/source> ?source }
      GROUP BY ?source
  
  annotation_count_distribution:
    count_1: "~89.7% of annotations (single mention)"
    count_2: "~8.0% of annotations (two mentions)"
    count_3_plus: "~2.3% (decreasing frequency with higher counts)"
    max_observed: 9
    methodology: "Estimated from sampling (exact GROUP BY times out)"
  
  performance_characteristics:
    - "Simple lookups by annotation ID: <1s"
    - "Entity-specific queries with filters: 1-5s"
    - "Cross-database (PubTator-PubMed): Tier 1 (~2-3s with pre-filtering)"
    - "Three-way joins (PubTator-PubMed-NCBI Gene): Tier 2 (~5-8s with pre-filtering)"
    - "Aggregations: Tier 2 (~5-10s with pre-filtering to specific entities)"
    - "bif:contains pre-filtering: 99.9997% reduction (37M → ~100 articles)"
  
  staleness_warning: "Database regularly updated; counts approximate at time of verification"

anti_patterns:
  - title: "Skipping MIE Schema Check Before Text Search"
    problem: "Using bif:contains without first checking MIE schema for structured alternatives."
    wrong_sparql: |
      # WRONG: Skipped schema check, used text search immediately
      # No inspection of available predicates
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      SELECT ?ann ?body WHERE {
        ?ann dcterms:subject ?type .
        FILTER(CONTAINS(?type, "Disease"))
      }
      LIMIT 100
    correct_sparql: |
      # CORRECT: Checked MIE schema FIRST
      # Workflow:
      # 1. get_MIE_file("pubtator") → examined shape_expressions
      # 2. Found: dcterms:subject is a typed predicate with literal values
      # 3. Inspected examples → confirmed "Disease" and "Gene" are exact values
      # 4. Use structured property:
      PREFIX dcterms: <http://purl.org/dc/terms/>
      PREFIX oa: <http://www.w3.org/ns/oa#>
      
      SELECT ?ann ?body WHERE {
        ?ann dcterms:subject "Disease" ;
             oa:hasBody ?body .
      }
      LIMIT 100
    explanation: |
      Always complete the bif:contains Gate Check before using text search:
      1. Get MIE file and examine entity Shape
      2. Check for classification/ontology predicates
      3. Check for external database IRIs (MeSH, NCBI Gene)
      4. Check for typed predicates with controlled vocabularies
      5. Inspect example entities to confirm available properties
      6. Document why no structured alternative exists (if using text search)
  
  - title: "Querying Without LIMIT Causes Timeouts"
    problem: "Large result sets without pagination timeout on this 238M+ annotation database."
    wrong_sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Will timeout - no LIMIT on large result set
      SELECT ?ann ?body
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?ann dcterms:subject "Disease" ;
             oa:hasBody ?body .
      }
    correct_sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Completes quickly with LIMIT
      SELECT ?ann ?body
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?ann dcterms:subject "Disease" ;
             oa:hasBody ?body .
      }
      LIMIT 100
    explanation: "Always use LIMIT (Strategy 10) to prevent timeouts. Use pagination (OFFSET) for larger result sets."
  
  - title: "Using Text Search When Specific IRI Available"
    problem: "Text search on URI strings instead of using specific MeSH or Gene IRIs."
    wrong_sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      
      # Slow - string search on URIs
      SELECT ?ann ?body
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?ann oa:hasBody ?body .
        FILTER(CONTAINS(STR(?body), "D003920"))
      }
      LIMIT 100
    correct_sparql: |
      PREFIX oa: <http://www.w3.org/ns/oa#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      # Fast - use specific MeSH IRI
      SELECT ?annotation ?article
      FROM <http://rdfportal.org/dataset/pubtator_central>
      WHERE {
        ?annotation dcterms:subject "Disease" ;
                    oa:hasBody <http://identifiers.org/mesh/D003920> ;
                    oa:hasTarget ?article .
      }
      LIMIT 100
    explanation: "Use specific IRIs for MeSH diseases and NCBI genes instead of text search. Much faster and more precise."
  
  - title: "Cross-Database Query Without Pre-Filtering"
    problem: "Joining databases without pre-filtering creates billions of intermediate results before filtering."
    wrong_sparql: |
      # Times out - filters after expensive join
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article <http://purl.org/ontology/bibo/pmid> ?pmid ;
                   <http://purl.org/dc/terms/title> ?title .
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?ann <http://www.w3.org/ns/oa#hasTarget> ?article ;
               <http://www.w3.org/ns/oa#hasBody> ?geneId .
        }
        FILTER(CONTAINS(?title, "BRCA1"))
      }
    correct_sparql: |
      # Completes in 2-3s - pre-filters before join
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article <http://purl.org/ontology/bibo/pmid> ?pmid ;
                   <http://purl.org/dc/terms/title> ?title .
          ?title bif:contains "'BRCA1'" .
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?ann <http://www.w3.org/ns/oa#hasTarget> ?article ;
               <http://www.w3.org/ns/oa#hasBody> ?geneId .
        }
      }
      LIMIT 50
    explanation: "Pre-filter with bif:contains before join (Strategy 2+4) reduces 37M articles to ~100 before joining with PubTator."

common_errors:
  - error: "Query timeout on aggregations"
    causes:
      - "Aggregating over entire dataset without LIMIT"
      - "Cross-database queries without pre-filtering within GRAPH clauses"
      - "Using FILTER(CONTAINS()) instead of bif:contains for text search"
    solutions:
      - "Add LIMIT clause (Strategy 10) - always use for large datasets"
      - "Pre-filter within GRAPH before joins (Strategy 2) - critical for performance"
      - "Use bif:contains for keyword searches (Strategy 4) - 10-100x faster than FILTER"
    example_fix: |
      # BEFORE: Times out
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article <http://purl.org/ontology/bibo/pmid> ?pmid .
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?ann <http://www.w3.org/ns/oa#hasTarget> ?article .
        }
      }
      
      # AFTER: Completes in 2s
      WHERE {
        GRAPH <http://rdfportal.org/dataset/pubmed> {
          ?article <http://purl.org/ontology/bibo/pmid> ?pmid ;
                   <http://purl.org/dc/terms/title> ?title .
          ?title bif:contains "'BRCA1'" .
        }
        GRAPH <http://rdfportal.org/dataset/pubtator_central> {
          ?ann <http://www.w3.org/ns/oa#hasTarget> ?article .
        }
      }
      LIMIT 50
  
  - error: "Empty results for entity type queries"
    causes:
      - "Case sensitivity in dcterms:subject literal matching"
      - "Using incorrect entity type values"
    solutions:
      - "Use exact string values: 'Disease' and 'Gene' (capitalized)"
      - "Check for exact literal matching in WHERE clause"
    example_fix: |
      # BEFORE: Returns nothing
      SELECT ?ann WHERE {
        ?ann <http://purl.org/dc/terms/subject> "disease" .
      }
      LIMIT 10
      
      # AFTER: Works correctly
      SELECT ?ann WHERE {
        ?ann <http://purl.org/dc/terms/subject> "Disease" .
      }
      LIMIT 10
  
  - error: "Missing annotations with dcterms:source"
    causes:
      - "Assuming all annotations have provenance source"
      - "Required pattern for optional property filters out 98.4% of data"
    solutions:
      - "Use OPTIONAL for dcterms:source (Strategy 7)"
      - "Place OPTIONAL patterns after all required patterns"
    example_fix: |
      # BEFORE: Misses 98.4% of annotations
      SELECT ?ann ?source WHERE {
        ?ann a <http://www.w3.org/ns/oa#Annotation> ;
             <http://purl.org/dc/terms/source> ?source .
      }
      LIMIT 100
      
      # AFTER: Captures all annotations
      SELECT ?ann ?source WHERE {
        ?ann a <http://www.w3.org/ns/oa#Annotation> .
        OPTIONAL { ?ann <http://purl.org/dc/terms/source> ?source . }
      }
      LIMIT 100
