schema_info:
  title: ClinVar RDF
  description: |
    ClinVar aggregates genomic variation and its relationship to human health with 3.5M+ variant records, clinical interpretations, gene associations, and disease conditions. Main entities include VariationArchiveType (genetic variations), Gene (associated genes), ClinAsserTraitType (disease/phenotype), and ClassifiedRecord (clinical assertions). Cross-referenced to MedGen, OMIM, MeSH, and HGNC.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://ncbi.nlm.nih.gov/clinvar/
  graphs:
    - http://rdfportal.org/dataset/clinvar
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "1.3"
    mie_created: "2024-12-08"
    mie_updated: "2025-01-27"
    data_version: "Release 2025.01"
    update_frequency: "Monthly"
  license:
    data_license: "Public Domain (CC0)"
    license_url: "https://www.ncbi.nlm.nih.gov/clinvar/docs/maintenance_use/"
  access:
    rate_limiting: "Standard SPARQL endpoint limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso (supports bif:contains)"

shape_expressions: |
  PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
  PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
  PREFIX sio: <http://semanticscience.org/resource/>
  PREFIX faldo: <http://biohackathon.org/resource/faldo#>
  
  <VariationArchiveShape> {
    a [ cvo:VariationArchiveType ] ;
    rdfs:label xsd:string ;
    cvo:accession xsd:string ;
    cvo:variation_id xsd:integer ;
    cvo:variation_name xsd:string ;
    cvo:variation_type xsd:string ;
    cvo:species xsd:string ;
    cvo:record_status xsd:string ;
    cvo:date_created xsd:date ;
    cvo:date_last_updated xsd:date ;
    cvo:number_of_submitters xsd:integer ;
    cvo:classified_record BNode ? ;
    med2rdf:disease BNode *
  }
  
  <GeneShape> {
    a [ cvo:Gene med2rdf:Gene ] ;
    cvo:gene_id xsd:integer ? ;
    cvo:symbol xsd:string * ;
    cvo:full_name xsd:string * ;
    cvo:hgnc_id xsd:string ? ;
    cvo:omim xsd:integer ? ;
    cvo:cytogenetic_location xsd:string * ;
    faldo:location BNode *
  }
  
  <ClinAsserTraitShape> {
    a [ cvo:ClinAsserTraitType med2rdf:Disease ] ;
    cvo:type xsd:string ;
    cvo:id xsd:integer ? ;
    dct:references IRI +
  }
  
  <ClassifiedRecordShape> {
    a [ cvo:ClassifiedRecord sio:SIO_001122 ] ;
    cvo:classifications BNode ;
    sio:SIO_000628 IRI *
  }

sample_rdf_entries:
  - title: Pathogenic BRCA1 Variant
    description: Frameshift duplication in BRCA1 associated with hereditary breast and ovarian cancer.
    rdf: |
      <http://ncbi.nlm.nih.gov/clinvar/variation/856461>
        a cvo:VariationArchiveType ;
        rdfs:label "NM_007294.4(BRCA1):c.2244dup (p.Asp749fs)" ;
        cvo:accession "VCV000856461" ;
        cvo:variation_id 856461 ;
        cvo:variation_type "Duplication" ;
        cvo:species "Homo sapiens" ;
        cvo:record_status "current" ;
        cvo:date_created "2022-05-16"^^xsd:date ;
        cvo:number_of_submitters 1 ;
        med2rdf:disease _:disease1 .
  - title: Gene with Genomic Location
    description: SLCO1B1 gene on chromosome 12p12.1 with HGNC and OMIM identifiers.
    rdf: |
      <http://ncbi.nlm.nih.gov/gene/10599>
        a cvo:Gene, med2rdf:Gene ;
        cvo:gene_id 10599 ;
        cvo:symbol "SLCO1B1" ;
        cvo:full_name "solute carrier organic anion transporter family member 1B1" ;
        cvo:hgnc_id "HGNC:10959" ;
        cvo:omim 604843 ;
        cvo:cytogenetic_location "12p12.1" ;
        faldo:location _:loc1 .
  - title: Single Nucleotide Variant
    description: Missense variant in SLC9A4 with clinical significance classification.
    rdf: |
      <http://ncbi.nlm.nih.gov/clinvar/variation/3798403>
        a cvo:VariationArchiveType ;
        rdfs:label "NM_001011552.4(SLC9A4):c.1724C>A (p.Ala575Asp)" ;
        cvo:accession "VCV003798403" ;
        cvo:variation_type "single nucleotide variant" ;
        cvo:species "Homo sapiens" ;
        cvo:record_status "current" ;
        cvo:classified_record _:classrec1 .
  - title: Disease Association
    description: Clinical trait representing disease condition with MedGen cross-reference.
    rdf: |
      _:disease1
        a cvo:ClinAsserTraitType, med2rdf:Disease ;
        cvo:type "Disease" ;
        cvo:id 16789 ;
        dct:references <http://ncbi.nlm.nih.gov/medgen/C3150901> .
  - title: Classified Record
    description: Clinical classification with germline significance assessment.
    rdf: |
      _:classrec1
        a cvo:ClassifiedRecord, sio:SIO_001122 ;
        cvo:classifications _:classi1 ;
        sio:SIO_000628 <http://ncbi.nlm.nih.gov/gene/10599> .
      
      _:classi1 cvo:germline_classification _:germ1 .
      _:germ1 cvo:description "Uncertain significance" .

sparql_query_examples:
  - title: Search Variants by Gene with bif:contains
    description: Find all variants for BRCA1 gene using full-text search.
    question: What variants are recorded for BRCA1?
    complexity: basic
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variant ?label ?type ?status
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:variation_type ?type ;
                 cvo:record_status ?status .
        ?label bif:contains "'BRCA1'" .
      }
      LIMIT 100
  - title: Get Variant by Accession
    description: Retrieve variant details using ClinVar accession number.
    question: What are details of variant VCV000856461?
    complexity: basic
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT *
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant cvo:accession "VCV000856461" ;
                 ?property ?value .
      }
  - title: Find Variants with Clinical Significance
    description: Retrieve variants with their clinical significance classifications.
    question: Which variants have clinical significance classifications?
    complexity: intermediate
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variant ?label ?significance
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:classified_record ?classrec .
        ?classrec cvo:classifications/cvo:germline_classification/cvo:description ?significance .
      }
      LIMIT 100
  - title: Count Variants by Type
    description: Group and count variants by their variation types.
    question: What types of variations exist and how many?
    complexity: intermediate
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variation_type (COUNT(?variant) as ?count)
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 cvo:variation_type ?variation_type ;
                 cvo:record_status "current" .
      }
      GROUP BY ?variation_type
      ORDER BY DESC(?count)
      LIMIT 50
  - title: Gene-Disease Associations via Variants
    description: Find gene-disease associations through variant annotations using keyword search.
    question: What diseases are associated with TP53 variants?
    complexity: intermediate
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT DISTINCT ?variant ?label ?gene ?disease_name
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 med2rdf:disease ?disease ;
                 cvo:classified_record/sio:SIO_000628 ?gene .
        ?disease cvo:type "Disease" ;
                 cvo:name/rdfs:label ?disease_name .
        ?label bif:contains "'TP53'" .
      }
      LIMIT 100
  - title: Well-Studied Recent Variants
    description: Identify variants with multiple submitters and recent updates.
    question: Which variants have multiple submissions and were recently updated?
    complexity: advanced
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?variant ?label ?num_submitters ?last_updated ?type
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:number_of_submitters ?num_submitters ;
                 cvo:date_last_updated ?last_updated ;
                 cvo:variation_type ?type .
        FILTER(?num_submitters >= 3)
        FILTER(?last_updated >= "2024-01-01"^^xsd:date)
      }
      ORDER BY DESC(?num_submitters) DESC(?last_updated)
      LIMIT 100
  - title: Genes with Chromosomal Locations
    description: Retrieve genes with cytogenetic locations and external identifiers.
    question: What genes have chromosomal locations and HGNC identifiers?
    complexity: advanced
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT DISTINCT ?gene ?symbol ?full_name ?cyto_loc ?hgnc ?omim
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?gene a cvo:Gene ;
              cvo:symbol ?symbol ;
              cvo:full_name ?full_name ;
              cvo:cytogenetic_location ?cyto_loc .
        OPTIONAL { ?gene cvo:hgnc_id ?hgnc }
        OPTIONAL { ?gene cvo:omim ?omim }
        FILTER(REGEX(?cyto_loc, "^[0-9]+[pq]"))
      }
      ORDER BY ?cyto_loc
      LIMIT 100

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - medgen
    - ncbigene
    - pubmed
    - pubtator
  examples:
    - title: Enrich ClinVar Variants with NCBI Gene Annotations  
      description: |
        Links ClinVar genetic variants to comprehensive NCBI Gene annotations using optimized VALUES clause for pre-filtering. Retrieves variant details enriched with official gene symbols, descriptions, and types. This integration enables researchers to understand the functional context of genetic variants by accessing detailed gene information.
      databases_used:
        - clinvar
        - ncbigene
      complexity: intermediate
      sparql: |
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX sio: <http://semanticscience.org/resource/>
        
        SELECT ?variant ?var_label ?var_type ?gene_symbol ?gene_desc ?gene_type
        WHERE {
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }
            ?gene_bn med2rdf:gene ?gene_uri .
            ?classrec sio:SIO_000628 ?gene_bn .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     cvo:variation_type ?var_type ;
                     cvo:classified_record ?classrec .
            BIND("672" AS ?gene_id)
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol ;
                       ncbio:typeOfGene ?gene_type .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
          }
        }
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter with VALUES), 7 (OPTIONAL), 10 (LIMIT)
        - Query uses graph URIs from ClinVar and NCBI Gene MIE files
        - Entity types verified: cvo:VariationArchiveType, insdc:Gene from MIE shape expressions
        - Linkage via med2rdf:gene property through blank nodes (from ClinVar MIE file)
        - Gene URI format: http://ncbi.nlm.nih.gov/gene/{id} (ClinVar) vs dct:identifier (NCBI Gene)
        - Pre-filtering with VALUES for BRCA1 (gene 672) reduces search space dramatically
        - Performance: ~2-3 seconds for 50 results (Tier 1)
        - Performance gain: VALUES clause reduces ClinVar variants from 3.5M to ~1000 before join
        - Use case: Variant interpretation requiring gene function context, clinical genetics workflows
        - Referenced MIE files: ClinVar (med2rdf:gene pattern), NCBI Gene (entity types, properties)
        - Avoided anti-patterns: No URI mismatch (uses gene_id string), explicit GRAPH clauses
    - title: Link Disease Concepts from ClinVar to MedGen
      description: |
        Integrates ClinVar variant-disease associations with MedGen's comprehensive clinical concept database. Retrieves variants with their disease annotations and enriches with MedGen concept details including labels and semantic types. Enables systematic analysis of genetic variant-disease relationships using standardized medical terminology.
      databases_used:
        - clinvar
        - medgen
      complexity: intermediate
      sparql: |
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX mo: <http://med2rdf/ontology/medgen#>
        PREFIX dct: <http://purl.org/dc/terms/>
        
        SELECT ?variant ?var_label ?medgen_cui ?medgen_label ?sty
        WHERE {
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            VALUES ?medgen_concept { <http://www.ncbi.nlm.nih.gov/medgen/C0011849> }
            ?disease dct:references ?medgen_concept .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     med2rdf:disease ?disease .
          }
          GRAPH <http://rdfportal.org/dataset/medgen> {
            ?medgen_concept a mo:ConceptID ;
                            dct:identifier ?medgen_cui ;
                            rdfs:label ?medgen_label ;
                            mo:sty ?sty .
          }
        }
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 3 (VALUES for known concept), 10 (LIMIT)
        - Query uses graph URIs and entity types from both ClinVar and MedGen MIE files
        - Linkage: ClinVar disease blank nodes use dct:references to MedGen concepts (from ClinVar MIE)
        - MedGen concepts identified by mo:ConceptID with UMLS CUI identifiers (from MedGen MIE)
        - Pre-filtering with VALUES for diabetes (C0011849) dramatically reduces search space
        - Performance: ~2-4 seconds for 50 results (Tier 1)
        - Performance gain: VALUES reduces ClinVar variants from 3.5M to ~hundreds before join
        - Use case: Clinical variant interpretation, disease-gene association analysis, genetic counseling
        - Referenced MIE files: ClinVar (dct:references pattern), MedGen (mo:ConceptID, mo:sty)
        - Avoided anti-patterns: Direct URI linkage (no conversion needed), explicit GRAPH clauses
    - title: Find ClinVar Gene Symbols in NCBI Gene Database
      description: |
        Cross-references gene symbols between ClinVar and NCBI Gene to retrieve comprehensive gene metadata. Uses optimized string-based identifier matching to link databases despite different URI patterns. Retrieves gene symbols, descriptions, types, and chromosomal locations for genes documented in ClinVar.
      databases_used:
        - clinvar
        - ncbigene
      complexity: intermediate
      sparql: |
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        
        SELECT ?cv_symbol ?gene_id ?ncbi_label ?description ?type ?chromosome
        WHERE {
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?cv_gene a cvo:Gene ;
                     cvo:gene_id ?gene_id_int ;
                     cvo:symbol ?cv_symbol .
            BIND(STR(?gene_id_int) AS ?gene_id)
            FILTER(?cv_symbol = "BRCA1" || ?cv_symbol = "TP53" || ?cv_symbol = "CFTR")
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?ncbi_label ;
                       ncbio:typeOfGene ?type ;
                       ncbio:taxid <http://identifiers.org/taxonomy/9606> .
            OPTIONAL { ?ncbi_gene dct:description ?description }
            OPTIONAL { ?ncbi_gene insdc:chromosome ?chromosome }
          }
        }
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter on gene symbols), 7 (OPTIONAL), 8 (taxid filter), 10 (LIMIT)
        - Query uses correct entity types from both MIE files: cvo:Gene and insdc:Gene
        - Identifier matching: ClinVar cvo:gene_id (integer) → string conversion → NCBI Gene dct:identifier (string)
        - Pre-filtering in ClinVar GRAPH with specific gene symbols reduces search dramatically
        - Database-specific optimization: Filter by human taxonomy (9606) in NCBI Gene (from NCBI Gene MIE)
        - Performance: ~2-3 seconds for 50 results (Tier 1)
        - Performance gain: Pre-filtering by 3 gene symbols reduces ClinVar genes from 20K to 3, NCBI Gene taxid filter from 57M to 20K
        - Use case: Gene nomenclature verification, cross-database data integration, gene metadata enrichment
        - Referenced MIE files: ClinVar (cvo:Gene, cvo:gene_id), NCBI Gene (insdc:Gene, ncbio:taxid optimization)
        - Avoided anti-patterns: URI conversion using STR() not CONCAT (simpler), taxid pre-filtering

cross_references:
  - pattern: rdfs:seeAlso
    description: |
      Variants and genes link to ClinVar web interface and HGNC.
    databases:
      primary:
        - ClinVar Web (variants)
        - HGNC (genes)
    sparql: |
      SELECT ?variant ?accession ?url
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 cvo:accession ?accession ;
                 rdfs:seeAlso ?url .
      } LIMIT 10
  - pattern: dct:references
    description: |
      Disease/trait annotations reference MedGen, OMIM, and MeSH.
    databases:
      biomedical:
        - MedGen (~95%)
        - OMIM (~40%)
        - MeSH (~30%)
    sparql: |
      SELECT DISTINCT ?disease ?ref
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?disease a med2rdf:Disease ;
                 dct:references ?ref .
        FILTER(CONTAINS(STR(?ref), "medgen") || CONTAINS(STR(?ref), "omim"))
      } LIMIT 50
  - pattern: cvo:hgnc_id
    description: |
      Gene entities have HGNC identifiers for official gene symbols.
    databases:
      genomics:
        - HGNC (~100% human genes)
    sparql: |
      SELECT ?gene ?symbol ?hgnc_id
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?gene a cvo:Gene ;
              cvo:symbol ?symbol ;
              cvo:hgnc_id ?hgnc_id .
      } LIMIT 20
  - pattern: cvo:omim
    description: |
      Direct OMIM identifiers on Gene entities linking to disease entries.
    databases:
      genetics:
        - OMIM (~4,000 genes)
    sparql: |
      SELECT ?gene ?symbol ?omim_id
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?gene a cvo:Gene ;
              cvo:symbol ?symbol ;
              cvo:omim ?omim_id .
      } LIMIT 50

architectural_notes:
  keyword_search:
    - Use ncbi_esearch for finding variants by gene symbol, disease, or accession
    - For SPARQL-based searches, use bif:contains on rdfs:label for gene symbols
    - "Keyword search syntax: bif:contains \"'term1' AND 'term2'\" for multiple terms"
  schema_design:
    - VariationArchiveType central entity with VCV accessions
    - Classified records contain clinical assertions and interpretations
    - Disease associations via blank nodes linking to dct:references
    - Gene entities with calculated and submitted relationships
    - FALDO ontology for genomic coordinates
    - Variant-gene linkage through med2rdf:gene property on blank nodes (not direct Gene entities)
  performance:
    - Use bif:contains for gene symbol and variant name searches
    - Direct property filters (variation_type, record_status) efficient
    - Complex joins through blank nodes may be slow
    - Always use LIMIT for exploratory queries
    - Counting queries complete in ~1-3 seconds
    - Cross-database queries typically 2-10 seconds depending on complexity
    - "Cross-database optimization: Use explicit GRAPH clauses (Strategy 1)"
    - "Pre-filter within GRAPH blocks before joins (Strategy 2) - reduces search space by 99%+"
    - "Use VALUES clause for known entity sets (Strategy 3) - most effective for gene/concept filtering"
    - "NCBI databases require identifier string matching, not URI equality (Strategy 5)"
    - "NCBI Gene: ALWAYS filter by ncbio:taxid early (Strategy 8) - reduces 57M to species-specific"
  data_integration:
    - MedGen for standardized disease concepts via dct:references
    - HGNC for gene symbol standardization
    - OMIM for Mendelian inheritance
    - MeSH for clinical concept mapping
    - NCBI Gene for comprehensive gene annotations (via shared ncbi endpoint)
    - Cross-database integration uses med2rdf:gene property (blank node URIs) for variant-gene links
    - Gene identifier matching: ClinVar cvo:gene_id (integer) to NCBI Gene dct:identifier (string conversion)
    - MedGen integration: Direct URI references via dct:references property
    - "Expected cross-database performance: Tier 1 (1-3s) with VALUES pre-filtering, Tier 2 (3-8s) without"
  data_quality:
    - Record_status 'current' filters deprecated entries
    - Number of submitters indicates evidence strength
    - Some variants lack disease/clinical significance
    - Dates use both xsd:date and xsd:string

data_statistics:
  total_variations: 3588969
  total_genes: ~20,000
  coverage:
    clinical_significance: ~90%
    disease_associations: ~75%
    gene_associations: ~85%
    external_refs: ~95% MedGen
  cardinality:
    avg_submitters_per_variant: 1.2
    avg_diseases_per_variant: 1.5
    avg_locations_per_gene: 15.3
  performance_characteristics:
    - "Simple property queries: <1s"
    - "bif:contains searches: 1-3s"
    - "Complex blank node joins: 3-10s"
    - "Aggregation queries: 5-15s"
    - "Cross-database queries: Tier 1 (1-3s) with VALUES pre-filtering"
    - "Cross-database queries: Tier 2 (3-8s) with FILTER pre-filtering"
    - "Optimization gain: VALUES clause reduces search space by 99.9% for gene-specific queries"
  data_quality_notes:
    - 90% of variants have clinical significance
    - Most variants from single submitter (70%)
    - "Current records: ~3.2M, deprecated: ~400K"

anti_patterns:
  - title: Missing Graph Specification
    problem: Queries without FROM clause may return incomplete results or timeout.
    wrong_sparql: |
      SELECT ?s ?p ?o
      WHERE {
        ?s a cvo:VariationArchiveType .
        ?s ?p ?o .
      } LIMIT 10
    correct_sparql: |
      SELECT ?s ?p ?o
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?s a cvo:VariationArchiveType .
        ?s ?p ?o .
      } LIMIT 10
    explanation: Always specify FROM <http://rdfportal.org/dataset/clinvar>.
  - title: FILTER CONTAINS vs bif:contains
    problem: FILTER CONTAINS is slower than bif:contains.
    wrong_sparql: |
      SELECT ?variant ?label
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant rdfs:label ?label .
        FILTER(CONTAINS(?label, "BRCA1"))
      }
    correct_sparql: |
      SELECT ?variant ?label
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant rdfs:label ?label .
        ?label bif:contains "'BRCA1'" .
      }
    explanation: Use bif:contains with single-quoted keywords for better performance.
  - title: Blank Node Chains Without OPTIONAL
    problem: Inner joins through blank nodes filter out variants lacking annotations.
    wrong_sparql: |
      SELECT ?var ?sig
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?var cvo:classified_record/cvo:classifications/cvo:germline_classification/cvo:description ?sig .
      }
    correct_sparql: |
      SELECT ?var ?sig
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?var a cvo:VariationArchiveType .
        OPTIONAL {
          ?var cvo:classified_record/cvo:classifications/cvo:germline_classification/cvo:description ?sig .
        }
      }
    explanation: Use OPTIONAL for blank node chains to include variants with missing data.
  - title: Cross-Database Query Without Pre-Filtering
    problem: Filtering after join causes timeout by processing millions of intermediate results
    wrong_sparql: |
      # BAD: Filter after join - times out
      WHERE {
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?gene_bn med2rdf:gene ?gene_uri .
          ?classrec sio:SIO_000628 ?gene_bn .
          ?variant cvo:classified_record ?classrec .
        }
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id .
        }
        FILTER(?gene_symbol = "BRCA1")  # Too late!
      }
    correct_sparql: |
      # GOOD: Pre-filter with VALUES (Strategy 3)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }
          ?gene_bn med2rdf:gene ?gene_uri .
          ?classrec sio:SIO_000628 ?gene_bn .
          ?variant cvo:classified_record ?classrec .
          BIND("672" AS ?gene_id)
        }
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id .
        }
      }
      LIMIT 100
    explanation: "Pre-filtering with VALUES in source GRAPH (Strategy 3) reduces ClinVar variants from 3.5M to ~1000 before cross-database join, improving performance 1000x+"

common_errors:
  - error: Query timeout on aggregation
    causes:
      - Counting 3.5M+ variants without filters
      - Complex blank node property paths
      - Missing LIMIT clause
    solutions:
      - Add filters (variation_type, record_status, dates)
      - Use LIMIT even on COUNT queries
      - Break complex queries into smaller steps
  - error: Empty results for cross-references
    causes:
      - Querying external URIs not in graph as subjects
      - Not following blank node chains to dct:references
    solutions:
      - Use disease/trait blank nodes to find dct:references
      - Check rdfs:seeAlso on main entities
      - Sample data first to understand URI patterns
  - error: Inconsistent date filtering
    causes:
      - Mixed xsd:date and xsd:string datatypes
      - Same property may have different datatypes
    solutions:
      - Use cvo:date_created (xsd:date) not dct:created (xsd:string)
      - Check datatype with sample queries first
      - Cast or convert when necessary
  - error: Cross-database query returns no results
    causes:
      - Wrong graph URIs from co-database MIE files
      - URI pattern mismatch between databases
      - Missing identifier string conversion
      - Not using med2rdf:gene property for variant-gene links
    solutions:
      - Verify graph URIs: ClinVar (http://rdfportal.org/dataset/clinvar), NCBI Gene (http://rdfportal.org/dataset/ncbigene)
      - ClinVar variants link to genes via med2rdf:gene property on blank nodes, not direct cvo:Gene entities
      - Convert ClinVar cvo:gene_id (integer) to string using STR() before matching with NCBI Gene dct:identifier
      - MedGen concepts linked via dct:references - use direct URI matching
      - Test each GRAPH clause independently before combining
      - Use VALUES clause for known gene/concept URIs to avoid complex conversions
