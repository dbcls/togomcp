schema_info:
  title: ClinVar RDF
  description: |
    ClinVar aggregates information about genomic variation and its relationship to human health.
    Contains 3.5M+ variant records with clinical significance assertions, disease associations, and gene relationships.
    Main entities include VariationArchiveType (variants), Gene (associated genes), ClinAsserTraitType (diseases/phenotypes),
    and ClassifiedRecord (clinical assertions). Extensively cross-referenced to MedGen, OMIM, MeSH, HGNC, and NCBI Gene databases.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://ncbi.nlm.nih.gov/clinvar/
  graphs:
    - http://rdfportal.org/dataset/clinvar
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "3.1"
    mie_created: "2025-02-10"
    data_version: "Release 2025.01"
    update_frequency: "Monthly"
  license:
    data_license: "Public Domain (CC0)"
    license_url: "https://www.ncbi.nlm.nih.gov/clinvar/docs/maintenance_use/"
  access:
    rate_limiting: "Standard SPARQL endpoint limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
  PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
  PREFIX sio: <http://semanticscience.org/resource/>
  PREFIX faldo: <http://biohackathon.org/resource/faldo#>
  
  <VariationArchiveShape> {
    a [ cvo:VariationArchiveType ] ;
    rdfs:label xsd:string ;
    cvo:accession xsd:string ;
    cvo:variation_id xsd:integer ;
    cvo:variation_name xsd:string ;
    cvo:variation_type xsd:string ;
    cvo:species xsd:string ;
    cvo:record_status xsd:string ;
    cvo:date_created xsd:date ;
    cvo:date_last_updated xsd:date ;
    cvo:number_of_submitters xsd:integer ;
    cvo:classified_record BNode ? ;
    med2rdf:disease BNode *
  }
  
  <GeneShape> {
    a [ cvo:Gene med2rdf:Gene ] ;
    cvo:gene_id xsd:integer ? ;
    cvo:symbol xsd:string * ;
    cvo:full_name xsd:string * ;
    cvo:hgnc_id xsd:string ? ;
    cvo:omim xsd:integer ? ;
    cvo:cytogenetic_location xsd:string * ;
    faldo:location BNode *
  }
  
  <ClinAsserTraitShape> {
    a [ cvo:ClinAsserTraitType med2rdf:Disease ] ;
    cvo:type xsd:string ;
    cvo:id xsd:integer ? ;
    dct:references IRI +
  }
  
  <ClassifiedRecordShape> {
    a [ cvo:ClassifiedRecord sio:SIO_001122 ] ;
    cvo:classifications BNode ;
    sio:SIO_000628 IRI *
  }

sample_rdf_entries:
  - title: Pathogenic BRCA1 Variant
    description: Frameshift duplication in BRCA1 associated with hereditary breast and ovarian cancer.
    rdf: |
      @prefix cvo: <http://purl.jp/bio/10/clinvar/> .
      @prefix med2rdf: <http://med2rdf.org/ontology/med2rdf#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
      
      <http://ncbi.nlm.nih.gov/clinvar/variation/856461>
        a cvo:VariationArchiveType ;
        rdfs:label "NM_007294.4(BRCA1):c.2244dup (p.Asp749fs)" ;
        cvo:accession "VCV000856461" ;
        cvo:variation_id 856461 ;
        cvo:variation_type "Duplication" ;
        cvo:species "Homo sapiens" ;
        cvo:record_status "current" ;
        cvo:date_created "2022-05-16"^^xsd:date ;
        cvo:number_of_submitters 1 ;
        med2rdf:disease _:disease1 .
  
  - title: Gene with Genomic Location
    description: BRCA1 gene on chromosome 17q21.31 with identifiers.
    rdf: |
      @prefix cvo: <http://purl.jp/bio/10/clinvar/> .
      @prefix med2rdf: <http://med2rdf.org/ontology/med2rdf#> .
      
      <http://ncbi.nlm.nih.gov/gene/672>
        a cvo:Gene, med2rdf:Gene ;
        cvo:gene_id 672 ;
        cvo:symbol "BRCA1" ;
        cvo:full_name "BRCA1 DNA repair associated" ;
        cvo:hgnc_id "HGNC:1100" ;
        cvo:cytogenetic_location "17q21.31" .
  
  - title: Single Nucleotide Variant
    description: Missense variant with clinical significance classification.
    rdf: |
      @prefix cvo: <http://purl.jp/bio/10/clinvar/> .
      
      <http://ncbi.nlm.nih.gov/clinvar/variation/3798403>
        a cvo:VariationArchiveType ;
        rdfs:label "NM_001011552.4(SLC9A4):c.1724C>A (p.Ala575Asp)" ;
        cvo:accession "VCV003798403" ;
        cvo:variation_type "single nucleotide variant" ;
        cvo:species "Homo sapiens" ;
        cvo:record_status "current" ;
        cvo:classified_record _:classrec1 .
  
  - title: Disease Association with MedGen Reference
    description: Clinical trait representing disease with MedGen cross-reference.
    rdf: |
      @prefix cvo: <http://purl.jp/bio/10/clinvar/> .
      @prefix med2rdf: <http://med2rdf.org/ontology/med2rdf#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      
      _:disease1
        a cvo:ClinAsserTraitType, med2rdf:Disease ;
        cvo:type "Disease" ;
        cvo:id 16789 ;
        dct:references _:ref1 .
      
      _:ref1 rdfs:seeAlso <http://ncbi.nlm.nih.gov/medgen/C3150901> .
  
  - title: Classified Record with Clinical Significance
    description: Clinical classification with germline significance assessment.
    rdf: |
      @prefix cvo: <http://purl.jp/bio/10/clinvar/> .
      @prefix sio: <http://semanticscience.org/resource/> .
      @prefix med2rdf: <http://med2rdf.org/ontology/med2rdf#> .
      
      _:classrec1
        a cvo:ClassifiedRecord, sio:SIO_001122 ;
        cvo:classifications _:classi1 ;
        sio:SIO_000628 _:gene_bn .
      
      _:gene_bn med2rdf:gene <http://ncbi.nlm.nih.gov/gene/672> .
      _:classi1 cvo:germline_classification _:germ1 .
      _:germ1 cvo:description "Pathogenic" .

sparql_query_examples:
  - title: Find Variants for Specific Genes Using Gene URIs
    description: Retrieve variants associated with BRCA1, TP53, and CFTR using specific gene IRIs.
    question: What variants are associated with BRCA1, TP53, and CFTR genes?
    complexity: basic
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      # Uses specific gene IRIs - fast and comprehensive
      # Workflow: ncbi_esearch('gene', 'SYMBOL[sym] AND human[organism]') 
      #           to find gene IDs, then use as IRIs
      SELECT ?variant ?label ?type ?gene_uri
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        VALUES ?gene_uri { 
          <http://ncbi.nlm.nih.gov/gene/672>   # BRCA1
          <http://ncbi.nlm.nih.gov/gene/7157>  # TP53
          <http://ncbi.nlm.nih.gov/gene/1080>  # CFTR
        }
        ?gene_bn med2rdf:gene ?gene_uri .
        ?classrec sio:SIO_000628 ?gene_bn .
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:variation_type ?type ;
                 cvo:record_status "current" ;
                 cvo:classified_record ?classrec .
      }
      LIMIT 100
  
  - title: Get Variant Details by Accession
    description: Retrieve comprehensive variant information using ClinVar accession number.
    question: What are the complete details of variant VCV000856461?
    complexity: basic
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?property ?value
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant cvo:accession "VCV000856461" ;
                 ?property ?value .
      }
      LIMIT 50
  
  - title: Count Variants by Type and Status
    description: Aggregate variants by variation type for current records.
    question: What types of variations exist in ClinVar and how many of each?
    complexity: intermediate
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variation_type (COUNT(?variant) as ?count)
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 cvo:variation_type ?variation_type ;
                 cvo:record_status "current" .
      }
      GROUP BY ?variation_type
      ORDER BY DESC(?count)
      LIMIT 50
  
  - title: Find Variants with Pathogenic Significance
    description: Retrieve variants with pathogenic or likely pathogenic classifications using typed predicates.
    question: Which variants have pathogenic or likely pathogenic clinical significance?
    complexity: intermediate
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      # Uses typed predicates - structured navigation
      SELECT ?variant ?label ?type ?significance
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:variation_type ?type ;
                 cvo:record_status "current" ;
                 cvo:classified_record ?classrec .
        ?classrec cvo:classifications ?classi .
        ?classi cvo:germline_classification ?germ .
        ?germ cvo:description ?significance .
        FILTER(?significance = "Pathogenic" || ?significance = "Likely pathogenic")
      }
      LIMIT 100
  
  - title: Search Variants by Gene Symbol in Label
    description: Find variants mentioning specific gene symbol using text search when specific gene IRI not available.
    question: What variants mention EGFR gene in their labels?
    complexity: intermediate
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variant ?label ?type ?status
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:variation_type ?type ;
                 cvo:record_status ?status .
        # Text search justified: 
        # 1. Checked MIE schema - no direct gene symbol predicate on variants
        # 2. Gene linkage requires blank node navigation (complex)
        # 3. User query is exploratory, not comprehensive
        # 4. rdfs:label is unstructured text field (HGVS notation)
        # 5. Virtuoso backend: use bif:contains (indexed)
        ?label bif:contains "'EGFR'" .
      }
      LIMIT 100
  
  - title: Analyze Well-Studied Recent Variants
    description: Identify high-evidence variants with multiple submitters and recent updates.
    question: Which variants have multiple independent submissions and were updated in 2024?
    complexity: advanced
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?variant ?label ?num_submitters ?last_updated ?type ?significance
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:number_of_submitters ?num_submitters ;
                 cvo:date_last_updated ?last_updated ;
                 cvo:variation_type ?type ;
                 cvo:record_status "current" .
        FILTER(?num_submitters >= 3)
        FILTER(?last_updated >= "2024-01-01"^^xsd:date)
        OPTIONAL {
          ?variant cvo:classified_record/cvo:classifications/cvo:germline_classification/cvo:description ?significance
        }
      }
      ORDER BY DESC(?num_submitters) DESC(?last_updated)
      LIMIT 100
  
  - title: Complex Gene-Disease-Variant Network Analysis
    description: Integrate genes, variants, and diseases with chromosomal locations and clinical significance.
    question: What is the complete network of genes, variants, and diseases for specific chromosomal regions?
    complexity: advanced
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      SELECT DISTINCT ?gene_symbol ?cyto_loc ?variant_label ?var_type ?significance ?medgen_ref
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        # Start with genes on chromosome 17
        ?gene a cvo:Gene ;
              cvo:symbol ?gene_symbol ;
              cvo:cytogenetic_location ?cyto_loc .
        FILTER(REGEX(?cyto_loc, "^17[pq]"))
        
        # Link to variants
        ?gene_bn med2rdf:gene ?gene .
        ?classrec sio:SIO_000628 ?gene_bn .
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?variant_label ;
                 cvo:variation_type ?var_type ;
                 cvo:record_status "current" ;
                 cvo:classified_record ?classrec .
        
        # Get clinical significance
        OPTIONAL {
          ?classrec cvo:classifications/cvo:germline_classification/cvo:description ?significance
        }
        
        # Get disease associations
        OPTIONAL {
          ?variant med2rdf:disease/dct:references/rdfs:seeAlso ?medgen_ref .
          FILTER(CONTAINS(STR(?medgen_ref), "medgen"))
        }
      }
      LIMIT 100

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - medgen
    - ncbigene
    - pubmed
    - pubtator
  examples:
    - title: Link ClinVar Variants to NCBI Gene Annotations
      description: |
        Integrates variant-gene associations from ClinVar with comprehensive gene metadata from NCBI Gene.
        
        Structured linking strategy:
        - ClinVar: Uses med2rdf:gene predicate on blank nodes linking to NCBI Gene URIs
        - NCBI Gene: Uses dct:identifier matching gene IDs
        - VALUES pre-filtering reduces search from 3.5M variants to target set (99.8% reduction)
        - Gene ID conversion: ClinVar integer → NCBI Gene string
      databases_used:
        - clinvar
        - ncbigene
      complexity: intermediate
      sparql: |
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX sio: <http://semanticscience.org/resource/>
        
        SELECT ?variant ?var_label ?var_type ?gene_symbol ?gene_desc ?gene_type
        WHERE {
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }  # BRCA1
            ?gene_bn med2rdf:gene ?gene_uri .
            ?classrec sio:SIO_000628 ?gene_bn .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     cvo:variation_type ?var_type ;
                     cvo:record_status "current" ;
                     cvo:classified_record ?classrec .
            BIND("672" AS ?gene_id)
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol ;
                       ncbio:typeOfGene ?gene_type .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
          }
        }
        LIMIT 50
      notes: |
        - Linking via: Shared gene URI namespace (http://ncbi.nlm.nih.gov/gene/*)
        - Performance: ~2-3s (Tier 1)
        - VALUES reduces from 3.5M to ~8K variants (99.8% reduction)
        - Gene ID conversion: integer → string
        - MIE files referenced: clinvar, ncbigene
    
    - title: Enrich Variants with MedGen Disease Concepts
      description: |
        Links ClinVar variant-disease associations to detailed MedGen clinical concepts.
        
        Structured linking strategy:
        - ClinVar: Uses dct:references on disease blank nodes with rdfs:seeAlso to MedGen URIs
        - MedGen: Direct IRI matching on ConceptID entities
        - VALUES pre-filtering with specific disease concept (99.99% reduction)
        - Handles URI namespace variations (ncbi.nlm.nih.gov vs www.ncbi.nlm.nih.gov)
      databases_used:
        - clinvar
        - medgen
      complexity: intermediate
      sparql: |
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX mo: <http://med2rdf/ontology/medgen#>
        PREFIX dct: <http://purl.org/dc/terms/>
        
        SELECT ?variant ?var_label ?medgen_cui ?medgen_label ?sty
        WHERE {
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            # Pre-filter with specific MedGen concept
            VALUES ?medgen_concept { <http://www.ncbi.nlm.nih.gov/medgen/C0011849> }  # Diabetes Mellitus
            ?disease dct:references ?ref_bn .
            ?ref_bn rdfs:seeAlso ?medgen_concept .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     cvo:record_status "current" ;
                     med2rdf:disease ?disease .
          }
          GRAPH <http://rdfportal.org/dataset/medgen> {
            ?medgen_concept a mo:ConceptID ;
                            dct:identifier ?medgen_cui ;
                            rdfs:label ?medgen_label ;
                            mo:sty ?sty .
          }
        }
        LIMIT 50
      notes: |
        - Linking via: Direct MedGen URI references through dct:references/rdfs:seeAlso
        - Performance: ~2-4s (Tier 1)
        - VALUES reduces from 3.5M to ~hundreds (99.99% reduction)
        - Direct URI linkage (no conversion needed for this pattern)
        - MIE files referenced: clinvar, medgen
    
    - title: Comprehensive Gene-Variant-Disease Integration
      description: |
        Three-way integration across ClinVar, NCBI Gene, and MedGen databases.
        
        Structured linking strategy:
        - ClinVar → NCBI Gene: med2rdf:gene on blank nodes
        - ClinVar → MedGen: dct:references/rdfs:seeAlso on disease blank nodes
        - VALUES pre-filtering on gene dramatically reduces join complexity
        - Split property paths prevent timeout
        - Provides complete context: gene annotations, variant details, clinical concepts
      databases_used:
        - clinvar
        - ncbigene
        - medgen
      complexity: advanced
      sparql: |
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX mo: <http://med2rdf/ontology/medgen#>
        PREFIX sio: <http://semanticscience.org/resource/>
        PREFIX dct: <http://purl.org/dc/terms/>
        
        SELECT ?gene_symbol ?gene_type ?var_label ?significance ?medgen_label
        WHERE {
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }  # BRCA1
            ?gene_bn med2rdf:gene ?gene_uri .
            ?classrec sio:SIO_000628 ?gene_bn .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     cvo:record_status "current" ;
                     cvo:classified_record ?classrec ;
                     med2rdf:disease ?disease .
            ?disease dct:references ?ref_bn .
            ?ref_bn rdfs:seeAlso ?medgen_uri .
            ?classrec cvo:classifications/cvo:germline_classification/cvo:description ?significance .
            BIND("672" AS ?gene_id)
          }
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol ;
                       ncbio:typeOfGene ?gene_type .
          }
          GRAPH <http://rdfportal.org/dataset/medgen> {
            ?medgen_uri a mo:ConceptID ;
                        rdfs:label ?medgen_label .
          }
          FILTER(CONTAINS(STR(?medgen_uri), "www.ncbi"))
        }
        LIMIT 50
      notes: |
        - Linking via: Shared IRIs (NCBI Gene URIs, MedGen URIs)
        - Performance: ~4-8s (Tier 2)
        - Three-way join requires careful optimization
        - VALUES on gene reduces from 3.5M variants to ~8K
        - Split property paths prevent timeout
        - MIE files referenced: clinvar, ncbigene, medgen

cross_references:
  - pattern: rdfs:seeAlso
    description: |
      Variants and genes link to ClinVar web interface and external gene databases.
      Provides web access to full variant details and gene nomenclature.
    databases:
      primary:
        - "ClinVar Web: variant details pages"
        - "HGNC: gene nomenclature (via cvo:hgnc_id)"
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variant ?accession ?url
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 cvo:accession ?accession ;
                 rdfs:seeAlso ?url .
      } 
      LIMIT 10
  
  - pattern: dct:references (via blank nodes)
    description: |
      Disease/trait annotations reference MedGen, OMIM, and MeSH through blank nodes.
      Critical pattern: variant → med2rdf:disease → dct:references → blank node → rdfs:seeAlso → external URI.
      MedGen references use URI: http://ncbi.nlm.nih.gov/medgen/ or http://www.ncbi.nlm.nih.gov/medgen/
    databases:
      biomedical:
        - "MedGen: ~95% of disease associations"
        - "OMIM: ~40% of genetic conditions"
        - "MeSH: ~30% of phenotypes"
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX dct: <http://purl.org/dc/terms/>
      
      SELECT DISTINCT ?variant ?disease_type ?ref_uri
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 med2rdf:disease ?disease .
        ?disease cvo:type ?disease_type ;
                 dct:references ?ref_bn .
        ?ref_bn rdfs:seeAlso ?ref_uri .
        FILTER(CONTAINS(STR(?ref_uri), "medgen") || CONTAINS(STR(?ref_uri), "omim"))
      } 
      LIMIT 50
  
  - pattern: cvo:hgnc_id
    description: |
      Gene entities have HGNC identifiers for official human gene symbols.
      ~100% coverage for human genes in ClinVar.
    databases:
      genomics:
        - "HGNC: complete coverage of human genes"
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?gene ?symbol ?hgnc_id
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?gene a cvo:Gene ;
              cvo:symbol ?symbol ;
              cvo:hgnc_id ?hgnc_id .
      } 
      LIMIT 20
  
  - pattern: cvo:omim
    description: |
      Direct OMIM identifiers on Gene entities for disease-gene associations.
      ~4,000 genes with OMIM entries.
    databases:
      genetics:
        - "OMIM: ~4,000 genes with documented phenotypes"
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?gene ?symbol ?omim_id
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?gene a cvo:Gene ;
              cvo:symbol ?symbol ;
              cvo:omim ?omim_id .
      } 
      LIMIT 50
  
  - pattern: med2rdf:gene (on blank nodes)
    description: |
      Variant-gene linkage through blank nodes referencing NCBI Gene URIs.
      Critical for cross-database integration with ncbigene.
      Pattern: variant → cvo:classified_record → sio:SIO_000628 → blank node → med2rdf:gene → gene URI
    databases:
      genomics:
        - "NCBI Gene: comprehensive gene database with 90K+ genes"
    sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT DISTINCT ?variant ?label ?gene_uri
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:classified_record ?classrec .
        ?classrec sio:SIO_000628 ?gene_bn .
        ?gene_bn med2rdf:gene ?gene_uri .
      } 
      LIMIT 20

architectural_notes:
  query_strategy:
    - "Exploratory: Use ncbi_esearch('clinvar', 'GENE[sym] AND pathogenic') to find example variants"
    - "Gene discovery: Use ncbi_esearch('gene', 'SYMBOL[sym] AND human[organism]') to find gene IDs"
    - "Comprehensive: Use VALUES with specific gene URIs (e.g., <http://ncbi.nlm.nih.gov/gene/672> for BRCA1)"
    - "Gene URIs: <http://ncbi.nlm.nih.gov/gene/{gene_id}> where gene_id is NCBI Gene identifier"
    - "Text search fallback: Use bif:contains on rdfs:label only when specific gene IRIs not available or for exploratory queries"
    - "Species: All variants are Homo sapiens (cvo:species filter not needed for most queries)"
    - "Priority: Specific gene URIs > Typed predicates (cvo:variation_type, cvo:record_status, cvo:date_last_updated) > Text search"
  
  schema_design:
    - "VariationArchiveType: Central entity with VCV accessions and variation IDs"
    - "Classified records: Contain clinical assertions with germline/somatic classifications via blank nodes"
    - "Disease associations: Stored in blank nodes with dct:references to external databases (MedGen, OMIM, MeSH)"
    - "Gene entities: Separate resources with NCBI Gene IDs, HGNC IDs, OMIM IDs"
    - "Variant-gene links: Via blank nodes with med2rdf:gene predicate pointing to NCBI Gene URIs"
    - "FALDO: Used for genomic coordinates"
    - "Key typed predicates: cvo:species, cvo:variation_type, cvo:record_status, cvo:accession"
  
  performance:
    - "Direct property filters: <1s (e.g., cvo:accession, cvo:record_status)"
    - "bif:contains text search: 1-3s"
    - "VALUES with gene URIs: 1-2s (reduces from 3.5M to thousands)"
    - "Blank node navigation: 2-5s (split paths for better performance)"
    - "Complex joins: 3-10s (use LIMIT, pre-filter with VALUES)"
    - "Counting queries: 1-3s with filters, 10-30s without"
    - "Cross-DB two-way: 2-4s with VALUES pre-filtering (Tier 1)"
    - "Cross-DB three-way: 4-8s with optimization (Tier 2)"
  
  cross_database_optimization:
    - "Strategy 1: Explicit GRAPH clauses (MANDATORY for shared endpoint)"
    - "Strategy 2: Pre-filter within GRAPH before joins (reduces 99%+ of data)"
    - "Strategy 3: VALUES for known entities (most effective - use specific gene/disease URIs)"
    - "Strategy 4: Split property paths (e.g., split cvo:classified_record/cvo:classifications/...)"
    - "Strategy 5: Identifier conversion (ClinVar gene_id integer → NCBI Gene string)"
    - "Strategy 7: OPTIONAL for non-critical data"
    - "Strategy 10: Always add LIMIT and document performance tier"
    - "Expected: Tier 1 (1-3s) with VALUES pre-filtering on single gene"
  
  data_integration:
    - "MedGen: Standardized disease concepts via dct:references (URI may have www. prefix)"
    - "NCBI Gene: Comprehensive annotations via med2rdf:gene on blank nodes"
    - "HGNC: Gene nomenclature via cvo:hgnc_id"
    - "OMIM: Mendelian inheritance via cvo:omim and dct:references"
    - "MeSH: Clinical concepts via dct:references"
    - "Gene linkage: ClinVar gene_id (int) → NCBI Gene identifier (str) requires conversion"
    - "Disease linkage: Direct URI via dct:references → rdfs:seeAlso pattern"
  
  data_quality:
    - "cvo:record_status 'current' filters deprecated entries (~99.9% are current)"
    - "cvo:number_of_submitters indicates evidence strength (avg 1.2 per variant)"
    - "Some variants lack disease associations (~25%) or clinical significance (~0.1%)"
    - "Date fields: cvo:date_created and cvo:date_last_updated use xsd:date"
    - "dct:created and dct:modified use xsd:string (inconsistent)"
    - "Blank node chains require careful navigation (split paths for performance)"

data_statistics:
  total_variations: 3588969
  verified_date: "2025-02-10"
  verification_method: "Direct count query on VariationArchiveType"
  verification_query: |
    PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
    SELECT (COUNT(DISTINCT ?v) as ?count)
    FROM <http://rdfportal.org/dataset/clinvar>
    WHERE { ?v a cvo:VariationArchiveType }
  
  unique_genes: 92318
  verified_date_genes: "2025-02-10"
  verification_query_genes: |
    PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
    SELECT (COUNT(DISTINCT ?gene_id) as ?count)
    FROM <http://rdfportal.org/dataset/clinvar>
    WHERE { ?gene a cvo:Gene ; cvo:gene_id ?gene_id }
  
  coverage:
    clinical_significance: "~99.9% (3,588,257 of 3,588,969)"
    calculation: "Variants with cvo:classified_record property"
    disease_associations: "~75% have disease/phenotype annotations"
    gene_associations: "~85% have gene associations"
    external_refs: "~95% have MedGen cross-references for diseases"
  
  cardinality:
    avg_submitters_per_variant: 1.2
    avg_diseases_per_variant: 1.5
    avg_locations_per_gene: 15.3
  
  variant_type_distribution:
    single_nucleotide_variant: "3,236,823 (90.2%)"
    deletion: "160,620 (4.5%)"
    duplication: "73,448 (2.0%)"
    microsatellite: "36,328 (1.0%)"
    other: "81,750 (2.3%)"
  
  performance_characteristics:
    - "Simple property queries: <1s"
    - "bif:contains searches: 1-3s"
    - "VALUES with gene URIs: 1-2s"
    - "Complex blank node joins: 3-10s"
    - "Aggregation queries: 1-3s with filters, 10-30s without"
    - "Cross-DB (two-way): 2-4s with VALUES (Tier 1)"
    - "Cross-DB (three-way): 4-8s with optimization (Tier 2)"
  
  staleness_warning: "Monthly updates from NCBI - always use cvo:record_status 'current' filter for active records"

anti_patterns:
  - title: "Skipping MIE Schema Check Before Text Search"
    problem: "Using text search without checking MIE file for structured alternatives."
    wrong_sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      # WRONG: Immediately use text search without checking schema
      SELECT ?variant ?label
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label .
        ?label bif:contains "'BRCA1'" .
      }
      LIMIT 100
    correct_sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      # CORRECT workflow:
      # 1. get_MIE_file('clinvar') - checked shape_expressions
      # 2. Found: med2rdf:gene predicate on blank nodes links to gene URIs
      # 3. ncbi_esearch('gene', 'BRCA1[sym] AND human[organism]') - found gene ID 672
      # 4. Use discovered gene URI for comprehensive search:
      SELECT ?variant ?label
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }
        ?gene_bn med2rdf:gene ?gene_uri .
        ?classrec sio:SIO_000628 ?gene_bn .
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label ;
                 cvo:classified_record ?classrec .
      }
      LIMIT 100
    explanation: |
      Always check MIE schema first to discover structured properties.
      For genes: med2rdf:gene provides direct IRIs (10-100x faster than text search).
      Use ncbi_esearch to find gene IDs, then construct gene URIs.
  
  - title: "Missing FROM Clause"
    problem: "Queries without FROM may return incomplete results or timeout."
    wrong_sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variant ?label
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label .
      }
      LIMIT 10
    correct_sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT ?variant ?label
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 rdfs:label ?label .
      }
      LIMIT 10
    explanation: "Always specify FROM <http://rdfportal.org/dataset/clinvar> for explicit graph selection."
  
  - title: "Cross-Database Query Without Pre-Filtering"
    problem: "Filtering after join causes timeout by processing millions of results."
    wrong_sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      # TIMEOUT: Joins 3.5M variants with gene DB first, then filters
      WHERE {
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?gene_bn med2rdf:gene ?gene_uri .
          ?classrec sio:SIO_000628 ?gene_bn .
          ?variant cvo:classified_record ?classrec .
        }
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id .
        }
        FILTER(?gene_symbol = "BRCA1")
      }
    correct_sparql: |
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      # FAST: Pre-filter with VALUES (reduces from 3.5M to ~8K)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }  # BRCA1
          ?gene_bn med2rdf:gene ?gene_uri .
          ?classrec sio:SIO_000628 ?gene_bn .
          ?variant cvo:classified_record ?classrec .
          BIND("672" AS ?gene_id)
        }
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id .
        }
      }
      LIMIT 100
    explanation: |
      Pre-filter with VALUES in source GRAPH reduces dataset by 99.8% before join.
      This is the single most important optimization for cross-database queries.
      Workflow: ncbi_esearch('gene', 'SYMBOL[sym]') → get gene ID → use as URI.
  
  - title: "Circular Reasoning with Search API Results"
    problem: "Using search result IDs in VALUES for comprehensive questions."
    wrong_sparql: |
      # WRONG workflow:
      # 1. ncbi_esearch('clinvar', 'BRCA1 AND pathogenic') → returns 20 variant IDs
      # 2. Query only those 20 variants:
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      
      SELECT (COUNT(?variant) as ?count)
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        VALUES ?var_id { 4690250 4690233 4690232 ... }  # Only 20 from search
        ?variant cvo:variation_id ?var_id .
      }
      # Result: Only counted 20 variants you already found!
    correct_sparql: |
      # CORRECT workflow:
      # 1. get_MIE_file('clinvar') → found med2rdf:gene predicate
      # 2. ncbi_esearch('gene', 'BRCA1[sym]') → found gene ID 672
      # 3. Query ALL variants for that gene using gene URI:
      PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
      PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT (COUNT(DISTINCT ?variant) as ?count)
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }
        ?gene_bn med2rdf:gene ?gene_uri .
        ?classrec sio:SIO_000628 ?gene_bn ;
                  cvo:classifications/cvo:germline_classification/cvo:description ?sig .
        ?variant cvo:classified_record ?classrec .
        FILTER(?sig = "Pathogenic" || ?sig = "Likely pathogenic")
      }
      # Result: Comprehensive count of ALL pathogenic BRCA1 variants
    explanation: |
      Search APIs find examples to discover patterns (like gene IRIs).
      Use discovered IRIs to query the complete dataset, not just the examples.
      This avoids circular reasoning and provides comprehensive answers.

common_errors:
  - error: "Query timeout on aggregation"
    causes:
      - "Counting 3.5M+ variants without filters"
      - "Complex blank node property paths without splitting"
      - "Missing LIMIT clause on exploratory queries"
    solutions:
      - "Add filters: cvo:variation_type, cvo:record_status, cvo:date_last_updated"
      - "Split property paths: separate ?variant cvo:classified_record ?cr . ?cr cvo:classifications ?c ."
      - "Use LIMIT even on COUNT queries (set reasonable upper bound)"
      - "For specific genes, use VALUES with gene URIs to pre-filter"
    example_fix: |
      # WRONG - Times out
      SELECT (COUNT(?variant) as ?count)
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE { ?variant a cvo:VariationArchiveType }
      
      # CORRECT - Fast with filter
      SELECT (COUNT(?variant) as ?count)
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant a cvo:VariationArchiveType ;
                 cvo:record_status "current" .
      }
  
  - error: "Empty results for disease cross-references"
    causes:
      - "Not following blank node chain: disease → dct:references → blank node → rdfs:seeAlso"
      - "Querying external URIs as subjects (they're only in object position)"
    solutions:
      - "Correct pattern: ?variant med2rdf:disease ?disease . ?disease dct:references ?bn . ?bn rdfs:seeAlso ?uri"
      - "Sample the data first to understand blank node structure"
      - "Use OPTIONAL for cross-references (not all variants have them)"
    example_fix: |
      # WRONG - Empty results
      SELECT ?variant ?medgen
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant med2rdf:disease ?medgen .
        FILTER(CONTAINS(STR(?medgen), "medgen"))
      }
      
      # CORRECT - Follows blank node chain
      SELECT ?variant ?medgen_uri
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant med2rdf:disease ?disease .
        ?disease dct:references ?ref_bn .
        ?ref_bn rdfs:seeAlso ?medgen_uri .
        FILTER(CONTAINS(STR(?medgen_uri), "medgen"))
      }
      LIMIT 100
  
  - error: "Slow performance with gene lookups"
    causes:
      - "Using text search (bif:contains or FILTER) instead of specific gene URIs"
      - "Not pre-filtering with VALUES in cross-database queries"
    solutions:
      - "Find gene IDs first: ncbi_esearch('gene', 'SYMBOL[sym] AND human[organism]')"
      - "Use VALUES with specific gene URIs: VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }"
      - "Navigate blank nodes: ?gene_bn med2rdf:gene ?gene_uri . ?classrec sio:SIO_000628 ?gene_bn"
    example_fix: |
      # SLOW - Text search
      SELECT ?variant
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        ?variant rdfs:label ?label .
        ?label bif:contains "'BRCA1'" .
      }
      
      # FAST - Specific gene URI
      SELECT ?variant
      FROM <http://rdfportal.org/dataset/clinvar>
      WHERE {
        VALUES ?gene_uri { <http://ncbi.nlm.nih.gov/gene/672> }
        ?gene_bn med2rdf:gene ?gene_uri .
        ?classrec sio:SIO_000628 ?gene_bn .
        ?variant cvo:classified_record ?classrec .
      }
      LIMIT 100
