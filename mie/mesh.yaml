schema_info:
  title: Medical Subject Headings (MeSH) RDF
  description: |
    National Library of Medicine's controlled vocabulary thesaurus for biomedical literature indexing.
    Contains ~30K topical descriptors with hierarchical tree numbers, ~250K supplementary chemical records,
    ~867K terms, and ~467K concepts. Organized in 16 tree categories (A-Z) for systematic navigation.
    Primary use: PubMed article indexing, biomedical database curation, clinical research queries.
  endpoint: https://rdfportal.org/primary/sparql
  base_uri: http://id.nlm.nih.gov/mesh/
  graphs:
    - http://id.nlm.nih.gov/mesh
    - http://id.nlm.nih.gov/mesh/vocab
    - http://id.nlm.nih.gov/mesh/void
  kw_search_tools:
    - search_mesh_descriptor
  version:
    mie_version: "2.0"
    mie_created: "2026-02-09"
    data_version: "2024"
    update_frequency: "Annual"
  license:
    data_license: "Public Domain (U.S. Government)"
    license_url: "https://www.nlm.nih.gov/databases/download/terms_and_conditions.html"
  access:
    rate_limiting: "No strict limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
  
  <TopicalDescriptorShape> {
    a [ meshv:TopicalDescriptor ] ;
    rdfs:label xsd:string ;
    meshv:identifier xsd:string ;
    meshv:treeNumber @<TreeNumberShape> + ;
    meshv:broaderDescriptor @<TopicalDescriptorShape> * ;
    meshv:annotation xsd:string ? ;
    meshv:preferredConcept @<ConceptShape> ;
    meshv:allowableQualifier @<QualifierShape> *
  }
  
  <ConceptShape> {
    a [ meshv:Concept ] ;
    rdfs:label xsd:string ;
    meshv:preferredTerm @<TermShape>
  }
  
  <TermShape> {
    a [ meshv:Term ] ;
    rdfs:label xsd:string ;
    meshv:prefLabel xsd:string
  }
  
  <TreeNumberShape> {
    a [ meshv:TreeNumber ] ;
    rdfs:label xsd:string
  }
  
  <QualifierShape> {
    a [ meshv:Qualifier ] ;
    rdfs:label xsd:string ;
    meshv:identifier xsd:string
  }
  
  <SCR_ChemicalShape> {
    a [ meshv:SCR_Chemical ] ;
    rdfs:label xsd:string ;
    meshv:identifier xsd:string ;
    meshv:registryNumber xsd:string ?
  }

sample_rdf_entries:
  - title: Topical Descriptor with Complete Structure
    description: Disease descriptor with tree numbers, broader relationship, and qualifier constraints.
    rdf: |
      @prefix mesh: <http://id.nlm.nih.gov/mesh/> .
      @prefix meshv: <http://id.nlm.nih.gov/mesh/vocab#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      
      mesh:D003920 a meshv:TopicalDescriptor ;
        rdfs:label "Diabetes Mellitus" ;
        meshv:identifier "D003920" ;
        meshv:treeNumber mesh:C18.452.394.750, mesh:C19.246 ;
        meshv:broaderDescriptor mesh:D044882 ;
        meshv:annotation "general or unspecified; prefer specifics..." ;
        meshv:allowableQualifier mesh:Q000188, mesh:Q000209 .
  
  - title: Hierarchical Relationship
    description: Parent-child descriptor relationship using broaderDescriptor.
    rdf: |
      mesh:D044882 a meshv:TopicalDescriptor ;
        rdfs:label "Glucose Metabolism Disorders" ;
        meshv:identifier "D044882" .
      
      mesh:D003920 a meshv:TopicalDescriptor ;
        rdfs:label "Diabetes Mellitus" ;
        meshv:broaderDescriptor mesh:D044882 .
  
  - title: Qualifier for Subheadings
    description: Allowable qualifier for creating descriptor-qualifier pairs in indexing.
    rdf: |
      mesh:Q000188 a meshv:Qualifier ;
        rdfs:label "drug therapy" ;
        meshv:identifier "Q000188" .
  
  - title: Supplementary Chemical Record
    description: Chemical substance with CAS registry number cross-reference.
    rdf: |
      mesh:C517652 a meshv:SCR_Chemical ;
        rdfs:label "Insulin Glargine" ;
        meshv:identifier "C517652" ;
        meshv:registryNumber "2ZM8CX04RZ" .
  
  - title: Tree Number Classification
    description: Hierarchical classification code for category navigation.
    rdf: |
      mesh:C18.452.394.750 a meshv:TreeNumber ;
        rdfs:label "C18.452.394.750" .

sparql_query_examples:
  - title: Retrieve Specific Descriptor Annotations
    description: Direct IRI lookup for complete descriptor information.
    question: What are the annotations and hierarchical details for Diabetes Mellitus?
    complexity: basic
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?label ?annotation ?treeNum ?broaderLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 rdfs:label ?label .
        OPTIONAL { mesh:D003920 meshv:annotation ?annotation }
        OPTIONAL { 
          mesh:D003920 meshv:treeNumber ?tree .
          ?tree rdfs:label ?treeNum
        }
        OPTIONAL {
          mesh:D003920 meshv:broaderDescriptor ?broader .
          ?broader rdfs:label ?broaderLabel
        }
      }
  
  - title: Query Multiple Related Descriptors
    description: Use VALUES to retrieve information for multiple specific disease IRIs.
    question: Compare annotations for diabetes subtypes?
    complexity: basic
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?descriptor ?label ?annotation ?treeNum
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        VALUES ?descriptor { 
          mesh:D003920  # Diabetes Mellitus
          mesh:D003922  # Type 1
          mesh:D003924  # Type 2
        }
        ?descriptor rdfs:label ?label .
        OPTIONAL { ?descriptor meshv:annotation ?annotation }
        OPTIONAL {
          ?descriptor meshv:treeNumber ?tree .
          ?tree rdfs:label ?treeNum
        }
      }
  
  - title: Navigate Hierarchical Tree Structure
    description: Graph navigation using tree number prefix patterns for category filtering.
    question: Which descriptors are under "Endocrine System Diseases" (C19 tree)?
    complexity: intermediate
    sparql: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?descriptor ?label ?treeNum
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
                    rdfs:label ?label ;
                    meshv:treeNumber ?tree .
        ?tree rdfs:label ?treeNum .
        # Tree navigation: C19 category
        FILTER(STRSTARTS(?treeNum, "C19"))
      }
      LIMIT 50
  
  - title: Retrieve Allowable Qualifiers
    description: Use specific descriptor IRI to find permitted qualifier combinations.
    question: Which qualifiers can be combined with Diabetes descriptor?
    complexity: intermediate
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?descriptor ?descLabel ?qualifier ?qualLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        VALUES ?descriptor { 
          mesh:D003920  # Diabetes Mellitus
          mesh:D002318  # Cardiovascular Diseases
        }
        ?descriptor rdfs:label ?descLabel ;
                    meshv:allowableQualifier ?qualifier .
        ?qualifier rdfs:label ?qualLabel .
      }
      ORDER BY ?descLabel ?qualLabel
  
  - title: Count Descriptors by Tree Category
    description: Aggregate statistics using tree number structure for distribution analysis.
    question: How many descriptors in each major MeSH category?
    complexity: intermediate
    sparql: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?category (COUNT(DISTINCT ?descriptor) as ?count)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
                    meshv:treeNumber ?tree .
        ?tree rdfs:label ?treeLabel .
        # Extract first character for category
        BIND(SUBSTR(?treeLabel, 1, 1) as ?category)
      }
      GROUP BY ?category
      ORDER BY ?category
  
  - title: Find Transitive Hierarchical Ancestors
    description: Use specific IRI with transitive broaderDescriptor for complete ancestry path.
    question: What are all parent categories of Diabetes Mellitus?
    complexity: advanced
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?parent ?parentLabel ?parentId
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        # Start from specific descriptor IRI
        mesh:D003920 meshv:broaderDescriptor+ ?parent .
        ?parent rdfs:label ?parentLabel ;
                meshv:identifier ?parentId .
      }
      ORDER BY ?parentLabel
  
  - title: Search Chemicals by Name with Text Index
    description: Full-text search for chemical records when exploring unknown concepts.
    question: Find insulin-related chemical substances?
    complexity: advanced
    sparql: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?chemical ?label ?registryNumber
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?chemical a meshv:SCR_Chemical ;
                  rdfs:label ?label .
        OPTIONAL { ?chemical meshv:registryNumber ?registryNumber }
        # Text search justified: exploring chemicals without known IRIs
        ?label bif:contains "'insulin'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20

cross_database_queries:
  shared_endpoint: primary
  co_located_databases:
    - mondo
    - go
    - taxonomy
    - nando
    - bacdive
    - mediadive
  mie_files_consulted:
    - "mondo (owl:Class shape, oboInOwl:hasDbXref, graph URI, MESH: xref format)"
  examples:
    - title: Link MeSH Descriptors to MONDO Disease Classification
      description: |
        Integrate medical subject headings with disease ontology using MONDO's hasDbXref.
        MONDO diseases reference MeSH via "MESH:D######" or "MESH:C######" format.
        Enables mapping between clinical literature terminology and formal disease classification.
        Use specific disease IRIs in MONDO after exploratory keyword search.
      databases_used:
        - mesh
        - mondo
      complexity: intermediate
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
        
        SELECT ?mondoDisease ?mondoLabel ?meshDescriptor ?meshLabel ?meshType
        WHERE {
          GRAPH <http://rdfportal.org/ontology/mondo> {
            # Use specific MONDO IRI after exploratory search
            VALUES ?mondoDisease {
              obo:MONDO_0005147  # Type 1 diabetes
              obo:MONDO_0005148  # Type 2 diabetes
            }
            ?mondoDisease a owl:Class ;
                          rdfs:label ?mondoLabel ;
                          oboInOwl:hasDbXref ?meshXref .
            FILTER(STRSTARTS(?meshXref, "MESH:"))
          }
          
          # Convert MESH:D###### format to IRI
          BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDescriptor)
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshDescriptor rdfs:label ?meshLabel .
            # Type can be TopicalDescriptor or SCR_*
            ?meshDescriptor a ?type .
            BIND(STRAFTER(STR(?type), "vocab#") as ?meshType)
          }
        }
        ORDER BY ?mondoLabel
      notes: |
        - Strategies: 1 (GRAPH), 2 (VALUES with IRIs), 5 (URI conversion), 10 (LIMIT implicit via VALUES)
        - Strategy 1: Explicit GRAPH clauses isolate each database
        - Strategy 2: Use specific MONDO IRIs found via exploratory search (not keyword filter here)
        - Strategy 5: URI conversion from MONDO's "MESH:D######" format
        - Performance: ~1-2s for small VALUES set (Tier 1)
        - Coverage: ~28% of MONDO diseases have MeSH xrefs (~8,500 mappings)
        - Note: MESH: xrefs can point to TopicalDescriptor (D) or SCR records (C)
        - Workflow: (1) Use OLS4:searchClasses to find MONDO IRIs, (2) Use those in VALUES
    
    - title: Multi-Category MeSH-MONDO Disease Integration
      description: |
        Cross-database query using multiple MONDO disease IRIs to retrieve their MeSH mappings.
        Demonstrates efficient batch lookup of MeSH descriptors across disease categories.
        Pre-selecting MONDO IRIs eliminates need for keyword filtering in cross-database context.
      databases_used:
        - mesh
        - mondo
      complexity: intermediate
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        
        SELECT ?mondoId ?mondoLabel ?meshId ?meshLabel ?meshAnnotation
        WHERE {
          GRAPH <http://rdfportal.org/ontology/mondo> {
            # Multiple specific disease IRIs
            VALUES ?mondoDisease {
              obo:MONDO_0004992  # cancer
              obo:MONDO_0005015  # diabetes mellitus
              obo:MONDO_0005260  # autism
            }
            ?mondoDisease a owl:Class ;
                          rdfs:label ?mondoLabel ;
                          oboInOwl:id ?mondoId ;
                          oboInOwl:hasDbXref ?meshXref .
            FILTER(STRSTARTS(?meshXref, "MESH:"))
          }
          
          BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDescriptor)
          BIND(SUBSTR(?meshXref, 6) as ?meshId)
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshDescriptor rdfs:label ?meshLabel .
            OPTIONAL {
              ?meshDescriptor meshv:annotation ?meshAnnotation
            }
          }
        }
        ORDER BY ?mondoLabel
      notes: |
        - Strategies: 1 (GRAPH), 2 (VALUES with IRIs), 5 (URI conversion)
        - No keyword filtering needed - using pre-selected IRIs
        - Efficient batch retrieval for multiple disease categories
        - Performance: ~1-2s (Tier 1)
        - Use case: Disease classification mapping, clinical terminology alignment
    
    - title: Three-Way Integration with NANDO for Japanese Rare Disease Research
      description: |
        Complex three-database integration using MONDO as semantic bridge.
        Links Japanese rare disease database (NANDO) to MeSH clinical terminology via MONDO.
        Uses simplified CONTAINS for stability in three-way queries.
        Pre-filtering in NANDO before cross-database joins.
      databases_used:
        - mesh
        - mondo
        - nando
      complexity: advanced
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX nando: <http://nanbyodata.jp/ontology/NANDO_>
        
        SELECT DISTINCT ?nandoLabelJa ?mondoLabel ?meshLabel ?notifNum
        WHERE {
          GRAPH <http://nanbyodata.jp/ontology/nando> {
            ?nandoDisease a owl:Class ;
                          skos:closeMatch ?mondoDisease ;
                          rdfs:label ?nandoLabelJa ;
                          rdfs:label ?nandoLabelEn .
            OPTIONAL { ?nandoDisease nando:hasNotificationNumber ?notifNum }
            FILTER(STRSTARTS(STR(?mondoDisease), "http://purl.obolibrary.org/obo/MONDO_"))
            FILTER(LANG(?nandoLabelJa) = "ja")
            FILTER(LANG(?nandoLabelEn) = "en")
            # Pre-filter in NANDO (simplified CONTAINS for three-way stability)
            FILTER(CONTAINS(LCASE(?nandoLabelEn), "diabetes"))
          }
          
          GRAPH <http://rdfportal.org/ontology/mondo> {
            ?mondoDisease a owl:Class ;
                          rdfs:label ?mondoLabel ;
                          oboInOwl:hasDbXref ?meshXref .
            FILTER(STRSTARTS(?meshXref, "MESH:"))
          }
          
          BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDescriptor)
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshDescriptor rdfs:label ?meshLabel .
          }
        }
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 5 (URI conversion), 10 (LIMIT)
        - Strategy 1: Three explicit GRAPH clauses isolate each database
        - Strategy 2: Pre-filtering in NANDO before three-way join
        - Uses simplified CONTAINS instead of bif:contains (three-way query stability)
        - Performance: ~3-5s (Tier 2) for three-database integration
        - Use case: Japanese rare disease research, international terminology alignment
        - Coverage: ~84% of NANDO diseases map to MONDO, ~28% of those reach MeSH

cross_references:
  - pattern: meshv:thesaurusID
    description: |
      External database cross-references via thesaurusID property.
      Coverage: 916K total references across 869K entities (~35% of all entities).
      Primary use: linking MeSH concepts to external medical, chemical, and genomic databases.
    databases:
      pharmaceutical:
        - "FDA SRS: 22.6K substance registrations"
        - "FDA UNII: 22.6K unique ingredient identifiers"
        - "INN: 8.8K international nonproprietary names"
      genetic:
        - "OMIM: 12.5K Mendelian disorders"
        - "GHR: 3.8K genetics home reference"
      chemical:
        - "ChEBI: 2.5K chemical entities"
      clinical:
        - "SNOMED CT: 800+ clinical terminology"
        - "FMA: 1.1K foundational anatomy"
    sparql: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?entity ?label ?xref
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?entity meshv:thesaurusID ?xref ;
                rdfs:label ?label .
        # Filter by database prefix
        FILTER(CONTAINS(STR(?xref), "OMIM"))
      }
      LIMIT 50

architectural_notes:
  query_strategy:
    - "Exploratory: Use FILTER(CONTAINS()) to discover examples and extract specific IRIs/identifiers"
    - "Comprehensive: Use specific descriptor IRIs (e.g., mesh:D003920) in direct queries"
    - "Tree navigation: Use STRSTARTS() with tree number prefixes for category filtering"
    - "Hierarchy: Use meshv:broaderDescriptor+ for transitive parent relationships"
    - "Text search: bif:contains (Virtuoso) only when no IRIs available (e.g., chemical name exploration)"
    - "Cross-database: Pre-filter in source GRAPH, use specific IRIs in VALUES when possible"
    - "Priority: Specific IRIs > Tree numbers > Graph navigation > Text search"
  
  schema_design:
    - "Three-level structure: TopicalDescriptor → Concept → Term for synonym management"
    - "Tree numbers provide hierarchical classification (A-Z categories, alphanumeric subcategories)"
    - "CRITICAL: Use meshv:broaderDescriptor (NOT meshv:broader) for parent relationships"
    - "CRITICAL: Use meshv:annotation (NOT meshv:scopeNote) for scope notes"
    - "CRITICAL: Terms use meshv:prefLabel (NOT rdfs:label) for preferred labels"
    - "Allowable qualifiers define valid descriptor-qualifier combinations for indexing"
    - "Supplementary records (SCR) include chemicals, organisms, diseases, protocols"
  
  performance:
    - "Specific IRIs: Fastest approach for known descriptors (mesh:D003920)"
    - "VALUES with IRIs: Efficient batch queries for multiple known concepts"
    - "Tree number filtering: Fast with STRSTARTS() for category-based queries"
    - "bif:contains: Use sparingly, only for exploratory searches without known IRIs"
    - "Always include LIMIT for exploratory queries (2.5M+ total entities)"
    - "FROM clause required: FROM <http://id.nlm.nih.gov/mesh>"
    - "Transitive queries: Work well from specific starting points (mesh:D003920 meshv:broaderDescriptor+ ?parent)"
  
  data_integration:
    - "Pharmaceutical: FDA SRS/UNII for substance identification and regulation"
    - "Genetic: OMIM for Mendelian disorders, rare disease research"
    - "Chemical: ChEBI for small molecules, CAS registry numbers via meshv:registryNumber"
    - "Clinical: SNOMED CT for clinical terminology, ICD coding alignment"
    - "Cross-database: MONDO provides ~8,500 disease mappings via hasDbXref"
    - "Shares 'primary' endpoint with mondo, go, taxonomy, nando, bacdive, mediadive"
  
  data_quality:
    - "All topical descriptors have tree numbers (100% coverage)"
    - "Annotations available for ~31% of descriptors (use OPTIONAL)"
    - "99.6% of descriptors have broader relationships"
    - "Chemical records (SCR) lack hierarchical structure"
    - "MONDO cross-references can point to descriptors (D) or supplementary records (C)"

data_statistics:
  total_entities: 2456909
  verified_date: "2026-02-09"
  verification_query: |
    SELECT (COUNT(?entity) as ?count)
    FROM <http://id.nlm.nih.gov/mesh>
    WHERE { ?entity a ?type }
  
  entity_breakdown:
    topical_descriptors: 30248
    terms: 869536
    concepts: 466976
    scr_chemical: 250445
    scr_organism: 66571
    tree_numbers: 81732
    qualifiers: 84
    verification_date: "2026-02-09"
    verification_query: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      
      SELECT ?type (COUNT(?e) as ?count)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE { 
        ?e a ?type .
        FILTER(STRSTARTS(STR(?type), "http://id.nlm.nih.gov/mesh/vocab#"))
      }
      GROUP BY ?type
  
  tree_category_distribution:
    methodology: "Tree numbers categorized by first letter (A-Z)"
    major_categories:
      - "D (Chemicals and Drugs): 10,541 descriptors"
      - "C (Diseases): 5,032 descriptors"
      - "B (Organisms): 3,964 descriptors"
      - "E (Analytical/Diagnostic Techniques): 3,102 descriptors"
      - "G (Phenomena and Processes): 2,430 descriptors"
      - "N (Health Care): 2,002 descriptors"
      - "A (Anatomy): 1,904 descriptors"
    verification_query: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?category (COUNT(DISTINCT ?descriptor) as ?count)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
                    meshv:treeNumber ?tree .
        ?tree rdfs:label ?treeLabel .
        BIND(SUBSTR(?treeLabel, 1, 1) as ?category)
      }
      GROUP BY ?category
      ORDER BY DESC(?count)
  
  coverage:
    descriptors_with_labels: "100%"
    descriptors_with_tree_numbers: "100%"
    descriptors_with_annotations: "30.7%"
    descriptors_with_broader_relationships: "99.65%"
    entities_with_thesaurus_ids: "35.4%"
    note: "916K total cross-references across 869K entities"
    mondo_mesh_mappings: "~28% of MONDO diseases (~8,500 mappings)"
  
  cardinality:
    avg_tree_numbers_per_descriptor: 2.1
    avg_qualifiers_per_descriptor: 21.5
    avg_terms_per_concept: 1.86
  
  performance_characteristics:
    - "Specific IRI lookup: <100ms (e.g., mesh:D003920)"
    - "VALUES with 3-10 IRIs: <500ms"
    - "Tree category filtering: 1-2s (e.g., STRSTARTS 'C19')"
    - "Transitive hierarchy: 2-5s from specific starting point"
    - "bif:contains exploratory: 3-10s (use LIMIT)"
    - "Cross-database (two-way): 1-3s with pre-filtering (Tier 1)"
    - "Cross-database (three-way): 3-5s with simplified CONTAINS (Tier 2)"
  
  staleness_warning: "MeSH is updated annually. Statistics verified 2026-02-09 against 2024 release."

anti_patterns:
  - title: "Text Search When Specific IRI Known"
    problem: "Using bif:contains when descriptor IRI is already known wastes full-text index"
    wrong_sparql: |
      # Slow: Text search for known concept
      SELECT ?descriptor ?label
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
                    rdfs:label ?label .
        ?label bif:contains "'Diabetes Mellitus'"
      }
    correct_sparql: |
      # Fast: Direct IRI lookup
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?label ?annotation
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 rdfs:label ?label .
        OPTIONAL { mesh:D003920 meshv:annotation ?annotation }
      }
    explanation: |
      When you know the descriptor IRI (e.g., from exploration or documentation),
      use it directly instead of text search. Performance: 100ms vs 5s.
  
  - title: "Circular Reasoning with Search Results"
    problem: "Using search results in VALUES for comprehensive count queries"
    wrong_sparql: |
      # Step 1: Search finds 20 diabetes descriptors
      # Step 2: WRONG - Count only those 20
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      
      SELECT (COUNT(?descriptor) as ?count)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        VALUES ?descriptor { 
          mesh:D003920 mesh:D003922 ... mesh:D020790  # Only 20 from search
        }
        ?descriptor a meshv:TopicalDescriptor .
      }
      # Result: 20 (circular - only counted what we searched for!)
    correct_sparql: |
      # Correct: Use tree number pattern discovered from examples
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT (COUNT(DISTINCT ?descriptor) as ?count)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
                    meshv:treeNumber ?tree .
        ?tree rdfs:label ?treeNum .
        # Use pattern from exploration: diabetes under C18.452 or C19
        FILTER(STRSTARTS(?treeNum, "C18.452") || STRSTARTS(?treeNum, "C19"))
      }
    explanation: |
      Workflow: (1) Use search to find examples, (2) Inspect to discover tree patterns,
      (3) Use tree patterns to query ALL matching descriptors, not just search results.
  
  - title: "Cross-Database Query Without Pre-Filtering"
    problem: "Filtering after join causes timeout by processing millions of intermediate rows"
    wrong_sparql: |
      # BAD: Filter after cross-database join
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      WHERE {
        GRAPH <http://rdfportal.org/ontology/mondo> {
          ?disease a owl:Class ;
                   oboInOwl:hasDbXref ?meshXref .
          FILTER(STRSTARTS(?meshXref, "MESH:"))
        }
        BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDesc)
        GRAPH <http://id.nlm.nih.gov/mesh> {
          ?meshDesc rdfs:label ?meshLabel .
        }
        # TOO LATE! Already joined 30K MONDO × 8,500 mappings
        FILTER(CONTAINS(?meshLabel, "diabetes"))
      }
    correct_sparql: |
      # GOOD: Pre-filter using specific MONDO IRIs
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      
      WHERE {
        GRAPH <http://rdfportal.org/ontology/mondo> {
          # Strategy 2: Use specific IRIs after exploratory search
          VALUES ?disease {
            obo:MONDO_0005147  # Type 1 diabetes
            obo:MONDO_0005148  # Type 2 diabetes
          }
          ?disease a owl:Class ;
                   rdfs:label ?diseaseLabel ;
                   oboInOwl:hasDbXref ?meshXref .
          FILTER(STRSTARTS(?meshXref, "MESH:"))
        }
        BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDesc)
        GRAPH <http://id.nlm.nih.gov/mesh> {
          ?meshDesc rdfs:label ?meshLabel .
        }
      }
    explanation: |
      Strategy 2 (pre-filtering): Use specific IRIs from exploratory search.
      Reduces query from 30K diseases → 2 diseases before MeSH join.
      Performance: 20s timeout → 1s completion.

common_errors:
  - error: "Empty results when querying hierarchy"
    causes:
      - "Using wrong property meshv:broader instead of meshv:broaderDescriptor"
      - "Missing FROM <http://id.nlm.nih.gov/mesh> clause"
      - "Unbounded transitive query without specific starting point"
    solutions:
      - "CRITICAL: Use meshv:broaderDescriptor, not meshv:broader"
      - "Always include FROM clause in queries"
      - "Start transitive queries from specific IRI: mesh:D003920 meshv:broaderDescriptor+ ?parent"
    example_fix: |
      # Wrong - incorrect property and missing FROM
      SELECT ?parent WHERE {
        mesh:D003920 meshv:broader ?parent .
      }
      
      # Correct - proper property and FROM clause
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?parent ?parentLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 meshv:broaderDescriptor+ ?parent .
        ?parent rdfs:label ?parentLabel .
      }
  
  - error: "Empty results when querying annotations"
    causes:
      - "Using wrong property meshv:scopeNote instead of meshv:annotation"
      - "Not using OPTIONAL (only 31% have annotations)"
    solutions:
      - "CRITICAL: Use meshv:annotation, not meshv:scopeNote"
      - "Always use OPTIONAL for annotation property"
      - "Include FROM clause"
    example_fix: |
      # Wrong
      SELECT ?desc ?scopeNote WHERE {
        ?desc meshv:scopeNote ?scopeNote .
      }
      
      # Correct
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?desc ?label ?annotation
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?desc a meshv:TopicalDescriptor ;
              rdfs:label ?label .
        OPTIONAL { ?desc meshv:annotation ?annotation }
      }
      LIMIT 50
  
  - error: "Query timeout on exploratory searches"
    causes:
      - "Missing LIMIT clause on bif:contains queries"
      - "Searching 869K terms without type filter"
    solutions:
      - "Always add LIMIT 20-50 for exploratory bif:contains queries"
      - "Filter by entity type first (meshv:TopicalDescriptor, meshv:SCR_Chemical)"
      - "Consider using tree number filtering for category-based queries"
    example_fix: |
      # Add LIMIT and ORDER BY relevance
      SELECT ?label
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?desc a meshv:TopicalDescriptor ;
              rdfs:label ?label .
        ?label bif:contains "'diabetes'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - error: "Cross-database query timeout"
    causes:
      - "Missing pre-filtering in source GRAPH (Strategy 2)"
      - "Using bif:contains filter after join instead of before"
      - "Missing VALUES with specific IRIs"
    solutions:
      - "Use specific IRIs in VALUES after exploratory search"
      - "Pre-filter within source GRAPH before cross-database join"
      - "For three-way queries, use simplified CONTAINS"
      - "Add LIMIT to prevent runaway queries"
    example_fix: |
      # Instead of keyword filter after join:
      GRAPH <http://rdfportal.org/ontology/mondo> {
        ?disease oboInOwl:hasDbXref ?meshXref .
      }
      FILTER(CONTAINS(?diseaseLabel, "diabetes"))
      
      # Use specific IRIs from exploration:
      GRAPH <http://rdfportal.org/ontology/mondo> {
        VALUES ?disease {
          obo:MONDO_0005147
          obo:MONDO_0005148
        }
        ?disease oboInOwl:hasDbXref ?meshXref .
      }
