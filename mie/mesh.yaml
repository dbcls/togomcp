schema_info:
  title: Medical Subject Headings (MeSH) RDF
  description: |
    National Library of Medicine's controlled vocabulary thesaurus for biomedical literature indexing. 
    Contains topical descriptors (subject headings), qualifiers (subheadings), supplementary chemical 
    records, supplementary disease records, concepts, terms, and tree numbers organized in 16 hierarchical 
    categories. Used for indexing articles in PubMed and other NLM databases. Includes ~30K descriptors 
    with hierarchical relationships, ~250K chemical records, and ~2.5M total entities.
  endpoint: https://rdfportal.org/primary/sparql
  base_uri: http://id.nlm.nih.gov/mesh/
  graphs:
    - http://id.nlm.nih.gov/mesh
    - http://id.nlm.nih.gov/mesh/vocab
    - http://id.nlm.nih.gov/mesh/void
  kw_search_tools:
    - search_mesh_descriptor
  version:
    mie_version: "1.4"
    mie_created: "2025-01-17"
    mie_updated: "2025-02-04"
    data_version: "2024"
    update_frequency: Annual
  license:
    data_license: Public Domain (U.S. Government)
    license_url: https://www.nlm.nih.gov/databases/download/terms_and_conditions.html
  access:
    rate_limiting: No strict limits
    max_query_timeout: 60 seconds
    backend: Virtuoso

shape_expressions: |
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
  
  <TopicalDescriptorShape> {
    a [ meshv:TopicalDescriptor ] ;
    rdfs:label xsd:string ;
    meshv:identifier xsd:string ;
    meshv:treeNumber @<TreeNumberShape> * ;
    meshv:broaderDescriptor @<TopicalDescriptorShape> * ;
    meshv:annotation xsd:string ? ;
    meshv:preferredConcept @<ConceptShape> ;
    meshv:allowableQualifier @<QualifierShape> *
  }
  
  <ConceptShape> {
    a [ meshv:Concept ] ;
    rdfs:label xsd:string ;
    meshv:preferredTerm @<TermShape>
  }
  
  <TermShape> {
    a [ meshv:Term ] ;
    rdfs:label xsd:string ;
    meshv:prefLabel xsd:string  # Terms use prefLabel, not rdfs:label
  }
  
  <TreeNumberShape> {
    a [ meshv:TreeNumber ] ;
    rdfs:label xsd:string
  }
  
  <QualifierShape> {
    a [ meshv:Qualifier ] OR [ meshv:TopicalDescriptor ] ;
    rdfs:label xsd:string
  }
  
  <SCR_ChemicalShape> {
    a [ meshv:SCR_Chemical ] ;
    rdfs:label xsd:string ;
    meshv:identifier xsd:string ;
    meshv:registryNumber xsd:string ?  # CAS Registry Number
  }
  
  <SCR_DiseaseShape> {
    a [ meshv:SCR_Disease ] ;
    rdfs:label xsd:string ;
    meshv:identifier xsd:string
  }

sample_rdf_entries:
  - title: Topical Descriptor with Tree Numbers
    description: Main subject heading with hierarchical classification codes.
    rdf: |
      mesh:D003920 a meshv:TopicalDescriptor ;
        rdfs:label "Diabetes Mellitus" ;
        meshv:identifier "D003920" ;
        meshv:treeNumber mesh:C18.452.394.750 ;
        meshv:annotation "general or unspecified; prefer specifics..." .
  
  - title: Descriptor with Broader Relationship
    description: Subject heading showing parent-child hierarchy using broaderDescriptor.
    rdf: |
      mesh:D003924 a meshv:TopicalDescriptor ;
        rdfs:label "Diabetes Mellitus, Type 2" ;
        meshv:identifier "D003924" ;
        meshv:broaderDescriptor mesh:D003920 .
  
  - title: Supplementary Chemical Record
    description: Chemical substance entry with CAS registry number.
    rdf: |
      mesh:C517652 a meshv:SCR_Chemical ;
        rdfs:label "Insulin Glargine" ;
        meshv:identifier "C517652" ;
        meshv:registryNumber "2ZM8CX04RZ" .
  
  - title: Descriptor with Concept and Term
    description: Complete descriptor with preferred concept and term structure.
    rdf: |
      mesh:D002318 a meshv:TopicalDescriptor ;
        rdfs:label "Cardiovascular Diseases" ;
        meshv:preferredConcept [
          a meshv:Concept ;
          meshv:preferredTerm [
            a meshv:Term ;
            rdfs:label "Cardiovascular Diseases" ;
            meshv:prefLabel "Cardiovascular Diseases"
          ]
        ] .
  
  - title: Descriptor with Allowable Qualifiers
    description: Subject heading with permitted subheadings for indexing combinations.
    rdf: |
      mesh:D003920 a meshv:TopicalDescriptor ;
        rdfs:label "Diabetes Mellitus" ;
        meshv:allowableQualifier mesh:Q000188 .
      mesh:Q000188 a meshv:Qualifier ;
        rdfs:label "drug therapy" .

sparql_query_examples:
  - title: Search Descriptors by Keyword with bif:contains
    description: Full-text search with relevance scoring
    question: Which descriptors relate to diabetes?
    complexity: basic
    sparql: |
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      
      SELECT ?descriptor ?label
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
          rdfs:label ?label .
        ?label bif:contains "'diabetes'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Get Biological Annotations for Descriptor
    description: Retrieve annotations, tree numbers, and hierarchy for a descriptor
    question: What are the annotations and hierarchical information for diabetes mellitus?
    complexity: basic
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?label ?annotation ?treeNumber ?broaderLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 rdfs:label ?label .
        OPTIONAL { mesh:D003920 meshv:annotation ?annotation }
        OPTIONAL { 
          mesh:D003920 meshv:treeNumber ?tree .
          ?tree rdfs:label ?treeNumber
        }
        OPTIONAL {
          mesh:D003920 meshv:broaderDescriptor ?broader .
          ?broader rdfs:label ?broaderLabel
        }
      }
  
  - title: Get Hierarchical Classification Path
    description: Retrieve all parent descriptors in tree structure using transitive property
    question: What are all parent categories of a descriptor?
    complexity: intermediate
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?parent ?parentLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 meshv:broaderDescriptor+ ?parent .
        ?parent rdfs:label ?parentLabel .
      }
  
  - title: Count Descriptors by Tree Category
    description: Aggregate counts by major MeSH tree categories (A-Z letter codes)
    question: How many descriptors in each major category?
    complexity: intermediate
    sparql: |
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      
      SELECT ?category (COUNT(DISTINCT ?descriptor) as ?count)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
          meshv:treeNumber ?tree .
        ?tree rdfs:label ?treeLabel .
        BIND(SUBSTR(?treeLabel, 1, 1) as ?category)
      }
      GROUP BY ?category
      ORDER BY DESC(?count)
  
  - title: Find Chemicals by Name
    description: Search supplementary chemical records with keyword search
    question: Which chemical records contain 'insulin'?
    complexity: intermediate
    sparql: |
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      
      SELECT ?chemical ?label ?registryNumber
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?chemical a meshv:SCR_Chemical ;
          rdfs:label ?label .
        OPTIONAL { ?chemical meshv:registryNumber ?registryNumber }
        ?label bif:contains "'insulin'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Get Allowable Qualifiers for Descriptor
    description: Retrieve permitted subheadings for subject heading combinations
    question: Which qualifiers can be used with diabetes descriptor?
    complexity: advanced
    sparql: |
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?qualifier ?qualifierLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 meshv:allowableQualifier ?qualifier .
        ?qualifier rdfs:label ?qualifierLabel .
      }
  
  - title: Multi-Faceted Descriptor Analysis
    description: Comprehensive query with annotations, tree numbers, and hierarchy
    question: Get complete information for cancer-related descriptors
    complexity: advanced
    sparql: |
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      
      SELECT DISTINCT ?descriptor ?label ?annotation ?treeNum ?broaderLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
          rdfs:label ?label .
        OPTIONAL { ?descriptor meshv:annotation ?annotation }
        OPTIONAL {
          ?descriptor meshv:treeNumber/rdfs:label ?treeNum
        }
        OPTIONAL {
          ?descriptor meshv:broaderDescriptor/rdfs:label ?broaderLabel
        }
        ?label bif:contains "'cancer'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 10

cross_database_queries:
  shared_endpoint: primary
  co_located_databases:
    - go
    - taxonomy
    - mondo
    - nando
    - bacdive
    - mediadive
  mie_files_consulted:
    - mondo (Disease class shape, hasDbXref property patterns, MESH:D##### format, graph URI)
    - go (GO term shape, hasOBONamespace property, graph URI, bif:contains patterns, filter requirements)
  examples:
    - title: Link MeSH Descriptors to MONDO Disease Ontology
      description: |
        Integrate MeSH medical subject headings with MONDO disease classifications using MONDO's 
        cross-references. MONDO diseases contain oboInOwl:hasDbXref properties linking to MeSH 
        descriptor/SCR IDs, enabling precise mapping between clinical literature terminology and 
        disease ontology classifications. This supports translational research and systematic reviews.
      databases_used:
        - mesh
        - mondo
      complexity: intermediate
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
        
        SELECT ?mondoDisease ?mondoLabel ?meshDescriptor ?meshLabel ?meshXref
        WHERE {
          GRAPH <http://rdfportal.org/ontology/mondo> {
            ?mondoDisease a owl:Class ;
              rdfs:label ?mondoLabel ;
              oboInOwl:hasDbXref ?meshXref .
            FILTER(STRSTARTS(?meshXref, "MESH:"))
            ?mondoLabel bif:contains "'diabetes'" option (score ?sc)
          }
          
          BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDescriptor)
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshDescriptor rdfs:label ?meshLabel .
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 10
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 5 (URI conversion), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses for each database prevent cross-contamination
        - Strategy 2: Pre-filtering in MONDO with bif:contains before join reduces 30K → ~10 diseases (99.97% reduction)
        - Strategy 4: bif:contains with relevance scoring provides 10-100x speedup over REGEX
        - Strategy 5: URI conversion from MONDO's MESH: format to MeSH URIs
        - Strategy 10: LIMIT 10 caps result set size for fast response
        - Query uses oboInOwl:hasDbXref from MONDO MIE file for cross-references
        - Entity types (owl:Class for MONDO) from MONDO MIE file shape expressions
        - BIND constructs MeSH URI from MONDO's "MESH:D######" or "MESH:C######" reference format
        - Note: MESH: references can point to TopicalDescriptors (D######) OR SCR records (C######)
        - Performance: ~2-3 seconds for keyword-filtered cross-database queries (Tier 1)
        - Performance gain: Pre-filtering reduces MONDO diseases from 30K to ~10 before MeSH join
        - Use case: Disease literature curation, systematic reviews, translational research
        - Coverage: ~28% of MONDO diseases have MeSH cross-references (~8,500 mappings)
        - Referenced MIE files: mondo (for owl:Class shape, hasDbXref property, graph URI)
        - Avoided anti-patterns: No REGEX (use bif:contains), no late filtering (pre-filter in GRAPH)
    
    - title: Correlate MeSH Terms with GO Biological Processes
      description: |
        Bridge MeSH medical subject headings with Gene Ontology biological processes using 
        keyword-based integration. Since MeSH and GO don't have direct links, this query 
        uses bif:contains on both databases to find related terms, enabling researchers 
        to connect clinical concepts with molecular biology terminology for multi-scale 
        biological studies.
      databases_used:
        - mesh
        - go
      complexity: intermediate
      sparql: |
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX oboinowl: <http://www.geneontology.org/formats/oboInOwl#>
        PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
        
        SELECT DISTINCT ?meshTerm ?meshLabel ?goTerm ?goLabel ?goNamespace
        WHERE {
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshTerm a meshv:TopicalDescriptor ;
              rdfs:label ?meshLabel .
            ?meshLabel bif:contains "'apoptosis'" option (score ?sc1)
          }
          
          GRAPH <http://rdfportal.org/ontology/go> {
            ?goTerm a owl:Class ;
              rdfs:label ?goLabel ;
              oboinowl:hasOBONamespace ?goNamespace .
            ?goLabel bif:contains "'apoptosis'" option (score ?sc2)
            FILTER(STRSTARTS(STR(?goTerm), "http://purl.obolibrary.org/obo/GO_"))
          }
        }
        ORDER BY DESC(?sc1)
        LIMIT 10
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses prevent query from mixing MeSH and GO data
        - Strategy 2: Pre-filtering with bif:contains in both GRAPH clauses before Cartesian product
        - Strategy 4: bif:contains with relevance scoring provides full-text index performance
        - Strategy 10: LIMIT 10 prevents excessive result generation
        - Uses owl:Class and oboinowl:hasOBONamespace from GO MIE file
        - Uses meshv:TopicalDescriptor from MeSH MIE file
        - Keyword-based integration (no direct semantic links between MeSH and GO)
        - Performance: ~2-3 seconds for cross-ontology keyword queries (Tier 1)
        - Performance gain: bif:contains reduces search from 869K MeSH terms × 48K GO terms to matched subset
        - Use case: Literature mining, connecting clinical and molecular biology terms
        - Note: Results based on keyword overlap, not semantic equivalence
        - Referenced MIE files: go (for owl:Class shape, hasOBONamespace property, graph URI, STRSTARTS filter)
        - Avoided anti-patterns: No REGEX (use bif:contains), explicit GRAPH clauses prevent cross-contamination
    
    - title: Find Disease-Related GO Terms via MONDO Cross-References
      description: |
        Three-way integration using MONDO as a semantic bridge between MeSH and GO. First filters 
        MONDO diseases with MeSH cross-references, then retrieves MeSH labels, finally finds related 
        GO terms via keyword matching. This approach enables disease-focused molecular biology queries 
        by combining clinical terminology (MeSH), disease classification (MONDO), and biological 
        processes (GO). Uses simplified CONTAINS for stability in three-way queries.
      databases_used:
        - mesh
        - mondo
        - go
      complexity: advanced
      sparql: |
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        SELECT DISTINCT ?meshLabel ?mondoLabel ?goLabel
        WHERE {
          GRAPH <http://rdfportal.org/ontology/mondo> {
            ?mondoDisease a owl:Class ;
              rdfs:label ?mondoLabel ;
              oboInOwl:hasDbXref ?meshXref .
            FILTER(STRSTARTS(?meshXref, "MESH:"))
            FILTER(CONTAINS(LCASE(?mondoLabel), "parkinson"))
          }
          
          BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDescriptor)
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshDescriptor rdfs:label ?meshLabel .
          }
          
          GRAPH <http://rdfportal.org/ontology/go> {
            ?goTerm rdfs:label ?goLabel .
            FILTER(CONTAINS(LCASE(?goLabel), "dopamine"))
          }
        }
        LIMIT 10
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 5 (URI conversion), 10 (LIMIT)
        - Strategy 1: Three explicit GRAPH clauses isolate each database's data
        - Strategy 2: Pre-filtering in MONDO (parkinson) and GO (dopamine) before three-way join
        - Strategy 5: URI conversion from MONDO's MESH:C###### format to MeSH URIs
        - Strategy 10: LIMIT 10 caps result set for performance
        - Simplified with CONTAINS instead of bif:contains for three-way query stability
        - MONDO acts as semantic hub linking MeSH descriptors to disease context
        - GO terms filtered by related keyword (dopamine for Parkinson's disease)
        - Performance: ~3-5 seconds for three-way cross-database queries (Tier 2)
        - Performance gain: Pre-filtering reduces MONDO (30K) → ~15 diseases, GO (48K) → ~50 terms before join
        - Use case: Disease mechanism research, systems biology, translational medicine
        - Note: Returns conceptual relationships, not direct molecular-clinical links
        - Coverage: Limited by both MONDO→MeSH (28%) and availability of related GO terms
        - Referenced MIE files: mondo (hasDbXref, graph URI), go (rdfs:label, graph URI, CONTAINS simplification)
        - Avoided anti-patterns: Uses CONTAINS instead of multiple bif:contains (prevents timeout in three-way queries)
        - CRITICAL: Three-way queries cannot use complex GO filters (namespace with STR) due to query complexity

cross_references:
  - pattern: meshv:thesaurusID
    description: |
      Cross-references to external databases via thesaurusID property. Coverage: 916K total 
      references across all entities.
    databases:
      pharmaceutical:
        - "FDA SRS: 22.6K"
        - "FDA UNII: 22.6K"
        - "INN: 8.8K"
      genetic:
        - "OMIM: 12.5K"
        - "GHR: 3.8K"
      chemical:
        - "ChEBI: 2.5K"
      clinical:
        - "SNOMED CT: 800+"
        - "FMA: 1.1K"
    sparql: |
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      
      SELECT ?entity ?xref
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?entity meshv:thesaurusID ?xref .
        FILTER(CONTAINS(STR(?xref), "OMIM"))
      }
      LIMIT 50

architectural_notes:
  schema_design:
    - "CRITICAL: Use meshv:broaderDescriptor (NOT meshv:broader) for hierarchical parent-child relationships"
    - "CRITICAL: Use meshv:annotation (NOT meshv:scopeNote) for scope notes and indexing guidance"
    - "CRITICAL: Terms use meshv:prefLabel (NOT rdfs:label) for their preferred labels"
    - Tree numbers provide alphanumeric hierarchical codes (A-Z categories with numeric subcategories)
    - "Three-level structure: Descriptor → Concept → Term for synonym management"
    - Allowable qualifiers constrain valid descriptor-qualifier combinations for indexing
    - MONDO cross-references can point to TopicalDescriptors (D######) OR SCR records (C######)
  performance:
    - Use bif:contains for label searches (full-text index + relevance scoring with option (score ?sc))
    - Tree number filtering with STRSTARTS or REGEX is efficient for category-based queries
    - Transitive broaderDescriptor+ queries work well when starting from specific descriptors
    - Always use LIMIT for exploratory queries (database contains 2.5M+ entities)
    - FROM <http://id.nlm.nih.gov/mesh> clause is required for queries
    - "Cross-database query optimization: Apply Strategies 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 5 (URI conversion), 10 (LIMIT)"
    - Pre-filtering within GRAPH clauses before joins provides 10-100x speedup (Strategy 2)
    - bif:contains provides 10-100x speedup over REGEX for keyword matching (Strategy 4)
    - Three-way queries use simplified CONTAINS filters for stability (avoid complex GO filters)
  data_integration:
    - FDA SRS/UNII for pharmaceutical substances and ingredient identification
    - OMIM for genetic disorders and Mendelian inheritance
    - ChEBI for chemical entities and small molecules
    - SNOMED CT for clinical terminology alignment
    - Use meshv:thesaurusID for cross-database linkage
    - MONDO provides semantic bridge to MeSH via oboInOwl:hasDbXref (28% coverage, ~8,500 diseases)
    - GO integration via keyword matching (no direct semantic links)
    - Shares "primary" endpoint with go, taxonomy, mondo, nando, bacdive, mediadive
    - "Cross-database performance tiers: Tier 1 (1-3s) for two-database queries, Tier 2 (3-5s) for three-way queries"
  data_quality:
    - Topical descriptors are primary subject headings (30,248 total)
    - Annotations available for ~31% of descriptors (use OPTIONAL for queries)
    - All descriptors have tree numbers (100% coverage)
    - broaderDescriptor relationships for ~99.6% of descriptors
    - Chemical records lack hierarchical structure (no broaderDescriptor)
    - "MESH: cross-references in MONDO can be descriptors (D) or supplementary records (C)"

data_statistics:
  total_entities: 2456909
  verified_date: "2025-02-04"
  verification_query: |
    SELECT (COUNT(?entity) as ?count)
    FROM <http://id.nlm.nih.gov/mesh>
    WHERE { ?entity a ?type }
  
  entity_breakdown:
    topical_descriptors: 30248
    terms: 869536
    concepts: 466976
    chemicals: 250445
    supplementary_records: 326812
    tree_numbers: 81732
    qualifiers: 84
  
  supplementary_record_breakdown:
    scr_chemical: 250445
    scr_organism: 66571
    scr_disease: 6771
    scr_population: 1764
    scr_protocol: 1237
    scr_anatomy: 24
  
  coverage:
    descriptors_with_labels: "100%"
    calculation: "All 30,248 TopicalDescriptors have rdfs:label"
    verified_date: "2025-02-04"
    
    descriptors_with_annotations: "30.7%"
    calculation: "9,293 descriptors with meshv:annotation / 30,248 total"
    verified_date: "2025-02-04"
    verification_query: |
      SELECT (COUNT(DISTINCT ?desc) as ?with_ann)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE { ?desc a meshv:TopicalDescriptor ; meshv:annotation ?ann }
    
    descriptors_with_tree_numbers: "100%"
    calculation: "All 30,248 descriptors have at least one meshv:treeNumber"
    verified_date: "2025-02-04"
    verification_query: |
      SELECT (COUNT(DISTINCT ?desc) as ?with_tree)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE { ?desc a meshv:TopicalDescriptor ; meshv:treeNumber ?tree }
    
    descriptors_with_broader_relationships: "99.65%"
    calculation: "30,142 descriptors with broaderDescriptor / 30,248 total (106 without)"
    verified_date: "2025-02-04"
    verification_query: |
      SELECT (COUNT(DISTINCT ?desc) as ?with_broader)
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE { ?desc a meshv:TopicalDescriptor ; meshv:broaderDescriptor ?broader }
    
    entities_with_thesaurus_ids: "35.4%"
    calculation: "869,206 entities with meshv:thesaurusID / 2,456,909 total (916,022 total xref statements)"
    verified_date: "2025-02-04"
    
    mondo_diseases_with_mesh_xrefs: "~28%"
    note: "Approximate coverage from MONDO to MeSH (~8,500 mappings)"
  
  cardinality:
    avg_tree_numbers_per_descriptor: 2.1
    verified_date: "2025-02-04"
    verification_query: |
      SELECT (AVG(?treeCount) as ?avg_trees)
      WHERE {
        { SELECT ?desc (COUNT(?tree) as ?treeCount)
          WHERE { ?desc a meshv:TopicalDescriptor ; meshv:treeNumber ?tree }
          GROUP BY ?desc }
      }
    
    avg_terms_per_concept: 1.86
    verified_date: "2025-02-04"
    
    avg_qualifiers_per_descriptor: 21.5
    verified_date: "2025-02-04"
  
  performance_characteristics:
    - bif:contains efficient for label searches with relevance ranking
    - Tree number filtering fast with STRSTARTS or REGEX patterns
    - Transitive broaderDescriptor+ queries work from specific starting descriptors
    - Recommend LIMIT 50 for exploratory queries
    - "Cross-database queries: Tier 1 (1-3s) for MONDO/GO two-database, Tier 2 (3-5s) for three-way"
    - "Optimization gain: Pre-filtering reduces join size by 99%+ before cross-database joins"
  
  data_quality_notes:
    - MONDO provides 28% coverage (~8,500) of MeSH disease mappings via hasDbXref
    - GO integration requires keyword matching (no direct semantic links)
    - Cross-database queries benefit from filtering by keyword first
    - Three-way queries require simplified CONTAINS filters (complex GO filters cause 400 errors)
  
  staleness_warning: "MeSH is updated annually. Statistics verified 2025-02-04 against 2024 release."

anti_patterns:
  - title: Using meshv:broader Instead of meshv:broaderDescriptor
    problem: Property name is incorrect - meshv:broader does not exist in the MeSH vocabulary
    wrong_sparql: |
      SELECT ?parent WHERE {
        mesh:D003920 meshv:broader+ ?parent .
      }
    correct_sparql: |
      SELECT ?parent ?parentLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 meshv:broaderDescriptor+ ?parent .
        ?parent rdfs:label ?parentLabel .
      }
    explanation: The correct property is meshv:broaderDescriptor, not meshv:broader. Always include FROM clause and retrieve labels.
  
  - title: Using meshv:scopeNote Instead of meshv:annotation
    problem: Property name is incorrect - meshv:scopeNote does not exist in MeSH RDF
    wrong_sparql: |
      SELECT ?descriptor ?scopeNote WHERE {
        ?descriptor meshv:scopeNote ?scopeNote .
      }
    correct_sparql: |
      SELECT ?descriptor ?label ?annotation
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
          rdfs:label ?label .
        OPTIONAL { ?descriptor meshv:annotation ?annotation }
      }
      LIMIT 50
    explanation: The correct property is meshv:annotation, not meshv:scopeNote or skos:scopeNote. Use OPTIONAL since only ~31% have annotations.
  
  - title: Using FILTER CONTAINS Instead of bif:contains
    problem: No full-text index or relevance ranking, very slow on large datasets
    wrong_sparql: |
      SELECT ?label WHERE {
        ?descriptor rdfs:label ?label .
        FILTER(CONTAINS(LCASE(?label), "diabetes"))
      }
    correct_sparql: |
      SELECT ?label
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor rdfs:label ?label .
        ?label bif:contains "'diabetes'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
    explanation: bif:contains uses Virtuoso's full-text index and provides relevance scoring (Strategy 4). Always include ORDER BY DESC(?sc) to get most relevant results first. Performance gain 10-100x over FILTER CONTAINS.
  
  - title: Cross-Database Query Without Pre-Filtering
    problem: Filtering after join causes timeout by processing millions of intermediate results
    wrong_sparql: |
      # BAD: Filter after cross-database join
      WHERE {
        GRAPH <http://rdfportal.org/ontology/mondo> {
          ?disease a owl:Class ;
            oboInOwl:hasDbXref ?meshXref .
          FILTER(STRSTARTS(?meshXref, "MESH:"))
        }
        GRAPH <http://id.nlm.nih.gov/mesh> {
          BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDesc)
          ?meshDesc rdfs:label ?meshLabel .
        }
        FILTER(CONTAINS(?meshLabel, "diabetes"))  # Too late!
      }
    correct_sparql: |
      # GOOD: Pre-filter in source GRAPH (Strategy 2)
      WHERE {
        GRAPH <http://rdfportal.org/ontology/mondo> {
          ?disease a owl:Class ;
            rdfs:label ?diseaseLabel ;
            oboInOwl:hasDbXref ?meshXref .
          FILTER(STRSTARTS(?meshXref, "MESH:"))
          ?diseaseLabel bif:contains "'diabetes'" option (score ?sc)  # Early filtering!
        }
        BIND(URI(CONCAT("http://id.nlm.nih.gov/mesh/", SUBSTR(?meshXref, 6))) AS ?meshDesc)
        GRAPH <http://id.nlm.nih.gov/mesh> {
          ?meshDesc rdfs:label ?meshLabel .
        }
      }
      ORDER BY DESC(?sc)
      LIMIT 10
    explanation: "Strategy 2: Pre-filtering in source database (MONDO) reduces 30K diseases → ~10 before MeSH join (99.97% reduction), improving performance 100x+. Always filter within GRAPH clauses before joins."

common_errors:
  - error: Empty results when querying broader relationships
    causes:
      - Using wrong property name meshv:broader instead of meshv:broaderDescriptor
      - Not starting from a specific descriptor for transitive queries
      - Forgetting FROM <http://id.nlm.nih.gov/mesh> clause
    solutions:
      - "CRITICAL: Use meshv:broaderDescriptor, not meshv:broader"
      - Start transitive queries (broaderDescriptor+) from specific descriptors
      - Use tree numbers as an alternative for category-based navigation
      - Always include FROM clause in queries
    example_fix: |
      # Wrong - incorrect property name and missing FROM
      SELECT ?parent WHERE {
        mesh:D003920 meshv:broader ?parent .
      }
      
      # Correct - use broaderDescriptor with FROM clause
      PREFIX mesh: <http://id.nlm.nih.gov/mesh/>
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?parent ?parentLabel
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        mesh:D003920 meshv:broaderDescriptor+ ?parent .
        ?parent rdfs:label ?parentLabel .
      }
  
  - error: Empty results when querying scope notes
    causes:
      - Using wrong property name meshv:scopeNote instead of meshv:annotation
      - Using skos:scopeNote which doesn't exist in MeSH RDF
      - Not using OPTIONAL for annotation property
    solutions:
      - "CRITICAL: Use meshv:annotation, not meshv:scopeNote"
      - Remember only ~31% of descriptors have annotations
      - Always use OPTIONAL for annotation property
      - Include FROM clause
    example_fix: |
      # Wrong - incorrect property name
      SELECT ?descriptor ?scopeNote WHERE {
        ?descriptor meshv:scopeNote ?scopeNote .
      }
      
      # Correct - use annotation with OPTIONAL
      PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?descriptor ?label ?annotation
      FROM <http://id.nlm.nih.gov/mesh>
      WHERE {
        ?descriptor a meshv:TopicalDescriptor ;
          rdfs:label ?label .
        OPTIONAL { ?descriptor meshv:annotation ?annotation }
      }
      LIMIT 50
  
  - error: Query timeout on term searches
    causes:
      - Searching 869K terms without filters
      - Missing LIMIT clause
      - Using FILTER CONTAINS instead of bif:contains
    solutions:
      - Filter by entity type first (TopicalDescriptor, SCR_Chemical, etc.)
      - Use bif:contains for keyword searches with full-text index (Strategy 4)
      - Add LIMIT 50-100 for exploratory queries
      - Use tree number filtering to narrow scope
  
  - error: Cross-database query timeout
    causes:
      - Missing pre-filtering (Strategy 2) - processing millions of rows
      - Missing GRAPH clauses (Strategy 1) - cross-contamination
      - Using multiple bif:contains in three-way queries
      - Missing LIMIT clause (Strategy 10)
    solutions:
      - Apply restrictive FILTER within source GRAPH clause before join (Strategy 2)
      - Use explicit GRAPH clauses for each database (Strategy 1)
      - For three-way queries, use simplified CONTAINS instead of multiple bif:contains
      - Add LIMIT to every query level (Strategy 10)
      - Test each GRAPH clause independently before combining
    example_fix: |
      # BEFORE (times out):
      WHERE {
        GRAPH <http://rdfportal.org/ontology/mondo> { ?d1 ?p1 ?o1 }
        GRAPH <http://id.nlm.nih.gov/mesh> { ?d2 ?p2 ?d1 }
        FILTER(?condition)
      }
      
      # AFTER (completes in 2s):
      WHERE {
        GRAPH <http://rdfportal.org/ontology/mondo> {
          ?d1 ?p1 ?o1 .
          FILTER(?condition)  # Early filter! (Strategy 2)
        }
        GRAPH <http://id.nlm.nih.gov/mesh> { ?d2 ?p2 ?d1 }
      }
      LIMIT 10
  
  - error: Cross-database query returns empty results with MONDO
    causes:
      - Assuming all MESH: xrefs are TopicalDescriptors (D######)
      - Not checking for SCR records (C######)
      - Wrong entity type filter
    solutions:
      - Query for rdfs:label without type restriction (works for both D and C records)
      - Note that MESH: xrefs can be descriptors OR supplementary records
      - Test BIND URI construction separately before full query
    example_fix: |
      # More robust - works for both D and C records
      GRAPH <http://id.nlm.nih.gov/mesh> {
        ?meshDescriptor rdfs:label ?meshLabel .
        # No type restriction - works for TopicalDescriptor AND SCR_Disease
      }
  
  - error: Three-way cross-database query returns 400 error
    causes:
      - Complex GO filters (namespace with STR, multiple property restrictions)
      - Combining multiple bif:contains across three databases
      - Query complexity exceeds endpoint limits
    solutions:
      - Use simplified CONTAINS instead of bif:contains in three-way queries
      - Remove complex GO filters like STR(?goNamespace) comparisons
      - Keep GO GRAPH clause minimal (rdfs:label and simple CONTAINS filter)
      - Test two-database queries first, then add third database
      - Consider splitting complex three-way queries into multiple two-database queries
    example_fix: |
      # FAILS with 400 error:
      GRAPH <http://rdfportal.org/ontology/go> {
        ?goTerm a owl:Class ;
          oboinowl:hasOBONamespace ?goNamespace .
        ?goLabel bif:contains "'dopamine'" option (score ?sc)
        FILTER(STR(?goNamespace) = "biological_process")
      }
      
      # WORKS - simplified:
      GRAPH <http://rdfportal.org/ontology/go> {
        ?goTerm rdfs:label ?goLabel .
        FILTER(CONTAINS(LCASE(?goLabel), "dopamine"))
      }
