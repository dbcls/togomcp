schema_info:
  title: ChEBI (Chemical Entities of Biological Interest)
  description: |
    ChEBI is a comprehensive ontology database containing 223,000+ chemical entities including small molecules, atoms, ions, radicals, and functional groups. Provides hierarchical classification via rdfs:subClassOf, molecular properties (formula, mass, InChI, SMILES), biological roles via RO_0000087, chemical relationships (conjugate acids/bases, tautomers, enantiomers), and cross-references to 50+ databases including KEGG, DrugBank, PubChem, and HMDB.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://purl.obolibrary.org/obo/CHEBI_
  graphs:
    - http://rdf.ebi.ac.uk/dataset/chebi
  kw_search_tools:
    - OLS4:searchClasses
  version:
    mie_version: "2.0"
    mie_created: "2025-02-09"
    data_version: "Release 2025"
    update_frequency: "Monthly"
  license:
    data_license: "Creative Commons Attribution 4.0"
    license_url: "https://creativecommons.org/licenses/by/4.0/"
  access:
    rate_limiting: "100 queries/min"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX chebi_data: <http://purl.obolibrary.org/obo/chebi/>
  PREFIX chebi_rel: <http://purl.obolibrary.org/obo/chebi#>
  PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
  PREFIX obo: <http://purl.obolibrary.org/obo/>
  
  <ChemicalEntityShape> {
    a [ owl:Class ] ;
    rdfs:label xsd:string ;
    rdfs:subClassOf IRI * ;
    obo:IAO_0000115 xsd:string ? ;
    oboInOwl:id xsd:string ;
    oboInOwl:hasOBONamespace xsd:string ;
    oboInOwl:hasDbXref xsd:string * ;
    oboInOwl:hasRelatedSynonym xsd:string * ;
    oboInOwl:hasExactSynonym xsd:string * ;
    chebi_data:formula xsd:string ? ;
    chebi_data:mass xsd:string ? ;
    chebi_data:charge xsd:string ? ;
    chebi_data:smiles xsd:string ? ;
    chebi_data:inchi xsd:string ? ;
    chebi_data:inchikey xsd:string ? ;
    owl:deprecated xsd:boolean ?
  }
  
  <ChemicalRelationshipShape> {
    rdfs:subClassOf [ a owl:Restriction ] ;
    owl:onProperty [ 
      chebi_rel:has_role |
      chebi_rel:is_conjugate_acid_of |
      chebi_rel:is_conjugate_base_of |
      chebi_rel:is_tautomer_of |
      chebi_rel:is_enantiomer_of |
      <http://purl.obolibrary.org/obo/RO_0000087>
    ]
  }

sample_rdf_entries:
  - title: "Simple Molecule - Glucose"
    description: "Basic carbohydrate with molecular properties and cross-references"
    rdf: |
      @prefix obo: <http://purl.obolibrary.org/obo/> .
      @prefix chebi: <http://purl.obolibrary.org/obo/chebi/> .
      @prefix oboInOwl: <http://www.geneontology.org/formats/oboInOwl#> .
      
      obo:CHEBI_17234 a owl:Class ;
        rdfs:label "glucose" ;
        rdfs:subClassOf obo:CHEBI_17992 ;
        obo:IAO_0000115 "An aldohexose used as a source of energy" ;
        oboInOwl:id "CHEBI:17234" ;
        oboInOwl:hasDbXref "KEGG:C00031", "HMDB:HMDB0000122" ;
        chebi:formula "C6H12O6" ;
        chebi:mass "180.15588" ;
        chebi:inchikey "WQZGKKKJIJFFOK-GASJEMHNSA-N" .
  
  - title: "Amino Acid - L-tyrosine"
    description: "Proteinogenic amino acid with aromatic side chain"
    rdf: |
      obo:CHEBI_17895 a owl:Class ;
        rdfs:label "L-tyrosine" ;
        rdfs:subClassOf obo:CHEBI_33709, obo:CHEBI_33704 ;
        chebi:formula "C9H11NO3" ;
        chebi:mass "181.18850" ;
        chebi:smiles "C1=CC(=CC=C1C[C@@H](C(=O)O)N)O" ;
        oboInOwl:hasDbXref "DrugBank:DB00135", "PubChem:6057" .
  
  - title: "Drug with Biological Role"
    description: "Penicillin with antimicrobial agent role via RO_0000087"
    rdf: |
      obo:CHEBI_17334 a owl:Class ;
        rdfs:label "penicillin" ;
        rdfs:subClassOf [
          a owl:Restriction ;
          owl:onProperty <http://purl.obolibrary.org/obo/RO_0000087> ;
          owl:someValuesFrom obo:CHEBI_33281
        ] ;
        chebi:formula "C16H18N2O4S" ;
        chebi:mass "334.39000" .
  
  - title: "Conjugate Acid-Base Pair"
    description: "Acetic acid with conjugate base relationship"
    rdf: |
      obo:CHEBI_15366 a owl:Class ;
        rdfs:label "acetic acid" ;
        rdfs:subClassOf [
          a owl:Restriction ;
          owl:onProperty chebi:is_conjugate_acid_of ;
          owl:someValuesFrom obo:CHEBI_30089
        ] ;
        chebi:formula "C2H4O2" ;
        chebi:mass "60.05200" ;
        chebi:smiles "CC(O)=O" .
  
  - title: "Element - Carbon Atom"
    description: "Atomic entity with minimal properties"
    rdf: |
      obo:CHEBI_27594 a owl:Class ;
        rdfs:label "carbon atom" ;
        rdfs:subClassOf obo:CHEBI_33318, obo:CHEBI_33582 ;
        chebi:formula "C" ;
        chebi:mass "12.01070" ;
        chebi:smiles "[C]" ;
        oboInOwl:hasDbXref "CAS:7440-44-0" .

sparql_query_examples:
  - title: "Retrieve Chemical Entity by Specific IRI"
    description: "Direct lookup using known CHEBI IRI for glucose"
    question: "What are the molecular properties of glucose (CHEBI:17234)?"
    complexity: basic
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      # Use specific IRI for fast, unambiguous lookup
      SELECT ?label ?formula ?mass ?smiles ?inchikey
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        obo:CHEBI_17234 a owl:Class ;
                        rdfs:label ?label .
        OPTIONAL { obo:CHEBI_17234 chebi:formula ?formula }
        OPTIONAL { obo:CHEBI_17234 chebi:mass ?mass }
        OPTIONAL { obo:CHEBI_17234 chebi:smiles ?smiles }
        OPTIONAL { obo:CHEBI_17234 chebi:inchikey ?inchikey }
      }
  
  - title: "Find Multiple Entities by Specific IRIs"
    description: "Retrieve properties for multiple known metabolites using VALUES with specific IRIs"
    question: "Get molecular data for glucose, fructose, and galactose"
    complexity: basic
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      # Use VALUES with specific IRIs for batch lookup
      SELECT ?entity ?label ?formula ?mass
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        VALUES ?entity {
          obo:CHEBI_17234  # glucose
          obo:CHEBI_28757  # fructose
          obo:CHEBI_28061  # galactose
        }
        ?entity a owl:Class ;
                rdfs:label ?label .
        OPTIONAL { ?entity chebi:formula ?formula }
        OPTIONAL { ?entity chebi:mass ?mass }
      }
  
  - title: "Navigate Hierarchy - Find Amino Acid Subclasses"
    description: "Use graph navigation with specific parent IRI to find all amino acids"
    question: "How many amino acid subclasses are in ChEBI?"
    complexity: intermediate
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      # Use specific IRI for amino acid class and navigate hierarchy
      SELECT (COUNT(DISTINCT ?entity) as ?count)
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        ?entity a owl:Class ;
                rdfs:subClassOf+ obo:CHEBI_33709 .
        FILTER(STRSTARTS(STR(?entity), "http://purl.obolibrary.org/obo/CHEBI_"))
      }
  
  - title: "Query Biological Roles via OWL Restrictions"
    description: "Find chemicals with antimicrobial agent role using specific role IRI"
    question: "Find antimicrobial agents with molecular formulas"
    complexity: intermediate
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      # Use specific IRI for antimicrobial agent role
      SELECT ?entity ?label ?formula
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        ?entity a owl:Class ;
                rdfs:label ?label ;
                rdfs:subClassOf ?restriction .
        ?restriction owl:onProperty <http://purl.obolibrary.org/obo/RO_0000087> ;
                     owl:someValuesFrom obo:CHEBI_33281 .
        OPTIONAL { ?entity chebi:formula ?formula }
      }
      LIMIT 50
  
  - title: "Find Chemical Relationships via Restrictions"
    description: "Query conjugate acid-base pairs using OWL restriction pattern"
    question: "Find chemicals and their conjugate bases"
    complexity: intermediate
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      SELECT ?acid ?acidLabel ?base ?baseLabel
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        ?acid a owl:Class ;
              rdfs:label ?acidLabel ;
              rdfs:subClassOf ?restriction .
        ?restriction owl:onProperty chebi:is_conjugate_acid_of ;
                     owl:someValuesFrom ?base .
        ?base rdfs:label ?baseLabel .
      }
      LIMIT 20
  
  - title: "Aggregate Cross-Reference Coverage"
    description: "Analyze database cross-reference patterns and coverage"
    question: "Which databases have the most ChEBI cross-references?"
    complexity: advanced
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      SELECT ?database (COUNT(DISTINCT ?entity) as ?entityCount) 
             (COUNT(?xref) as ?xrefCount)
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        ?entity a owl:Class ;
                oboInOwl:hasDbXref ?xref .
        FILTER(STRSTARTS(STR(?entity), "http://purl.obolibrary.org/obo/CHEBI_"))
        BIND(REPLACE(STR(?xref), ":.*", "") AS ?database)
      }
      GROUP BY ?database
      ORDER BY DESC(?entityCount)
      LIMIT 30
  
  - title: "Complex Formula Analysis with Text Search"
    description: "Find compounds by formula pattern when no specific IRI exists"
    question: "Find carbon-nitrogen compounds with high database coverage"
    complexity: advanced
    sparql: |
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
      PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
      
      SELECT ?entity ?label ?formula (COUNT(?xref) as ?xrefCount)
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        ?entity a owl:Class ;
                rdfs:label ?label ;
                chebi:formula ?formula .
        FILTER(STRSTARTS(STR(?entity), "http://purl.obolibrary.org/obo/CHEBI_"))
        # Text search justified: formula is unstructured string, no controlled vocabulary
        FILTER(CONTAINS(?formula, "C") && CONTAINS(?formula, "N"))
        OPTIONAL { ?entity oboInOwl:hasDbXref ?xref }
      }
      GROUP BY ?entity ?label ?formula
      HAVING (COUNT(?xref) > 5)
      ORDER BY DESC(?xrefCount)
      LIMIT 20

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chembl
    - reactome
    - ensembl
    - amrportal
  examples:
    - title: "ChEBI-ChEMBL Integration via skos:exactMatch"
      description: |
        Link ChEBI chemical entities to ChEMBL drug molecules to enrich compounds with bioactivity data and development phases. ChEMBL references ChEBI via skos:exactMatch for seamless integration.
      databases_used:
        - chembl
        - chebi
      complexity: intermediate
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        
        SELECT DISTINCT ?moleculeLabel ?chebiLabel ?formula ?mass ?developmentPhase
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?moleculeLabel ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase ?developmentPhase .
            # Pre-filter: only phase 3+ drugs (reduces 2.4M→~10k)
            FILTER(?developmentPhase >= 3)
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
            OPTIONAL { ?chebiId chebi:mass ?mass }
          }
        }
        ORDER BY DESC(?developmentPhase)
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter phase≥3), 7 (OPTIONAL), 10 (LIMIT)
        - Pre-filtering reduces 2.4M→~10k molecules (99.5% reduction) before join
        - Performance: ~1-2s (Tier 1)
        - Use case: Identify late-stage/marketed drugs with ChEBI ontology data
    
    - title: "ChEBI-Reactome Pathway Integration"
      description: |
        Connect ChEBI molecules to Reactome pathways to understand metabolite roles. Reactome uses UnificationXref with bp:db="ChEBI" and requires URI conversion from "CHEBI:15422" format to ChEBI IRI format.
      databases_used:
        - reactome
        - chebi
      complexity: intermediate
      sparql: |
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?reactomeName ?chebiLabel ?formula ?pathwayName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            ?molecule a bp:SmallMolecule ;
                      bp:displayName ?reactomeName ;
                      bp:entityReference/bp:xref ?xref .
            # Type restriction CRITICAL for Reactome
            ?xref a bp:UnificationXref ;
                  bp:db "ChEBI"^^xsd:string ;
                  bp:id ?fullChebiId .
            FILTER(STRSTARTS(?fullChebiId, "CHEBI:"))
            # Extract numeric ID from "CHEBI:15422" format
            BIND(SUBSTR(?fullChebiId, 7) AS ?chebiNum)
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:pathwayComponent+/bp:left|bp:right ?molecule .
            # Pre-filter pathways
            FILTER(CONTAINS(?pathwayName, "metabolism"))
          }
          # Convert to ChEBI URI format
          BIND(IRI(CONCAT("http://purl.obolibrary.org/obo/CHEBI_", ?chebiNum)) AS ?chebiUri)
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiUri a owl:Class ;
                      rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiUri chebi:formula ?formula }
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 5 (URI conversion), 7 (OPTIONAL), 9 (^^xsd:string), 10 (LIMIT)
        - URI conversion: "CHEBI:15422" → "http://purl.obolibrary.org/obo/CHEBI_15422"
        - ^^xsd:string CRITICAL for Reactome bp:db filter
        - Performance: ~3-5s (Tier 2) due to property paths
        - Use case: Map metabolites to metabolic pathways
    
    - title: "Marketed Kinase Inhibitors with ChEBI Structure"
      description: |
        Link FDA-approved kinase inhibitor drugs from ChEMBL to ChEBI structural data. Demonstrates pharmaceutical research workflow with optimized performance via aggressive pre-filtering.
      databases_used:
        - chembl
        - chebi
      complexity: advanced
      sparql: |
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        
        SELECT DISTINCT ?drugName ?chebiLabel ?formula ?targetName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase 4 ;
                      cco:hasActivity/cco:hasAssay/cco:hasTarget ?target .
            ?target a cco:SingleProtein ;
                    rdfs:label ?targetName .
            # Use bif:contains for indexed text search on Virtuoso
            ?targetName bif:contains "'kinase'" option (score ?sc)
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (double pre-filter), 4 (bif:contains), 6 (property path), 7 (OPTIONAL), 10 (LIMIT)
        - Double filter: phase=4 (2.4M→~8k) + kinase (~8k→hundreds) = >99.9% reduction
        - Performance: ~2-3s (Tier 1) due to aggressive filtering
        - Use case: Find FDA-approved kinase inhibitors like Imatinib, Sorafenib
        - bif:contains used because target names are unstructured text fields

cross_references:
  - pattern: oboInOwl:hasDbXref
    description: |
      Cross-references to external databases as literal strings with "prefix:id" format. Covers chemical databases (CAS, PubChem, Reaxys), biological databases (KEGG, HMDB, DrugBank), and knowledge resources (Wikipedia, PMID).
    databases:
      chemical:
        - "CAS: Chemical Abstracts Service"
        - "Beilstein: Beilstein database"
        - "Reaxys: Reaxys chemical database"
        - "Gmelin: Gmelin database"
      biological:
        - "KEGG: KEGG Compound"
        - "HMDB: Human Metabolome Database"
        - "DrugBank: Drug database"
        - "MetaCyc: Metabolic pathways"
        - "LIPID_MAPS_instance: Lipid database"
      structure:
        - "PubChem: PubChem Compound"
        - "ChEMBL: ChEMBL molecules"
      knowledge:
        - "Wikipedia: Wikipedia articles"
        - "PMID: PubMed articles"
        - "Patent: Patent numbers"
    sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX oboInOwl: <http://www.geneontology.org/formats/oboInOwl#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      
      SELECT ?entity ?label ?xref
      FROM <http://rdf.ebi.ac.uk/dataset/chebi>
      WHERE {
        ?entity a owl:Class ;
                rdfs:label ?label ;
                oboInOwl:hasDbXref ?xref .
        FILTER(STRSTARTS(STR(?entity), "http://purl.obolibrary.org/obo/CHEBI_"))
        FILTER(STRSTARTS(?xref, "KEGG:") || STRSTARTS(?xref, "DrugBank:"))
      }
      LIMIT 100

architectural_notes:
  query_strategy:
    - "Exploratory: Use OLS4:searchClasses to find examples and extract specific IRIs (e.g., CHEBI:17234 for glucose, CHEBI:33709 for amino acid)"
    - "Comprehensive: Use specific IRIs with VALUES or direct predicates for precise, fast queries"
    - "Hierarchy: Navigate via rdfs:subClassOf with specific parent IRIs (e.g., amino acid descendants)"
    - "Biological roles: Query via OWL restrictions with specific role IRIs (e.g., CHEBI:33281 for antimicrobial agent)"
    - "Text search: Use bif:contains (Virtuoso indexed) for unstructured text like formulas when no structured alternative exists"
    - "Priority: Specific IRIs > Typed predicates > Graph navigation > bif:contains > FILTER(CONTAINS())"
  
  schema_design:
    - "OWL ontology with owl:Class for all chemical entities"
    - "Hierarchical classification via rdfs:subClassOf (single and multiple inheritance)"
    - "Chemical relationships encoded as OWL restrictions (conjugate acids/bases, tautomers, enantiomers)"
    - "Biological roles via RO_0000087 through owl:Restriction and owl:someValuesFrom"
    - "CRITICAL: TWO namespaces - data properties use chebi/ (formula, mass, smiles), relationship properties use chebi# (is_conjugate_acid_of, has_role)"
    - "Cross-references as literal strings in \"database:id\" format"
  
  performance:
    - "Specific IRI lookups: <0.5s"
    - "VALUES with IRIs: <1s for batches of 5-10 entities"
    - "Hierarchy traversal (rdfs:subClassOf+): 1-3s for moderate depth"
    - "bif:contains text searches: <2s for indexed fields"
    - "Cross-database queries: 1-3s (Tier 1) with pre-filtering, 3-8s (Tier 2) with property paths"
    - "Filter by CHEBI_ URI prefix early to exclude non-entity classes"
    - "Use LIMIT for large result sets"
  
  data_integration:
    - "Cross-references require parsing literal strings (\"KEGG:C00031\" → extract database and ID)"
    - "InChI/InChIKey for structure-based matching across databases"
    - "SMILES for substructure searches"
    - "ChEMBL integration via skos:exactMatch (Tier 1 performance with pre-filtering)"
    - "Reactome integration requires URI conversion and ^^xsd:string type (Tier 2 performance)"
  
  data_quality:
    - "Not all entities have molecular properties (abstract classes like 'amino acid' lack formula/mass)"
    - "Deprecated entities marked with owl:deprecated"
    - "Some synonyms have synonym types via oboInOwl:hasSynonymType"
    - "Coverage: ~87% formula, ~86% mass, ~85% SMILES, ~81% InChI/InChIKey"

data_statistics:
  total_chemical_entities: 223078
  verified_date: "2025-02-09"
  verification_query: |
    PREFIX owl: <http://www.w3.org/2002/07/owl#>
    SELECT (COUNT(DISTINCT ?e) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/chebi>
    WHERE { 
      ?e a owl:Class .
      FILTER(STRSTARTS(STR(?e), "http://purl.obolibrary.org/obo/CHEBI_"))
    }
  
  coverage:
    with_formula: "87%"
    with_mass: "86%"
    with_smiles: "85%"
    with_inchi: "81%"
    with_inchikey: "81%"
    with_dbxrefs: "~100%"
    verified_date: "2025-02-09"
    methodology: "COUNT with property / COUNT total entities"
  
  cardinality:
    avg_dbxrefs_per_entity: 3.5
    avg_synonyms_per_entity: 1.9
    avg_parents_per_entity: 1.7
  
  performance_characteristics:
    - "Specific IRI lookups: <0.5s"
    - "Hierarchy traversal with rdfs:subClassOf+: 1-3s"
    - "bif:contains searches: <2s"
    - "Cross-DB ChEMBL: 1-3s (Tier 1) with pre-filtering"
    - "Cross-DB Reactome: 3-8s (Tier 2) with property paths"
    - "Pre-filtering reduces join size by 99.5%"
  
  staleness_warning: "Monthly updates - data current as of last release"

anti_patterns:
  - title: "Text Search When Specific IRI Available"
    problem: "Using bif:contains keyword search when specific CHEBI IRI exists"
    wrong_sparql: |
      # Slow and imprecise: text search for glucose
      SELECT ?entity ?label
      WHERE {
        ?entity rdfs:label ?label .
        ?label bif:contains "'glucose'"
      }
    correct_sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      
      # Fast and precise: use specific IRI
      SELECT ?label ?formula ?mass
      WHERE {
        obo:CHEBI_17234 rdfs:label ?label .
        OPTIONAL { obo:CHEBI_17234 chebi:formula ?formula }
        OPTIONAL { obo:CHEBI_17234 chebi:mass ?mass }
      }
    explanation: "First use OLS4:searchClasses to find glucose is CHEBI:17234, then query with specific IRI. Text search returns many results and is slower."
  
  - title: "Wrong Property Namespace"
    problem: "Using chebi# namespace for data properties instead of chebi/"
    wrong_sparql: |
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi#>
      
      # WRONG namespace for formula
      SELECT ?entity ?formula
      WHERE {
        ?entity chebi:formula ?formula .
      }
    correct_sparql: |
      PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
      
      # CORRECT namespace for formula
      SELECT ?entity ?formula
      WHERE {
        ?entity chebi:formula ?formula .
      }
    explanation: "ChEBI uses TWO namespaces: data properties (formula, mass, smiles) use chebi/ while relationship properties (is_conjugate_acid_of, has_role) use chebi#"
  
  - title: "Circular Reasoning with Search Results"
    problem: "Using search API results in VALUES for comprehensive count queries"
    wrong_sparql: |
      # WRONG: Only counts 20 entities from search
      VALUES ?entity { obo:CHEBI_1 obo:CHEBI_2 ... obo:CHEBI_20 }
      SELECT (COUNT(?entity) as ?count) WHERE { ... }
    correct_sparql: |
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      
      # CORRECT: Use specific parent IRI to count all descendants
      SELECT (COUNT(DISTINCT ?entity) as ?count)
      WHERE {
        ?entity rdfs:subClassOf+ obo:CHEBI_33709 .
        FILTER(STRSTARTS(STR(?entity), "http://purl.obolibrary.org/obo/CHEBI_"))
      }
    explanation: "Extract concept IRIs (like CHEBI:33709 for amino acid) from search examples, then query ALL entities matching that concept. Don't use search result entities directly in VALUES."

common_errors:
  - error: "Empty results for molecular properties"
    causes:
      - "Using wrong namespace (chebi# instead of chebi/) for data properties"
      - "Querying abstract chemical classes without molecular data"
      - "Entity deprecated or incomplete"
    solutions:
      - "Use chebi/ namespace for formula, mass, smiles, inchi, inchikey"
      - "Check owl:deprecated status with: FILTER NOT EXISTS { ?entity owl:deprecated true }"
      - "Use OPTIONAL for properties that may be missing"
  
  - error: "Chemical relationship queries return empty"
    causes:
      - "Using property directly instead of via OWL restrictions"
      - "Wrong namespace for relationship properties (chebi/ instead of chebi#)"
    solutions:
      - "Use OWL restriction pattern with owl:onProperty and owl:someValuesFrom"
      - "Use chebi# namespace for relationship properties like is_conjugate_acid_of"
      - "Example: ?entity rdfs:subClassOf ?restriction . ?restriction owl:onProperty chebi:is_conjugate_acid_of"
  
  - error: "Cross-database query timeout or empty results"
    causes:
      - "Missing pre-filtering (Strategy 2) before join"
      - "Missing GRAPH clauses (Strategy 1)"
      - "Missing ^^xsd:string for Reactome bp:db predicate"
      - "Wrong URI format for ChEBI entities in Reactome"
    solutions:
      - "Apply FILTER within source GRAPH before join (e.g., FILTER(?phase >= 3) in ChEMBL graph)"
      - "Use explicit GRAPH clauses for each database"
      - "Add ^^xsd:string for Reactome bp:db: bp:db \"ChEBI\"^^xsd:string"
      - "Convert Reactome IDs: BIND(IRI(CONCAT(\"http://purl.obolibrary.org/obo/CHEBI_\", SUBSTR(?id, 7))) AS ?chebiUri)"
    example_fix: |
      # Reactome URI conversion:
      ?xref bp:db "ChEBI"^^xsd:string ; bp:id ?fullChebiId .
      FILTER(STRSTARTS(?fullChebiId, "CHEBI:"))
      BIND(SUBSTR(?fullChebiId, 7) AS ?chebiNum)
      BIND(IRI(CONCAT("http://purl.obolibrary.org/obo/CHEBI_", ?chebiNum)) AS ?chebiUri)
