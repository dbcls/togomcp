schema_info:
  title: Reactome Pathway Database RDF
  description: |
    Open-source, curated knowledgebase of biological pathways and processes based on BioPAX Level 3 ontology.
    Contains 23K pathways, 93K biochemical reactions, 233K proteins, 109K complexes, and 51K small molecules across 30+ species.
    Includes hierarchical pathway organization and cross-references to UniProt, ChEBI, PubMed, GO, ChEMBL, and drug databases.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://www.reactome.org/biopax/
  graphs:
    - http://rdf.ebi.ac.uk/dataset/reactome
  kw_search_tools:
    - search_reactome_entity
  version:
    mie_version: "1.3"
    mie_created: "2025-02-04"
    data_version: "Release 88"
    update_frequency: "Quarterly"
  license:
    data_license: "CC BY 4.0"
    license_url: "https://creativecommons.org/licenses/by/4.0/"
  access:
    rate_limiting: "No strict limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  
  <PathwayShape> {
    a [ bp:Pathway ] ;
    bp:displayName xsd:string ;
    bp:organism @<BioSourceShape> ? ;
    bp:comment xsd:string * ;
    bp:pathwayComponent @<PathwayShape> * ;
    bp:pathwayComponent @<BiochemicalReactionShape> * ;
    bp:pathwayOrder @<PathwayStepShape> * ;
    bp:dataSource @<ProvenanceShape> * ;
    bp:xref @<XrefShape> *
  }
  
  <BiochemicalReactionShape> {
    a [ bp:BiochemicalReaction ] ;
    bp:displayName xsd:string ? ;
    bp:left @<PhysicalEntityShape> * ;
    bp:right @<PhysicalEntityShape> * ;
    bp:eCNumber xsd:string * ;
    bp:spontaneous xsd:boolean ? ;
    bp:conversionDirection xsd:string ? ;
    bp:comment xsd:string * ;
    bp:xref @<XrefShape> *
  }
  
  <PhysicalEntityShape> {
    a [ bp:Protein bp:Complex bp:SmallMolecule bp:Dna bp:Rna ] ;
    bp:displayName xsd:string ? ;
    bp:entityReference @<EntityReferenceShape> ? ;
    bp:cellularLocation @<CellularLocationShape> ? ;
    bp:feature @<EntityFeatureShape> * ;
    bp:memberPhysicalEntity @<PhysicalEntityShape> *
  }
  
  <EntityReferenceShape> {
    a [ bp:ProteinReference bp:SmallMoleculeReference bp:DnaReference bp:RnaReference ] ;
    bp:name xsd:string * ;
    bp:xref @<UnificationXrefShape> * ;
    bp:organism @<BioSourceShape> ?
  }
  
  <ComplexShape> {
    a [ bp:Complex ] ;
    bp:component @<PhysicalEntityShape> + ;
    bp:componentStoichiometry @<StoichiometryShape> *
  }
  
  <StoichiometryShape> {
    a [ bp:Stoichiometry ] ;
    bp:physicalEntity @<PhysicalEntityShape> ;
    bp:stoichiometricCoefficient xsd:float
  }
  
  <CatalysisShape> {
    a [ bp:Catalysis ] ;
    bp:controller @<PhysicalEntityShape> ;
    bp:controlled @<BiochemicalReactionShape> ;
    bp:catalysisDirection xsd:string ?
  }
  
  <XrefShape> {
    a [ bp:UnificationXref bp:PublicationXref bp:RelationshipXref ] ;
    bp:db xsd:string ? ;
    bp:id xsd:string ?
  }
  
  <UnificationXrefShape> {
    a [ bp:UnificationXref ] ;
    bp:db xsd:string ;
    bp:id xsd:string
  }
  
  <BioSourceShape> {
    a [ bp:BioSource ] ;
    bp:name xsd:string * ;
    bp:xref @<UnificationXrefShape> *
  }
  
  <CellularLocationShape> {
    a [ bp:CellularLocationVocabulary ] ;
    bp:term xsd:string
  }
  
  <EvidenceShape> {
    a [ bp:Evidence ] ;
    bp:evidenceCode @<EvidenceCodeVocabularyShape> ? ;
    bp:xref @<PublicationXrefShape> *
  }

sample_rdf_entries:
  - title: Pathway with Hierarchy and Organism
    description: Top-level human pathway with sub-pathways and GO cross-reference.
    rdf: |
      reactome:Pathway227 a bp:Pathway ;
        bp:displayName "Platelet homeostasis" ;
        bp:organism reactome:BioSource1 ;
        bp:pathwayComponent reactome:Pathway234 ,
                            reactome:Pathway235 ;
        bp:xref [
          a bp:UnificationXref ;
          bp:db "GENE ONTOLOGY"^^xsd:string ;
          bp:id "GO:0030168"
        ] .
      
      reactome:BioSource1 a bp:BioSource ;
        bp:name "Homo sapiens" .
  
  - title: Biochemical Reaction with Catalysis
    description: Autophosphorylation reaction with enzyme catalyst and EC number.
    rdf: |
      reactome:BiochemicalReaction1154 a bp:BiochemicalReaction ;
        bp:displayName "Autophosphorylation of PDGFRA" ;
        bp:left reactome:Complex630 ;
        bp:right reactome:Complex1445 ;
        bp:eCNumber "2.7.10.1" ;
        bp:spontaneous false .
      
      reactome:Catalysis5678 a bp:Catalysis ;
        bp:controller reactome:Protein728 ;
        bp:controlled reactome:BiochemicalReaction1154 .
  
  - title: Protein Complex with Stoichiometry and Location
    description: Multi-component complex with stoichiometric coefficients and cellular localization.
    rdf: |
      reactome:Complex630 a bp:Complex ;
        bp:displayName "PDGF-PDGFRA dimer" ;
        bp:component reactome:Protein728 ,
                     reactome:Protein965 ;
        bp:componentStoichiometry [
          a bp:Stoichiometry ;
          bp:physicalEntity reactome:Protein728 ;
          bp:stoichiometricCoefficient 2
        ] ;
        bp:cellularLocation [
          a bp:CellularLocationVocabulary ;
          bp:term "plasma membrane"
        ] .
  
  - title: Protein with UniProt and GO Cross-References
    description: Protein entity with database identifiers and biological process annotation.
    rdf: |
      reactome:Protein728 a bp:Protein ;
        bp:displayName "PDGFRA" ;
        bp:entityReference reactome:ProteinReference728 .
      
      reactome:ProteinReference728 a bp:ProteinReference ;
        bp:name "PDGFRA" ;
        bp:xref [
          a bp:UnificationXref ;
          bp:db "UniProt"^^xsd:string ;
          bp:id "P16234"
        ] ;
        bp:xref [
          a bp:RelationshipXref ;
          bp:db "GENE ONTOLOGY"^^xsd:string ;
          bp:id "GO:0004714"
        ] .
  
  - title: Small Molecule with ChEBI Reference
    description: Chemical compound with ChEBI identifier used in metabolic reactions.
    rdf: |
      reactome:SmallMolecule1234 a bp:SmallMolecule ;
        bp:displayName "ATP" ;
        bp:entityReference [
          a bp:SmallMoleculeReference ;
          bp:name "ATP" ;
          bp:xref [
            a bp:UnificationXref ;
            bp:db "ChEBI"^^xsd:string ;
            bp:id "CHEBI:15422"
          ]
        ] .

sparql_query_examples:
  - title: Search Pathways by Keyword with Relevance Scoring
    description: Full-text search using bif:contains with relevance ranking.
    question: Which pathways are related to cancer?
    complexity: basic
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      
      SELECT ?pathway ?name
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
          bp:displayName ?name .
        ?name bif:contains "'cancer'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Get Pathway Hierarchy and Sub-Components
    description: Retrieve nested sub-pathways starting from a specific parent pathway.
    question: What are the sub-pathways of Platelet homeostasis?
    complexity: basic
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX reactome: <http://www.reactome.org/biopax/68/49646#>
      
      SELECT ?subPathway ?name
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        reactome:Pathway227 bp:pathwayComponent ?subPathway .
        ?subPathway a bp:Pathway ;
          bp:displayName ?name .
      }
  
  - title: Find Pathways with GO Biological Process Annotations
    description: Retrieve pathways mapped to specific Gene Ontology processes.
    question: Which pathways are annotated with the GO term for platelet activation?
    complexity: intermediate
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?pathway ?name ?goId
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
          bp:displayName ?name ;
          bp:xref ?xref .
        ?xref bp:db "GENE ONTOLOGY"^^xsd:string ;
          bp:id ?goId .
        FILTER(CONTAINS(?goId, "GO:0030168"))
      }
      LIMIT 50
  
  - title: Find Disease-Related Pathways with Boolean Search
    description: Search for pathways using keyword filtering with boolean operators.
    question: Find pathways about Alzheimer's disease but not normal aging processes?
    complexity: intermediate
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      
      SELECT ?pathway ?name ?comment
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
          bp:displayName ?name ;
          bp:comment ?comment .
        ?name bif:contains "('alzheimer' AND 'disease' AND NOT 'aging')" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Get Pathway Proteins with Organism and UniProt IDs
    description: Retrieve proteins in a pathway with species and database identifiers.
    question: What are the UniProt IDs and organisms of proteins in a specific pathway?
    complexity: intermediate
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX reactome: <http://www.reactome.org/biopax/68/49646#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT DISTINCT ?proteinName ?uniprotId ?organism
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        reactome:Pathway227 bp:pathwayComponent*/bp:left ?entity .
        ?entity bp:entityReference ?proteinRef .
        ?proteinRef a bp:ProteinReference ;
          bp:name ?proteinName ;
          bp:organism ?org ;
          bp:xref ?xref .
        ?org bp:name ?organism .
        ?xref a bp:UnificationXref ;
          bp:db "UniProt"^^xsd:string ;
          bp:id ?uniprotId .
      }
      LIMIT 100
  
  - title: Find Protein Complexes with Component Details
    description: Retrieve complexes with stoichiometric coefficients and localization.
    question: Which complexes have multiple copies of the same protein and where are they located?
    complexity: advanced
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      
      SELECT ?complex ?complexName ?componentName ?coefficient ?location
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?complex a bp:Complex ;
          bp:displayName ?complexName ;
          bp:componentStoichiometry ?stoich .
        OPTIONAL { 
          ?complex bp:cellularLocation ?cellLoc .
          ?cellLoc bp:term ?location .
        }
        ?stoich bp:physicalEntity ?component ;
          bp:stoichiometricCoefficient ?coefficient .
        ?component bp:entityReference/bp:name ?componentName .
        FILTER(?coefficient > 1)
      }
      LIMIT 50
  
  - title: Pathway-Drug Target Integration via Pharmacology Database
    description: Link cancer pathways to drug targets through protein cross-references.
    question: Which cancer pathways contain proteins with documented drug interactions?
    complexity: advanced
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT DISTINCT ?pathway ?pathwayName ?proteinName ?drugTargetId
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
          bp:displayName ?pathwayName ;
          bp:pathwayComponent*/bp:left ?entity .
        ?entity bp:entityReference ?proteinRef .
        ?proteinRef bp:name ?proteinName ;
          bp:xref ?drugXref .
        ?drugXref bp:db "Guide to Pharmacology"^^xsd:string ;
          bp:id ?drugTargetId .
        ?pathwayName bif:contains "'cancer'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 50

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chembl
    - chebi
    - ensembl
    - amrportal
  examples:
    - title: Link Reactome Pathways to ChEBI Chemical Ontology
      description: |
        Connect Reactome small molecules to ChEBI entities to enrich pathway metabolites with chemical ontology, molecular formulas, mass, InChI keys, and hierarchical classification.
        Reactome references ChEBI via UnificationXref with bp:db="ChEBI"^^xsd:string.
      databases_used:
        - reactome
        - chebi
      complexity: intermediate
      sparql: |
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?reactomeName ?chebiLabel ?formula ?mass ?pathwayName
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            ?molecule a bp:SmallMolecule ;
                      bp:displayName ?reactomeName ;
                      bp:entityReference/bp:xref ?xref .
            ?xref a bp:UnificationXref ;
                  bp:db "ChEBI"^^xsd:string ;
                  bp:id ?fullChebiId .
            FILTER(STRSTARTS(?fullChebiId, "CHEBI:"))
            BIND(SUBSTR(?fullChebiId, 7) AS ?chebiNum)
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:pathwayComponent+/bp:left|bp:right ?molecule .
            FILTER(CONTAINS(?pathwayName, "metabolism"))
          }
          BIND(IRI(CONCAT("http://purl.obolibrary.org/obo/CHEBI_", ?chebiNum)) AS ?chebiUri)
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiUri a owl:Class ;
                      rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiUri chebi:formula ?formula }
            OPTIONAL { ?chebiUri chebi:mass ?mass }
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 5 (URI conversion), 7 (OPTIONAL), 9 (type), 10 (LIMIT)
        - Pre-filter on "metabolism" reduces pathway search before URI conversion and ChEBI join
        - URI conversion: BIND(IRI(CONCAT(...))) transforms "CHEBI:15422" to "http://purl.obolibrary.org/obo/CHEBI_15422"
        - Type restriction bp:db "ChEBI"^^xsd:string prevents datatype mismatch (CRITICAL)
        - Performance: ~3-5s (Tier 2) - property paths add overhead but pre-filtering maintains speed
        - MIE files referenced: reactome (graph, type restriction, ChEBI format), chebi (graph, URI format, OPTIONAL)
    
    - title: Integrate Reactome Pathways with ChEMBL Drug Targets
      description: |
        Link Reactome pathways to ChEMBL drug molecules targeting proteins in those pathways, enabling drug target validation and mechanism of action research.
        Integration via UniProt as common protein identifier.
      databases_used:
        - reactome
        - chembl
      complexity: advanced
      sparql: |
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?pathwayName ?proteinName ?drugName ?targetName ?phase
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:pathwayComponent*/bp:left|bp:right ?protein .
            ?protein a bp:Protein ;
                     bp:entityReference/bp:name ?proteinName ;
                     bp:entityReference/bp:xref ?protXref .
            ?protXref a bp:UnificationXref ;
                      bp:db "UniProt"^^xsd:string ;
                      bp:id ?uniprotIdStr .
            ?pathwayName bif:contains "'cancer'" option (score ?sc)
          }
          BIND(IRI(CONCAT("http://purl.uniprot.org/uniprot/", ?uniprotIdStr)) AS ?uniprotId)
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    rdfs:label ?targetName ;
                    cco:organismName "Homo sapiens" ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprotId ;
                    cco:hasAssay/cco:hasActivity/cco:hasMolecule ?molecule .
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      cco:highestDevelopmentPhase ?phase .
            FILTER(?phase >= 3)
          }
        }
        ORDER BY DESC(?sc) DESC(?phase)
        LIMIT 20
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 5 (URI), 6 (paths), 9 (type), 10 (LIMIT)
        - Double pre-filtering: cancer keyword + phase >=3 reduces join by >99%
        - URI conversion transforms UniProt string to full URI for ChEMBL join
        - Type restriction bp:db "UniProt"^^xsd:string CRITICAL for preventing datatype mismatch
        - Performance: ~4-6s (Tier 2) - complex property paths but pre-filtering enables execution
        - MIE files referenced: reactome (type restriction, property paths), chembl (entity types, property paths, phase filter)
    
    - title: Three-Way Integration - Pathways, Drugs, and Chemical Structure
      description: |
        Link Reactome pathways to ChEMBL drugs targeting pathway proteins, enriched with ChEBI structure data.
        Demonstrates multi-database integration for systems pharmacology. Uses simplified pathway matching for performance.
      databases_used:
        - reactome
        - chembl
        - chebi
      complexity: advanced
      sparql: |
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?pathwayName ?drugName ?chebiLabel ?formula
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName .
            FILTER(CONTAINS(?pathwayName, "EGFR"))
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    cco:organismName "Homo sapiens" ;
                    cco:hasTargetComponent/skos:exactMatch <http://purl.uniprot.org/uniprot/P00533> ;
                    cco:hasAssay/cco:hasActivity/cco:hasMolecule ?molecule .
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      skos:exactMatch ?chebiId ;
                      cco:highestDevelopmentPhase 4 .
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiId a owl:Class ;
                     rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiId chebi:formula ?formula }
          }
        }
        LIMIT 10
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filter), 3 (VALUES implicit), 6 (paths), 7 (OPTIONAL), 10 (LIMIT)
        - Triple pre-filtering: EGFR pathway + protein P00533 + phase 4 + ChEBI match reduces by >99.99%
        - Simplified pathway matching (CONTAINS on name) avoids complex bp:pathwayComponent* traversal
        - Performance: ~3-5s (Tier 2) - aggressive filtering enables fast 3-way integration
        - Finds marketed EGFR inhibitors (e.g., Lapatinib) with complete chemical structure data
        - MIE files referenced: reactome (simplified matching), chembl (property paths, phase filter), chebi (OPTIONAL pattern)

cross_references:
  - pattern: bp:xref with bp:db
    description: |
      Unified cross-reference pattern using bp:xref with database name in bp:db.
      CRITICAL: Always use ^^xsd:string type restriction for bp:db comparisons.
    databases:
      proteins:
        - "UniProt: 87K protein references"
        - "Ensembl: 2K gene mappings"
        - "RefSeq: via NCBI Gene"
      pathways:
        - "GENE ONTOLOGY: 65K GO term annotations"
        - "KEGG Pathway: pathway mappings"
        - "PANTHER: pathway classifications"
      chemicals:
        - "ChEBI: 32K small molecule references"
        - "COMPOUND: 22K compound identifiers"
        - "PubChem Compound: 631 mappings"
      publications:
        - "PubMed: 443K evidence citations"
      drugs:
        - "Guide to Pharmacology: 8K drug-target interactions"
      organisms:
        - "NCBI Taxonomy: species identifiers"
      diseases:
        - "COSMIC: 5K cancer gene variants"
        - "ClinGen: 288 clinical genomics annotations"
        - "LOVD: 132 variant database entries"
      structural:
        - "ComplexPortal: 976 protein complex mappings"
        - "MOD: 1K protein modifications"
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?entity ?database ?externalId
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?entity bp:xref ?xref .
        ?xref a bp:UnificationXref ;
          bp:db ?database ;
          bp:id ?externalId .
        FILTER(?database = "UniProt"^^xsd:string)
      }
      LIMIT 50

architectural_notes:
  schema_design:
    - BioPAX Level 3 ontology provides standardized biological pathway representation
    - Hierarchical pathways via bp:pathwayComponent allow multi-level organization
    - Reactions link to proteins, complexes, small molecules via bp:left/bp:right
    - Entity references separate instances from canonical definitions
    - Catalysis and Control classes model regulatory relationships
  performance:
    - Use bif:contains for keyword searches (full-text index optimized)
    - Boolean operators in bif:contains - AND, OR, NOT for complex queries
    - Always specify FROM graph for multi-graph endpoints
    - Property path bp:pathwayComponent* works but add LIMIT to prevent timeouts
    - Cross-database optimization - explicit GRAPH clauses (Strategy 1)
    - Pre-filter within GRAPH before joins (Strategy 2) - 10-100x speedup
    - Use bif:contains with split property paths (Strategy 4)
    - Convert URIs when linking to ChEBI/ChEMBL (Strategy 5)
    - Handle type restrictions properly (Strategy 9) - ^^xsd:string CRITICAL
  data_integration:
    - UniProt provides protein sequences and functional annotations
    - ChEBI offers small molecule structures and chemical ontology (EBI endpoint)
    - PubMed links to primary literature and evidence
    - GO terms map pathways to biological processes
    - Guide to Pharmacology connects proteins to drug targets
    - ChEMBL integration for drug-target relationships (EBI endpoint)
    - Cross-database integration with co-located databases (ChEMBL, ChEBI, Ensembl, AMRPortal)
    - Expected performance - Tier 1 (1-3s) for simple ChEBI joins, Tier 2 (3-8s) for ChEMBL joins
  data_quality:
    - All pathways manually curated with expert review
    - Evidence tracking via PublicationXref to PubMed
    - Quarterly updates ensure current biological knowledge
    - CRITICAL - Use ^^xsd:string for bp:db comparisons

data_statistics:
  total_pathways: 23145
  verified_date: "2025-02-04"
  verification_query: |
    SELECT (COUNT(DISTINCT ?p) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE { ?p a bp:Pathway }
  
  total_reactions: 92977
  verification_query_reactions: |
    SELECT (COUNT(DISTINCT ?r) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE { ?r a bp:BiochemicalReaction }
  
  total_proteins: 233200
  verification_query_proteins: |
    SELECT (COUNT(DISTINCT ?p) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE { ?p a bp:Protein }
  
  total_complexes: 109261
  verification_query_complexes: |
    SELECT (COUNT(DISTINCT ?c) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE { ?c a bp:Complex }
  
  total_small_molecules: 51214
  verification_query_molecules: |
    SELECT (COUNT(DISTINCT ?m) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE { ?m a bp:SmallMolecule }
  
  total_catalysis: 46901
  total_species: 30
  
  coverage:
    pathways_with_organisms: ">95%"
    reactions_with_ec_numbers: "~60%"
    proteins_with_uniprot: "~90%"
    pathways_with_go_terms: "~85%"
    pathways_with_pubmed: "~85%"
    entities_with_cellular_location: "~40%"
  
  cardinality:
    avg_subpathways_per_pathway: 5.3
    avg_proteins_per_complex: 3.2
    avg_reactions_per_pathway: 8.7
    avg_xrefs_per_entity: 4.5
  
  performance_characteristics:
    - "bif:contains pathway search: <1s for 20 results"
    - "Hierarchy traversal from specific pathway: <2s"
    - "Cross-reference queries with ^^xsd:string: <3s"
    - "Complex stoichiometry queries: <5s"
    - "Cross-database (ChEBI): 3-5s (Tier 2)"
    - "Cross-database (ChEMBL): 4-6s (Tier 2)"
    - "Three-way integration: 3-5s (Tier 2) with pre-filtering"
    - "Pre-filtering optimization: 99-99.9% reduction in results"
  
  staleness_warning: "Quarterly updates - verify current release for latest data"

anti_patterns:
  - title: Using FILTER Instead of bif:contains for Text Search
    problem: REGEX and CONTAINS are slow and not optimized for full-text searches.
    wrong_sparql: |
      SELECT ?pathway ?name 
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
          bp:displayName ?name .
        FILTER(CONTAINS(LCASE(?name), "cancer"))
      }
    correct_sparql: |
      SELECT ?pathway ?name 
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
          bp:displayName ?name .
        ?name bif:contains "'cancer'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
    explanation: bif:contains uses Virtuoso's full-text index for 10-100x faster searches with relevance scoring.
  
  - title: Unbounded Property Path Without Starting Point
    problem: Using bp:pathwayComponent* without specific starting pathway causes timeout.
    wrong_sparql: |
      SELECT ?pathway ?subPathway 
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway bp:pathwayComponent* ?subPathway
      }
    correct_sparql: |
      PREFIX reactome: <http://www.reactome.org/biopax/68/49646#>
      
      SELECT ?subPathway ?name
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        reactome:Pathway227 bp:pathwayComponent+ ?subPathway .
        ?subPathway a bp:Pathway ;
          bp:displayName ?name .
      }
      LIMIT 100
    explanation: Start from specific pathway URI, use + instead of *, add type filters, and include LIMIT.
  
  - title: Missing Type Restriction for Database Name Comparison
    problem: Direct string comparison with bp:db fails due to RDF literal datatype mismatches.
    wrong_sparql: |
      SELECT ?entity ?id 
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?entity bp:xref ?xref .
        ?xref bp:db "UniProt" ;
          bp:id ?id .
      }
    correct_sparql: |
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?entity ?id 
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?entity bp:xref ?xref .
        ?xref bp:db "UniProt"^^xsd:string ;
          bp:id ?id .
      }
    explanation: Use ^^xsd:string type restriction to ensure proper literal matching - CRITICAL for all bp:db comparisons.
  
  - title: Cross-Database Query Without Pre-Filtering
    problem: Filtering after join causes timeout by processing millions of intermediate results.
    wrong_sparql: |
      WHERE {
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?molecule a cco:SmallMolecule ;
                    skos:exactMatch ?chebiId ;
                    cco:highestDevelopmentPhase ?phase .
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
          ?chebiId a owl:Class ;
                   rdfs:label ?label .
        }
        FILTER(?phase >= 3)
      }
    correct_sparql: |
      WHERE {
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?molecule a cco:SmallMolecule ;
                    skos:exactMatch ?chebiId ;
                    cco:highestDevelopmentPhase ?phase .
          FILTER(?phase >= 3)
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
          ?chebiId a owl:Class ;
                   rdfs:label ?label .
        }
      }
      LIMIT 100
    explanation: Pre-filtering in source database reduces intermediate results by 99.5% before cross-database join, improving from timeout to 1-2 seconds.

common_errors:
  - error: Query returns empty results for cross-references despite known data
    causes:
      - Direct comparison with bp:db without ^^xsd:string type restriction
      - Datatype mismatch between plain literals and typed literals
      - Wrong xref type (PublicationXref instead of UnificationXref)
    solutions:
      - Always use ^^xsd:string type restriction - bp:db 'UniProt'^^xsd:string
      - Alternative - FILTER(STR(?db) = 'UniProt') for variable bindings
      - Use bp:UnificationXref for external IDs, bp:PublicationXref for literature
    example_fix: |
      # Before (returns nothing):
      ?xref bp:db "ChEBI" ; bp:id ?chebiId .
      
      # After (works correctly):
      ?xref bp:db "ChEBI"^^xsd:string ; bp:id ?chebiId .
  
  - error: Query timeout when searching pathways or retrieving components
    causes:
      - Using FILTER with REGEX/CONTAINS instead of bif:contains
      - Missing LIMIT clause on exploratory queries
      - Unbounded property paths without starting entity
      - Complex cross-database property paths
    solutions:
      - Use bif:contains for all keyword searches in names
      - Add LIMIT 50-100 during development
      - Start property path traversals from specific URIs
      - Use simplified matching for cross-database queries when possible
    example_fix: |
      # Before (timeout risk):
      ?pathway bp:pathwayComponent* ?component .
      
      # After (fast):
      reactome:Pathway227 bp:pathwayComponent+ ?component .
      ?component a bp:Pathway .
      LIMIT 100
      
      # Cross-database (simplified):
      FILTER(CONTAINS(?pathwayName, "keyword"))
  
  - error: Missing expected proteins or pathway components
    causes:
      - Not following complete property paths
      - Missing bp:left and bp:right for reaction participants
      - Not checking both Protein and Complex entity types
      - Filtering too aggressively without OPTIONAL
    solutions:
      - Use bp:pathwayComponent+ to get all descendants
      - Include both bp:left and bp:right for reactions
      - Use UNION or multiple patterns for different entity types
      - Use OPTIONAL for properties that may not exist
    example_fix: |
      # Before (incomplete):
      ?pathway bp:pathwayComponent/bp:left ?entity .
      
      # After (comprehensive):
      ?pathway bp:pathwayComponent*/bp:left|bp:right ?entity .
      ?entity a ?type .
      FILTER(?type IN (bp:Protein, bp:Complex, bp:SmallMolecule))
  
  - error: Cross-database query timeout or empty results
    causes:
      - Missing ^^xsd:string type restriction for bp:db (CRITICAL)
      - Missing pre-filtering before joins
      - Missing GRAPH clauses
      - Wrong graph URIs or entity types from co-database
      - Missing URI conversion for different identifier formats
    solutions:
      - Always use ^^xsd:string for bp:db comparisons
      - Apply restrictive FILTER within source GRAPH before join
      - Use explicit GRAPH clauses for each database
      - Verify graph URIs and patterns from co-database MIE files
      - Use URI conversion with BIND(IRI(CONCAT(...))) for ChEBI
      - Add LIMIT to every query level
    example_fix: |
      # BEFORE (times out or empty):
      WHERE {
        GRAPH <reactome> {
          ?xref bp:db "UniProt" ; bp:id ?id .
        }
        GRAPH <chembl> { ?target skos:exactMatch ?uri }
        FILTER(?phase >= 3)
      }
      
      # AFTER (works in 4-6s):
      WHERE {
        GRAPH <reactome> {
          ?xref bp:db "UniProt"^^xsd:string ; bp:id ?id .
          ?pathwayName bif:contains "'cancer'" option (score ?sc)
        }
        BIND(IRI(CONCAT("http://purl.uniprot.org/uniprot/", ?id)) AS ?uri)
        GRAPH <chembl> {
          ?target skos:exactMatch ?uri ;
                  cco:hasAssay/cco:hasActivity/cco:hasMolecule ?molecule .
          ?molecule cco:highestDevelopmentPhase ?phase .
          FILTER(?phase >= 3)
        }
      }
      LIMIT 20
