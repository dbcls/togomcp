schema_info:
  title: Reactome Pathway Database
  description: |
    Curated knowledgebase of biological pathways and processes in BioPAX Level 3 format.
    Contains 23K pathways, 93K biochemical reactions, 233K proteins, 109K complexes, 51K small molecules across 30+ species.
    Hierarchical pathway organization with cross-references to UniProt, ChEBI, PubMed, GO, ChEMBL.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://www.reactome.org/biopax/
  graphs:
    - http://rdf.ebi.ac.uk/dataset/reactome
    - http://rdfportal.org/ontology/go
  kw_search_tools:
    - search_reactome_entity
  version:
    mie_version: "4.0"
    mie_created: "2025-02-10"
    data_version: "Release 88"
    update_frequency: "Quarterly"
  license:
    data_license: "CC BY 4.0"
    license_url: "https://creativecommons.org/licenses/by/4.0/"
  access:
    rate_limiting: "No strict limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  
  <PathwayShape> {
    a [ bp:Pathway ] ;
    bp:displayName xsd:string ;
    bp:organism @<BioSourceShape> ? ;
    bp:comment xsd:string * ;
    bp:pathwayComponent @<PathwayShape> * ;
    bp:pathwayComponent @<BiochemicalReactionShape> * ;
    bp:pathwayOrder @<PathwayStepShape> * ;
    bp:xref @<XrefShape> *
  }
  
  <BiochemicalReactionShape> {
    a [ bp:BiochemicalReaction ] ;
    bp:displayName xsd:string ? ;
    bp:left @<PhysicalEntityShape> * ;
    bp:right @<PhysicalEntityShape> * ;
    bp:eCNumber xsd:string * ;
    bp:spontaneous xsd:boolean ? ;
    bp:xref @<XrefShape> *
  }
  
  <PhysicalEntityShape> {
    a [ bp:Protein bp:Complex bp:SmallMolecule ] ;
    bp:displayName xsd:string ? ;
    bp:entityReference @<EntityReferenceShape> ? ;
    bp:cellularLocation @<CellularLocationShape> ?
  }
  
  <EntityReferenceShape> {
    a [ bp:ProteinReference bp:SmallMoleculeReference ] ;
    bp:name xsd:string * ;
    bp:xref @<UnificationXrefShape> * ;
    bp:organism @<BioSourceShape> ?
  }
  
  <ComplexShape> {
    a [ bp:Complex ] ;
    bp:component @<PhysicalEntityShape> + ;
    bp:componentStoichiometry @<StoichiometryShape> *
  }
  
  <CatalysisShape> {
    a [ bp:Catalysis ] ;
    bp:controller @<PhysicalEntityShape> ;
    bp:controlled @<BiochemicalReactionShape>
  }
  
  <XrefShape> {
    a [ bp:UnificationXref bp:PublicationXref bp:RelationshipXref ] ;
    bp:db xsd:string ? ;
    bp:id xsd:string ?
  }
  
  <BioSourceShape> {
    a [ bp:BioSource ] ;
    bp:name xsd:string *
  }

sample_rdf_entries:
  - title: Human Pathway with GO Annotation
    description: Top-level human pathway with GO biological process annotation.
    rdf: |
      @prefix bp: <http://www.biopax.org/release/biopax-level3.owl#> .
      @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
      
      <http://www.reactome.org/biopax/40/48887#Pathway227>
        a bp:Pathway ;
        bp:displayName "Platelet homeostasis"^^xsd:string ;
        bp:organism <http://www.reactome.org/biopax/40/48887#BioSource1> ;
        bp:xref [
          a bp:RelationshipXref ;
          bp:db "GENE ONTOLOGY"^^xsd:string ;
          bp:id "GO:0030168"^^xsd:string
        ] .
      
      <http://www.reactome.org/biopax/40/48887#BioSource1>
        a bp:BioSource ;
        bp:name "Homo sapiens"^^xsd:string .
  
  - title: Biochemical Reaction with EC Number
    description: Protein kinase reaction with specific EC classification.
    rdf: |
      @prefix bp: <http://www.biopax.org/release/biopax-level3.owl#> .
      @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
      
      <http://www.reactome.org/biopax/40/48887#BiochemicalReaction1154>
        a bp:BiochemicalReaction ;
        bp:displayName "Autophosphorylation of PDGFRA"^^xsd:string ;
        bp:eCNumber "2.7.10.1"^^xsd:string ;
        bp:left <http://www.reactome.org/biopax/40/48887#Complex630> ;
        bp:right <http://www.reactome.org/biopax/40/48887#Complex1445> .
  
  - title: Protein Complex with Stoichiometry
    description: Multi-component complex with stoichiometric coefficients.
    rdf: |
      @prefix bp: <http://www.biopax.org/release/biopax-level3.owl#> .
      @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
      
      <http://www.reactome.org/biopax/40/48887#Complex630>
        a bp:Complex ;
        bp:displayName "PDGF-PDGFRA dimer"^^xsd:string ;
        bp:component <http://www.reactome.org/biopax/40/48887#Protein728> ;
        bp:componentStoichiometry [
          a bp:Stoichiometry ;
          bp:physicalEntity <http://www.reactome.org/biopax/40/48887#Protein728> ;
          bp:stoichiometricCoefficient 2
        ] .
  
  - title: Protein with UniProt Reference
    description: Protein entity with UniProt identifier cross-reference.
    rdf: |
      @prefix bp: <http://www.biopax.org/release/biopax-level3.owl#> .
      @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
      
      <http://www.reactome.org/biopax/40/48887#Protein728>
        a bp:Protein ;
        bp:displayName "PDGFRA"^^xsd:string ;
        bp:entityReference [
          a bp:ProteinReference ;
          bp:name "PDGFRA"^^xsd:string ;
          bp:xref [
            a bp:UnificationXref ;
            bp:db "UniProt"^^xsd:string ;
            bp:id "P16234"^^xsd:string
          ]
        ] .
  
  - title: Small Molecule with ChEBI Reference
    description: Chemical compound with ChEBI identifier.
    rdf: |
      @prefix bp: <http://www.biopax.org/release/biopax-level3.owl#> .
      @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
      
      <http://www.reactome.org/biopax/40/48887#SmallMolecule1234>
        a bp:SmallMolecule ;
        bp:displayName "ATP"^^xsd:string ;
        bp:entityReference [
          a bp:SmallMoleculeReference ;
          bp:name "ATP"^^xsd:string ;
          bp:xref [
            a bp:UnificationXref ;
            bp:db "ChEBI"^^xsd:string ;
            bp:id "CHEBI:15422"^^xsd:string
          ]
        ] .

sparql_query_examples:
  - title: Count Human Pathways Using Specific Organism IRI
    description: |
      Retrieve count of human pathways using organism name with exact match.
      Demonstrates structured property usage with ^^xsd:string for exact matching.
    question: How many pathways are there for humans?
    complexity: basic
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Uses specific organism name for filtering
      # ^^xsd:string required for exact value matching
      SELECT (COUNT(DISTINCT ?pathway) as ?count)
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?pathway a bp:Pathway ;
                 bp:organism ?org .
        ?org bp:name "Homo sapiens"^^xsd:string .
      }
  
  - title: Find Reactions by Specific EC Numbers
    description: |
      Retrieve reactions with specific enzyme commission numbers using VALUES.
      Uses structured EC number property with exact matching.
    question: What protein kinase reactions are in the database?
    complexity: basic
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Uses VALUES with specific EC numbers
      # ^^xsd:string required for each value in VALUES clause
      SELECT ?reaction ?name ?ec
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        VALUES ?ec { 
          "2.7.10.1"^^xsd:string   # Protein-tyrosine kinase
          "2.7.11.1"^^xsd:string   # Serine/threonine-protein kinase
        }
        ?reaction a bp:BiochemicalReaction ;
                  bp:displayName ?name ;
                  bp:eCNumber ?ec .
      }
      LIMIT 50
  
  - title: Find Pathways by Specific GO Term IRIs
    description: |
      Query pathways annotated with specific Gene Ontology terms using VALUES.
      Demonstrates structured GO term usage via RelationshipXref.
    question: Which pathways are involved in MAPK cascade signaling?
    complexity: intermediate
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Uses VALUES with specific GO term IDs
      # GO terms primarily stored as RelationshipXref (not UnificationXref)
      SELECT DISTINCT ?pathway ?name ?goTerm
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        VALUES ?goTerm { 
          "GO:0000165"^^xsd:string    # MAPKKK cascade
          "GO:0051897"^^xsd:string    # MAPK cascade regulation
          "GO:0007264"^^xsd:string    # Small GTPase mediated signal transduction
        }
        ?pathway a bp:Pathway ;
                 bp:displayName ?name ;
                 bp:xref ?xref .
        ?xref a bp:RelationshipXref ;
              bp:db "GENE ONTOLOGY"^^xsd:string ;
              bp:id ?goTerm .
      }
      LIMIT 50
  
  - title: Navigate Pathway Hierarchy from Specific Pathway
    description: |
      Explore pathway component structure using graph navigation.
      Uses search_reactome_entity() to find starting pathway IRI first.
    question: What are the sub-pathways and their components for a specific pathway?
    complexity: intermediate
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      
      # Use specific pathway IRI (find via search_reactome_entity first)
      # Example IRI used here: http://www.reactome.org/biopax/40/48887#Pathway227
      SELECT ?subPathway ?subName ?subSubPathway ?subSubName
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        # Replace with actual pathway IRI from search
        <http://www.reactome.org/biopax/40/48887#Pathway227> 
          bp:pathwayComponent ?subPathway .
        ?subPathway a bp:Pathway ;
                    bp:displayName ?subName .
        
        # Optional: Get next level
        OPTIONAL {
          ?subPathway bp:pathwayComponent ?subSubPathway .
          ?subSubPathway a bp:Pathway ;
                         bp:displayName ?subSubName .
        }
      }
      LIMIT 100
  
  - title: Analyze Reactions with Components and Catalysts
    description: |
      Comprehensive query integrating reactions, proteins, and catalysis relationships.
      Demonstrates multi-type integration with typed predicates.
    question: What are the catalyzed reactions with their proteins and EC numbers?
    complexity: intermediate
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Integrates multiple entity types using typed predicates
      SELECT ?reaction ?name ?ec ?catalyst (COUNT(?protein) as ?proteinCount)
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?reaction a bp:BiochemicalReaction ;
                  bp:displayName ?name ;
                  bp:eCNumber ?ec .
        
        # Link to catalysis
        ?catalysis a bp:Catalysis ;
                   bp:controlled ?reaction ;
                   bp:controller ?catalyst .
        
        # Get proteins involved
        OPTIONAL {
          ?reaction bp:left|bp:right ?entity .
          ?entity a bp:Protein ;
                  bp:entityReference ?protein .
        }
      }
      GROUP BY ?reaction ?name ?ec ?catalyst
      ORDER BY DESC(?proteinCount)
      LIMIT 100
  
  - title: Find Cross-Referenced Proteins with UniProt Links
    description: |
      Query proteins with UniProt identifiers using structured xref pattern.
      Demonstrates filtering on typed cross-reference properties.
    question: Which proteins have UniProt annotations?
    complexity: advanced
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Uses typed predicate filtering for cross-references
      SELECT ?protein ?name ?uniprotId ?organism
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?protein a bp:Protein ;
                 bp:displayName ?name ;
                 bp:entityReference ?ref .
        
        ?ref a bp:ProteinReference ;
             bp:organism ?org ;
             bp:xref ?xref .
        ?org bp:name ?organism .
        
        # Structured xref filtering with typed predicates
        ?xref a bp:UnificationXref ;
              bp:db "UniProt"^^xsd:string ;
              bp:id ?uniprotId .
        
        # Filter for human proteins
        FILTER(?organism = "Homo sapiens"^^xsd:string)
      }
      LIMIT 100
  
  - title: Comprehensive Complex Analysis with Stoichiometry
    description: |
      Advanced query integrating complexes, stoichiometry, cellular location, and protein references.
      Demonstrates complex multi-property integration for human pathways.
    question: What multi-protein complexes exist with detailed component information?
    complexity: advanced
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Complex multi-type integration with optional properties
      SELECT ?complex ?complexName ?componentName ?coefficient ?location ?uniprotId
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?complex a bp:Complex ;
                 bp:displayName ?complexName ;
                 bp:componentStoichiometry ?stoich ;
                 bp:organism ?org .
        ?org bp:name "Homo sapiens"^^xsd:string .
        
        # Stoichiometry details
        ?stoich bp:physicalEntity ?component ;
                bp:stoichiometricCoefficient ?coefficient .
        
        # Component protein details
        ?component bp:entityReference ?proteinRef .
        ?proteinRef bp:name ?componentName ;
                    bp:xref ?xref .
        ?xref a bp:UnificationXref ;
              bp:db "UniProt"^^xsd:string ;
              bp:id ?uniprotId .
        
        # Optional cellular location
        OPTIONAL {
          ?complex bp:cellularLocation ?cellLoc .
          ?cellLoc bp:term ?location .
        }
        
        # Only multi-copy components
        FILTER(?coefficient > 1)
      }
      ORDER BY ?complexName
      LIMIT 100

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chembl
    - chebi
    - ensembl
  examples:
    - title: Link Reactome Small Molecules to ChEBI Ontology
      description: |
        Connect Reactome small molecules to ChEBI chemical ontology for enriched chemical properties.
        
        Linking strategy:
        - Reactome: Uses bp:xref with bp:db="ChEBI"^^xsd:string for molecule references
        - ChEBI: Chemical ontology with formulas, mass, InChI keys
        - URI conversion: BIND(IRI(CONCAT(...))) transforms "CHEBI:15422" to ChEBI ontology IRI
        - Pre-filtering: Human pathways + "metabolism" keyword reduces result set
      databases_used: [reactome, chebi]
      complexity: intermediate
      sparql: |
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX chebi: <http://purl.obolibrary.org/obo/chebi/>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?reactomeName ?chebiLabel ?formula ?mass
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            # Pre-filter: human metabolism pathways
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:organism ?org ;
                     bp:pathwayComponent+/bp:left|bp:right ?molecule .
            ?org bp:name "Homo sapiens"^^xsd:string .
            FILTER(CONTAINS(?pathwayName, "metabolism"))
            
            ?molecule a bp:SmallMolecule ;
                      bp:displayName ?reactomeName ;
                      bp:entityReference/bp:xref ?xref .
            ?xref a bp:UnificationXref ;
                  bp:db "ChEBI"^^xsd:string ;
                  bp:id ?fullChebiId .
            FILTER(STRSTARTS(?fullChebiId, "CHEBI:"))
            BIND(SUBSTR(?fullChebiId, 7) AS ?chebiNum)
          }
          
          # URI conversion: "CHEBI:15422" -> "http://purl.obolibrary.org/obo/CHEBI_15422"
          BIND(IRI(CONCAT("http://purl.obolibrary.org/obo/CHEBI_", ?chebiNum)) AS ?chebiUri)
          
          GRAPH <http://rdf.ebi.ac.uk/dataset/chebi> {
            ?chebiUri a owl:Class ;
                      rdfs:label ?chebiLabel .
            OPTIONAL { ?chebiUri chebi:formula ?formula }
            OPTIONAL { ?chebiUri chebi:mass ?mass }
          }
        }
        LIMIT 50
      notes: |
        - Performance: ~3-5s (Tier 2) with pre-filtering
        - Pre-filtering: human + "metabolism" reduces pathways before property path traversal
        - URI conversion: BIND(IRI(CONCAT(...))) for cross-database IRI matching
        - ^^xsd:string required for exact matches (bp:db, bp:name)
    
    - title: Integrate Reactome Pathways with ChEMBL Drug Targets
      description: |
        Link pathways to ChEMBL drugs targeting pathway proteins for drug target validation.
        
        Linking strategy:
        - Reactome: Proteins with UniProt xrefs in human cancer pathways
        - ChEMBL: Drug targets with UniProt links, late-stage drugs (phase ≥3)
        - Integration: UniProt IRI conversion for joining databases
        - Pre-filtering: Organism + cancer keyword + development phase
      databases_used: [reactome, chembl]
      complexity: advanced
      sparql: |
        PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        
        SELECT DISTINCT ?pathwayName ?proteinName ?drugName ?phase
        WHERE {
          GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
            # Pre-filter: human cancer pathways
            ?pathway a bp:Pathway ;
                     bp:displayName ?pathwayName ;
                     bp:organism ?org ;
                     bp:pathwayComponent*/bp:left|bp:right ?protein .
            ?org bp:name "Homo sapiens"^^xsd:string .
            ?pathwayName bif:contains "'cancer'" option (score ?sc)
            
            ?protein a bp:Protein ;
                     bp:entityReference/bp:name ?proteinName ;
                     bp:entityReference/bp:xref ?protXref .
            ?protXref a bp:UnificationXref ;
                      bp:db "UniProt"^^xsd:string ;
                      bp:id ?uniprotIdStr .
          }
          
          # URI conversion: UniProt string to full IRI
          BIND(IRI(CONCAT("http://purl.uniprot.org/uniprot/", ?uniprotIdStr)) AS ?uniprotId)
          
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            # Pre-filter: human targets, late-stage drugs
            ?target a cco:SingleProtein ;
                    cco:organismName "Homo sapiens" ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprotId ;
                    cco:hasAssay/cco:hasActivity/cco:hasMolecule ?molecule .
            
            ?molecule a cco:SmallMolecule ;
                      rdfs:label ?drugName ;
                      cco:highestDevelopmentPhase ?phase .
            FILTER(?phase >= 3)
          }
        }
        ORDER BY DESC(?sc) DESC(?phase)
        LIMIT 20
      notes: |
        - Performance: ~4-6s (Tier 2) with aggressive pre-filtering
        - Triple pre-filtering: organism + cancer keyword + phase ≥3
        - URI conversion: UniProt string to IRI for ChEMBL join
        - bif:contains for pathway discovery, ^^xsd:string for exact matches

cross_references:
  - pattern: bp:xref with bp:db and bp:id
    description: |
      Unified cross-reference pattern using bp:xref with database name and identifier.
      CRITICAL: bp:db and bp:id require ^^xsd:string for exact value matching.
      Two xref types: UnificationXref (primary IDs), RelationshipXref (ontology terms, especially GO).
    databases:
      proteins:
        - "UniProt: 87K protein references (UnificationXref)"
        - "Ensembl: 2K gene mappings"
      pathways:
        - "GENE ONTOLOGY: 1.5K UnificationXref + 26.5K RelationshipXref"
        - "KEGG Pathway: pathway mappings"
      chemicals:
        - "ChEBI: 32K small molecule references"
        - "COMPOUND: 22K compound identifiers"
      publications:
        - "PubMed: 443K evidence citations (PublicationXref)"
      drugs:
        - "Guide to Pharmacology: 8K drug-target interactions"
    sparql: |
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      # Example: Find UniProt cross-references
      SELECT ?entity ?externalId
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        ?entity bp:xref ?xref .
        ?xref a bp:UnificationXref ;
              bp:db "UniProt"^^xsd:string ;
              bp:id ?externalId .
      }
      LIMIT 50

architectural_notes:
  query_strategy:
    - "CRITICAL RULE: ^^xsd:string required for exact value matching (direct patterns, VALUES, FILTER with =)"
    - "NO ^^xsd:string for: CONTAINS(), STRSTARTS(), REGEX(), bif:contains, retrieving values"
    - "Exploratory: Use search_reactome_entity() to find examples (~30 results)"
    - "Extract values: Organism names, GO term IDs, EC numbers from examples"
    - "Comprehensive: Use extracted values with ^^xsd:string for exact matching"
    - "Organism filtering: bp:name 'Homo sapiens'^^xsd:string"
    - "GO terms: Primarily in RelationshipXref (26.5K) vs UnificationXref (1.5K)"
    - "EC numbers: bp:eCNumber with ^^xsd:string for exact matches"
    - "Pathway hierarchy: Start from specific pathway IRI, use bp:pathwayComponent+ with LIMIT"
    - "Text search: bif:contains for discovery (no ^^xsd:string needed)"
    - "Priority: Specific IRIs/VALUES > Typed predicates > Graph navigation > Text search"
  
  schema_design:
    - "BioPAX Level 3 ontology provides standardized biological pathway representation"
    - "Hierarchical pathways via bp:pathwayComponent enable multi-level organization"
    - "Reactions link to proteins, complexes, small molecules via bp:left/bp:right"
    - "Entity references separate instances from canonical definitions"
    - "Two xref types: UnificationXref (identifiers), RelationshipXref (ontology terms)"
    - "String properties stored as xsd:string - exact matching requires type restriction"
  
  performance:
    - "Use ^^xsd:string for exact matching (fast with proper indexing)"
    - "Use specific GO/EC values instead of text search (more precise)"
    - "bif:contains for keyword searches (indexed text search)"
    - "Always specify FROM graph for multi-graph endpoints"
    - "Property path bp:pathwayComponent* requires LIMIT to prevent timeouts"
    - "Start from specific pathway IRIs when navigating hierarchy"
    - "Cross-database: GRAPH clauses + pre-filtering + URI conversion"
  
  data_integration:
    - "UniProt provides protein sequences and functional annotations"
    - "ChEBI offers small molecule structures via URI conversion"
    - "PubMed links to primary literature and evidence"
    - "GO terms map pathways to biological processes (primarily RelationshipXref)"
    - "ChEMBL integration for drug-target relationships (shared EBI endpoint)"
    - "Expected performance: Tier 1 (1-3s) for ChEBI, Tier 2 (3-8s) for ChEMBL"
  
  data_quality:
    - "All pathways manually curated with expert review"
    - "Evidence tracking via PublicationXref to PubMed"
    - "Quarterly updates ensure current biological knowledge"
    - "GO terms: Check both UnificationXref and RelationshipXref for completeness"

data_statistics:
  total_pathways: 23145
  verified_date: "2025-02-10"
  verification_method: "Direct COUNT query on bp:Pathway"
  verification_query: |
    PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
    SELECT (COUNT(DISTINCT ?p) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE { ?p a bp:Pathway }
  
  human_pathways: 2825
  human_pathways_verified_date: "2025-02-10"
  human_pathways_verification_query: |
    PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    SELECT (COUNT(DISTINCT ?p) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE {
      ?p a bp:Pathway ;
         bp:organism ?org .
      ?org bp:name "Homo sapiens"^^xsd:string .
    }
  
  total_reactions: 92977
  total_proteins: 233200
  total_complexes: 109261
  total_small_molecules: 51214
  total_species: 30
  
  reactions_with_ec_2_7_10_1: 290
  reactions_with_ec_verified_date: "2025-02-10"
  reactions_with_ec_verification_query: |
    PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    SELECT (COUNT(?r) as ?count)
    FROM <http://rdf.ebi.ac.uk/dataset/reactome>
    WHERE {
      ?r a bp:BiochemicalReaction ;
         bp:eCNumber "2.7.10.1"^^xsd:string .
    }
  
  go_unification_xrefs: 1525
  go_relationship_xrefs: 26532
  go_notes: "GO terms primarily stored as RelationshipXref. Always query both types for comprehensive coverage."
  
  coverage:
    pathways_with_organisms: ">95%"
    reactions_with_ec_numbers: "~60%"
    proteins_with_uniprot: "~90%"
    pathways_with_go_relationship_xrefs: "~85%"
    pathways_with_pubmed: "~85%"
  
  performance_characteristics:
    - "Exact value matching with ^^xsd:string: <1s"
    - "EC number filtering with ^^xsd:string: <2s"
    - "GO term RelationshipXref queries: <3s"
    - "Pathway hierarchy from specific IRI: <2s"
    - "Cross-database (ChEBI): 3-5s with pre-filtering"
    - "Cross-database (ChEMBL): 4-6s with organism + phase filter"
  
  staleness_warning: "Quarterly updates - verify current release for latest data"

anti_patterns:
  - title: Skipping MIE Schema Check Before Querying
    problem: "Using text search or wrong predicates without examining MIE shape_expressions first."
    wrong_sparql: |
      # ❌ WRONG: Immediately use text search without checking MIE schema
      SELECT ?pathway ?name
      WHERE {
        ?pathway a bp:Pathway .
        ?name bif:contains "'apoptosis'"
      }
    correct_sparql: |
      # ✅ CORRECT: Check MIE schema first, discover structured approach
      # 1. get_MIE_file("reactome") → examined shape_expressions
      # 2. Found: RelationshipXref with bp:db="GENE ONTOLOGY"^^xsd:string
      # 3. search_reactome_entity("apoptosis") → found examples
      # 4. Inspected examples → extracted GO term IDs: GO:0006915, etc.
      # 5. Use discovered GO terms for comprehensive query:
      PREFIX bp: <http://www.biopax.org/release/biopax-level3.owl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      SELECT ?pathway ?name
      FROM <http://rdf.ebi.ac.uk/dataset/reactome>
      WHERE {
        VALUES ?goTerm { "GO:0006915"^^xsd:string "GO:0097194"^^xsd:string }
        ?pathway a bp:Pathway ;
                 bp:displayName ?name ;
                 bp:xref ?xref .
        ?xref a bp:RelationshipXref ;
              bp:db "GENE ONTOLOGY"^^xsd:string ;
              bp:id ?goTerm .
      }
      LIMIT 50
    explanation: "Always check MIE schema for structured properties (GO terms, EC numbers, organism names) before defaulting to text search."
  
  - title: Missing ^^xsd:string for Exact Value Matching
    problem: "Exact matching in triple patterns, VALUES, or FILTER with = requires ^^xsd:string."
    wrong_sparql: |
      # ❌ WRONG: Returns nothing - missing ^^xsd:string
      ?org bp:name "Homo sapiens" .
      VALUES ?ec { "2.7.10.1" "2.7.11.1" }
      FILTER(?organism = "Homo sapiens")
    correct_sparql: |
      # ✅ CORRECT: Exact matching requires ^^xsd:string
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      
      ?org bp:name "Homo sapiens"^^xsd:string .
      VALUES ?ec { "2.7.10.1"^^xsd:string "2.7.11.1"^^xsd:string }
      FILTER(?organism = "Homo sapiens"^^xsd:string)
    explanation: "Reactome stores literals as xsd:string. Exact matching requires type restriction. String functions don't need it."
  
  - title: Circular Reasoning with Search Results
    problem: "Using search results in VALUES for comprehensive questions instead of extracting concept IRIs."
    wrong_sparql: |
      # ❌ WRONG: Circular reasoning
      # 1. search_reactome_entity("apoptosis") → returns 10 pathway IDs
      # 2. Query only those 10:
      VALUES ?pathway { <pathway1> <pathway2> ... <pathway10> }
      SELECT (COUNT(?pathway) as ?count) WHERE { ... }
      # → Only counted what you already found!
    correct_sparql: |
      # ✅ CORRECT: Extract concept IRIs, query complete dataset
      # 1. search_reactome_entity("apoptosis") → found example pathways
      # 2. Inspected examples → extracted GO term IRIs from xrefs
      # 3. Use discovered GO terms to query ALL matching pathways:
      VALUES ?goTerm { "GO:0006915"^^xsd:string "GO:0097194"^^xsd:string }
      SELECT (COUNT(DISTINCT ?pathway) as ?count)
      WHERE {
        ?pathway a bp:Pathway ;
                 bp:xref ?xref .
        ?xref a bp:RelationshipXref ;
              bp:id ?goTerm .
      }
    explanation: "Search finds examples to discover IRIs/values. Use those IRIs to query the entire dataset comprehensively."
  
  - title: Unbounded Property Path Without Starting Point
    problem: "Using bp:pathwayComponent* without specific starting pathway causes timeout."
    wrong_sparql: |
      # ❌ Times out: No starting point
      SELECT ?pathway ?subPathway
      WHERE {
        ?pathway bp:pathwayComponent* ?subPathway
      }
    correct_sparql: |
      # ✅ Fast: Start from specific pathway IRI
      SELECT ?subPathway ?name
      WHERE {
        <http://www.reactome.org/biopax/40/48887#Pathway227> 
          bp:pathwayComponent+ ?subPathway .
        ?subPathway a bp:Pathway ;
                    bp:displayName ?name .
      }
      LIMIT 100
    explanation: "Start from specific pathway URI (from search_reactome_entity), use + instead of *, add type filters, include LIMIT."

common_errors:
  - error: "Query returns empty results for exact matching"
    causes:
      - "Missing ^^xsd:string for exact value matching"
      - "Wrong xref type (checking UnificationXref when GO term is in RelationshipXref)"
      - "Incorrect predicate (e.g., using wrong path to cross-references)"
    solutions:
      - "Add ^^xsd:string to direct triple patterns, VALUES, and FILTER with ="
      - "Check both UnificationXref and RelationshipXref for GO terms"
      - "Verify predicates match MIE schema shape_expressions"
      - "For GO terms: Use RelationshipXref (26.5K) not just UnificationXref (1.5K)"
    example_fix: |
      # ❌ Before (returns nothing):
      ?org bp:name "Homo sapiens" .
      ?xref a bp:UnificationXref ;
            bp:db "GENE ONTOLOGY" ;
            bp:id "GO:0006915" .
      
      # ✅ After (works):
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      ?org bp:name "Homo sapiens"^^xsd:string .
      ?xref a bp:RelationshipXref ;    # Changed to RelationshipXref
            bp:db "GENE ONTOLOGY"^^xsd:string ;
            bp:id "GO:0006915"^^xsd:string .
  
  - error: "Incomplete comprehensive results"
    causes:
      - "Used VALUES with search results instead of concept IRIs"
      - "Checked only one xref type when both exist"
      - "Missing broader terms in hierarchy"
    solutions:
      - "Extract GO terms/EC numbers from examples, use those IRIs"
      - "Query both UnificationXref and RelationshipXref"
      - "Use hierarchical navigation (bp:pathwayComponent+) when appropriate"
    example_fix: |
      # ❌ Wrong approach:
      # search_reactome_entity() → got 10 IDs → query only those 10
      
      # ✅ Correct approach:
      # 1. search_reactome_entity("MAPK") → found example pathways
      # 2. Inspected examples → extracted GO term IDs
      # 3. Query ALL pathways with those GO terms:
      VALUES ?goTerm { "GO:0000165"^^xsd:string "GO:0051897"^^xsd:string }
      SELECT (COUNT(DISTINCT ?pathway) as ?count)
      WHERE {
        ?pathway bp:xref ?xref .
        ?xref bp:id ?goTerm .
      }
  
  - error: "Cross-database query timeout or empty results"
    causes:
      - "Missing ^^xsd:string in Reactome GRAPH"
      - "No pre-filtering before joining"
      - "Missing GRAPH clauses"
      - "Incorrect URI conversion"
    solutions:
      - "Add ^^xsd:string for exact matches in Reactome GRAPH"
      - "Apply organism + keyword filters within source GRAPH"
      - "Use BIND(IRI(CONCAT(...))) for URI conversion"
      - "Add LIMIT to every query level"
    example_fix: |
      # ❌ Before:
      GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
        ?pathway bp:organism ?org .
        ?org bp:name "Homo sapiens" .  # Missing ^^xsd:string
      }
      
      # ✅ After:
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      GRAPH <http://rdf.ebi.ac.uk/dataset/reactome> {
        ?pathway bp:organism ?org ;
                 bp:displayName ?pathwayName .
        ?org bp:name "Homo sapiens"^^xsd:string .
        FILTER(CONTAINS(?pathwayName, "cancer"))  # Pre-filter
      }
