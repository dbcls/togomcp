schema_info:
  title: MediaDive - Microbial Culture Media Database
  description: |
    Comprehensive culture media database from DSMZ with 3,289 standardized recipes for bacteria, archaea, 
    fungi, yeast, microalgae, and phages. Includes 1,489 ingredients with chemical cross-references 
    (GMO 58%, CAS 59%, ChEBI 46%), 45,685 strain records (73% with BacDive links), and growth conditions 
    (pH, temperature, oxygen). Hierarchical recipe structure: medium → solution → solution_recipe → ingredient 
    with detailed preparation protocols.
  endpoint: https://rdfportal.org/primary/sparql
  base_uri: https://purl.dsmz.de/mediadive/
  graphs:
    - http://rdfportal.org/dataset/mediadive
  kw_search_tools:
    - sparql
  version:
    mie_version: "2.0"
    mie_created: "2025-02-10"
    data_version: "Current"
    update_frequency: "Regular"
  license:
    data_license: "CC BY 4.0"
    license_url: "https://www.dsmz.de"
  access:
    rate_limiting: "Reasonable use"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX schema: <https://purl.dsmz.de/schema/>
  PREFIX dct: <http://purl.org/dc/terms/>
  
  <MediumShape> {
    a [ schema:CultureMedium ] ;
    rdfs:label xsd:string ;
    schema:belongsToGroup xsd:string ;
    schema:hasFinalPH xsd:string ? ;
    schema:hasMinPH xsd:float ? ;
    schema:hasMaxPH xsd:float ? ;
    schema:isComplex xsd:boolean
  }
  
  <IngredientShape> {
    a [ schema:Ingredient ] ;
    rdfs:label xsd:string ;
    schema:hasFormula xsd:string ? ;
    schema:hasCAS xsd:string ? ;
    schema:hasChEBI xsd:integer ? ;
    schema:hasPubChem xsd:integer ? ;
    schema:hasKEGG xsd:string ? ;
    schema:hasGMO IRI ?
  }
  
  <MediumCompositionShape> {
    a [ schema:MediumComposition ] ;
    schema:partOfMedium @<MediumShape> ;
    schema:containsIngredient @<IngredientShape> ;
    schema:gramsPerLiter xsd:float ? ;
    schema:isOptionalIngredient xsd:boolean
  }
  
  <GrowthShape> {
    a [ schema:GrowthCondition ] ;
    schema:partOfMedium @<MediumShape> ;
    schema:relatedToStrain @<StrainShape> ;
    schema:growthTemperature xsd:integer ;
    schema:growthPH xsd:float ? ;
    schema:hasOxygenRequirement xsd:string ?
  }
  
  <StrainShape> {
    a [ schema:Strain ] ;
    schema:hasDSMNumber xsd:integer ;
    schema:hasBacDiveID xsd:integer ? ;
    schema:hasSpecies xsd:string ;
    schema:belongsTaxGroup xsd:string
  }

sample_rdf_entries:
  - title: Culture Medium
    description: Complete medium with pH and classification.
    rdf: |
      mediadive:medium/1118 a schema:CultureMedium ;
        rdfs:label "MD1-MEDIUM" ;
        schema:belongsToGroup "MD1-MEDIUM" ;
        schema:hasFinalPH "7.0-7.2" ;
        schema:isComplex true .
  
  - title: Ingredient with Cross-References
    description: Chemical ingredient with multiple database identifiers.
    rdf: |
      mediadive:ingredient/234 a schema:Ingredient ;
        rdfs:label "Glucose" ;
        schema:hasFormula "C6H12O6" ;
        schema:hasCAS "50-99-7" ;
        schema:hasChEBI 17234 ;
        schema:hasPubChem 5793 ;
        schema:hasKEGG "C00031" .
  
  - title: Growth Conditions
    description: Strain cultivation parameters with biological annotations.
    rdf: |
      mediadive:growth/5678 a schema:GrowthCondition ;
        schema:partOfMedium mediadive:medium/1118 ;
        schema:relatedToStrain mediadive:strain/12345 ;
        schema:growthTemperature 37 ;
        schema:growthPH 7.2 ;
        schema:hasOxygenRequirement "aerobic" .
  
  - title: Solution Recipe
    description: Ingredient amounts in solution.
    rdf: |
      mediadive:solution_recipe/890 a schema:SolutionRecipe ;
        schema:partOfSolution mediadive:solution/sol123 ;
        schema:includesIngredient mediadive:ingredient/234 ;
        schema:ingredientAmount 10.0 ;
        schema:ingredientUnit "g" ;
        schema:gramsPerLiter 10.0 .
  
  - title: Microbial Strain
    description: Strain with taxonomic data and BacDive link.
    rdf: |
      mediadive:strain/12345 a schema:Strain ;
        schema:hasDSMNumber 12345 ;
        schema:hasBacDiveID 167744 ;
        schema:hasSpecies "Desulfotomaculum antarcticum" ;
        schema:belongsTaxGroup "Bacteria" .

sparql_query_examples:
  - title: Find Rich Media by Essential Nutrient Combination (Multiple Ingredient IRIs)
    description: |
      Use VALUES with multiple specific ingredient IRIs to find rich media containing key nutrients.
      This pattern demonstrates how to search for media with specific nutrient combinations without
      text search. Common use case: finding media suitable for heterotrophic cultivation.
    question: Which media contain both yeast extract (organic nitrogen) and glucose (carbon source)?
    complexity: basic
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      # Use specific ingredient IRIs in VALUES for exact nutrient matching
      SELECT DISTINCT ?medium ?label
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        # Yeast extract (ingredient/16) - organic nitrogen source
        ?comp1 schema:partOfMedium ?medium ;
               schema:containsIngredient <https://purl.dsmz.de/mediadive/ingredient/16> .
        # Glucose (ingredient/5) - carbon source  
        ?comp2 schema:partOfMedium ?medium ;
               schema:containsIngredient <https://purl.dsmz.de/mediadive/ingredient/5> .
        ?medium rdfs:label ?label .
      }
      ORDER BY ?label
      LIMIT 30
  
  - title: Media for Specific Taxonomic Groups (Typed String Values)
    description: |
      Filter strains by taxonomic group using typed string matching, then retrieve compatible media.
      Demonstrates combining typed predicates (belongsTaxGroup) with graph navigation through
      growth conditions. No text search needed - taxonomic groups are controlled values.
    question: Which media are validated for fungal cultivation?
    complexity: basic
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      # Use typed predicate with controlled taxonomic value (not text search)
      SELECT DISTINCT ?medium ?label (COUNT(DISTINCT ?strain) as ?strainCount)
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?strain a schema:Strain ;
                schema:belongsTaxGroup "Fungus" .
        ?growth schema:relatedToStrain ?strain ;
                schema:partOfMedium ?medium .
        ?medium rdfs:label ?label .
      }
      GROUP BY ?medium ?label
      ORDER BY DESC(?strainCount)
      LIMIT 20
  
  - title: Media Using Specific Trace Element Solutions (Solution IRIs)
    description: |
      Query for media using specific standardized trace element solutions by IRI. This pattern
      demonstrates hierarchical navigation: medium → solution, avoiding text search on solution names.
      Use case: finding media with standardized micronutrient formulations for reproducibility.
    question: Which media use the standard SL-10 trace element solution?
    complexity: intermediate
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      # Use specific solution IRI for exact match (SL-10 is solution/2423)
      SELECT ?medium ?medLabel ?solution ?solLabel
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?medium a schema:CultureMedium ;
                rdfs:label ?medLabel ;
                schema:includesSolution <https://purl.dsmz.de/mediadive/solution/2423> .
        # Also retrieve solution label for display
        <https://purl.dsmz.de/mediadive/solution/2423> rdfs:label ?solLabel .
        BIND(<https://purl.dsmz.de/mediadive/solution/2423> as ?solution)
      }
      ORDER BY ?medLabel
      LIMIT 30
  
  - title: Cultivation Conditions for Specific DSMZ Strain (Strain IRI)
    description: |
      Retrieve complete cultivation protocol for a specific strain using its IRI. Demonstrates
      direct IRI lookup with graph navigation to medium, ingredients, and growth parameters.
      Fast query pattern for known strain numbers.
    question: What are the complete cultivation conditions for DSM strain 1 (Weizmannia coagulans)?
    complexity: intermediate
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      # Use specific strain IRI for direct lookup (DSM 1 = strain/1)
      SELECT ?medium ?medLabel ?temp ?ph ?oxygen ?ingredient ?gPerL
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        # Navigate from specific strain IRI to growth conditions
        ?growth schema:relatedToStrain <https://purl.dsmz.de/mediadive/strain/1> ;
                schema:partOfMedium ?medium ;
                schema:growthTemperature ?temp .
        OPTIONAL { ?growth schema:growthPH ?ph }
        OPTIONAL { ?growth schema:hasOxygenRequirement ?oxygen }
        ?medium rdfs:label ?medLabel .
        
        # Get medium composition
        OPTIONAL {
          ?comp schema:partOfMedium ?medium ;
                schema:containsIngredient ?ingredient ;
                schema:gramsPerLiter ?gPerL .
          ?ingredient rdfs:label ?ingredientLabel .
        }
      }
      ORDER BY DESC(?gPerL)
      LIMIT 50
  
  - title: Chemically Defined vs Complex Media (Boolean Predicate)
    description: |
      Filter media by complexity using typed boolean predicate (isComplex). Chemically defined
      media (isComplex=false) have known exact composition, critical for metabolic studies.
      Demonstrates using structured boolean values instead of text search.
    question: Which chemically defined media are available for precise metabolic studies?
    complexity: intermediate
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      # Use typed boolean predicate (not text search on "defined")
      SELECT ?medium ?label ?ph (COUNT(DISTINCT ?ingredient) as ?ingredientCount)
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?medium a schema:CultureMedium ;
                rdfs:label ?label ;
                schema:isComplex false .  # Chemically defined = not complex
        OPTIONAL { ?medium schema:hasFinalPH ?ph }
        OPTIONAL {
          ?comp schema:partOfMedium ?medium ;
                schema:containsIngredient ?ingredient .
        }
      }
      GROUP BY ?medium ?label ?ph
      ORDER BY DESC(?ingredientCount)
      LIMIT 30
  
  - title: Find Media with Similar Formulations (Multiple Specific IRIs)
    description: |
      Identify media sharing core ingredient combinations using VALUES with multiple IRIs.
      This pattern enables finding alternative or similar media based on chemical composition.
      Use case: finding substitute media when primary medium is unavailable.
    question: Which media contain the common mineral base (NaCl, MgSO4, CaCl2, KH2PO4)?
    complexity: advanced
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      # Use VALUES with specific IRIs for core minerals
      SELECT DISTINCT ?medium ?label (COUNT(DISTINCT ?ingredient) as ?matchingIngredients)
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        VALUES ?ingredient {
          <https://purl.dsmz.de/mediadive/ingredient/43>   # NaCl
          <https://purl.dsmz.de/mediadive/ingredient/8>    # MgSO4 x 7 H2O
          <https://purl.dsmz.de/mediadive/ingredient/7>    # CaCl2 x 2 H2O
          <https://purl.dsmz.de/mediadive/ingredient/11>   # KH2PO4
        }
        ?comp schema:partOfMedium ?medium ;
              schema:containsIngredient ?ingredient .
        ?medium rdfs:label ?label .
      }
      GROUP BY ?medium ?label
      HAVING (COUNT(DISTINCT ?ingredient) >= 3)  # At least 3 of 4 minerals
      ORDER BY DESC(?matchingIngredients) ?label
      LIMIT 30
  
  - title: Anaerobic Media with Specific Oxygen Scavengers (Combined IRI + Typed Predicate)
    description: |
      Combine oxygen requirement predicate with specific reducing agent IRIs to find validated
      anaerobic media. Demonstrates combining typed predicates (hasOxygenRequirement) with
      ingredient IRIs for comprehensive anaerobic cultivation queries. Text search justified
      only for oxygenRequirement field (unstructured phenotype text).
    question: Which anaerobic media contain cysteine or thioglycolate as oxygen scavengers?
    complexity: advanced
    sparql: |
      PREFIX schema: <https://purl.dsmz.de/schema/>
      
      SELECT DISTINCT ?medium ?medLabel ?oxygen ?reducer ?gPerL
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        # Use typed predicate for oxygen requirement
        ?growth schema:partOfMedium ?medium ;
                schema:hasOxygenRequirement ?oxygen .
        # Text search justified: oxygen requirement is free text phenotype
        FILTER(CONTAINS(LCASE(?oxygen), "anaero"))
        
        ?medium rdfs:label ?medLabel .
        
        # Find specific reducing agent ingredients by IRI pattern
        ?comp schema:partOfMedium ?medium ;
              schema:containsIngredient ?reducer ;
              schema:gramsPerLiter ?gPerL .
        ?reducer rdfs:label ?reducerLabel .
        # Text search justified here: ingredient names vary ("L-Cysteine", "Cysteine-HCl", etc.)
        FILTER(CONTAINS(LCASE(?reducerLabel), "cysteine") || 
               CONTAINS(LCASE(?reducerLabel), "thioglycol"))
      }
      ORDER BY ?medLabel DESC(?gPerL)
      LIMIT 30

cross_database_queries:
  shared_endpoint: primary
  co_located_databases: [bacdive, taxonomy, mesh, go, mondo, nando]
  mie_files_consulted:
    - bacdive (for graph URI, strain schema, BacDiveID linking, genus filters, oxygen phenotypes)
    - taxonomy (for verification of cross-reference patterns)
  examples:
    - title: Detailed Culture Recipes from BacDive Strains
      description: |
        Link BacDive bacterial strain records to MediaDive culture media recipes using shared BacDive IDs 
        (schema:hasBacDiveID). This enables researchers to retrieve complete media composition including 
        ingredient concentrations, chemical identifiers (ChEBI, CAS, GMO), and preparation protocols for 
        specific strains.
        
        Query Strategy: Uses specific IRI pattern (Strategy 1: GRAPH clauses) and pre-filtering 
        (Strategy 2: genus filter) to reduce 97K BacDive strains to ~5K before cross-database join, 
        achieving 95% reduction and sub-3s query time.
      databases_used: [bacdive, mediadive]
      complexity: intermediate
      sparql: |
        PREFIX schema: <https://purl.dsmz.de/schema/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        SELECT ?strainLabel ?mediumLabel ?ingredientLabel ?gPerL ?chebi
        WHERE {
          # Strategy 1: Explicit GRAPH clauses for each database
          GRAPH <http://rdfportal.org/dataset/bacdive> {
            ?bacDiveStrain a schema:Strain ;
                           rdfs:label ?strainLabel ;
                           schema:hasBacDiveID ?bacDiveID ;
                           # Strategy 2: Pre-filter by genus (95% reduction)
                           schema:hasGenus "Bacillus" .
          }
          GRAPH <http://rdfportal.org/dataset/mediadive> {
            # Direct integer matching on BacDiveID (no URI conversion)
            ?mediaDiveStrain a schema:Strain ;
                             schema:hasBacDiveID ?bacDiveID .
            ?growth a schema:GrowthCondition ;
                    schema:relatedToStrain ?mediaDiveStrain ;
                    schema:partOfMedium ?medium .
            ?medium rdfs:label ?mediumLabel .
            
            ?composition a schema:MediumComposition ;
                         schema:partOfMedium ?medium ;
                         schema:containsIngredient ?ingredient ;
                         schema:gramsPerLiter ?gPerL .
            ?ingredient rdfs:label ?ingredientLabel .
            # Strategy 7: OPTIONAL after required patterns
            OPTIONAL { ?ingredient schema:hasChEBI ?chebi }
          }
        }
        ORDER BY ?strainLabel ?mediumLabel DESC(?gPerL)
        # Strategy 10: Always LIMIT cross-database queries
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH clauses), 2 (genus pre-filter), 7 (OPTIONAL ordering), 10 (LIMIT)
        - Performance: ~2-3s (Tier 1) with genus filter
        - Performance gain: Genus filter reduces 97K strains to ~5K before join (95% reduction)
        - Coverage: ~34% of BacDive strains (33,226 MediaDive records / 97,334 BacDive strains)
        - Use case: Reproduce exact culture conditions for strain isolation studies
        - Direct integer matching on schema:hasBacDiveID (no URI conversion needed)
    
    - title: Thermophilic Bacteria with Growth Conditions
      description: |
        Integrate BacDive's taxonomic data with MediaDive's growth conditions to identify thermophilic 
        bacteria and their optimal cultivation parameters. Uses text search on species names (justified 
        because species is free text) combined with structured temperature data from MediaDive.
        
        Query Strategy: Combines text search (unavoidable for species names) with typed predicates 
        (growthTemperature) and pre-filtering to achieve efficient cross-database integration.
      databases_used: [bacdive, mediadive]
      complexity: intermediate
      sparql: |
        PREFIX schema: <https://purl.dsmz.de/schema/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        SELECT ?strainLabel ?species ?mediumLabel ?temp ?ph
        WHERE {
          # Strategy 1: Explicit GRAPH clauses
          GRAPH <http://rdfportal.org/dataset/bacdive> {
            ?bacDiveStrain a schema:Strain ;
                           rdfs:label ?strainLabel ;
                           schema:hasBacDiveID ?bacDiveID ;
                           schema:hasSpecies ?species .
            # Strategy 2: Pre-filter by species keyword (99.8% reduction)
            # Text search justified: species is unstructured free text
            FILTER(CONTAINS(LCASE(?species), "thermophil"))
          }
          GRAPH <http://rdfportal.org/dataset/mediadive> {
            ?mediaDiveStrain a schema:Strain ;
                             schema:hasBacDiveID ?bacDiveID .
            ?growth a schema:GrowthCondition ;
                    schema:relatedToStrain ?mediaDiveStrain ;
                    schema:partOfMedium ?medium ;
                    # Use typed predicate for temperature
                    schema:growthTemperature ?temp .
            # Strategy 7: OPTIONAL after required patterns
            OPTIONAL { ?growth schema:growthPH ?ph }
            ?medium rdfs:label ?mediumLabel .
          }
        }
        ORDER BY DESC(?temp)
        # Strategy 10: Always LIMIT
        LIMIT 30
      notes: |
        - Optimization strategies applied: 1 (GRAPH clauses), 2 (species text filter), 7 (OPTIONAL ordering), 10 (LIMIT)
        - Performance: ~2-4s (Tier 1) with species keyword filter
        - Performance gain: Species filter reduces ~97K strains to ~200 thermophiles (99.8% reduction)
        - Use case: Comparative study of thermophile cultivation requirements
        - Text search on species is justified (unstructured free text field)
        - MediaDive provides quantitative parameters (typed predicates: temperature, pH)
    
    - title: Anaerobic Strain Culture Media with Ingredients
      description: |
        Combine BacDive's oxygen tolerance phenotypes with MediaDive's detailed culture media recipes 
        to identify anaerobic bacteria and their specialized media formulations. Demonstrates integration 
        of biological phenotypes with chemical composition data.
        
        Query Strategy: Uses structured phenotype data from BacDive (OxygenTolerance class with 
        hasOxygenTolerance predicate) combined with MediaDive's hierarchical recipe structure.
      databases_used: [bacdive, mediadive]
      complexity: advanced
      sparql: |
        PREFIX schema: <https://purl.dsmz.de/schema/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        
        SELECT ?strainLabel ?oxygenTolerance ?mediumLabel ?ingredientLabel ?gPerL
        WHERE {
          # Strategy 1: Explicit GRAPH clauses
          GRAPH <http://rdfportal.org/dataset/bacdive> {
            ?bacDiveStrain a schema:Strain ;
                           rdfs:label ?strainLabel ;
                           schema:hasBacDiveID ?bacDiveID .
            # Navigate BacDive graph structure
            ?oxy a schema:OxygenTolerance ;
                 schema:describesStrain ?bacDiveStrain ;
                 schema:hasOxygenTolerance ?oxygenTolerance .
            # Strategy 2: Pre-filter by oxygen phenotype (64% reduction)
            # Text search justified: oxygenTolerance is free text phenotype
            FILTER(CONTAINS(LCASE(?oxygenTolerance), "anaero"))
          }
          GRAPH <http://rdfportal.org/dataset/mediadive> {
            ?mediaDiveStrain a schema:Strain ;
                             schema:hasBacDiveID ?bacDiveID .
            # Navigate MediaDive graph structure
            ?growth a schema:GrowthCondition ;
                    schema:relatedToStrain ?mediaDiveStrain ;
                    schema:partOfMedium ?medium .
            ?medium rdfs:label ?mediumLabel .
            
            ?composition a schema:MediumComposition ;
                         schema:partOfMedium ?medium ;
                         schema:containsIngredient ?ingredient ;
                         schema:gramsPerLiter ?gPerL .
            ?ingredient rdfs:label ?ingredientLabel .
          }
        }
        ORDER BY ?strainLabel ?mediumLabel DESC(?gPerL)
        # Strategy 10: Always LIMIT
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH clauses), 2 (oxygen phenotype filter), 7 (pattern ordering), 10 (LIMIT)
        - Performance: ~5-8s (Tier 2) due to phenotype joins and composition data
        - Performance gain: Oxygen filter reduces ~97K strains to ~35K anaerobes (64% reduction)
        - Use case: Design anaerobic culture protocols based on successful strain isolations
        - Links BacDive phenotypes (oxygen tolerance ~40% coverage) with MediaDive recipes
        - Text search on oxygenTolerance is justified (unstructured phenotype field)

cross_references:
  - pattern: schema:has[Database] properties
    description: |
      Ingredients link to chemical databases via dedicated typed predicates. Use these specific properties 
      instead of text search on identifiers. Coverage varies by database, use OPTIONAL with FILTER for 
      requiring at least one.
    databases:
      chemical_identifiers:
        - "GMO (58%)"
        - "CAS (59%)"
      metabolic:
        - "ChEBI (46%)"
        - "PubChem (18%)"
        - "KEGG (13%)"
        - "MetaCyc (7%)"
      regional:
        - "ZVG (15%)"
    sparql: |
      SELECT ?ingredient ?cas ?chebi ?kegg ?gmo
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?ingredient a schema:Ingredient .
        OPTIONAL { ?ingredient schema:hasCAS ?cas }
        OPTIONAL { ?ingredient schema:hasChEBI ?chebi }
        OPTIONAL { ?ingredient schema:hasKEGG ?kegg }
        OPTIONAL { ?ingredient schema:hasGMO ?gmo }
        FILTER(BOUND(?cas) || BOUND(?chebi))
      } LIMIT 50
  
  - pattern: schema:hasBacDiveID
    description: |
      Strains link to BacDive for phenotypic data via integer BacDiveID. Direct integer matching, 
      no URI conversion needed. 73% coverage enables rich cross-database integration.
    databases:
      microbial:
        - "BacDive (73% of 45,685 strains)"
    sparql: |
      SELECT ?strain ?dsmNumber ?bacDiveID ?species
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?strain a schema:Strain ;
                schema:hasDSMNumber ?dsmNumber ;
                schema:hasBacDiveID ?bacDiveID ;
                schema:hasSpecies ?species .
      } LIMIT 30
  
  - pattern: schema:hasLinkToSource
    description: |
      Media link to DSMZ PDF documentation for complete protocol details. 99% coverage provides 
      authoritative preparation instructions.
    databases:
      documentation:
        - "DSMZ PDFs (99% of 3,289 media)"
    sparql: |
      SELECT ?medium ?label ?pdfLink
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?medium a schema:CultureMedium ;
                rdfs:label ?label ;
                schema:hasLinkToSource ?pdfLink .
      } LIMIT 30

architectural_notes:
  query_strategy:
    - "PRIORITY HIERARCHY: Specific IRIs > Typed predicates > Graph navigation > Text search"
    - "Specific IRIs: Use VALUES with medium/ingredient/strain/solution IRIs for direct lookup (fastest)"
    - "Common IRI patterns: ingredient/16 (yeast extract), ingredient/5 (glucose), solution/2423 (SL-10), strain/1 (DSM 1)"
    - "Typed predicates: Use schema:hasChEBI, schema:growthTemperature, schema:isComplex, schema:belongsTaxGroup"
    - "Graph navigation: Follow schema:partOfMedium, schema:relatedToStrain, schema:includesSolution paths"
    - "Text search: bif:contains (Virtuoso indexed) ONLY for truly unstructured fields (rdfs:label, species names, phenotypes)"
    - "NEVER use FILTER(CONTAINS()) when bif:contains is available (Virtuoso backend)"
    - "Cross-database: Strategy 1 (GRAPH clauses) + Strategy 2 (pre-filtering) mandatory for BacDive integration"
    - "Pre-filtering reduces search space by 64-99% before cross-database joins"
  
  schema_design:
    - "Medium as central hub: compositions, solutions, growth conditions, steps"
    - "Hierarchical recipe: medium → solution → solution_recipe → ingredient"
    - "Strain-medium linkage via GrowthCondition enables cultivation compatibility queries"
    - "Typed predicates for all structured data: temperature (integer), pH (float), database IDs (integer/string)"
    - "Cross-references use dedicated properties (hasChEBI, hasKEGG) not generic predicates"
    - "Taxonomic groups are controlled values: Bacterium, Fungus, Yeast, Microalgae, Archaeon, etc."
  
  performance:
    - "Specific IRI queries: <100ms (immediate)"
    - "Typed predicate filtering (pH, temperature, isComplex): <1s"
    - "Multiple ingredient IRI matching (VALUES): 1-2s"
    - "Composition queries: MUST filter by medium IRI first (72K+ compositions total)"
    - "Keyword search with bif:contains: 1-2s"
    - "Cross-database with pre-filtering: 2-4s (Tier 1) with genus/species, 5-8s (Tier 2) with phenotypes"
    - "Always use LIMIT (30-50) for unbounded queries"
  
  data_integration:
    - "Shared 'primary' endpoint with bacdive, taxonomy, mesh, go, mondo, nando"
    - "Primary integration: MediaDive-BacDive via integer BacDiveID (73% coverage, 34% of BacDive strains)"
    - "BacDiveID enables: phenotype integration, taxonomic context, strain characterization"
    - "Cross-database optimization: Pre-filter within GRAPH blocks (genus 95% reduction, species 99.8% reduction, phenotype 64% reduction)"
    - "Direct integer matching on BacDiveID (no URI conversion overhead)"
    - "Ingredient cross-references enable metabolic pathway integration (ChEBI, KEGG, GMO)"
  
  data_quality:
    - "pH data: Both string ranges (hasFinalPH) and numeric min/max for different use cases"
    - "Cross-reference coverage: GMO highest (58%), use OPTIONAL with FILTER(BOUND()) for flexible queries"
    - "BacDive integration: 33,226 MediaDive strains (~34% of 97,334 BacDive strains with IDs 1-170,041)"
    - "Growth conditions: Temperature always present, pH/oxygen optional (~70-80% coverage)"
    - "Use isOptionalIngredient flag for recipe flexibility"
    - "Taxonomic groups: 12 controlled values with Bacterium (32,662) and Fungus (5,079) most common"

data_statistics:
  total_media: 3289
  verified_date: "2025-02-10"
  verification_query: |
    SELECT (COUNT(DISTINCT ?medium) as ?count)
    FROM <http://rdfportal.org/dataset/mediadive>
    WHERE { ?medium a schema:CultureMedium }
  
  total_ingredients: 1489
  verification_query_ingredients: |
    SELECT (COUNT(DISTINCT ?ingredient) as ?count)
    FROM <http://rdfportal.org/dataset/mediadive>
    WHERE { ?ingredient a schema:Ingredient }
  
  total_strains: 45685
  verification_query_strains: |
    SELECT (COUNT(DISTINCT ?strain) as ?count)
    FROM <http://rdfportal.org/dataset/mediadive>
    WHERE { ?strain a schema:Strain }
  
  coverage:
    ingredients_gmo: "58%"
    calculation_gmo: "870 ingredients with GMO / 1489 total"
    ingredients_cas: "59%"
    calculation_cas: "872 ingredients with CAS / 1489 total"
    ingredients_chebi: "46%"
    calculation_chebi: "687 ingredients with ChEBI / 1489 total"
    strains_bacdive: "73%"
    calculation_bacdive: "33,226 strains with BacDiveID / 45,685 total"
    media_pdf_links: "99%"
    verified_date: "2025-02-10"
    verification_query: |
      SELECT 
        (COUNT(DISTINCT ?ingredient) as ?total)
        (COUNT(DISTINCT ?withGMO) as ?withGMO)
        (COUNT(DISTINCT ?withCAS) as ?withCAS)
        (COUNT(DISTINCT ?withChEBI) as ?withChEBI)
      FROM <http://rdfportal.org/dataset/mediadive>
      WHERE {
        ?ingredient a schema:Ingredient .
        OPTIONAL { ?ingredient schema:hasGMO ?gmo . BIND(?ingredient as ?withGMO) }
        OPTIONAL { ?ingredient schema:hasCAS ?cas . BIND(?ingredient as ?withCAS) }
        OPTIONAL { ?ingredient schema:hasChEBI ?chebi . BIND(?ingredient as ?withChEBI) }
      }
  
  cardinality:
    total_compositions: 72184
    avg_compositions_per_medium: 21.9
    total_solution_recipes: 40471
    avg_solution_recipes_per_solution: 7.2
    total_growth_conditions: 68001
    common_ingredients:
      - "Yeast extract (ingredient/16): 1,824 media"
      - "Glucose (ingredient/5): high usage"
      - "NaCl (ingredient/43): 1,712 media"
    taxonomic_distribution:
      - "Bacterium: 32,662 strains"
      - "Fungus: 5,079 strains"
      - "Yeast: 3,125 strains"
      - "Microalgae: 1,289 strains"

anti_patterns:
  - title: Text Search When Specific IRI Available
    problem: Using text search on labels when specific ingredient/solution/strain IRIs exist.
    wrong_sparql: |
      # Slow and ambiguous: Text search for glucose
      SELECT ?medium ?label
      WHERE {
        ?comp schema:partOfMedium ?medium ;
              schema:containsIngredient ?ing .
        ?ing rdfs:label ?ingLabel .
        FILTER(CONTAINS(LCASE(?ingLabel), "glucose"))
        ?medium rdfs:label ?label .
      }
    correct_sparql: |
      # Fast and precise: Use specific glucose IRI
      SELECT ?medium ?label
      WHERE {
        ?comp schema:partOfMedium ?medium ;
              schema:containsIngredient <https://purl.dsmz.de/mediadive/ingredient/5> .
        ?medium rdfs:label ?label .
      }
    explanation: |
      MediaDive has stable IRIs for all ingredients (1,489), solutions (5,613), and strains (45,685).
      Use specific IRIs from VALUES or direct <IRI> references instead of text search on labels.
      Common IRIs: ingredient/16 (yeast extract), ingredient/5 (glucose), solution/2423 (SL-10).
  
  - title: FILTER(CONTAINS()) Instead of bif:contains
    problem: Using unindexed FILTER(CONTAINS()) when indexed bif:contains is available on Virtuoso.
    wrong_sparql: |
      # Slow: Unindexed text search
      SELECT ?medium ?label
      WHERE {
        ?medium a schema:CultureMedium ;
                rdfs:label ?label .
        FILTER(CONTAINS(LCASE(?label), "marine"))
      }
    correct_sparql: |
      # Fast: Indexed text search (Virtuoso)
      SELECT ?medium ?label
      WHERE {
        ?medium a schema:CultureMedium ;
                rdfs:label ?label .
        ?label bif:contains "'marine'"
      }
    explanation: |
      MediaDive runs on Virtuoso which provides bif:contains for indexed full-text search. 
      Use bif:contains for 10-100x speedup over FILTER(CONTAINS()) on text fields.
      Only use text search when no specific IRI or typed predicate exists.
  
  - title: Text Search for Taxonomic Groups
    problem: Using text search when taxonomic groups are controlled values with typed predicates.
    wrong_sparql: |
      # Inefficient: Text search on species
      SELECT ?strain ?species
      WHERE {
        ?strain schema:hasSpecies ?species .
        FILTER(CONTAINS(LCASE(?species), "fung"))
      }
    correct_sparql: |
      # Efficient: Use typed predicate with controlled value
      SELECT ?strain ?species
      WHERE {
        ?strain schema:belongsTaxGroup "Fungus" ;
                schema:hasSpecies ?species .
      }
    explanation: |
      Taxonomic groups (Bacterium, Fungus, Yeast, Microalgae, Archaeon, etc.) are controlled
      values in schema:belongsTaxGroup. Use this typed predicate instead of text search.
  
  - title: Missing OPTIONAL for Partial Coverage Cross-References
    problem: Requiring all cross-references filters out most ingredients due to partial coverage.
    wrong_sparql: |
      # Returns almost nothing (only ingredients with ALL identifiers)
      SELECT ?ingredient ?chebi ?kegg ?pubchem
      WHERE {
        ?ingredient a schema:Ingredient ;
                    schema:hasChEBI ?chebi ;
                    schema:hasKEGG ?kegg ;
                    schema:hasPubChem ?pubchem .
      }
    correct_sparql: |
      # Returns ingredients with at least ChEBI OR KEGG
      SELECT ?ingredient ?chebi ?kegg ?pubchem
      WHERE {
        ?ingredient a schema:Ingredient .
        OPTIONAL { ?ingredient schema:hasChEBI ?chebi }
        OPTIONAL { ?ingredient schema:hasKEGG ?kegg }
        OPTIONAL { ?ingredient schema:hasPubChem ?pubchem }
        FILTER(BOUND(?chebi) || BOUND(?kegg))
      }
    explanation: |
      Cross-reference coverage varies (ChEBI 46%, KEGG 13%, PubChem 18%). Use OPTIONAL for each 
      database property, then FILTER for at least one. Strategy 7: Place OPTIONAL blocks after 
      required patterns for efficiency.
  
  - title: Unbounded Composition Queries
    problem: Querying 72K+ compositions without medium filter causes timeout.
    wrong_sparql: |
      # Timeout: Processes all 72K+ compositions
      SELECT ?composition ?medium ?ingredient ?gPerL
      WHERE {
        ?composition schema:partOfMedium ?medium ;
                     schema:containsIngredient ?ingredient ;
                     schema:gramsPerLiter ?gPerL .
      }
    correct_sparql: |
      # Fast: Pre-filter by specific medium IRI or VALUES
      SELECT ?composition ?medium ?ingredient ?gPerL
      WHERE {
        VALUES ?medium {
          <https://purl.dsmz.de/mediadive/medium/1118>
          <https://purl.dsmz.de/mediadive/medium/1217>
        }
        ?composition schema:partOfMedium ?medium ;
                     schema:containsIngredient ?ingredient ;
                     schema:gramsPerLiter ?gPerL .
      }
      LIMIT 50
    explanation: |
      Strategy 2 (pre-filtering): Always filter by specific medium IRI(s) in VALUES before joining 
      composition data. Reduces search space from 72K to ~22 compositions (avg 21.9 per medium). 
      Strategy 10: Always LIMIT.

common_errors:
  - error: Not using available IRIs
    causes:
      - Defaulting to text search without checking for specific IRIs
      - Not aware of common ingredient/solution/strain IRI patterns
    solutions:
      - "Check for common ingredients: ingredient/16 (yeast extract), ingredient/5 (glucose), ingredient/43 (NaCl)"
      - "Check for solutions: solution/2423 (SL-10), solution/2439 (SL-7)"
      - "Check for strains: strain/1 (DSM 1), strain/9 (DSM 10 - B. subtilis)"
      - Use VALUES with multiple IRIs for nutrient combinations or media comparisons
      - "Exploratory workflow: Find one example with text search → extract IRI → use IRI in comprehensive query"
  
  - error: Keyword search failures or slow performance
    causes:
      - Using FILTER(CONTAINS()) instead of bif:contains
      - Not wrapping keywords in single quotes for bif:contains
      - Using text search when typed predicates exist (belongsTaxGroup, isComplex)
    solutions:
      - "Use bif:contains for full-text search on Virtuoso: ?label bif:contains \"'keyword'\""
      - "Boolean operators: ?label bif:contains \"'term1' OR 'term2'\""
      - "Check if typed predicate exists first: belongsTaxGroup, isComplex, hasOxygenRequirement"
      - "Check if specific IRI exists: ingredient, solution, strain IRIs"
      - Text search only for truly unstructured fields (rdfs:label, species names, phenotypes)
  
  - error: Empty cross-reference results
    causes:
      - Requiring all database identifiers (AND logic) with partial coverage
      - Not using OPTIONAL for properties with <100% coverage
    solutions:
      - Use OPTIONAL for each cross-reference property
      - "Filter with OR logic: FILTER(BOUND(?chebi) || BOUND(?kegg))"
      - "Remember coverage: GMO 58%, CAS 59%, ChEBI 46%, PubChem 18%, KEGG 13%"
      - "Strategy 7: Place OPTIONAL blocks after required patterns"
  
  - error: Query timeout on composition or growth condition queries
    causes:
      - No medium filter with 72K+ compositions or 68K+ growth conditions
      - Missing LIMIT clause
      - Not using specific medium IRI(s) for filtering
    solutions:
      - "Strategy 2: Filter by specific medium IRI(s) FIRST using VALUES or FILTER"
      - Use VALUES with 2-5 specific medium IRIs for multi-medium queries
      - Always add LIMIT 30-50 for unbounded queries (Strategy 10)
      - Pre-filtering reduces 72K compositions to ~22 per medium (avg 21.9)
  
  - error: Cross-database query timeout (MediaDive + BacDive)
    causes:
      - Missing genus/species/phenotype pre-filtering in BacDive GRAPH (Strategy 2)
      - Joining 97K BacDive strains to 33K MediaDive strains without filtering
      - Missing explicit GRAPH clauses (Strategy 1)
      - Missing LIMIT clause (Strategy 10)
    solutions:
      - "Strategy 1: Use explicit GRAPH <uri> clauses for each database"
      - "Strategy 2: Apply restrictive FILTER within BacDive GRAPH clause BEFORE join"
      - "Pre-filter options and reduction rates:"
      - "  • Genus filter (schema:hasGenus): 95% reduction (97K → 5K strains)"
      - "  • Species keyword filter (CONTAINS on species): 99.8% reduction (97K → 200 strains)"
      - "  • Phenotype filter (oxygen tolerance): 64% reduction (97K → 35K strains)"
      - "Strategy 10: Add LIMIT to every cross-database query"
      - Test with 'Bacillus' genus (lower BacDiveIDs) instead of 'Escherichia' (high IDs >130K)
      - "Expected performance: Genus filter 2-3s (Tier 1), phenotype filter 5-8s (Tier 2)"
