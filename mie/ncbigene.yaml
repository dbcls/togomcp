schema_info:
  title: NCBI Gene Database
  description: |
    Gene database with 57M+ entries covering protein-coding genes, ncRNAs, pseudogenes across all organisms.
    Includes gene symbols, descriptions, chromosomal locations, types, synonyms, and cross-references to Ensembl, HGNC, OMIM.
    Supports comparative genomics via orthology relationships and taxonomic classification.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://identifiers.org/ncbigene/
  graphs:
    - http://rdfportal.org/dataset/ncbigene
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "1.8"
    mie_created: "2025-01-10"
    mie_updated: "2025-01-28"
    data_version: November 2024
    update_frequency: Regular
  license:
    data_license: NCBI Public Domain
    license_url: https://www.ncbi.nlm.nih.gov/home/about/policies/
  access:
    rate_limiting: Standard SPARQL limits
    max_query_timeout: 60 seconds
    backend: Virtuoso

shape_expressions: |
  PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
  PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX orth: <http://purl.org/net/orth#>

  <GeneShape> {
    a [ insdc:Gene ] ;
    dct:identifier xsd:integer ;
    rdfs:label xsd:string ;                    # Gene symbol (INS, BRCA1)
    dct:description xsd:string ? ;             # Full name (insulin)
    insdc:gene_synonym xsd:string * ;
    dct:alternative xsd:string * ;
    ncbio:typeOfGene xsd:string ;
    ncbio:nomenclatureStatus xsd:string ? ;
    ncbio:fullName xsd:string ? ;
    ncbio:taxid IRI ;
    insdc:chromosome xsd:string ? ;
    insdc:map xsd:string ? ;
    insdc:dblink IRI * ;
    insdc:db_xref xsd:string * ;
    orth:hasOrtholog IRI * ;
    dct:modified xsd:date
  }

sample_rdf_entries:
  - title: Protein-Coding Gene (A1BG)
    description: Human gene with synonyms, location, cross-references.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix dct: <http://purl.org/dc/terms/> .

      <http://identifiers.org/ncbigene/1> a insdc:Gene ;
        rdfs:label "A1BG" ;
        dct:description "alpha-1-B glycoprotein" ;
        insdc:gene_synonym "A1B", "ABG", "GAB" ;
        ncbio:typeOfGene "protein-coding" ;
        insdc:chromosome "19" ;
        insdc:map "19q13.43" ;
        insdc:dblink <http://identifiers.org/ensembl/ENSG00000121410>,
                    <http://identifiers.org/hgnc/5> ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> .
  
  - title: Non-Coding RNA (LINC00165)
    description: Long intergenic ncRNA with alternative names.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix dct: <http://purl.org/dc/terms/> .

      <http://identifiers.org/ncbigene/727701> a insdc:Gene ;
        rdfs:label "LINC00165" ;
        ncbio:typeOfGene "ncRNA" ;
        insdc:chromosome "21" ;
        dct:alternative "narcolepsy candidate-region 1 gene B" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> .
  
  - title: Gene with Orthologs (INS)
    description: Insulin gene with cross-species relationships.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix orth: <http://purl.org/net/orth#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix dct: <http://purl.org/dc/terms/> .

      <http://identifiers.org/ncbigene/3630> a insdc:Gene ;
        rdfs:label "INS" ;
        dct:description "insulin" ;
        orth:hasOrtholog <http://identifiers.org/ncbigene/16334>,
                         <http://identifiers.org/ncbigene/24506> .
  
  - title: Pseudogene (ACTG1P14)
    description: Non-functional gene copy.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

      <http://identifiers.org/ncbigene/100418910> a insdc:Gene ;
        rdfs:label "ACTG1P14" ;
        ncbio:typeOfGene "pseudo" ;
        insdc:chromosome "9" .
  
  - title: Multi-Chromosome Gene (SHOX)
    description: Gene on X and Y with multiple OMIM links.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

      <http://identifiers.org/ncbigene/6473> a insdc:Gene ;
        rdfs:label "SHOX" ;
        insdc:chromosome "X|Y" ;
        insdc:dblink <http://identifiers.org/mim/312865>,
                     <http://identifiers.org/mim/400020> .

sparql_query_examples:
  - title: Basic Gene Info
    description: Get gene metadata by ID
    question: What is gene 1?
    complexity: basic
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>

      SELECT ?label ?description ?type
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/1> rdfs:label ?label ;
          ncbio:typeOfGene ?type .
        OPTIONAL { <http://identifiers.org/ncbigene/1> dct:description ?description }
      }

  - title: List Genes by Type
    description: Filter genes by biological type
    question: Find protein-coding genes in human
    complexity: basic
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

      SELECT ?gene ?label
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:typeOfGene "protein-coding" ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
      }
      LIMIT 10

  - title: Search Gene Symbols
    description: Full-text search on gene symbols with relevance scoring
    question: Find INS, BRCA1, or TP53
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

      SELECT ?gene ?label ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?label bif:contains "'INS' OR 'BRCA1' OR 'TP53'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)

  - title: Search Full Gene Names
    description: Keyword search in gene descriptions with biological context
    question: Find insulin-related genes
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>

      SELECT ?gene ?label ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              dct:description ?description ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 20

  - title: Boolean Keyword Search
    description: Complex text search with AND/OR/NOT for biological annotations
    question: Cancer genes but not suppressors
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>

      SELECT ?gene ?label ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              dct:description ?description ;
              ncbio:typeOfGene "protein-coding" ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?description bif:contains "('cancer' OR 'tumor') AND NOT 'suppressor'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 20

  - title: Orthology Analysis
    description: Find orthologous genes across species
    question: What are INS orthologs?
    complexity: advanced
    sparql: |
      PREFIX orth: <http://purl.org/net/orth#>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

      SELECT ?ortholog ?label ?taxid
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?ortholog .
        ?ortholog rdfs:label ?label ;
                  ncbio:taxid ?taxid .
      }
      LIMIT 100

  - title: Comprehensive Gene Annotation
    description: Aggregate all metadata with biological context
    question: Get complete gene profile
    complexity: advanced
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX orth: <http://purl.org/net/orth#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>

      SELECT ?label ?description ?type ?chromosome ?map 
             (GROUP_CONCAT(DISTINCT ?synonym; separator="; ") as ?synonyms)
             (GROUP_CONCAT(DISTINCT ?dblink; separator="; ") as ?links)
             (COUNT(DISTINCT ?ortholog) as ?ortho_count)
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> rdfs:label ?label ;
          ncbio:typeOfGene ?type .
        OPTIONAL { <http://identifiers.org/ncbigene/3630> dct:description ?description }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:chromosome ?chromosome }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:map ?map }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:gene_synonym ?synonym }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:dblink ?dblink }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?ortholog }
      }
      GROUP BY ?label ?description ?type ?chromosome ?map

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - clinvar
    - pubmed
    - pubtator
    - medgen
  examples:
    - title: Enrich Gene Information with ClinVar Variant Data
      description: |
        Links NCBI Gene entries to genetic variants from ClinVar, providing comprehensive view of gene-disease relationships.
        Retrieves all variants associated with a gene including variation types (SNV, deletion, insertion) and clinical significance classifications.
        Useful for understanding pathogenic variants, benign polymorphisms, and variants of uncertain significance in specific genes.
      databases_used:
        - ncbigene
        - clinvar
      complexity: intermediate
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

        SELECT ?gene_symbol ?gene_desc ?var_label ?var_type
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
            ?gene_symbol bif:contains "'BRCA1'" .
          }
          BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_gene_uri)
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?allele_bnode med2rdf:gene ?cv_gene_uri .
            ?variant a cvo:VariationArchiveType ;
                     cvo:classified_record ?classrec ;
                     rdfs:label ?var_label ;
                     cvo:variation_type ?var_type .
            ?classrec ?rel ?allele_bnode .
          }
        }
        LIMIT 50
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter with bif:contains), 5 (URI conversion), 10 (LIMIT)
        - Query uses graph URIs from ClinVar MIE file: http://rdfportal.org/dataset/clinvar
        - Entity types verified: cvo:VariationArchiveType from ClinVar MIE shape expressions
        - CRITICAL: BIND placed BETWEEN GRAPH clauses, not inside ClinVar GRAPH
        - URI conversion: identifiers.org/ncbigene/{id} → ncbi.nlm.nih.gov/gene/{id} (Strategy 5)
        - Pre-filtering with bif:contains in NCBI Gene reduces search from 57M to ~5 genes (Strategy 2)
        - Linkage via med2rdf:gene property through blank nodes (from ClinVar MIE file)
        - Performance: ~2-3 seconds for 50 results (Tier 1)
        - Performance gain: bif:contains reduces NCBI Gene from 57M to 5, then join with 15K BRCA1 variants
        - Use case: Clinical genetics, variant discovery, genetic counseling
        - Referenced MIE files: ClinVar (med2rdf:gene pattern, cvo:VariationArchiveType)
        - Avoided anti-patterns: BIND outside GRAPH, explicit GRAPH clauses, bif:contains not FILTER

    - title: Find Literature About Genes via PubMed
      description: |
        Integrates NCBI Gene with PubMed to discover research literature about specific genes.
        Links gene symbols to publications, enabling comprehensive literature review for gene function, regulation, and clinical significance.
        Useful for finding research papers, reviews, and case reports about genes of interest.
      databases_used:
        - ncbigene
        - pubmed
      complexity: intermediate
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>

        SELECT ?gene_symbol ?gene_desc ?pmid ?article_title
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       rdfs:label ?gene_symbol ;
                       ncbio:taxid <http://identifiers.org/taxonomy/9606> .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
            ?gene_symbol bif:contains "'TP53'" .
          }
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?article_title .
            ?article_title bif:contains "'TP53' AND 'cancer'" .
          }
        }
        LIMIT 30
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (double pre-filter), 7 (OPTIONAL), 8 (taxid filter), 10 (LIMIT)
        - Query uses graph URIs from both MIE files: ncbigene and pubmed datasets
        - Integration via keyword matching on gene symbol in both databases
        - Double keyword search ensures relevant gene-specific literature
        - Database-specific optimization: Filter by human taxonomy (9606) in NCBI Gene (Strategy 8)
        - Performance: ~3-5 seconds for 30 results (Tier 2)
        - Performance gain: bif:contains in NCBI Gene (57M→1) + PubMed (37M→8K) = efficient join
        - Use case: Literature review, gene function research, translational medicine
        - Referenced MIE files: PubMed (bibo:pmid, dct:title properties), NCBI Gene (taxid optimization)
        - Avoided anti-patterns: Used bif:contains not FILTER/REGEX, taxid pre-filtering

    - title: Comprehensive Gene-Variant-Literature Integration
      description: |
        Three-way integration across NCBI Gene, ClinVar variants, and PubMed literature to provide complete research context for genes.
        Retrieves gene information, associated variants, and relevant publications in a single query.
        NOTE: This query may timeout with aggregation due to complexity. Use separate queries for production.
      databases_used:
        - ncbigene
        - clinvar
        - pubmed
      complexity: advanced
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX dct: <http://purl.org/dc/terms/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

        SELECT ?gene_symbol ?gene_type ?var_label ?pmid ?article_title
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            VALUES ?gene_id { "672" }
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol ;
                       ncbio:typeOfGene ?gene_type ;
                       ncbio:taxid <http://identifiers.org/taxonomy/9606> .
          }
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?allele_bnode med2rdf:gene <http://ncbi.nlm.nih.gov/gene/672> .
            ?variant cvo:classified_record ?classrec ;
                     rdfs:label ?var_label .
            ?classrec ?rel ?allele_bnode .
          }
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?article_title .
            ?article_title bif:contains "'BRCA1'" .
          }
        }
        LIMIT 5
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 3 (VALUES), 8 (taxid), 10 (LIMIT)
        - CRITICAL: Three-way integration queries may timeout (Tier 3-4, >20 seconds)
        - For production: Execute as separate two-way queries and join results programmatically
        - VALUES pre-filters to specific gene (672=BRCA1) reducing from 57M to 1 gene (Strategy 3)
        - Joins: Gene (1) × ClinVar variants (15K) × PubMed articles (8K) = large cartesian product
        - Performance: ~5-20 seconds without aggregation, may timeout with COUNT/GROUP BY (Tier 3-4)
        - Use case: Comprehensive gene analysis, research planning, grant writing
        - Referenced MIE files: All three databases for correct graph URIs and property patterns
        - Recommendation: Use two separate two-way queries for better performance and reliability

cross_references:
  - pattern: insdc:dblink (IRI links)
    description: |
      Primary external links via identifiers.org URIs to Ensembl, HGNC, OMIM.
    databases:
      Genomics:
        - "Ensembl: gene annotations"
        - "HGNC: human nomenclature"
        - "OMIM: disease associations"
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>

      SELECT ?gene ?external
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene insdc:dblink ?external .
        FILTER(STRSTARTS(STR(?external), "http://identifiers.org/ensembl/"))
      }
      LIMIT 10

  - pattern: insdc:db_xref (string refs)
    description: |
      String-based references like "Database:ID".
    databases:
      Various:
        - "AllianceGenome: integrated resources"
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>

      SELECT ?gene ?xref
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene insdc:db_xref ?xref .
        FILTER(CONTAINS(?xref, "AllianceGenome"))
      }
      LIMIT 10

  - pattern: orth:hasOrtholog
    description: |
      Bidirectional orthology for comparative genomics.
    databases:
      Internal:
        - "NCBI Gene: within-database orthology"
    sparql: |
      PREFIX orth: <http://purl.org/net/orth#>

      SELECT ?gene1 ?gene2
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene1 orth:hasOrtholog ?gene2 .
      }
      LIMIT 10

  - pattern: ncbio:taxid
    description: |
      Taxonomic classification via NCBI Taxonomy.
    databases:
      Taxonomy:
        - "NCBI Taxonomy: organism classification"
    sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>

      SELECT ?gene ?taxid
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid ?taxid .
      }
      LIMIT 10

architectural_notes:
  search_strategies:
    - "RECOMMENDED WORKFLOW: Use ncbi_esearch BEFORE SPARQL for efficient gene discovery"
    - "ncbi_esearch(database='gene', query='BRCA1 AND human[organism]') returns Gene IDs directly"
    - "ncbi_esearch supports Entrez syntax: field tags [Gene Name], [Symbol], boolean operators (AND, OR, NOT)"
    - "Use ncbi_esearch for: gene symbol lookup, organism-specific queries, broad discovery"
    - "Use SPARQL for: detailed metadata retrieval, property aggregation, cross-database linking, complex filters"
    - "Optimal pattern: ncbi_esearch to find IDs → SPARQL to get full RDF data"
    - "Example: ncbi_esearch('insulin receptor', max_results=20) then query each ID via SPARQL"
    - "For general keyword search strategies across databases, call the TogoMCP_Usage_Guide tool"
  
  schema_design:
    - "Single Gene entity with comprehensive properties"
    - "identifiers.org URIs for cross-database consistency"
    - "Label=symbols (INS), description=full names (insulin)"
    - "IRI-based (dblink) vs string-based (db_xref) references"
    - "Bidirectional orthology enables comparative analysis"
  
  performance:
    - "Use bif:contains for text search (not REGEX/FILTER)"
    - "Filter by taxid early to reduce search space"
    - "Gene ID lookups fast (<1s)"
    - "Always add LIMIT to orthology queries"
    - "Include FROM clause for graph targeting"
  
  data_integration:
    - "identifiers.org enables seamless cross-database linking"
    - "HGNC for official nomenclature"
    - "Ensembl for detailed annotations"
    - "OMIM for disease associations"
    - "Taxonomy for phylogenetic context"
    - "ClinVar for genetic variants via med2rdf:gene property (shared ncbi endpoint)"
    - "PubMed for literature via keyword matching (shared ncbi endpoint)"
    - "Cross-database URI conversion: http://identifiers.org/ncbigene/{id} ↔ http://ncbi.nlm.nih.gov/gene/{id}"
  
  cross_database_optimization:
    - "Use explicit GRAPH clauses (Strategy 1) - MANDATORY for each database"
    - "Apply restrictive filters early (Strategy 2) - bif:contains within GRAPH blocks before joins"
    - "Use VALUES for known entities (Strategy 3) - Most effective for gene-specific queries"
    - "CRITICAL: Place BIND BETWEEN GRAPH clauses, not inside - BIND inside GRAPH with cross-GRAPH variables fails"
    - "Convert URIs when patterns differ (Strategy 5) - NCBI databases use different namespaces"
    - "Order OPTIONAL blocks correctly (Strategy 7) - Required patterns first"
    - "Apply database-specific optimizations (Strategy 8) - ALWAYS filter by taxid for NCBI Gene (reduces 57M→20K)"
    - "Document performance tier (Strategy 10) - Set user expectations (Tier 1: 1-3s, Tier 2: 3-8s, Tier 3: 8-20s)"
    - "Three-way queries may timeout - Consider separate queries for production systems"
    - "Expected cross-database performance: Tier 1 (1-3s) for two-way with pre-filtering, Tier 3-4 (>20s) for three-way"
  
  data_quality:
    - "Official status via nomenclatureStatus"
    - "Synonyms capture historical names"
    - "Optional properties vary by curation level"
    - "Best coverage for model organisms"

data_statistics:
  total_genes: 57768578
  coverage:
    typeOfGene: "100%"
    description: "~95%"
    chromosomal_location: "~80%"
    external_links: "~70%"
    orthology: "~40%"
  cardinality:
    avg_synonyms: 2.5
    avg_links: 1.8
    avg_orthologs: 150
  gene_types:
    protein_coding: 46105590
    ncRNA: 3476823
    tRNA: 3030346
    pseudo: 2731789
    rRNA: 993602
  performance_characteristics:
    - "Gene ID lookup: <1s"
    - "Type filtering: 1-5s"
    - "bif:contains search: 1-3s"
    - "Orthology queries: 10-30s"
    - "Cross-database queries (two-way): 2-5s with optimizations"
    - "Cross-database queries (three-way): May timeout (>60s)"
  data_quality_notes:
    - "Best curated for human, mouse, rat"
    - "Coverage decreases for non-model organisms"
    - "Orthology most complete between close species"

anti_patterns:
  - title: Searching without organism filter
    problem: Timeout with 57M+ genes
    wrong_sparql: |
      SELECT ?gene ?description
      WHERE {
        ?gene dct:description ?description .
        FILTER(CONTAINS(?description, "insulin"))
      }
    correct_sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX dct: <http://purl.org/dc/terms/>

      SELECT ?gene ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              dct:description ?description .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 100
    explanation: "Filter by taxid first; use bif:contains not FILTER (Strategies 2 and 8)"

  - title: Searching full names in label
    problem: No results when searching 'insulin' in label
    wrong_sparql: |
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

      SELECT ?gene ?label
      WHERE {
        ?gene rdfs:label ?label .
        ?label bif:contains "'insulin'" option (score ?sc) .
      }
    correct_sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX dct: <http://purl.org/dc/terms/>

      SELECT ?gene ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene dct:description ?description ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
    explanation: "Label=symbols (INS), description=full names (insulin)"

  - title: Unbounded orthology queries
    problem: Millions of results cause timeout
    wrong_sparql: |
      PREFIX orth: <http://purl.org/net/orth#>

      SELECT ?gene1 ?gene2
      WHERE {
        ?gene1 orth:hasOrtholog ?gene2 .
      }
    correct_sparql: |
      PREFIX orth: <http://purl.org/net/orth#>

      SELECT ?gene2
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?gene2 .
      }
      LIMIT 100
    explanation: "Start with specific gene; always add LIMIT (Strategy 10)"

  - title: BIND Inside GRAPH Clause with Cross-GRAPH Variables
    problem: BIND fails when placed inside GRAPH clause using variables from another GRAPH
    wrong_sparql: |
      SELECT ?gene_symbol ?var_label
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id ;
                     rdfs:label ?gene_symbol .
        }
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_uri)
          ?allele_bnode med2rdf:gene ?cv_uri .
        }
      }
    correct_sparql: |
      SELECT ?gene_symbol ?var_label
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id ;
                     rdfs:label ?gene_symbol .
        }
        BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_uri)
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?allele_bnode med2rdf:gene ?cv_uri .
          ?variant rdfs:label ?var_label ;
                   cvo:classified_record ?classrec .
          ?classrec ?rel ?allele_bnode .
        }
      }
      LIMIT 100
    explanation: "CRITICAL: Place BIND BETWEEN GRAPH clauses, not inside. BIND inside a GRAPH using variables from another GRAPH will fail. This is the most common error in cross-database queries."

  - title: Cross-Database URI Mismatch Without Conversion
    problem: No results when joining NCBI Gene with ClinVar using different URI patterns
    wrong_sparql: |
      SELECT ?ncbi_gene ?cv_gene
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene a insdc:Gene .
        }
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?allele_bnode med2rdf:gene ?ncbi_gene .
        }
      }
    correct_sparql: |
      SELECT ?ncbi_gene ?gene_id
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene a insdc:Gene ;
                     dct:identifier ?gene_id .
        }
        BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_gene_uri)
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?allele_bnode med2rdf:gene ?cv_gene_uri .
        }
      }
      LIMIT 100
    explanation: "Convert identifiers.org/ncbigene/{id} to ncbi.nlm.nih.gov/gene/{id} using BIND with CONCAT (Strategy 5). BIND must be placed between GRAPH clauses."

common_errors:
  - error: Query timeout or no results
    causes:
      - "No organism filter on 57M+ genes"
      - "FILTER/CONTAINS instead of bif:contains"
      - "Missing FROM clause"
      - "Unbounded orthology traversal"
      - "BIND placed inside GRAPH clause with cross-GRAPH variables"
    solutions:
      - "Filter by ncbio:taxid early (Strategy 8)"
      - "Use bif:contains for text search (Strategy 2)"
      - "Include FROM <http://rdfportal.org/dataset/ncbigene>"
      - "Add LIMIT (10-1000) (Strategy 10)"
      - "Start with specific gene IDs"
      - "Place BIND between GRAPH clauses, not inside"
      - "Consider using ncbi_esearch for initial discovery"
    example_fix: |
      # Wrong: FILTER(CONTAINS(?desc, "insulin"))
      # Right: ?desc bif:contains "'insulin'" option (score ?sc)
      
      # Wrong BIND placement:
      GRAPH <db2> { BIND(IRI(CONCAT(..., ?var_from_db1))) }
      # Right BIND placement:
      GRAPH <db1> { ?var_from_db1 ... }
      BIND(IRI(CONCAT(..., ?var_from_db1)) AS ?uri)
      GRAPH <db2> { ... ?uri ... }

  - error: Empty results for valid IDs
    causes:
      - "Wrong identifier format"
      - "Missing full URI"
      - "No FROM clause"
      - "Discontinued gene ID"
    solutions:
      - "Use full URI: <http://identifiers.org/ncbigene/ID>"
      - "Verify ID exists in NCBI Gene via ncbi_esearch"
      - "Include FROM clause"
      - "Check dct:modified for currency"
    example_fix: |
      # Wrong: ?gene dct:identifier 1
      # Right: <http://identifiers.org/ncbigene/1> ?p ?o

  - error: Missing external links
    causes:
      - "Using only dblink, not db_xref"
      - "Not using OPTIONAL blocks"
      - "Poor coverage for organism"
    solutions:
      - "Query both insdc:dblink and insdc:db_xref"
      - "Wrap in OPTIONAL blocks (Strategy 7)"
      - "Filter by well-curated organisms"
    example_fix: |
      # Incomplete: ?gene insdc:dblink ?link
      # Complete:
      OPTIONAL { ?gene insdc:dblink ?link }
      OPTIONAL { ?gene insdc:db_xref ?xref }

  - error: Cross-database query returns no results
    causes:
      - "URI pattern mismatch between databases"
      - "Wrong graph URIs"
      - "Missing URI conversion with BIND and CONCAT"
      - "BIND placed inside GRAPH clause"
    solutions:
      - "Convert NCBI Gene identifiers.org URIs to ClinVar ncbi.nlm.nih.gov URIs"
      - "Use BIND(IRI(CONCAT('http://ncbi.nlm.nih.gov/gene/', ?gene_id)) AS ?cv_gene_uri)"
      - "Place BIND between GRAPH clauses, never inside"
      - "Verify graph URIs from MIE files"
      - "Test each GRAPH clause independently before combining"
    example_fix: |
      # NCBI Gene → ClinVar: Convert URI pattern
      GRAPH <http://rdfportal.org/dataset/ncbigene> {
        ?ncbi_gene dct:identifier ?gene_id .
      }
      BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_gene_uri)
      GRAPH <http://rdfportal.org/dataset/clinvar> {
        ?allele_bnode med2rdf:gene ?cv_gene_uri .
      }
