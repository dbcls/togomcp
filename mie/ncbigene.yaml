schema_info:
  title: NCBI Gene Database
  description: |
    Gene database with 57M+ entries covering protein-coding genes, ncRNAs, pseudogenes across all organisms.
    Includes symbols, descriptions, chromosomal locations, types, synonyms, and cross-references to Ensembl, HGNC, OMIM.
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://identifiers.org/ncbigene/
  graphs:
    - http://rdfportal.org/dataset/ncbigene
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "2.0"
    mie_created: "2025-01-10"
    mie_updated: "2025-02-04"
    data_version: "November 2024"
    update_frequency: "Regular"
  license:
    data_license: "NCBI Public Domain"
    license_url: "https://www.ncbi.nlm.nih.gov/home/about/policies/"
  access:
    rate_limiting: "Standard SPARQL limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
  PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX orth: <http://purl.org/net/orth#>
  
  <GeneShape> {
    a [ insdc:Gene ] ;
    dct:identifier xsd:integer ;
    rdfs:label xsd:string ;
    dct:description xsd:string ? ;
    insdc:gene_synonym xsd:string * ;
    dct:alternative xsd:string * ;
    ncbio:typeOfGene xsd:string ;
    ncbio:nomenclatureStatus xsd:string ? ;
    ncbio:fullName xsd:string ? ;
    ncbio:taxid IRI ;
    insdc:chromosome xsd:string ? ;
    insdc:map xsd:string ? ;
    insdc:dblink IRI * ;
    insdc:db_xref xsd:string * ;
    orth:hasOrtholog IRI * ;
    dct:modified xsd:date
  }

sample_rdf_entries:
  - title: Protein-Coding Gene (A1BG)
    description: Human gene with synonyms, chromosomal location, and external database links.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      
      <http://identifiers.org/ncbigene/1> a insdc:Gene ;
        rdfs:label "A1BG" ;
        dct:description "alpha-1-B glycoprotein" ;
        insdc:gene_synonym "A1B", "ABG", "GAB" ;
        ncbio:typeOfGene "protein-coding" ;
        insdc:chromosome "19" ;
        insdc:map "19q13.43" ;
        insdc:dblink <http://identifiers.org/ensembl/ENSG00000121410>,
                    <http://identifiers.org/hgnc/5> ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> .
  
  - title: Non-Coding RNA (LINC00165)
    description: Long intergenic ncRNA with alternative naming.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/ncbigene/727701> a insdc:Gene ;
        rdfs:label "LINC00165" ;
        ncbio:typeOfGene "ncRNA" ;
        insdc:chromosome "21" ;
        dct:alternative "narcolepsy candidate-region 1 gene B" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> .
  
  - title: Gene with Orthologs (INS)
    description: Insulin gene showing cross-species orthology relationships.
    rdf: |
      @prefix orth: <http://purl.org/net/orth#> .
      
      <http://identifiers.org/ncbigene/3630> a insdc:Gene ;
        rdfs:label "INS" ;
        dct:description "insulin" ;
        orth:hasOrtholog <http://identifiers.org/ncbigene/16334>,
                         <http://identifiers.org/ncbigene/24506> .
  
  - title: Pseudogene (ACTG1P14)
    description: Non-functional gene copy classified as pseudogene.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/ncbigene/100418910> a insdc:Gene ;
        rdfs:label "ACTG1P14" ;
        ncbio:typeOfGene "pseudo" ;
        insdc:chromosome "9" .
  
  - title: Multi-Chromosome Gene (SHOX)
    description: Gene present on both X and Y chromosomes with multiple OMIM cross-references.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/ncbigene/6473> a insdc:Gene ;
        rdfs:label "SHOX" ;
        insdc:chromosome "X|Y" ;
        insdc:dblink <http://identifiers.org/mim/312865>,
                     <http://identifiers.org/mim/400020> .

sparql_query_examples:
  - title: Basic Gene Info
    description: Retrieve metadata for specific gene by ID.
    question: What is gene 1?
    complexity: basic
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?label ?description ?type
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/1> rdfs:label ?label ;
          ncbio:typeOfGene ?type .
        OPTIONAL { <http://identifiers.org/ncbigene/1> dct:description ?description }
      }
  
  - title: List Genes by Type
    description: Filter genes by biological type and organism.
    question: Find protein-coding genes in human.
    complexity: basic
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:typeOfGene "protein-coding" ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
      }
      LIMIT 10
  
  - title: Search Gene Symbols
    description: Full-text search on gene symbols with relevance scoring.
    question: Find INS, BRCA1, or TP53 genes.
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?label bif:contains "'INS' OR 'BRCA1' OR 'TP53'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
  
  - title: Search Full Gene Names
    description: Keyword search in gene descriptions.
    question: Find insulin-related genes.
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              dct:description ?description ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Boolean Keyword Search
    description: Complex text search with AND/OR/NOT operators.
    question: Find cancer genes excluding suppressors.
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              dct:description ?description ;
              ncbio:typeOfGene "protein-coding" ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?description bif:contains "('cancer' OR 'tumor') AND NOT 'suppressor'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Orthology Analysis
    description: Find orthologous genes across species.
    question: What are the orthologs of human INS?
    complexity: advanced
    sparql: |
      PREFIX orth: <http://purl.org/net/orth#>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?ortholog ?label ?taxid
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?ortholog .
        ?ortholog rdfs:label ?label ;
                  ncbio:taxid ?taxid .
      }
      LIMIT 100
  
  - title: Comprehensive Gene Annotation
    description: Aggregate all metadata with grouping.
    question: Get complete profile for a gene.
    complexity: advanced
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX orth: <http://purl.org/net/orth#>
      
      SELECT ?label ?description ?type ?chromosome ?map 
             (GROUP_CONCAT(DISTINCT ?synonym; separator="; ") as ?synonyms)
             (GROUP_CONCAT(DISTINCT ?dblink; separator="; ") as ?links)
             (COUNT(DISTINCT ?ortholog) as ?ortho_count)
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> rdfs:label ?label ;
          ncbio:typeOfGene ?type .
        OPTIONAL { <http://identifiers.org/ncbigene/3630> dct:description ?description }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:chromosome ?chromosome }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:map ?map }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:gene_synonym ?synonym }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> insdc:dblink ?dblink }
        OPTIONAL { <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?ortholog }
      }
      GROUP BY ?label ?description ?type ?chromosome ?map

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - clinvar
    - pubmed
    - pubtator
    - medgen
  examples:
    - title: Gene-Variant Integration via ClinVar
      description: Links genes to genetic variants with clinical significance.
      databases_used:
        - ncbigene
        - clinvar
      complexity: intermediate
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        
        SELECT ?gene_symbol ?gene_desc ?var_label ?var_type
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
            ?gene_symbol bif:contains "'BRCA1'" .
          }
          BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_gene_uri)
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?allele_bnode med2rdf:gene ?cv_gene_uri .
            ?variant a cvo:VariationArchiveType ;
                     cvo:classified_record ?classrec ;
                     rdfs:label ?var_label ;
                     cvo:variation_type ?var_type .
            ?classrec ?rel ?allele_bnode .
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 2 (bif:contains pre-filter), 5 (URI conversion), 10 (LIMIT)
        - URI conversion: identifiers.org/ncbigene/{id} → ncbi.nlm.nih.gov/gene/{id}
        - BIND placed BETWEEN GRAPH clauses (critical)
        - Performance: ~2-3s (Tier 1)
        - MIE files: ClinVar (med2rdf:gene, cvo:VariationArchiveType)
    
    - title: Gene-Literature Integration via PubMed
      description: Links genes to research publications via keyword matching.
      databases_used:
        - ncbigene
        - pubmed
      complexity: intermediate
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        
        SELECT ?gene_symbol ?gene_desc ?pmid ?article_title
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            ?ncbi_gene a insdc:Gene ;
                       rdfs:label ?gene_symbol ;
                       ncbio:taxid <http://identifiers.org/taxonomy/9606> .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
            ?gene_symbol bif:contains "'TP53'" .
          }
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?article_title .
            ?article_title bif:contains "'TP53' AND 'cancer'" .
          }
        }
        LIMIT 30
      notes: |
        - Strategies: 1 (GRAPH), 2 (double bif:contains), 7 (OPTIONAL), 8 (taxid), 10 (LIMIT)
        - Double keyword search for relevance
        - Performance: ~3-5s (Tier 2)
        - MIE files: PubMed (bibo:pmid, dct:title)
    
    - title: Three-Way Gene-Variant-Literature Integration
      description: Comprehensive integration across all three databases (may timeout with aggregation).
      databases_used:
        - ncbigene
        - clinvar
        - pubmed
      complexity: advanced
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        
        SELECT ?gene_symbol ?gene_type ?var_label ?pmid ?article_title
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            VALUES ?gene_id { "672" }
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol ;
                       ncbio:typeOfGene ?gene_type ;
                       ncbio:taxid <http://identifiers.org/taxonomy/9606> .
          }
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?allele_bnode med2rdf:gene <http://ncbi.nlm.nih.gov/gene/672> .
            ?variant cvo:classified_record ?classrec ;
                     rdfs:label ?var_label .
            ?classrec ?rel ?allele_bnode .
          }
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?article_title .
            ?article_title bif:contains "'BRCA1'" .
          }
        }
        LIMIT 5
      notes: |
        - Strategies: 1 (GRAPH), 3 (VALUES), 8 (taxid), 10 (LIMIT)
        - Performance: ~5-20s (Tier 3-4), may timeout with GROUP BY
        - For production: use separate two-way queries
        - MIE files: all three databases

cross_references:
  - pattern: insdc:dblink (IRI links)
    description: Primary external links via identifiers.org URIs.
    databases:
      Genomics:
        - "Ensembl: gene annotations"
        - "HGNC: human nomenclature"
        - "OMIM: disease associations"
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?gene ?external
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene insdc:dblink ?external .
        FILTER(STRSTARTS(STR(?external), "http://identifiers.org/ensembl/"))
      }
      LIMIT 10
  
  - pattern: insdc:db_xref (string refs)
    description: String-based references in "Database:ID" format.
    databases:
      Various:
        - "AllianceGenome: integrated resources"
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?gene ?xref
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene insdc:db_xref ?xref .
        FILTER(CONTAINS(?xref, "AllianceGenome"))
      }
      LIMIT 10
  
  - pattern: orth:hasOrtholog
    description: Bidirectional orthology for comparative genomics.
    databases:
      Internal:
        - "NCBI Gene: within-database orthology"
    sparql: |
      PREFIX orth: <http://purl.org/net/orth#>
      
      SELECT ?gene1 ?gene2
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene1 orth:hasOrtholog ?gene2 .
      }
      LIMIT 10
  
  - pattern: ncbio:taxid
    description: Taxonomic classification via NCBI Taxonomy.
    databases:
      Taxonomy:
        - "NCBI Taxonomy: organism classification"
    sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?taxid
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid ?taxid .
      }
      LIMIT 10

architectural_notes:
  search_strategies:
    - "RECOMMENDED: Use ncbi_esearch BEFORE SPARQL for gene discovery"
    - "ncbi_esearch supports Entrez syntax: field tags, boolean operators"
    - "Optimal pattern: ncbi_esearch to find IDs → SPARQL for full RDF data"
    - "For general keyword strategies: call TogoMCP_Usage_Guide tool"
  schema_design:
    - Single Gene entity with comprehensive properties
    - identifiers.org URIs for cross-database consistency
    - Label=symbols (INS), description=full names (insulin)
    - IRI-based (dblink) vs string-based (db_xref) references
    - Bidirectional orthology enables comparative analysis
  performance:
    - Use bif:contains for text search (not REGEX/FILTER)
    - Filter by taxid early to reduce search space
    - Gene ID lookups fast (<1s)
    - Always add LIMIT to orthology queries
    - Include FROM clause for graph targeting
  data_integration:
    - identifiers.org enables seamless cross-database linking
    - HGNC for nomenclature, Ensembl for annotations, OMIM for diseases
    - ClinVar for variants via med2rdf:gene (shared endpoint)
    - PubMed for literature via keyword matching (shared endpoint)
    - URI conversion: identifiers.org/ncbigene/{id} ↔ ncbi.nlm.nih.gov/gene/{id}
  cross_database_optimization:
    - "Strategy 1: Explicit GRAPH clauses (MANDATORY)"
    - "Strategy 2: Apply bif:contains within GRAPH before joins"
    - "Strategy 3: VALUES for known entities"
    - "Strategy 5: URI conversion with BIND between GRAPHs"
    - "Strategy 7: Order OPTIONAL blocks (required first)"
    - "Strategy 8: Filter by taxid (57M→20K for human)"
    - "Strategy 10: Document performance tier"
    - "CRITICAL: BIND between GRAPH clauses, never inside"
    - "Three-way queries may timeout - use separate queries"
  data_quality:
    - Official status via nomenclatureStatus
    - Synonyms capture historical names
    - Optional properties vary by curation level
    - Best coverage for model organisms

data_statistics:
  total_genes: 57768578
  verified_date: "2025-02-04"
  verification_query: |
    SELECT (COUNT(?gene) as ?count)
    FROM <http://rdfportal.org/dataset/ncbigene>
    WHERE { ?gene a insdc:Gene }
  
  gene_types:
    protein_coding: 46105590
    ncRNA: 3476823
    tRNA: 3030346
    pseudo: 2731789
    rRNA: 993602
    verified_date: "2025-02-04"
    verification_query: |
      SELECT ?type (COUNT(?gene) as ?count)
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE { ?gene ncbio:typeOfGene ?type }
      GROUP BY ?type
  
  coverage:
    description: "~95%"
    chromosomal_location: "~80%"
    external_links: "~70%"
    methodology: "Sampled 1000 human genes"
    verified_date: "2025-02-04"
  
  cardinality:
    avg_synonyms: 2.5
    avg_links: 1.8
    methodology: "Sampled human protein-coding genes"
  
  performance_characteristics:
    - "Gene ID lookup: <1s"
    - "Type filtering: 1-5s"
    - "bif:contains search: 1-3s"
    - "Orthology queries: 10-30s"
    - "Cross-database (two-way): 2-5s with optimizations"
    - "Cross-database (three-way): May timeout (>60s)"
  
  staleness_warning: "Best curated for human, mouse, rat; coverage decreases for non-model organisms"

anti_patterns:
  - title: Searching without organism filter
    problem: Timeout with 57M+ genes.
    wrong_sparql: |
      SELECT ?gene ?description
      WHERE {
        ?gene dct:description ?description .
        FILTER(CONTAINS(?description, "insulin"))
      }
    correct_sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              dct:description ?description .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 100
    explanation: Filter by taxid first; use bif:contains not FILTER.
  
  - title: Searching full names in label
    problem: No results when searching 'insulin' in label.
    wrong_sparql: |
      SELECT ?gene ?label
      WHERE {
        ?gene rdfs:label ?label .
        ?label bif:contains "'insulin'" .
      }
    correct_sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene dct:description ?description ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
    explanation: Label=symbols (INS), description=full names (insulin).
  
  - title: Unbounded orthology queries
    problem: Millions of results cause timeout.
    wrong_sparql: |
      SELECT ?gene1 ?gene2
      WHERE {
        ?gene1 orth:hasOrtholog ?gene2 .
      }
    correct_sparql: |
      PREFIX orth: <http://purl.org/net/orth#>
      
      SELECT ?gene2
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?gene2 .
      }
      LIMIT 100
    explanation: Start with specific gene; always add LIMIT.
  
  - title: BIND inside GRAPH with cross-GRAPH variables
    problem: BIND fails when placed inside GRAPH using variables from another GRAPH.
    wrong_sparql: |
      SELECT ?gene_symbol ?var_label
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id ;
                     rdfs:label ?gene_symbol .
        }
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_uri)
          ?allele_bnode med2rdf:gene ?cv_uri .
        }
      }
    correct_sparql: |
      SELECT ?gene_symbol ?var_label
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ncbigene> {
          ?ncbi_gene dct:identifier ?gene_id ;
                     rdfs:label ?gene_symbol .
        }
        BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_uri)
        GRAPH <http://rdfportal.org/dataset/clinvar> {
          ?allele_bnode med2rdf:gene ?cv_uri .
        }
      }
      LIMIT 100
    explanation: CRITICAL - Place BIND BETWEEN GRAPH clauses, not inside.

common_errors:
  - error: Query timeout or no results
    causes:
      - No organism filter on 57M+ genes
      - FILTER/CONTAINS instead of bif:contains
      - Missing FROM clause
      - BIND inside GRAPH with cross-GRAPH variables
    solutions:
      - Filter by ncbio:taxid early
      - Use bif:contains for text search
      - Include FROM <http://rdfportal.org/dataset/ncbigene>
      - Place BIND between GRAPH clauses
      - Add LIMIT (10-1000)
      - Consider ncbi_esearch for initial discovery
    example_fix: |
      # Wrong: FILTER(CONTAINS(?desc, "insulin"))
      # Right: ?desc bif:contains "'insulin'" option (score ?sc)
      
      # Wrong BIND: GRAPH <db2> { BIND(IRI(...?var_from_db1...)) }
      # Right BIND: } BIND(IRI(...)) GRAPH <db2> {
  
  - error: Empty results for valid IDs
    causes:
      - Wrong identifier format
      - Missing full URI
      - Discontinued gene ID
    solutions:
      - Use full URI: <http://identifiers.org/ncbigene/ID>
      - Verify ID exists via ncbi_esearch
      - Check dct:modified for currency
  
  - error: Cross-database query returns no results
    causes:
      - URI pattern mismatch between databases
      - BIND placed inside GRAPH clause
      - Wrong graph URIs
    solutions:
      - Convert URI patterns with BIND and CONCAT
      - Place BIND between GRAPH clauses
      - Verify graph URIs from MIE files
      - Test each GRAPH independently
    example_fix: |
      # NCBI Gene → ClinVar URI conversion
      GRAPH <...ncbigene> { ?gene dct:identifier ?gene_id . }
      BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_uri)
      GRAPH <...clinvar> { ?allele med2rdf:gene ?cv_uri . }
