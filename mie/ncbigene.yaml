schema_info:
  title: NCBI Gene
  description: |
    Comprehensive gene database with 57.8M+ entries covering protein-coding genes, ncRNAs, pseudogenes across all organisms.
    Includes gene symbols, descriptions, chromosomal locations, gene types, synonyms, and extensive cross-references to Ensembl, HGNC, OMIM.
    Supports comparative genomics through bidirectional orthology relationships. Best coverage for model organisms (human, mouse, rat).
  endpoint: https://rdfportal.org/ncbi/sparql
  base_uri: http://identifiers.org/ncbigene/
  graphs:
    - http://rdfportal.org/dataset/ncbigene
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "3.0"
    mie_created: "2025-02-09"
    data_version: "November 2024"
    update_frequency: "Regular updates"
  license:
    data_license: "NCBI Public Domain"
    license_url: "https://www.ncbi.nlm.nih.gov/home/about/policies/"
  access:
    rate_limiting: "Standard SPARQL limits"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
  PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
  PREFIX dct: <http://purl.org/dc/terms/>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX orth: <http://purl.org/net/orth#>
  
  <GeneShape> {
    a [ insdc:Gene ] ;
    dct:identifier xsd:integer ;
    rdfs:label xsd:string ;
    dct:description xsd:string ? ;
    insdc:standard_name xsd:string ? ;
    insdc:locus_tag xsd:string ? ;
    insdc:gene_synonym xsd:string * ;
    dct:alternative xsd:string * ;
    ncbio:typeOfGene xsd:string ;
    ncbio:nomenclatureStatus xsd:string ? ;
    ncbio:fullName xsd:string ? ;
    ncbio:featureType xsd:string * ;
    ncbio:taxid IRI ;
    insdc:chromosome xsd:string ? ;
    insdc:map xsd:string ? ;
    insdc:dblink IRI * ;
    insdc:db_xref xsd:string * ;
    orth:hasOrtholog IRI * ;
    dct:modified xsd:date
  }

sample_rdf_entries:
  - title: Protein-Coding Gene (TP53)
    description: Tumor suppressor gene with official nomenclature, chromosomal location, and external links.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      @prefix dct: <http://purl.org/dc/terms/> .
      
      <http://identifiers.org/ncbigene/7157> a insdc:Gene ;
        rdfs:label "TP53" ;
        dct:description "tumor protein p53" ;
        dct:identifier 7157 ;
        insdc:gene_synonym "P53", "LFS1", "TRP53" ;
        ncbio:typeOfGene "protein-coding" ;
        ncbio:nomenclatureStatus "official" ;
        insdc:chromosome "17" ;
        insdc:map "17p13.1" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
        insdc:dblink <http://identifiers.org/ensembl/ENSG00000141510>,
                     <http://identifiers.org/hgnc/11998>,
                     <http://identifiers.org/mim/191170> ;
        dct:modified "2024-11-18"^^xsd:date .
  
  - title: Non-Coding RNA (LINC00165)
    description: Long intergenic ncRNA with alternative naming and chromosomal location.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      
      <http://identifiers.org/ncbigene/727701> a insdc:Gene ;
        rdfs:label "LINC00165" ;
        ncbio:typeOfGene "ncRNA" ;
        insdc:chromosome "21" ;
        dct:alternative "narcolepsy candidate-region 1 gene B" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> .
  
  - title: Gene with Orthologs (INS)
    description: Insulin gene showing cross-species orthology relationships across multiple organisms.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix orth: <http://purl.org/net/orth#> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      
      <http://identifiers.org/ncbigene/3630> a insdc:Gene ;
        rdfs:label "INS" ;
        dct:description "insulin" ;
        ncbio:typeOfGene "protein-coding" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
        orth:hasOrtholog <http://identifiers.org/ncbigene/16334>,
                         <http://identifiers.org/ncbigene/24506> .
  
  - title: Pseudogene (ACTG1P14)
    description: Non-functional gene copy classified as pseudogene with chromosomal location.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      
      <http://identifiers.org/ncbigene/100418910> a insdc:Gene ;
        rdfs:label "ACTG1P14" ;
        ncbio:typeOfGene "pseudo" ;
        insdc:chromosome "9" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> .
  
  - title: Multi-Chromosome Gene (SHOX)
    description: Gene present on both X and Y chromosomes with multiple OMIM disease associations.
    rdf: |
      @prefix insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#> .
      
      <http://identifiers.org/ncbigene/6473> a insdc:Gene ;
        rdfs:label "SHOX" ;
        dct:description "short stature homeobox" ;
        ncbio:typeOfGene "protein-coding" ;
        insdc:chromosome "X|Y" ;
        ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
        insdc:dblink <http://identifiers.org/mim/312865>,
                     <http://identifiers.org/mim/400020> .

sparql_query_examples:
  - title: Retrieve Human Protein-Coding Genes on Specific Chromosome
    description: Use specific organism IRI and typed predicate to find genes efficiently.
    question: What are protein-coding genes on human chromosome 17?
    complexity: basic
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?description
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              # Use specific organism IRI (9606 = Homo sapiens)
              ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              # Use typed predicate for gene type
              ncbio:typeOfGene "protein-coding" ;
              # Use typed predicate for chromosome
              insdc:chromosome "17" .
        OPTIONAL { ?gene dct:description ?description }
      }
      LIMIT 100
  
  - title: Find Genes by Specific IRIs
    description: Retrieve metadata for multiple specific genes using their unique identifiers.
    question: What are the details for TP53, BRCA1, and INS genes?
    complexity: basic
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?description ?type ?chromosome
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        # Use specific gene IRIs (VALUES pattern)
        VALUES ?gene {
          <http://identifiers.org/ncbigene/7157>  # TP53
          <http://identifiers.org/ncbigene/672>   # BRCA1
          <http://identifiers.org/ncbigene/3630>  # INS
        }
        ?gene rdfs:label ?label ;
              ncbio:typeOfGene ?type .
        OPTIONAL { ?gene dct:description ?description }
        OPTIONAL { ?gene insdc:chromosome ?chromosome }
      }
  
  - title: List Genes with Official Nomenclature Status
    description: Filter by specific nomenclature status using typed predicate.
    question: What are officially named human genes?
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?fullName
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              # Use specific typed predicate value
              ncbio:nomenclatureStatus "official" .
        OPTIONAL { ?gene ncbio:fullName ?fullName }
      }
      LIMIT 100
  
  - title: Count Gene Types Across Multiple Organisms
    description: Aggregate statistics using specific organism IRIs and typed predicates.
    question: How many genes of each type exist in human, mouse, and rat?
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?taxid ?type (COUNT(?gene) as ?count)
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        # Use specific organism IRIs
        VALUES ?taxid {
          <http://identifiers.org/taxonomy/9606>   # Homo sapiens
          <http://identifiers.org/taxonomy/10090>  # Mus musculus
          <http://identifiers.org/taxonomy/10116>  # Rattus norvegicus
        }
        ?gene a insdc:Gene ;
              ncbio:taxid ?taxid ;
              ncbio:typeOfGene ?type .
      }
      GROUP BY ?taxid ?type
      ORDER BY ?taxid DESC(?count)
  
  - title: Navigate Gene Cross-References to External Databases
    description: Explore IRI-based external links through graph navigation.
    question: What Ensembl and HGNC identifiers exist for human genes?
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?dblink
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              # Navigate to external database links
              insdc:dblink ?dblink .
        # Filter by URI pattern for specific databases
        FILTER(
          STRSTARTS(STR(?dblink), "http://identifiers.org/ensembl/") ||
          STRSTARTS(STR(?dblink), "http://identifiers.org/hgnc/")
        )
      }
      LIMIT 100
  
  - title: Explore Orthology Relationships
    description: Navigate bidirectional orthology graph to find related genes across species.
    question: What are the orthologs of human insulin gene?
    complexity: advanced
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      PREFIX orth: <http://purl.org/net/orth#>
      
      SELECT ?ortholog ?label ?taxid ?type
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        # Start with specific gene IRI
        <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?ortholog .
        # Navigate to get ortholog metadata
        ?ortholog rdfs:label ?label ;
                  ncbio:taxid ?taxid ;
                  ncbio:typeOfGene ?type .
      }
      LIMIT 100
  
  - title: Text Search for Gene Descriptions When No Structured Alternative
    description: Use text search on unstructured description field when specific IRIs or predicates not available.
    question: Find genes with "insulin receptor" in their description.
    complexity: intermediate
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?label ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              dct:description ?description .
        # Text search only because description is unstructured free text
        # Use bif:contains (Virtuoso indexed search) for better performance
        ?description bif:contains "'insulin' AND 'receptor'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 50

cross_database_queries:
  shared_endpoint: ncbi
  co_located_databases:
    - clinvar
    - pubmed
    - pubtator
    - medgen
  examples:
    - title: Gene-Variant Integration via ClinVar
      description: |
        Links genes to genetic variants with clinical significance.
        Uses specific gene IRI for pre-filtering (reduces from 3.5M variants to ~8K).
        Handles URI conversion between databases (identifiers.org vs ncbi.nlm.nih.gov).
        Critical optimization: VALUES with gene IRI in ClinVar GRAPH before join.
      databases_used:
        - ncbigene
        - clinvar
      complexity: intermediate
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX sio: <http://semanticscience.org/resource/>
        
        SELECT ?gene_symbol ?gene_desc ?var_label ?var_type ?significance
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            # Use specific gene IRI
            VALUES ?ncbi_gene { <http://identifiers.org/ncbigene/672> }  # BRCA1
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
          }
          # URI conversion between NCBI Gene ID formats
          BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_gene_uri)
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?allele_bnode med2rdf:gene ?cv_gene_uri .
            ?classrec sio:SIO_000628 ?allele_bnode .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     cvo:variation_type ?var_type ;
                     cvo:record_status "current" ;
                     cvo:classified_record ?classrec .
            OPTIONAL {
              ?classrec cvo:classifications/cvo:germline_classification/cvo:description ?significance
            }
          }
        }
        LIMIT 50
      notes: |
        - Strategies: 1 (GRAPH), 3 (VALUES with specific IRI), 5 (URI conversion), 7 (OPTIONAL), 10 (LIMIT)
        - Performance: ~2-3s (Tier 1)
        - VALUES reduces search space by 99.8% (3.5M → ~8K variants)
        - BIND placed BETWEEN GRAPH clauses (critical for performance)
        - URI conversion: identifiers.org/ncbigene/{id} → ncbi.nlm.nih.gov/gene/{id}
        - MIE files referenced: ClinVar (med2rdf:gene, cvo:VariationArchiveType)
    
    - title: Gene-Literature Integration via PubMed
      description: |
        Links genes to research publications via keyword matching.
        Uses specific gene symbol for targeted search.
        Demonstrates cross-database text search coordination.
      databases_used:
        - ncbigene
        - pubmed
      complexity: intermediate
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        
        SELECT ?gene_symbol ?gene_desc ?pmid ?article_title
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            # Use specific gene IRI
            VALUES ?ncbi_gene { <http://identifiers.org/ncbigene/7157> }  # TP53
            ?ncbi_gene a insdc:Gene ;
                       rdfs:label ?gene_symbol .
            OPTIONAL { ?ncbi_gene dct:description ?gene_desc }
          }
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?article_title .
            # Text search for gene symbol in article title
            ?article_title bif:contains "'TP53' AND 'cancer'" .
          }
        }
        LIMIT 30
      notes: |
        - Strategies: 1 (GRAPH), 3 (VALUES), 2 (bif:contains), 7 (OPTIONAL), 10 (LIMIT)
        - Performance: ~3-5s (Tier 2)
        - Double text search (gene + PubMed) for relevance
        - MIE files referenced: PubMed (bibo:pmid, dct:title)
    
    - title: Three-Way Gene-Variant-Literature Integration
      description: |
        Comprehensive integration across three databases for complete gene context.
        May timeout with aggregation - use carefully with strict limits.
        Demonstrates maximum complexity cross-database query pattern.
      databases_used:
        - ncbigene
        - clinvar
        - pubmed
      complexity: advanced
      sparql: |
        PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
        PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
        PREFIX cvo: <http://purl.jp/bio/10/clinvar/>
        PREFIX med2rdf: <http://med2rdf.org/ontology/med2rdf#>
        PREFIX sio: <http://semanticscience.org/resource/>
        PREFIX bibo: <http://purl.org/ontology/bibo/>
        
        SELECT ?gene_symbol ?gene_type ?var_label ?pmid ?article_title
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ncbigene> {
            # Use specific gene IRI
            VALUES ?ncbi_gene { <http://identifiers.org/ncbigene/672> }  # BRCA1
            ?ncbi_gene a insdc:Gene ;
                       dct:identifier ?gene_id ;
                       rdfs:label ?gene_symbol ;
                       ncbio:typeOfGene ?gene_type ;
                       ncbio:taxid <http://identifiers.org/taxonomy/9606> .
          }
          BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_gene_uri)
          GRAPH <http://rdfportal.org/dataset/clinvar> {
            ?allele_bnode med2rdf:gene ?cv_gene_uri .
            ?classrec sio:SIO_000628 ?allele_bnode .
            ?variant a cvo:VariationArchiveType ;
                     rdfs:label ?var_label ;
                     cvo:record_status "current" ;
                     cvo:classified_record ?classrec .
          }
          GRAPH <http://rdfportal.org/dataset/pubmed> {
            ?article bibo:pmid ?pmid ;
                     dct:title ?article_title .
            ?article_title bif:contains "'BRCA1'" .
          }
        }
        LIMIT 5
      notes: |
        - Strategies: 1 (GRAPH), 3 (VALUES), 8 (taxid), 10 (LIMIT)
        - Performance: ~5-20s (Tier 3-4), may timeout with GROUP BY
        - For production use: prefer separate two-way queries
        - MIE files referenced: all three databases

cross_references:
  - pattern: insdc:dblink (IRI links)
    description: |
      Primary external links via identifiers.org URIs.
      Direct IRI-based references for seamless cross-database integration.
    databases:
      Genomics:
        - "Ensembl: gene annotations (~38K human genes)"
        - "HGNC: human nomenclature (~38K genes)"
        - "OMIM: disease associations (~4K genes)"
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?gene ?external
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene insdc:dblink ?external .
        FILTER(STRSTARTS(STR(?external), "http://identifiers.org/ensembl/"))
      }
      LIMIT 10
  
  - pattern: insdc:db_xref (string references)
    description: |
      String-based references in "Database:ID" format.
      Used for databases without identifiers.org URIs.
    databases:
      Various:
        - "AllianceGenome: integrated genomics resources"
    sparql: |
      PREFIX insdc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?gene ?xref
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene insdc:db_xref ?xref .
        FILTER(CONTAINS(?xref, "AllianceGenome"))
      }
      LIMIT 10
  
  - pattern: orth:hasOrtholog
    description: |
      Bidirectional orthology for comparative genomics.
      Internal NCBI Gene references enabling cross-species analysis.
    databases:
      Internal:
        - "NCBI Gene: within-database orthology"
    sparql: |
      PREFIX orth: <http://purl.org/net/orth#>
      
      SELECT ?gene1 ?gene2
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene1 orth:hasOrtholog ?gene2 .
      }
      LIMIT 10
  
  - pattern: ncbio:taxid
    description: |
      Taxonomic classification via NCBI Taxonomy IRIs.
      Essential filter for organism-specific queries.
    databases:
      Taxonomy:
        - "NCBI Taxonomy: organism classification (9606=human, 10090=mouse, etc.)"
    sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      SELECT ?gene ?taxid
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid ?taxid .
      }
      LIMIT 10

architectural_notes:
  query_strategy:
    - "Exploratory: Use ncbi_esearch('gene', 'SYMBOL[sym] AND organism[orgn]') to find gene IDs"
    - "Comprehensive: Use specific gene IRIs in VALUES or direct references"
    - "Organism filtering: Use specific taxonomy IRIs (e.g., <http://identifiers.org/taxonomy/9606> for human)"
    - "Gene type filtering: Use typed predicate ncbio:typeOfGene with specific values"
    - "Chromosome filtering: Use typed predicate insdc:chromosome"
    - "Text search: bif:contains (Virtuoso indexed) > FILTER(CONTAINS()) (fallback)"
    - "Priority: Specific IRIs > Typed predicates > Graph navigation > Text search"
  
  schema_design:
    - "Single Gene entity with comprehensive properties"
    - "identifiers.org URIs for cross-database consistency"
    - "Label = gene symbols (TP53), description = full names (tumor protein p53)"
    - "IRI-based (dblink) vs string-based (db_xref) external references"
    - "Bidirectional orthology enables comparative analysis"
    - "Typed predicates for controlled vocabularies (typeOfGene, nomenclatureStatus)"
  
  performance:
    - "Use specific organism IRIs (not text search on species)"
    - "Use bif:contains for text search (indexed), not REGEX/FILTER"
    - "Filter by ncbio:taxid early to reduce search space (57M → ~200K for human)"
    - "Gene ID lookups by IRI: <1s"
    - "Type/chromosome filtering with taxid: 1-5s"
    - "bif:contains text search with taxid: 1-3s"
    - "Orthology queries: always add LIMIT (10-30s without)"
    - "Always include FROM clause for graph targeting"
  
  data_integration:
    - "identifiers.org URIs enable seamless cross-database linking"
    - "HGNC for nomenclature, Ensembl for annotations, OMIM for diseases"
    - "ClinVar integration via URI conversion (identifiers.org ↔ ncbi.nlm.nih.gov)"
    - "PubMed integration via symbol-based text search"
    - "Orthology links enable comparative genomics within NCBI Gene"
  
  cross_database_optimization:
    - "Strategy 1: Explicit GRAPH clauses (MANDATORY for shared endpoint)"
    - "Strategy 2: Apply filters within GRAPH before joins"
    - "Strategy 3: VALUES with specific gene IRIs for pre-filtering"
    - "Strategy 5: URI conversion with BIND between GRAPHs (never inside)"
    - "Strategy 7: Order OPTIONAL blocks (required first)"
    - "Strategy 8: Filter by taxid (reduces 57M → ~200K for human)"
    - "Strategy 10: Document performance tier and add LIMIT"
    - "CRITICAL: BIND between GRAPH clauses, not inside"
    - "Three-way queries may timeout - use separate two-way queries"
  
  data_quality:
    - "Official status via ncbio:nomenclatureStatus (official/interim)"
    - "Synonyms capture historical and alternative names"
    - "Optional properties vary by curation level"
    - "Best coverage for model organisms (human, mouse, rat)"
    - "Non-model organisms have sparser annotations"

data_statistics:
  total_genes: 57768578
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(?gene) as ?count)
    FROM <http://rdfportal.org/dataset/ncbigene>
    WHERE { ?gene a insdc:Gene }
  
  human_genes: 193288
  verified_date_human: "2025-02-09"
  verification_query_human: |
    SELECT (COUNT(?gene) as ?count)
    FROM <http://rdfportal.org/dataset/ncbigene>
    WHERE {
      ?gene a insdc:Gene ;
            ncbio:taxid <http://identifiers.org/taxonomy/9606> .
    }
  
  gene_types:
    protein_coding: 46105590
    ncRNA: 3476823
    tRNA: 3030346
    pseudo: 2731789
    rRNA: 993602
    verified_date: "2025-02-09"
    verification_query: |
      SELECT ?type (COUNT(?gene) as ?count)
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE { ?gene ncbio:typeOfGene ?type }
      GROUP BY ?type
  
  top_organisms:
    human_9606: 193288
    mouse_10090: 112285
    verified_date: "2025-02-09"
    methodology: "Counted by ncbio:taxid"
  
  coverage:
    description: "~95% (human genes)"
    chromosomal_location: "~80% (human genes)"
    external_ensembl_links: "~20% (38,399 human genes with Ensembl)"
    methodology: "Sampled human genes"
    verified_date: "2025-02-09"
  
  cardinality:
    avg_synonyms: "2.5 per gene (human protein-coding)"
    avg_links: "1.8 external links per gene (human)"
    avg_orthologs: "15-50 per gene (varies by species)"
    methodology: "Sampled human protein-coding genes"
  
  performance_characteristics:
    - "Gene ID lookup by IRI: <1s"
    - "Type filtering with taxid: 1-5s"
    - "Chromosome filtering with taxid: 1-5s"
    - "bif:contains search with taxid: 1-3s"
    - "Orthology queries with LIMIT: 10-30s"
    - "Cross-database (two-way with VALUES): 2-5s (Tier 1)"
    - "Cross-database (three-way with VALUES): 5-20s (Tier 3-4)"
  
  staleness_warning: |
    Regular updates from NCBI. Best curated for human, mouse, rat.
    Coverage decreases for non-model organisms.

anti_patterns:
  - title: "Text Search for Organism When Specific IRI Available"
    problem: "Slow text search when specific taxonomy IRI can be used."
    wrong_sparql: |
      # Slow: text search for organism
      SELECT ?gene ?label
      WHERE {
        ?gene rdfs:label ?label .
        ?label bif:contains "'human'" .
      }
    correct_sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      # Fast: use specific organism IRI
      SELECT ?gene ?label
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene a insdc:Gene ;
              rdfs:label ?label ;
              ncbio:taxid <http://identifiers.org/taxonomy/9606> .
      }
      LIMIT 100
    explanation: "Find organism IRI from NCBI Taxonomy or use known values (9606=human, 10090=mouse). This is 10-100x faster than text search."
  
  - title: "Searching Without Organism Filter"
    problem: "Query timeout with 57M+ genes when no organism filter applied."
    wrong_sparql: |
      # Timeout: searches all 57M genes
      SELECT ?gene ?description
      WHERE {
        ?gene dct:description ?description .
        ?description bif:contains "'insulin'" .
      }
    correct_sparql: |
      PREFIX ncbio: <https://dbcls.github.io/ncbigene-rdf/ontology.ttl#>
      
      # Fast: filter by organism first
      SELECT ?gene ?description ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              dct:description ?description .
        ?description bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 100
    explanation: "Always filter by ncbio:taxid to reduce search space from 57M to organism subset (~200K for human). Add FROM clause and LIMIT."
  
  - title: "Unbounded Orthology Queries"
    problem: "Millions of orthology relationships cause timeout."
    wrong_sparql: |
      # Timeout: retrieves millions of ortholog pairs
      SELECT ?gene1 ?gene2
      WHERE {
        ?gene1 orth:hasOrtholog ?gene2 .
      }
    correct_sparql: |
      PREFIX orth: <http://purl.org/net/orth#>
      
      # Fast: start with specific gene IRI
      SELECT ?ortholog ?label
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        <http://identifiers.org/ncbigene/3630> orth:hasOrtholog ?ortholog .
        ?ortholog rdfs:label ?label .
      }
      LIMIT 100
    explanation: "Always start with specific gene IRI and add LIMIT. Never query all orthology relationships."

common_errors:
  - error: "Query timeout or no results"
    causes:
      - "No organism filter on 57M+ genes"
      - "Using FILTER(CONTAINS()) instead of bif:contains"
      - "Missing FROM clause"
      - "Unbounded orthology queries"
    solutions:
      - "Filter by ncbio:taxid with specific organism IRI early"
      - "Use bif:contains for text search (indexed)"
      - "Include FROM <http://rdfportal.org/dataset/ncbigene>"
      - "Add LIMIT (10-1000 depending on query)"
      - "Start with specific gene IRIs using VALUES"
      - "Consider ncbi_esearch for initial discovery"
    example_fix: |
      # Wrong: No organism filter, slow text search
      SELECT ?gene WHERE {
        ?gene dct:description ?desc .
        FILTER(CONTAINS(?desc, "insulin"))
      }
      
      # Right: Organism filter + bif:contains
      SELECT ?gene ?desc ?sc
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              dct:description ?desc .
        ?desc bif:contains "'insulin'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 100
  
  - error: "Empty results for valid gene symbols"
    causes:
      - "Searching for full name in label field"
      - "Wrong identifier format"
      - "Missing full URI"
    solutions:
      - "Label = symbols (TP53), description = full names (tumor protein p53)"
      - "Search descriptions for full names using bif:contains"
      - "Use full URI: <http://identifiers.org/ncbigene/ID>"
      - "Verify gene ID exists via ncbi_esearch"
    example_fix: |
      # Wrong: Searching for full name in label
      SELECT ?gene WHERE {
        ?gene rdfs:label ?label .
        ?label bif:contains "'tumor protein'" .
      }
      
      # Right: Search in description field
      SELECT ?gene ?label ?description
      FROM <http://rdfportal.org/dataset/ncbigene>
      WHERE {
        ?gene ncbio:taxid <http://identifiers.org/taxonomy/9606> ;
              rdfs:label ?label ;
              dct:description ?description .
        ?description bif:contains "'tumor protein'" .
      }
      LIMIT 100
  
  - error: "Cross-database query returns no results"
    causes:
      - "URI pattern mismatch between databases"
      - "BIND placed inside GRAPH clause"
      - "Wrong graph URIs"
    solutions:
      - "Convert URI patterns with BIND and CONCAT"
      - "Place BIND between GRAPH clauses (never inside)"
      - "Verify graph URIs from MIE files"
      - "Test each GRAPH independently first"
    example_fix: |
      # Wrong: BIND inside GRAPH
      GRAPH <ncbigene> {
        ?gene dct:identifier ?gene_id .
        BIND(IRI(CONCAT("http://...", ?gene_id)) AS ?uri)  # WRONG!
      }
      
      # Right: BIND between GRAPHs
      GRAPH <ncbigene> {
        ?gene dct:identifier ?gene_id .
      }
      BIND(IRI(CONCAT("http://ncbi.nlm.nih.gov/gene/", ?gene_id)) AS ?cv_uri)
      GRAPH <clinvar> {
        ?variant med2rdf:gene ?cv_uri .
      }
