schema_info:
  title: DDBJ (DNA Data Bank of Japan)
  description: |
    DDBJ RDF provides nucleotide sequence data from INSDC (International Nucleotide Sequence Database Collaboration). 
    Contains genome entries with genes, coding sequences, and RNA features using FALDO coordinates, Sequence Ontology typing, 
    and BFO/RO relationships. Primarily prokaryotic genomes (bacteria, archaea) and phages with links to BioProject, BioSample, 
    NCBI Protein, and Taxonomy.
  endpoint: https://rdfportal.org/ddbj/sparql
  base_uri: http://identifiers.org/insdc/
  graphs:
    - http://rdfportal.org/dataset/ddbj
    - http://rdfportal.org/ontology/taxonomy
    - http://rdfportal.org/ontology/so
    - http://rdfportal.org/ontology/faldo
  kw_search_tools: []
  version:
    mie_version: "2.4"
    mie_created: "2025-02-10"
    data_version: "DDBJ Release (continuous updates)"
    update_frequency: "Daily"
  license:
    data_license: "CC0 1.0 Universal (CC0 1.0) Public Domain Dedication"
    license_url: "https://creativecommons.org/publicdomain/zero/1.0/"
  access:
    rate_limiting: "No strict rate limit, use responsibly"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
  PREFIX faldo: <http://biohackathon.org/resource/faldo#>
  PREFIX bfo: <http://purl.obolibrary.org/obo/BFO_>
  PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
  PREFIX sio: <http://semanticscience.org/resource/SIO_>
  PREFIX so: <http://purl.obolibrary.org/obo/SO_>
  
  <EntryShape> {
    a [ nuc:Entry ] ;
    rdfs:label xsd:string ;
    dcterms:identifier xsd:string ;
    nuc:definition xsd:string ;
    nuc:organism xsd:string ;
    nuc:taxonomy xsd:string ;
    nuc:division IRI ;
    nuc:sequence IRI ;
    nuc:sequence_version xsd:string ;
    nuc:sequence_date xsd:date ;
    nuc:dblink IRI* ;
    nuc:reference IRI* ;
    nuc:comment xsd:string ? ;
    nuc:source xsd:string ?
  }
  
  <GeneShape> {
    a [ nuc:Gene ] ;
    rdfs:subClassOf IRI+ ;
    nuc:locus_tag xsd:string ;
    nuc:gene xsd:string ? ;
    faldo:location @<RegionShape> ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <CodingSequenceShape> {
    a [ nuc:Coding_Sequence ] ;
    rdfs:subClassOf IRI+ ;
    nuc:locus_tag xsd:string ;
    nuc:product xsd:string ;
    nuc:translation xsd:string ;
    nuc:codon_start xsd:integer ;
    nuc:transl_table xsd:integer ;
    faldo:location @<RegionShape> ;
    rdfs:seeAlso IRI ;
    sio:SIO_010081 IRI ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <RNAFeatureShape> {
    a [ nuc:Transfer_RNA nuc:Ribosomal_RNA nuc:Non_Coding_RNA ] ;
    rdfs:subClassOf IRI+ ;
    faldo:location @<RegionShape> ;
    nuc:product xsd:string ? ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <SourceShape> {
    a [ nuc:Source ] ;
    rdfs:subClassOf IRI ;
    nuc:organism xsd:string ;
    nuc:mol_type xsd:string ;
    faldo:location @<RegionShape> ;
    rdfs:seeAlso IRI ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <RegionShape> {
    a [ faldo:Region ] ;
    faldo:begin @<PositionShape> ;
    faldo:end @<PositionShape>
  }
  
  <PositionShape> {
    a [ faldo:ExactPosition ] ;
    faldo:position xsd:integer ;
    faldo:reference IRI
  }

sample_rdf_entries:
  - title: Entry with BioProject and BioSample Links
    description: Genome entry demonstrating external database linkage for experimental context.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/insdc/CP036276.1>
        a nuc:Entry ;
        rdfs:label "Symmachiella dynata strain Mal52 chromosome, complete genome." ;
        dcterms:identifier "CP036276.1" ;
        nuc:organism "Symmachiella dynata" ;
        nuc:division <http://ddbj.nig.ac.jp/ontologies/nucleotide/Division#BCT> ;
        nuc:dblink <http://identifiers.org/biosample/SAMN10954015> ;
        nuc:dblink <http://identifiers.org/bioproject/PRJNA485700> .
  
  - title: Gene with FALDO Coordinates
    description: Gene with locus tag and precise genomic location using FALDO.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix faldo: <http://biohackathon.org/resource/faldo#> .
      @prefix bfo: <http://purl.obolibrary.org/obo/BFO_> .
      @prefix ro: <http://purl.obolibrary.org/obo/RO_> .
      
      <http://identifiers.org/insdc/CP036276.1#feature:1001623-1002915:1:gene.47722>
        a nuc:Gene ;
        rdfs:subClassOf <http://purl.obolibrary.org/obo/SO_0000704> ;
        nuc:locus_tag "Mal52_08030" ;
        nuc:gene "clpX" ;
        faldo:location <http://identifiers.org/insdc/CP036276.1#region:1001623-1002915:1> ;
        bfo:0000050 <http://identifiers.org/insdc/CP036276.1#sequence> ;
        ro:0002162 <http://identifiers.org/taxonomy/2527995> .
  
  - title: CDS with Protein Cross-reference
    description: Coding sequence showing protein product annotation and NCBI Protein link.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix sio: <http://semanticscience.org/resource/SIO_> .
      
      <http://identifiers.org/insdc/CP036276.1#feature:1001623-1002915:1:CDS.47054>
        a nuc:Coding_Sequence ;
        nuc:locus_tag "Mal52_08030" ;
        nuc:product "ATP-dependent Clp protease ATP-binding subunit ClpX" ;
        nuc:translation "MPSGNDVTSGSRGATGKK..." ;
        nuc:codon_start 1 ;
        nuc:transl_table 11 ;
        rdfs:seeAlso <http://identifiers.org/ncbiprotein/QDU42347.1> ;
        sio:SIO_010081 <http://identifiers.org/insdc/CP036276.1#feature:1001623-1002915:1:gene.47722> .
  
  - title: Transfer RNA Feature
    description: tRNA showing structured annotation with FALDO coordinates.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix so: <http://purl.obolibrary.org/obo/SO_> .
      
      <http://identifiers.org/insdc/CP036276.1#feature:1040005-1040079:1:tRNA.513>
        a nuc:Transfer_RNA ;
        rdfs:subClassOf so:0000253 ;
        nuc:product "tRNA-Ile" ;
        bfo:0000050 <http://identifiers.org/insdc/CP036276.1#sequence> ;
        ro:0002162 <http://identifiers.org/taxonomy/2527995> .
  
  - title: Source with Taxonomy Link
    description: Source feature linking organism to NCBI Taxonomy classification.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/insdc/AB023775.1#feature:103-136:1:source.1>
        a nuc:Source ;
        nuc:organism "Lactobacillus phage phiFSW" ;
        nuc:mol_type "genomic DNA" ;
        rdfs:seeAlso <http://identifiers.org/taxonomy/91019> ;
        ro:0002162 <http://identifiers.org/taxonomy/1582> .

sparql_query_examples:
  - title: Retrieve Phage Entries by Division IRI
    description: Use specific division IRI to filter bacteriophage genomes.
    question: What phage entries are in the database?
    complexity: basic
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?organism ?definition
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:division <http://ddbj.nig.ac.jp/ontologies/nucleotide/Division#PHG> ;
               nuc:organism ?organism ;
               nuc:definition ?definition .
      }
      LIMIT 10
  
  - title: Get Gene Annotations by Locus Tag
    description: Retrieve gene and product details for specific locus identifier using typed predicate.
    question: What are the annotations for locus Mal52_08030?
    complexity: basic
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?gene ?gene_symbol ?product
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag "Mal52_08030" .
        OPTIONAL { ?gene nuc:gene ?gene_symbol }
        OPTIONAL {
          ?cds nuc:locus_tag "Mal52_08030" ;
               nuc:product ?product .
        }
      }
  
  - title: Find Genes for Specific Organism by Taxonomy IRI
    description: Query genes using specific NCBI Taxonomy IRI to filter by organism.
    question: What genes are annotated for Symmachiella dynata (taxonomy:2527995)?
    complexity: intermediate
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
      
      SELECT ?gene ?locus ?gene_name
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              ro:0002162 <http://identifiers.org/taxonomy/2527995> ;
              nuc:locus_tag ?locus .
        OPTIONAL { ?gene nuc:gene ?gene_name }
      }
      LIMIT 20
  
  - title: Search Entries by Organism Using bif:contains
    description: |
      Full-text organism search with relevance scoring when specific taxonomy IRI is unknown.
      
      Text search justified:
      - Checked MIE schema - nuc:organism is free-text string field
      - No controlled vocabulary exists for organism names at entry level
      - Taxonomy IRIs available via ro:0002162 but require knowing exact NCBI Taxonomy ID
      - bif:contains appropriate for exploratory organism search by name
    question: What entries exist for organisms containing 'Escherichia' and 'coli' in their names?
    complexity: intermediate
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?organism ?relevance
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:organism ?organism .
        # Text search justified: organism field is free-text, use for name-based discovery
        ?organism bif:contains "'escherichia' AND 'coli'" option (score ?relevance) .
      }
      ORDER BY DESC(?relevance)
      LIMIT 10
  
  - title: Retrieve Genes with Genomic Coordinates in Entry
    description: Query genes with FALDO positions from specific entry, demonstrating entry-scoped filtering.
    question: What are the gene coordinates in entry CP036276.1?
    complexity: intermediate
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      
      SELECT ?locus ?gene_name ?start ?end
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag ?locus ;
              faldo:location ?region .
        OPTIONAL { ?gene nuc:gene ?gene_name }
        ?region faldo:begin/faldo:position ?start ;
                faldo:end/faldo:position ?end .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      }
      LIMIT 20
  
  - title: Gene-CDS-Protein Integration with Coordinates
    description: Complex join of genes, coding sequences, proteins, and positions with entry-scoped filtering to prevent Cartesian products.
    question: Get complete gene-to-protein annotations with coordinates for CP036276.1.
    complexity: advanced
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT ?entry_id ?locus ?gene_name ?product ?start ?end ?protein
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               dcterms:identifier ?entry_id .
        FILTER(?entry_id = "CP036276.1")
        
        ?gene a nuc:Gene ;
              nuc:locus_tag ?locus ;
              faldo:location ?region .
        OPTIONAL { ?gene nuc:gene ?gene_name }
        FILTER(CONTAINS(STR(?gene), ?entry_id))
        
        ?region faldo:begin/faldo:position ?start ;
                faldo:end/faldo:position ?end .
        
        ?cds sio:SIO_010081 ?gene ;
             nuc:product ?product ;
             rdfs:seeAlso ?protein .
        FILTER(CONTAINS(STR(?protein), "ncbiprotein"))
      }
      LIMIT 20
  
  - title: Multi-Feature Query with Division and Taxonomy Context
    description: Advanced query retrieving genes and RNAs with organism classification using specific IRIs.
    question: Get genes and RNA features with division and taxonomy for CP036276.1.
    complexity: advanced
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
      
      SELECT ?entry_id ?organism ?division ?taxon ?locus ?feature_type
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               dcterms:identifier ?entry_id ;
               nuc:organism ?organism ;
               nuc:division ?division .
        FILTER(?entry_id = "CP036276.1")
        
        ?feature ro:0002162 ?taxon ;
                 nuc:locus_tag ?locus .
        
        {
          ?feature a nuc:Gene .
          BIND("gene" AS ?feature_type)
        }
        UNION
        {
          ?feature a nuc:Transfer_RNA .
          BIND("tRNA" AS ?feature_type)
        }
        UNION
        {
          ?feature a nuc:Ribosomal_RNA .
          BIND("rRNA" AS ?feature_type)
        }
      }
      LIMIT 50

cross_references:
  - pattern: nuc:dblink
    description: |
      Entry-level links to BioProject and BioSample providing sequencing project organization and specimen metadata.
    databases:
      project_metadata:
        - "BioProject: Sequencing project organization"
        - "BioSample: Specimen and sample metadata"
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?bioproject ?biosample
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:dblink ?bioproject ;
               nuc:dblink ?biosample .
        FILTER(CONTAINS(STR(?bioproject), "bioproject"))
        FILTER(CONTAINS(STR(?biosample), "biosample"))
      }
      LIMIT 10
  
  - pattern: rdfs:seeAlso
    description: |
      Feature-level links to NCBI Protein for translations and NCBI Taxonomy for organism classification.
    databases:
      protein:
        - "NCBI Protein: RefSeq protein sequences"
      taxonomy:
        - "NCBI Taxonomy: Taxonomic classification"
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?feature ?external_db
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?feature rdfs:seeAlso ?external_db .
        FILTER(CONTAINS(STR(?external_db), "ncbiprotein") || 
               CONTAINS(STR(?external_db), "taxonomy"))
      }
      LIMIT 50
  
  - pattern: ro:0002162 (in taxon)
    description: |
      RO property linking all features to NCBI Taxonomy for phylogenetic context.
    databases:
      taxonomy:
        - "NCBI Taxonomy: Complete taxonomic hierarchy"
    sparql: |
      PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
      
      SELECT ?feature ?taxon
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?feature ro:0002162 ?taxon .
        FILTER(CONTAINS(STR(?taxon), "taxonomy"))
      }
      LIMIT 50
  
  - pattern: rdfs:subClassOf
    description: |
      Semantic classification using Sequence Ontology for standardized feature typing.
    databases:
      ontology:
        - "Sequence Ontology: Genomic feature type vocabulary"
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?feature ?so_class
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?feature rdfs:subClassOf ?so_class .
        FILTER(CONTAINS(STR(?so_class), "obo/SO_"))
      }
      LIMIT 50

architectural_notes:
  query_strategy:
    - "MANDATORY FIRST STEP: Check MIE shape_expressions for structured properties before any query"
    - "Use specific IRIs whenever possible: division IRIs (<http://ddbj.nig.ac.jp/ontologies/nucleotide/Division#BCT>, Division#PHG), taxonomy IRIs (<http://identifiers.org/taxonomy/TAXID>)"
    - "Typed predicates: Use nuc:locus_tag, nuc:product, dcterms:identifier for precise filtering"
    - "Text search: Use bif:contains ONLY at entry level for organism searches when taxonomy IRI is unknown (indexed, fast, relevance-scored)"
    - "Entry-scoped filtering: ALWAYS filter by entry accession (FILTER(CONTAINS(STR(?var), 'ACCESSION'))) before complex joins to prevent timeout"
    - "Feature products: Use FILTER CONTAINS or REGEX (not bif:contains) for feature-level product searches within entries"
    - "Priority: Specific IRIs > Typed predicates (locus_tag, product) > Entry filtering > Text search (rare)"
  
  schema_design:
    - "Entry-centric model: BFO_0000050 (part of) for feature-to-entry relationships"
    - "FALDO provides precise genomic coordinates for all features (>99% coverage)"
    - "Sequence Ontology terms via rdfs:subClassOf for semantic feature typing"
    - "Gene-CDS links via sio:SIO_010081 (UPPERCASE SIO required, case-sensitive)"
    - "All features linked to organisms via ro:0002162 (RO relation ontology)"
    - "Division IRIs: Division#BCT (bacteria), Division#PHG (phage), Division#VRL (viral), Division#PLN (plant)"
  
  performance:
    - "CRITICAL: Filter by entry accession BEFORE joins to prevent Cartesian products and timeouts"
    - "Entry-specific queries: <1s response time"
    - "bif:contains at entry level: <2s with relevance scoring"
    - "Avoid aggregation (COUNT, GROUP BY) without entry filtering - use LIMIT sampling instead"
    - "Always scope coordinate queries to specific entries"
  
  data_integration:
    - "Uses identifiers.org URIs for cross-database linking"
    - "BioProject/BioSample provide experimental context (~85% coverage)"
    - "NCBI Protein and Taxonomy enable protein and organism connections (>99% coverage)"
    - "Direct IRI linkage allows graph navigation without string matching"
  
  data_quality:
    - "Locus tags more reliable than gene symbols (>99% vs ~60% coverage)"
    - "CDS features have >95% product and translation coverage"
    - "Primarily prokaryotic genomes (bacteria, archaea) plus viral sequences"
    - "All features have FALDO coordinates (>99%)"
    - "Daily updates - statistics may change frequently"

data_statistics:
  total_entries: "Large collection (100K+ entries)"
  verified_date: "2025-02-10"
  verification_method: "Sampling with LIMIT (full COUNT times out due to large dataset size)"
  
  coverage:
    entries_with_organism: ">99%"
    calculation: "Sample query confirmed organism field nearly universal"
    verified_date: "2025-02-10"
    
    entries_with_bioproject: "~85%"
    calculation: "Based on sample of entries with nuc:dblink to bioproject"
    verified_date: "2025-02-10"
    verification_query: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      SELECT ?entry ?bioproject
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:dblink ?bioproject .
        FILTER(CONTAINS(STR(?bioproject), "bioproject"))
      }
      LIMIT 100
    
    genes_with_locus_tag: ">99%"
    calculation: "Based on sampling CP036276.1 genes"
    verified_date: "2025-02-10"
    
    genes_with_gene_symbol: "~60%"
    note: "Gene symbols are optional annotations, locus tags are primary identifiers"
    
    cds_with_product: ">95%"
    note: "Product descriptions nearly universal for coding sequences"
    
    features_with_faldo: ">99%"
    note: "FALDO coordinates nearly universal"
  
  cardinality:
    genes_per_entry: "10-5000"
    note: "Varies by genome size and organism complexity"
    
    trna_per_entry: "40-100"
    note: "Typical for bacterial genomes"
    
    rrna_per_entry: "3-9"
    note: "5S, 16S, 23S ribosomal RNAs"
  
  performance_characteristics:
    - "Entry-specific queries by accession: <1s"
    - "bif:contains organism search at entry level: <2s"
    - "Product searches require entry filtering to avoid timeout"
    - "Cross-entry aggregation requires sampling approach"
  
  staleness_warning: "Daily updates - statistics current as of 2025-02-10, may change frequently"

anti_patterns:
  - title: Skipping MIE Schema Check Before Text Search
    problem: Using bif:contains without checking MIE schema for structured alternatives (division IRIs, taxonomy IRIs, typed predicates).
    wrong_sparql: |
      # WRONG - No schema checked, no examples inspected
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?organism
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:organism ?organism .
        ?organism bif:contains "'phage'"
      }
    correct_sparql: |
      # CORRECT - Checked MIE schema, found division IRI for phages
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      # Workflow:
      # 1. get_MIE_file("ddbj") â†’ examined <EntryShape>
      # 2. Found: nuc:division predicate with IRI values
      # 3. Discovered: Division#PHG IRI for bacteriophages
      # 4. Use specific IRI (faster, more precise):
      SELECT ?entry ?organism
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:division <http://ddbj.nig.ac.jp/ontologies/nucleotide/Division#PHG> ;
               nuc:organism ?organism .
      }
    explanation: |
      Always check MIE schema_expressions before defaulting to text search. 
      DDBJ has division IRIs for major categories (bacteria, phage, virus, plant).
      Use specific IRIs when available for better performance and precision.
  
  - title: Unfiltered Feature Joins Create Cartesian Products
    problem: Joining features without entry filtering causes massive result sets (millions of combinations) and timeouts.
    wrong_sparql: |
      # WRONG - Creates Cartesian product, will timeout
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT ?gene ?cds
      WHERE {
        ?gene a nuc:Gene .
        ?cds a nuc:Coding_Sequence .
        ?cds sio:SIO_010081 ?gene .
      }
    correct_sparql: |
      # CORRECT - Entry-scoped filtering prevents Cartesian product
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT ?gene ?cds
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene .
        ?cds sio:SIO_010081 ?gene .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      }
      LIMIT 100
    explanation: ALWAYS filter by entry accession BEFORE joins. Without entry scope, the query matches all genes against all CDS features across the entire database.
  
  - title: Aggregation Without Entry Scope
    problem: Using COUNT/GROUP BY without entry filter scans entire database causing timeout.
    wrong_sparql: |
      # WRONG - Tries to count all entries, will timeout
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT (COUNT(*) as ?count)
      WHERE { ?entry a nuc:Entry }
    correct_sparql: |
      # CORRECT - Use sampling instead of aggregation
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE { ?entry a nuc:Entry }
      LIMIT 100
    explanation: Replace aggregation with LIMIT-based sampling for statistics. For exact counts, scope to specific divisions or use data statistics documentation.
  
  - title: Text Search Instead of Specific IRIs
    problem: Using text search (bif:contains or FILTER) when specific division or taxonomy IRIs are available.
    wrong_sparql: |
      # SLOW - Text search when division IRI is available
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?organism
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:organism ?organism .
        ?organism bif:contains "'phage'"
      }
    correct_sparql: |
      # FAST - Use specific division IRI
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?organism
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:division <http://ddbj.nig.ac.jp/ontologies/nucleotide/Division#PHG> ;
               nuc:organism ?organism .
      }
    explanation: Use specific IRIs (division, taxonomy) for faster, more precise queries. Text search should be last resort when no structured alternative exists.

common_errors:
  - error: Query Timeout
    causes:
      - "Cartesian products from unfiltered joins between gene/CDS/RNA features"
      - "Aggregation (COUNT, GROUP BY) without entry filtering"
      - "FALDO coordinate queries without entry scope"
      - "Using bif:contains on feature properties instead of entry level"
    solutions:
      - "Add entry filter: FILTER(CONTAINS(STR(?var), 'ACCESSION'))"
      - "Use FILTER CONTAINS/REGEX (not bif:contains) for feature products"
      - "Sample with LIMIT instead of COUNT"
      - "Scope all queries to specific entries before joins"
    example_fix: |
      # WRONG - timeout risk (Cartesian product):
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      SELECT ?gene ?cds WHERE {
        ?gene a nuc:Gene .
        ?cds sio:SIO_010081 ?gene .
      }
      
      # CORRECT - entry-scoped (prevents Cartesian product):
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      SELECT ?gene ?cds
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene .
        ?cds sio:SIO_010081 ?gene .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      } LIMIT 100
  
  - error: Wrong SIO Property Case
    causes:
      - "Using lowercase sio:010081 instead of sio:SIO_010081"
      - "SIO namespace is case-sensitive in DDBJ"
    solutions:
      - "Always use uppercase: sio:SIO_010081"
      - "Verify property names match exactly in examples"
    example_fix: |
      # WRONG - lowercase will not match:
      ?cds sio:010081 ?gene .
      
      # CORRECT - uppercase required:
      ?cds sio:SIO_010081 ?gene .
  
  - error: Empty Results or Missing Data
    causes:
      - "Missing FROM clause"
      - "Treating optional properties (like nuc:gene) as required"
      - "Wrong bif:contains syntax"
      - "Not using specific IRIs when available"
    solutions:
      - "Always include: FROM <http://rdfportal.org/dataset/ddbj>"
      - "Use OPTIONAL for properties like nuc:gene (gene symbols are ~60% coverage)"
      - "bif:contains syntax: bif:contains \"'keyword'\" or bif:contains \"'term1' AND 'term2'\""
      - "Use specific division/taxonomy IRIs instead of text search"
      - "Sample entries first to verify feature types exist"
    example_fix: |
      # WRONG - missing optional, no FROM:
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      SELECT ?gene ?symbol WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag "ABC_001" ;
              nuc:gene ?symbol .
      }
      
      # CORRECT - with optional and FROM:
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      SELECT ?gene ?symbol
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag "ABC_001" .
        OPTIONAL { ?gene nuc:gene ?symbol }
      }
