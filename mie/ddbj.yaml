schema_info:
  title: DDBJ (DNA Data Bank of Japan)
  description: |
    DDBJ RDF provides nucleotide sequence data from INSDC (International Nucleotide Sequence Database Collaboration). Contains genome entries with genes, coding sequences, and RNA features using FALDO coordinates, Sequence Ontology typing, and BFO/RO relationships. Primarily prokaryotic genomes with links to BioProject, BioSample, NCBI Protein, and Taxonomy.
  endpoint: https://rdfportal.org/ddbj/sparql
  base_uri: http://identifiers.org/insdc/
  graphs:
    - http://rdfportal.org/dataset/ddbj
  kw_search_tools:
    - sparql (use bif:contains for organism searches)
  version:
    mie_version: "2.2"
    mie_created: "2025-02-03"
    data_version: "DDBJ Release (continuous updates)"
    update_frequency: "Daily"
  license:
    data_license: "CC0 1.0 Universal (CC0 1.0) Public Domain Dedication"
    license_url: "https://creativecommons.org/publicdomain/zero/1.0/"
  access:
    rate_limiting: "No strict rate limit, use responsibly"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso (supports bif:contains)"

shape_expressions: |
  PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
  PREFIX faldo: <http://biohackathon.org/resource/faldo#>
  PREFIX bfo: <http://purl.obolibrary.org/obo/BFO_>
  PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
  PREFIX sio: <http://semanticscience.org/resource/SIO_>
  PREFIX so: <http://purl.obolibrary.org/obo/SO_>
  
  <EntryShape> {
    a [ nuc:Entry ] ;
    rdfs:label xsd:string ;
    dcterms:identifier xsd:string ;
    nuc:definition xsd:string ;
    nuc:organism xsd:string ;
    nuc:taxonomy xsd:string ;
    nuc:division IRI ;
    nuc:sequence IRI ;
    nuc:sequence_version xsd:string ;
    nuc:sequence_date xsd:date ;
    nuc:dblink IRI* ;
    nuc:reference IRI* ;
    nuc:comment xsd:string ? ;
    nuc:source xsd:string ?
  }
  
  <GeneShape> {
    a [ nuc:Gene ] ;
    rdfs:subClassOf IRI+ ;
    nuc:locus_tag xsd:string ;
    nuc:gene xsd:string ? ;
    faldo:location @<RegionShape> ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <CodingSequenceShape> {
    a [ nuc:Coding_Sequence ] ;
    rdfs:subClassOf IRI+ ;
    nuc:locus_tag xsd:string ;
    nuc:product xsd:string ;
    nuc:translation xsd:string ;
    nuc:codon_start xsd:integer ;
    nuc:transl_table xsd:integer ;
    faldo:location @<RegionShape> ;
    rdfs:seeAlso IRI ;
    sio:SIO_010081 IRI ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <RNAFeatureShape> {
    a [ nuc:Transfer_RNA nuc:Ribosomal_RNA nuc:Non_Coding_RNA ] ;
    rdfs:subClassOf IRI+ ;
    faldo:location @<RegionShape> ;
    nuc:product xsd:string ? ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <SourceShape> {
    a [ nuc:Source ] ;
    rdfs:subClassOf IRI ;
    nuc:organism xsd:string ;
    nuc:mol_type xsd:string ;
    faldo:location @<RegionShape> ;
    rdfs:seeAlso IRI ;
    bfo:0000050 IRI ;
    ro:0002162 IRI
  }
  
  <RegionShape> {
    a [ faldo:Region ] ;
    faldo:begin @<PositionShape> ;
    faldo:end @<PositionShape>
  }
  
  <PositionShape> {
    a [ faldo:ExactPosition ] ;
    faldo:position xsd:integer ;
    faldo:reference IRI
  }

sample_rdf_entries:
  - title: Entry with BioProject and BioSample Links
    description: Genome entry demonstrating external database linkage for experimental context.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/insdc/CP036276.1>
        a nuc:Entry ;
        rdfs:label "Symmachiella dynata strain Mal52 chromosome, complete genome." ;
        dcterms:identifier "CP036276.1" ;
        nuc:organism "Symmachiella dynata" ;
        nuc:dblink <http://identifiers.org/biosample/SAMN10954015> ;
        nuc:dblink <http://identifiers.org/bioproject/PRJNA485700> .

  - title: Gene with FALDO Coordinates
    description: Gene with locus tag and precise genomic location using FALDO.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix faldo: <http://biohackathon.org/resource/faldo#> .
      @prefix bfo: <http://purl.obolibrary.org/obo/BFO_> .
      @prefix ro: <http://purl.obolibrary.org/obo/RO_> .
      
      <http://identifiers.org/insdc/CP036276.1#feature:1001623-1002915:1:gene.47722>
        a nuc:Gene ;
        rdfs:subClassOf <http://purl.obolibrary.org/obo/SO_0000704> ;
        nuc:locus_tag "Mal52_08030" ;
        nuc:gene "clpX" ;
        faldo:location <http://identifiers.org/insdc/CP036276.1#region:1001623-1002915:1> ;
        bfo:0000050 <http://identifiers.org/insdc/CP036276.1#sequence> ;
        ro:0002162 <http://identifiers.org/taxonomy/2527995> .

  - title: CDS with Protein Cross-reference
    description: Coding sequence showing protein product annotation and NCBI Protein link.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix sio: <http://semanticscience.org/resource/SIO_> .
      
      <http://identifiers.org/insdc/CP036276.1#feature:1001623-1002915:1:CDS.47054>
        a nuc:Coding_Sequence ;
        nuc:locus_tag "Mal52_08030" ;
        nuc:product "ATP-dependent Clp protease ATP-binding subunit ClpX" ;
        nuc:translation "MPSGNDVTSGSRGATGKK..." ;
        nuc:codon_start 1 ;
        nuc:transl_table 11 ;
        rdfs:seeAlso <http://identifiers.org/ncbiprotein/QDU42347.1> ;
        sio:SIO_010081 <http://identifiers.org/insdc/CP036276.1#feature:1001623-1002915:1:gene.47722> .

  - title: Non-coding RNA Feature
    description: ncRNA showing regulatory RNA annotation.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      @prefix so: <http://purl.obolibrary.org/obo/SO_> .
      
      <http://identifiers.org/insdc/CP040814.1#feature:1849218-1849588:1:ncRNA.979>
        a nuc:Non_Coding_RNA ;
        rdfs:subClassOf so:0000655 ;
        nuc:product "RNase P RNA component class A" ;
        bfo:0000050 <http://identifiers.org/insdc/CP040814.1#sequence> ;
        ro:0002162 <http://identifiers.org/taxonomy/573> .

  - title: Source with Taxonomy Link
    description: Source feature linking organism to NCBI Taxonomy classification.
    rdf: |
      @prefix nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/> .
      
      <http://identifiers.org/insdc/AB023775.1#feature:103-136:1:source.1>
        a nuc:Source ;
        nuc:organism "Lactobacillus phage phiFSW" ;
        nuc:mol_type "genomic DNA" ;
        rdfs:seeAlso <http://identifiers.org/taxonomy/91019> ;
        ro:0002162 <http://identifiers.org/taxonomy/1582> .

sparql_query_examples:
  - title: Search Entries by Organism Using bif:contains
    description: Full-text organism search with relevance scoring.
    question: "What entries exist for Escherichia coli?"
    complexity: basic
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?organism ?relevance
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:organism ?organism .
        ?organism bif:contains "'escherichia' AND 'coli'" option (score ?relevance) .
      }
      ORDER BY DESC(?relevance)
      LIMIT 10

  - title: Get Gene Annotations by Locus Tag
    description: Retrieve gene and product details for specific locus identifier.
    question: "What are the annotations for locus Mal52_08030?"
    complexity: basic
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?gene ?gene_symbol ?product
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag "Mal52_08030" .
        OPTIONAL { ?gene nuc:gene ?gene_symbol }
        OPTIONAL {
          ?cds nuc:locus_tag "Mal52_08030" ;
               nuc:product ?product .
        }
      }

  - title: Retrieve Genes with Genomic Coordinates
    description: Query genes with FALDO positions from specific entry.
    question: "What are the gene coordinates in entry CP036276.1?"
    complexity: intermediate
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      
      SELECT ?locus_tag ?gene_name ?start ?end
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag ?locus_tag ;
              faldo:location ?region .
        OPTIONAL { ?gene nuc:gene ?gene_name }
        ?region faldo:begin/faldo:position ?start ;
                faldo:end/faldo:position ?end .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      }
      LIMIT 10

  - title: Search Products by Keywords Within Entry
    description: Find genes by product description filtering within entry scope.
    question: "Find protease or peptidase genes in CP036276.1."
    complexity: intermediate
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?locus_tag ?product
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?cds a nuc:Coding_Sequence ;
             nuc:locus_tag ?locus_tag ;
             nuc:product ?product .
        FILTER(CONTAINS(STR(?cds), "CP036276.1"))
        FILTER(REGEX(?product, "protease|peptidase", "i"))
      }
      LIMIT 50

  - title: Retrieve All RNA Feature Types
    description: Query different RNA types using UNION pattern.
    question: "What RNA features exist in the database?"
    complexity: intermediate
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?rna_type ?product
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        {
          ?rna a nuc:Transfer_RNA ; nuc:product ?product .
          BIND("tRNA" AS ?rna_type)
        }
        UNION
        {
          ?rna a nuc:Ribosomal_RNA ; nuc:product ?product .
          BIND("rRNA" AS ?rna_type)
        }
        UNION
        {
          ?rna a nuc:Non_Coding_RNA ; nuc:product ?product .
          BIND("ncRNA" AS ?rna_type)
        }
      }
      LIMIT 20

  - title: Gene-CDS-Protein Integration with Coordinates
    description: Complex join of genes, coding sequences, proteins, and positions.
    question: "Get complete gene-to-protein annotations with coordinates for CP036276.1."
    complexity: advanced
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      PREFIX sio: <http://semanticscience.org/resource/>
      
      SELECT ?locus_tag ?gene_name ?product ?start ?end ?protein_id
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag ?locus_tag ;
              faldo:location ?region .
        OPTIONAL { ?gene nuc:gene ?gene_name }
        ?region faldo:begin/faldo:position ?start ;
                faldo:end/faldo:position ?end .
        ?cds sio:SIO_010081 ?gene ;
             nuc:product ?product ;
             rdfs:seeAlso ?protein_id .
        FILTER(CONTAINS(STR(?protein_id), "ncbiprotein"))
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      }
      LIMIT 20

  - title: Multi-Feature Query with Taxonomic Context
    description: Advanced query retrieving genes and RNAs with organism classification.
    question: "Get genes and RNA features with taxonomy for CP036276.1."
    complexity: advanced
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
      
      SELECT ?entry_id ?organism ?taxon ?locus_tag ?feature_type
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               dcterms:identifier ?entry_id ;
               nuc:organism ?organism .
        FILTER(?entry_id = "CP036276.1")
        
        ?feature ro:0002162 ?taxon ;
                 nuc:locus_tag ?locus_tag .
        
        {
          ?feature a nuc:Gene .
          BIND("gene" AS ?feature_type)
        }
        UNION
        {
          ?feature a nuc:Transfer_RNA .
          BIND("tRNA" AS ?feature_type)
        }
        UNION
        {
          ?feature a nuc:Ribosomal_RNA .
          BIND("rRNA" AS ?feature_type)
        }
      }
      LIMIT 50

cross_references:
  - pattern: nuc:dblink
    description: |
      Entry-level links to BioProject and BioSample providing sequencing project organization and specimen metadata.
    databases:
      project_metadata:
        - "BioProject: Sequencing project organization"
        - "BioSample: Specimen and sample metadata"
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?entry ?bioproject ?biosample
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?entry a nuc:Entry ;
               nuc:dblink ?bioproject ;
               nuc:dblink ?biosample .
        FILTER(CONTAINS(STR(?bioproject), "bioproject"))
        FILTER(CONTAINS(STR(?biosample), "biosample"))
      }
      LIMIT 10

  - pattern: rdfs:seeAlso
    description: |
      Feature-level links to NCBI Protein for translations and NCBI Taxonomy for organism classification.
    databases:
      protein:
        - "NCBI Protein: RefSeq protein sequences"
      taxonomy:
        - "NCBI Taxonomy: Taxonomic classification"
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?feature ?external_db
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?feature rdfs:seeAlso ?external_db .
        FILTER(CONTAINS(STR(?external_db), "ncbiprotein") || 
               CONTAINS(STR(?external_db), "taxonomy"))
      }
      LIMIT 50

  - pattern: ro:0002162 (in taxon)
    description: |
      RO property linking all features to NCBI Taxonomy for phylogenetic context.
    databases:
      taxonomy:
        - "NCBI Taxonomy: Complete taxonomic hierarchy"
    sparql: |
      PREFIX ro: <http://purl.obolibrary.org/obo/RO_>
      
      SELECT ?feature ?taxon
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?feature ro:0002162 ?taxon .
        FILTER(CONTAINS(STR(?taxon), "taxonomy"))
      }
      LIMIT 50

  - pattern: rdfs:subClassOf
    description: |
      Semantic classification using Sequence Ontology for standardized feature typing.
    databases:
      ontology:
        - "Sequence Ontology: Genomic feature type vocabulary"
    sparql: |
      PREFIX nuc: <http://ddbj.nig.ac.jp/ontologies/nucleotide/>
      
      SELECT ?feature ?so_class
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?feature rdfs:subClassOf ?so_class .
        FILTER(CONTAINS(STR(?so_class), "obo/SO_"))
      }
      LIMIT 50

architectural_notes:
  search_strategies:
    - Use bif:contains for organism searches at entry level (fast, relevance-scored)
    - Within entries, use FILTER CONTAINS or REGEX for product searches
    - Always filter by entry accession before complex queries to prevent timeouts
  schema_design:
    - Entry-centric with BFO_0000050 (part of) for feature-to-entry relationships
    - FALDO provides precise genomic coordinates for all features
    - SO terms via rdfs:subClassOf for semantic feature typing
    - Gene-CDS links via sio:SIO_010081 (uppercase SIO required)
    - All features linked to organisms via ro:0002162
  performance:
    - CRITICAL - Filter by entry accession before joins to prevent timeouts
    - Entry-specific queries are fast (<1s)
    - bif:contains works best at entry level, not feature level
    - Avoid aggregation without entry filtering
  data_integration:
    - Uses identifiers.org URIs for cross-database linking
    - BioProject/BioSample provide experimental context
    - NCBI Protein and Taxonomy enable protein and organism connections
  data_quality:
    - Locus tags more reliable than gene symbols (>99% vs ~60% coverage)
    - CDS features have >95% product and translation coverage
    - Primarily prokaryotic genomes (bacteria, archaea) plus viral sequences
    - All features have FALDO coordinates (>99%)

data_statistics:
  total_entries: "Large collection (100K+ entries)"
  verified_date: "2025-02-03"
  verification_method: "Sampling with LIMIT 100 (full COUNT times out)"
  
  coverage:
    entries_with_organism: ">99%"
    verified_date: "2025-02-03"
    verification_query: |
      SELECT ?entry ?organism
      WHERE { ?entry a nuc:Entry ; nuc:organism ?organism }
      LIMIT 100
    
    entries_with_bioproject: "~85%"
    verified_date: "2025-02-03"
    calculation: "85/100 sampled entries had BioProject links"
    
    genes_with_locus_tag: ">99%"
    verified_date: "2025-02-03"
    note: "Locus tags are primary identifiers"
    
    genes_with_gene_symbol: "~60%"
    verified_date: "2025-02-03"
    calculation: "60/100 sampled genes had nuc:gene symbols in CP036276.1"
    
    cds_with_product: ">95%"
    verified_date: "2025-02-03"
    note: "Product descriptions highly complete"
    
    features_with_faldo: ">99%"
    verified_date: "2025-02-03"
    note: "FALDO coordinates nearly universal"
  
  cardinality:
    genes_per_entry: "10-5000"
    note: "Varies by genome size"
    trna_per_entry: "40-100"
    note: "Typical bacterial genomes"
    rrna_per_entry: "3-9"
    note: "Typical bacterial genomes"
  
  performance_characteristics:
    - "Entry-specific queries by accession: <1s"
    - "bif:contains organism search: <2s"
    - "Product searches require entry filtering"
    - "Cross-entry aggregation requires sampling"
  
  staleness_warning: "Daily updates - statistics current as of 2025-02-03"

anti_patterns:
  - title: Unfiltered Feature Joins Create Cartesian Products
    problem: Joining features without entry filtering causes massive result sets and timeouts.
    wrong_sparql: |
      SELECT ?gene ?cds
      WHERE {
        ?gene a nuc:Gene .
        ?cds a nuc:Coding_Sequence .
        ?cds sio:SIO_010081 ?gene .
      }
    correct_sparql: |
      SELECT ?gene ?cds
      WHERE {
        ?gene a nuc:Gene .
        ?cds sio:SIO_010081 ?gene .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      }
      LIMIT 100
    explanation: Always filter by entry accession first to constrain joins.

  - title: Aggregation Without Entry Scope
    problem: Using COUNT/GROUP BY without entry filter causes timeout.
    wrong_sparql: |
      SELECT (COUNT(*) as ?count)
      WHERE { ?entry a nuc:Entry }
    correct_sparql: |
      SELECT ?entry
      WHERE { ?entry a nuc:Entry }
      LIMIT 100
    explanation: Replace aggregation with sampling for statistics.

  - title: FALDO Queries Without Entry Filter
    problem: Coordinate queries without entry ID scan all features causing timeout.
    wrong_sparql: |
      SELECT ?gene ?start
      WHERE {
        ?gene a nuc:Gene ;
              faldo:location/faldo:begin/faldo:position ?start .
        FILTER(?start >= 1000000)
      }
    correct_sparql: |
      SELECT ?gene ?start
      WHERE {
        ?gene a nuc:Gene ;
              faldo:location/faldo:begin/faldo:position ?start .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
        FILTER(?start >= 1000000)
      }
      LIMIT 50
    explanation: Always filter by entry URI before FALDO coordinate queries.

common_errors:
  - error: Query Timeout
    causes:
      - Cartesian products from unfiltered joins
      - Aggregation without entry filtering
      - FALDO queries without entry scope
      - Using bif:contains on feature properties instead of entry level
    solutions:
      - "Add entry filter: FILTER(CONTAINS(STR(?var), 'ACCESSION'))"
      - Use FILTER CONTAINS/REGEX (not bif:contains) for feature products
      - Sample with LIMIT instead of COUNT
      - Scope queries to specific entries before joins
    example_fix: |
      # Wrong - timeout risk:
      SELECT ?gene ?cds WHERE {
        ?gene a nuc:Gene .
        ?cds sio:SIO_010081 ?gene .
      }
      
      # Correct - entry-scoped:
      SELECT ?gene ?cds WHERE {
        ?gene a nuc:Gene .
        ?cds sio:SIO_010081 ?gene .
        FILTER(CONTAINS(STR(?gene), "CP036276.1"))
      } LIMIT 100

  - error: Wrong SIO Property Case
    causes:
      - Using lowercase sio:010081 instead of sio:SIO_010081
      - SIO namespace is case-sensitive in DDBJ
    solutions:
      - "Always use uppercase: sio:SIO_010081"
      - Verify property names match exactly
    example_fix: |
      # Wrong:
      ?cds sio:010081 ?gene .
      
      # Correct:
      ?cds sio:SIO_010081 ?gene .

  - error: Empty Results or Missing Data
    causes:
      - Missing FROM clause
      - Treating optional properties (like nuc:gene) as required
      - Wrong bif:contains syntax
      - Filtering for non-existent feature types
    solutions:
      - "Always include: FROM <http://rdfportal.org/dataset/ddbj>"
      - Use OPTIONAL for properties like nuc:gene (gene symbols)
      - "bif:contains syntax: bif:contains \"'keyword'\""
      - Sample entries first to verify feature types exist
    example_fix: |
      # Wrong - missing optional:
      SELECT ?gene ?symbol WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag "ABC_001" ;
              nuc:gene ?symbol .
      }
      
      # Correct - with optional and FROM:
      SELECT ?gene ?symbol
      FROM <http://rdfportal.org/dataset/ddbj>
      WHERE {
        ?gene a nuc:Gene ;
              nuc:locus_tag "ABC_001" .
        OPTIONAL { ?gene nuc:gene ?symbol }
      }
