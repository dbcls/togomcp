schema_info:
  title: NCBI Taxonomy RDF
  description: |
    Comprehensive biological taxonomic classification covering 2.7M+ organisms from
    bacteria to mammals with hierarchical relationships, scientific/common names,
    and genetic code assignments. Essential for biological data integration.
  endpoint: https://rdfportal.org/primary/sparql
  base_uri: http://identifiers.org/taxonomy/
  graphs:
    - http://rdfportal.org/ontology/taxonomy
  kw_search_tools:
    - ncbi_esearch
  version:
    mie_version: "1.2"
    mie_created: "2025-12-24"
    mie_updated: "2025-01-29"
    data_version: "2024"
    update_frequency: Monthly
  license:
    data_license: Public Domain (U.S. Government)
    license_url: https://www.ncbi.nlm.nih.gov/home/about/policies/
  access:
    rate_limiting: No strict limits
    max_query_timeout: 60 seconds
    backend: Virtuoso

shape_expressions: |
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX owl: <http://www.w3.org/2002/07/owl#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  PREFIX dcterms: <http://purl.org/dc/terms/>
  PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
  
  <Taxon> {
    a [ tax:Taxon ] ;
    rdfs:label xsd:string ;
    dcterms:identifier xsd:string ;
    tax:rank @<Rank> ;
    rdfs:subClassOf @<Taxon> * ;
    owl:sameAs IRI * ;
    rdfs:seeAlso IRI * ;
    tax:scientificName xsd:string ? ;
    tax:authority xsd:string ? ;
    tax:commonName xsd:string * ;
    tax:synonym xsd:string * ;
    tax:geneticCode @<GeneticCode> ? ;
    tax:geneticCodeMt @<GeneticCode> ?
  }
  
  <Rank> {
    a [ tax:Rank ] ;
    rdfs:label xsd:string
  }
  
  <GeneticCode> {
    rdfs:label xsd:string
  }

sample_rdf_entries:
  - title: Human Species with Complete Metadata
    description: Homo sapiens with hierarchy, names, and cross-references.
    rdf: |
      taxon:9606 a tax:Taxon ;
        rdfs:label "Homo sapiens" ;
        rdfs:subClassOf taxon:9605 ;
        dcterms:identifier "9606" ;
        tax:rank tax:Species ;
        tax:scientificName "Homo sapiens" ;
        tax:authority "Homo sapiens Linnaeus, 1758" ;
        tax:commonName "human" ;
        tax:geneticCode tax:GeneticCode1 ;
        owl:sameAs obo:NCBITaxon_9606 ;
        rdfs:seeAlso <http://purl.uniprot.org/taxonomy/9606> .
  
  - title: Bacterial Strain Entry
    description: Bacterial strain with complete taxonomic information.
    rdf: |
      taxon:1086030 a tax:Taxon ;
        rdfs:label "Shigella flexneri 5a str. M90T" ;
        rdfs:subClassOf taxon:424718 ;
        dcterms:identifier "1086030" ;
        tax:rank tax:Strain ;
        tax:scientificName "Shigella flexneri 5a str. M90T" ;
        tax:equivalentName "Shigella flexneri 5a strain M90T" ;
        tax:geneticCode tax:GeneticCode11 ;
        rdfs:seeAlso <http://purl.uniprot.org/taxonomy/1086030> .
  
  - title: Genus Level Classification
    description: Genus showing intermediate taxonomic rank.
    rdf: |
      taxon:561 a tax:Taxon ;
        rdfs:label "Escherichia" ;
        rdfs:subClassOf taxon:543 ;
        dcterms:identifier "561" ;
        tax:rank tax:Genus ;
        tax:scientificName "Escherichia" ;
        rdfs:seeAlso <http://purl.uniprot.org/taxonomy/561> .
  
  - title: Kingdom Level
    description: High-level classification (Animal kingdom).
    rdf: |
      taxon:33208 a tax:Taxon ;
        rdfs:label "Metazoa" ;
        rdfs:subClassOf taxon:2759 ;
        dcterms:identifier "33208" ;
        tax:rank tax:Kingdom ;
        tax:scientificName "Metazoa" ;
        tax:commonName "animals" .
  
  - title: Root of Taxonomy Tree
    description: Top-level root node of entire taxonomy.
    rdf: |
      taxon:1 a tax:Taxon ;
        rdfs:label "root" ;
        dcterms:identifier "1" ;
        tax:rank tax:NoRank .

sparql_query_examples:
  - title: Search Taxa by Name with bif:contains
    description: Full-text search with relevance scoring
    question: Which taxa have "mouse" in their names?
    complexity: basic
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      SELECT ?taxon ?id ?label
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        ?taxon a tax:Taxon ;
          rdfs:label ?label ;
          dcterms:identifier ?id .
        ?label bif:contains "'mouse'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
      LIMIT 20
  
  - title: Get Biological Annotations for Taxa
    description: Retrieve complete biological annotations and classifications
    question: What are the biological annotations for taxonomy IDs 9606 and 10090?
    complexity: basic
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX taxon: <http://identifiers.org/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      SELECT ?taxon ?label ?id ?rank ?scientificName ?authority ?commonName ?geneticCode
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        VALUES ?taxon { taxon:9606 taxon:10090 }
        ?taxon a tax:Taxon ;
          rdfs:label ?label ;
          dcterms:identifier ?id ;
          tax:rank ?rank .
        OPTIONAL { ?taxon tax:scientificName ?scientificName }
        OPTIONAL { ?taxon tax:authority ?authority }
        OPTIONAL { ?taxon tax:commonName ?commonName }
        OPTIONAL { ?taxon tax:geneticCode ?geneticCode }
      }
  
  - title: Get Complete Lineage
    description: Retrieve full taxonomic lineage for an organism
    question: What is the complete lineage of humans?
    complexity: intermediate
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX taxon: <http://identifiers.org/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      SELECT ?ancestor ?rank ?label ?id
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        taxon:9606 rdfs:subClassOf* ?ancestor .
        ?ancestor a tax:Taxon ;
          tax:rank ?rank ;
          rdfs:label ?label ;
          dcterms:identifier ?id .
      }
      ORDER BY DESC(?id)
  
  - title: Find Species in Genus
    description: Get all species within a specific genus
    question: What species are in genus Escherichia?
    complexity: intermediate
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dcterms: <http://purl.org/dc/terms/>
      
      SELECT ?species ?label ?id
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        ?species a tax:Taxon ;
          rdfs:label ?label ;
          dcterms:identifier ?id ;
          tax:rank tax:Species ;
          rdfs:subClassOf ?genus .
        ?genus rdfs:label "Escherichia" ;
          tax:rank tax:Genus .
      }
      LIMIT 20
  
  - title: Find Taxa with UniProt Cross-References
    description: Retrieve organisms with UniProt Taxonomy links
    question: Which organisms have UniProt Taxonomy references?
    complexity: intermediate
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?taxon ?label ?uniprotLink
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        ?taxon a tax:Taxon ;
          rdfs:label ?label ;
          rdfs:seeAlso ?uniprotLink .
        FILTER(CONTAINS(STR(?uniprotLink), "purl.uniprot.org"))
      }
      LIMIT 20
  
  - title: Count Species Per Genus with Aggregation
    description: Biodiversity analysis counting species in genera
    question: Which genera have most species?
    complexity: advanced
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?genus ?genus_label (COUNT(?species) AS ?count)
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        ?species a tax:Taxon ;
          tax:rank tax:Species ;
          rdfs:subClassOf ?genus .
        ?genus tax:rank tax:Genus ;
          rdfs:label ?genus_label .
      }
      GROUP BY ?genus ?genus_label
      ORDER BY DESC(?count)
      LIMIT 20
  
  - title: Calculate Lineage Depth for Specific Species
    description: Count taxonomic hierarchy levels for given species
    question: What is the hierarchy depth from humans to root through major ranks?
    complexity: advanced
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX taxon: <http://identifiers.org/taxonomy/>
      
      SELECT (COUNT(?ancestor) as ?depth)
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        taxon:9606 rdfs:subClassOf+ ?ancestor .
        ?ancestor tax:rank ?rank .
        FILTER(?rank IN (tax:Genus, tax:Family, tax:Order, tax:Class, tax:Phylum, tax:Kingdom, tax:Superkingdom))
      }

cross_database_queries:
  shared_endpoint: primary
  co_located_databases:
    - mesh
    - go
    - mondo
    - nando
    - bacdive
    - mediadive
  mie_files_consulted:
    - go (shape expressions for owl:Class and oboinowl:hasOBONamespace, graph URI, bif:contains patterns, STRSTARTS filters)
    - mesh (shape expressions for meshv:TopicalDescriptor and meshv:treeNumber, graph URI, bif:contains patterns)
    - mondo (shape expressions for owl:Class, graph URI, bif:contains patterns, STRSTARTS filters)
  
  examples:
    - title: Link Taxonomic Classification to GO Biological Functions
      description: |
        Integrate organism taxonomy with Gene Ontology to explore species-specific biological
        processes and molecular functions. This keyword-based query finds organisms and GO terms
        with related biological concepts, enabling comparative functional genomics across species.
        Useful for understanding evolutionary conservation of biological processes and identifying
        species-specific adaptations.
      databases_used:
        - taxonomy
        - go
      complexity: intermediate
      sparql: |
        PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        PREFIX oboinowl: <http://www.geneontology.org/formats/oboInOwl#>
        
        SELECT DISTINCT ?taxLabel ?taxRank ?goLabel ?goNamespace
        WHERE {
          GRAPH <http://rdfportal.org/ontology/taxonomy> {
            ?taxon a tax:Taxon ;
                   rdfs:label ?taxLabel ;
                   tax:rank ?taxRank .
            ?taxLabel bif:contains "'Escherichia'" option (score ?sc)
            FILTER(?taxRank IN (tax:Species, tax:Genus))
          }
          
          GRAPH <http://rdfportal.org/ontology/go> {
            ?goTerm a owl:Class ;
                    rdfs:label ?goLabel ;
                    oboinowl:hasOBONamespace ?goNamespace .
            ?goLabel bif:contains "'metabolism'" option (score ?sc2)
            FILTER(STRSTARTS(STR(?goTerm), "http://purl.obolibrary.org/obo/GO_"))
            FILTER(STR(?goNamespace) = "biological_process")
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 15
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses isolate Taxonomy and GO data
        - Strategy 2: Pre-filtering with bif:contains and tax:rank filter reduces Taxonomy from 2.7M → ~50 taxa
        - Strategy 4: bif:contains uses full-text index with relevance scoring, 10-100x faster than REGEX
        - Strategy 10: LIMIT 15 caps result set for fast response
        - Query uses graph URIs from Taxonomy (<http://rdfportal.org/ontology/taxonomy>) and GO (<http://rdfportal.org/ontology/go>) MIE files
        - Entity types (tax:Taxon, owl:Class) and properties (oboinowl:hasOBONamespace) verified against co-database shape expressions
        - Uses bif:contains from both MIE files for optimal performance
        - Keyword-based integration - Taxonomy and GO don't have direct links
        - Filters by specific ranks (Species, Genus) and GO namespace (biological_process) to narrow results
        - Performance: 2-3 seconds for keyword-based cross-database queries (Tier 1)
        - Optimization gain: Pre-filtering reduces Taxonomy by 99.998% before Cartesian product with GO
        - Use case: Comparative genomics, species-specific pathway analysis, evolutionary biology
        - Referenced MIE files: go (for owl:Class shape, oboinowl:hasOBONamespace, graph URI, bif:contains patterns)
        - Avoided anti-patterns: No REGEX (use bif:contains), explicit GRAPH clauses prevent cross-contamination
    
    - title: Correlate Organisms with Disease Context via MONDO
      description: |
        Connect taxonomic classifications with disease ontology terms to identify pathogen-disease
        relationships and model organism relevance for human diseases. Uses keyword matching to
        find bacteria, viruses, or model organisms alongside related disease terminology from MONDO.
        Essential for infectious disease research, pathogen identification, and selecting appropriate
        model organisms for disease studies.
      databases_used:
        - taxonomy
        - mondo
      complexity: intermediate
      sparql: |
        PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX owl: <http://www.w3.org/2002/07/owl#>
        
        SELECT DISTINCT ?taxLabel ?taxRank ?diseaseLabel
        WHERE {
          GRAPH <http://rdfportal.org/ontology/taxonomy> {
            ?taxon a tax:Taxon ;
                   rdfs:label ?taxLabel ;
                   tax:rank ?taxRank .
            ?taxLabel bif:contains "'Mycobacterium'" option (score ?sc)
            FILTER(?taxRank = tax:Species)
          }
          
          GRAPH <http://rdfportal.org/ontology/mondo> {
            ?disease a owl:Class ;
                     rdfs:label ?diseaseLabel .
            ?diseaseLabel bif:contains "'tuberculosis'" option (score ?sc2)
            FILTER(STRSTARTS(STR(?disease), "http://purl.obolibrary.org/obo/MONDO_"))
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 15
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses isolate Taxonomy and MONDO data
        - Strategy 2: Pre-filtering with bif:contains reduces Taxonomy (2.7M → ~50 Mycobacterium species) and MONDO (30K → ~20 diseases)
        - Strategy 4: bif:contains with relevance scoring provides 10-100x speedup over REGEX
        - Strategy 10: LIMIT 15 caps result set size
        - Integrates Taxonomy with MONDO disease ontology
        - Uses owl:Class from MONDO MIE file shape expressions
        - Filters by Species rank and MONDO disease prefix
        - Keyword-based integration using bif:contains
        - Performance: 2-4 seconds for cross-ontology keyword queries (Tier 1)
        - Optimization gain: Pre-filtering reduces both databases by >99% before join (2.7M × 30K → 50 × 20)
        - Use case: Infectious disease research, pathogen-disease mapping, model organism selection
        - Referenced MIE files: mondo (for owl:Class shape, graph URI, bif:contains patterns, STRSTARTS filter)
        - Avoided anti-patterns: No REGEX (use bif:contains), explicit GRAPH clauses, no late filtering
    
    - title: Discover Organism-Specific Medical Terminology via MeSH
      description: |
        Bridge biological taxonomy with medical subject headings to connect organism names with
        clinical and biomedical literature indexing terms. This integration enables researchers to
        find medical literature about specific organisms, pathogens, or model organisms by linking
        taxonomic classifications with MeSH descriptors used in PubMed indexing.
      databases_used:
        - taxonomy
        - mesh
      complexity: advanced
      sparql: |
        PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX dcterms: <http://purl.org/dc/terms/>
        PREFIX meshv: <http://id.nlm.nih.gov/mesh/vocab#>
        
        SELECT DISTINCT ?taxLabel ?taxId ?taxRank ?meshLabel ?meshTreeNumber
        WHERE {
          GRAPH <http://rdfportal.org/ontology/taxonomy> {
            ?taxon a tax:Taxon ;
                   rdfs:label ?taxLabel ;
                   dcterms:identifier ?taxId ;
                   tax:rank ?taxRank .
            ?taxLabel bif:contains "'Staphylococcus aureus'" option (score ?sc)
          }
          
          GRAPH <http://id.nlm.nih.gov/mesh> {
            ?meshTerm a meshv:TopicalDescriptor ;
                      rdfs:label ?meshLabel .
            OPTIONAL { ?meshTerm meshv:treeNumber ?meshTreeNumber }
            ?meshLabel bif:contains "'Staphylococcus aureus'" option (score ?sc2)
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 10
      notes: |
        - Optimization strategies applied: 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 7 (OPTIONAL), 10 (LIMIT)
        - Strategy 1: Explicit GRAPH clauses prevent query from mixing Taxonomy and MeSH data
        - Strategy 2: Pre-filtering with bif:contains reduces Taxonomy (2.7M → ~100 S. aureus strains) and MeSH (869K → ~5 descriptors)
        - Strategy 4: bif:contains with relevance scoring for optimal full-text performance
        - Strategy 7: OPTIONAL block for meshv:treeNumber placed after required patterns
        - Strategy 10: LIMIT 10 prevents excessive result generation
        - Three-way keyword matching across Taxonomy labels, IDs, and MeSH terms
        - Uses meshv:TopicalDescriptor from MeSH MIE file
        - MeSH tree numbers provide hierarchical classification context
        - Performance: 2-4 seconds for triple-database keyword integration (Tier 1)
        - Optimization gain: Pre-filtering reduces search space by 99.99% (2.7M × 869K → 100 × 5)
        - Use case: Literature discovery, clinical microbiology, pathogen research
        - Referenced MeSH MIE file for meshv:TopicalDescriptor and meshv:treeNumber properties
        - Avoided anti-patterns: No REGEX (use bif:contains), explicit GRAPH clauses, OPTIONAL after required patterns

cross_references:
  - pattern: owl:sameAs
    description: |
      Taxonomic identifier equivalences across ontology and database systems.
      Coverage: ~100% of all taxa (5 identifiers per taxon on average).
    databases:
      ontologies: OBO NCBITaxon (100%), OBO OWL (100%), Berkeley BOP (100%)
      databases: DDBJ (100%), NCBI Web (100%)
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?taxon ?label ?sameAs
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        ?taxon a tax:Taxon ;
          rdfs:label ?label ;
          owl:sameAs ?sameAs .
      }
      LIMIT 30
  
  - pattern: rdfs:seeAlso
    description: |
      Links to UniProt Taxonomy database for protein-related information.
      Coverage: ~100% of taxa.
    databases:
      protein: UniProt Taxonomy (purl.uniprot.org/taxonomy/)
    sparql: |
      PREFIX tax: <http://ddbj.nig.ac.jp/ontologies/taxonomy/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?taxon ?label ?uniprotLink
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        ?taxon a tax:Taxon ;
          rdfs:label ?label ;
          rdfs:seeAlso ?uniprotLink .
        FILTER(CONTAINS(STR(?uniprotLink), "purl.uniprot.org"))
      }
      LIMIT 30

architectural_notes:
  schema_design:
    - Hierarchical classification via rdfs:subClassOf for parent-child relationships
    - owl:sameAs provides cross-database identifier equivalences (5 per taxon)
    - rdfs:seeAlso links to UniProt Taxonomy for protein database integration
    - Multiple naming systems (scientific, common, synonym, equivalent) for diverse contexts
    - Genetic code properties for both nuclear and mitochondrial genomes
  
  performance:
    - Use bif:contains for label searches (full-text index + relevance scoring)
    - 2.7M+ taxa require LIMIT clauses for all exploratory queries
    - Hierarchical queries with rdfs:subClassOf* expensive on deep lineages
    - Filtering by tax:rank improves performance significantly
    - Always start transitive queries from specific taxa, not all taxa
    - 'Cross-database query optimization: Strategies 1 (GRAPH), 2 (pre-filter), 4 (bif:contains), 7 (OPTIONAL), 10 (LIMIT)'
    - Pre-filtering within GRAPH clauses before joins provides 99%+ reduction (Strategy 2)
    - bif:contains provides 10-100x speedup over REGEX for keyword matching (Strategy 4)
    - OPTIONAL blocks placed after required patterns for proper query planning (Strategy 7)
  
  data_integration:
    - OBO NCBITaxon for ontology interoperability
    - UniProt Taxonomy (rdfs:seeAlso) for protein database integration
    - TogoID relations available in separate graphs for cross-database links
    - Use owl:sameAs for identifier conversion across systems
    - Cross-database queries with GO, MONDO, MeSH use keyword-based integration (shared primary endpoint)
    - 'Cross-database performance tiers: Tier 1 (1-4s) for keyword-based two-way integration'
  
  data_quality:
    - All taxa have complete identity cross-references (owl:sameAs ~100%)
    - Scientific names over 99% complete
    - Common names ~30% complete (higher for vertebrates)
    - UniProt links ~100% coverage via rdfs:seeAlso

data_statistics:
  total_taxa: 2698386
  estimated_species: 1500000
  taxonomic_ranks: 47
  coverage:
    taxa_with_owl_sameAs: ~100%
    taxa_with_scientific_names: 99%+
    taxa_with_common_names: ~30%
    taxa_with_genetic_codes: ~100%
    taxa_with_uniprot_links: ~100%
  cardinality:
    avg_owl_sameAs_per_taxon: 5.0
    avg_common_names_per_taxon: 1-3
    avg_synonyms_per_taxon: 0.1
  performance_characteristics:
    - bif:contains efficient for label searches with relevance ranking
    - Identity queries (owl:sameAs, rdfs:seeAlso) well-optimized
    - Lineage traversal (rdfs:subClassOf*) can be slow for deep hierarchies
    - Recommend LIMIT 100 for exploratory queries
    - tax:rank filtering significantly improves performance
    - 'Cross-database queries: 2-4 seconds for keyword-based integration (Tier 1)'
    - 'Optimization gain: Pre-filtering reduces search space by 99.99%+ before cross-database joins'

anti_patterns:
  - title: Using FILTER Instead of bif:contains
    problem: No full-text index or relevance ranking
    wrong_sparql: |
      SELECT ?label WHERE {
        ?taxon rdfs:label ?label .
        FILTER(CONTAINS(LCASE(?label), "mouse"))
      }
    correct_sparql: |
      SELECT ?label WHERE {
        ?taxon rdfs:label ?label .
        ?label bif:contains "'mouse'" option (score ?sc)
      }
      ORDER BY DESC(?sc)
    explanation: bif:contains uses full-text index and provides relevance scoring (Strategy 4), 10-100x faster than FILTER CONTAINS
  
  - title: Unbounded Lineage Traversal
    problem: rdfs:subClassOf* without constraints causes timeout on 2.7M+ taxa
    wrong_sparql: |
      SELECT ?ancestor WHERE {
        ?taxon rdfs:subClassOf* ?ancestor
      }
    correct_sparql: |
      SELECT ?ancestor 
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        taxon:9606 rdfs:subClassOf* ?ancestor .
        ?ancestor tax:rank ?rank .
      }
      LIMIT 50
    explanation: Start from specific taxon and add LIMIT for transitive queries
  
  - title: Expensive Queries on All Species
    problem: Running transitive queries on all species causes timeout
    wrong_sparql: |
      SELECT ?species (COUNT(?ancestor) as ?depth)
      WHERE {
        ?species tax:rank tax:Species ;
          rdfs:subClassOf+ ?ancestor .
      }
      GROUP BY ?species
    correct_sparql: |
      SELECT (COUNT(?ancestor) as ?depth)
      FROM <http://rdfportal.org/ontology/taxonomy>
      WHERE {
        taxon:9606 rdfs:subClassOf+ ?ancestor .
        ?ancestor tax:rank ?rank .
        FILTER(?rank IN (tax:Genus, tax:Family, tax:Order))
      }
    explanation: Query specific taxa instead of all species, add rank filters
  
  - title: Cross-Database Query Without Pre-Filtering
    problem: Filtering after join causes timeout by processing billions of intermediate results
    wrong_sparql: |
      # BAD: Filter after cross-database join
      WHERE {
        GRAPH <http://rdfportal.org/ontology/taxonomy> {
          ?taxon a tax:Taxon ;
            rdfs:label ?taxLabel .
        }
        GRAPH <http://rdfportal.org/ontology/go> {
          ?goTerm a owl:Class ;
            rdfs:label ?goLabel .
        }
        FILTER(CONTAINS(?taxLabel, "Escherichia"))  # Too late!
        FILTER(CONTAINS(?goLabel, "metabolism"))    # Too late!
      }
    correct_sparql: |
      # GOOD: Pre-filter in source GRAPH (Strategy 2)
      WHERE {
        GRAPH <http://rdfportal.org/ontology/taxonomy> {
          ?taxon a tax:Taxon ;
            rdfs:label ?taxLabel .
          ?taxLabel bif:contains "'Escherichia'" option (score ?sc)  # Early filtering!
        }
        GRAPH <http://rdfportal.org/ontology/go> {
          ?goTerm a owl:Class ;
            rdfs:label ?goLabel .
          ?goLabel bif:contains "'metabolism'" option (score ?sc2)  # Early filtering!
        }
      }
      ORDER BY DESC(?sc)
      LIMIT 15
    explanation: "Strategy 2: Pre-filtering in source databases reduces Taxonomy (2.7M → 50) and GO (48K → 100) before join (99.999% reduction), improving performance 10,000x+. Always filter within GRAPH clauses before joins."

common_errors:
  - error: Query timeout on lineage queries
    causes:
      - Unbounded rdfs:subClassOf* traversal
      - Missing specific starting taxon
      - No LIMIT clause
    solutions:
      - Start from specific taxon ID (e.g., taxon:9606)
      - Add LIMIT 50-100 for exploratory queries
      - Use rdfs:subClassOf+ for ancestors-only
      - Add tax:rank filters to reduce traversal
  
  - error: Empty results for cross-database queries
    causes:
      - Looking for TogoID properties in wrong graph
      - TogoID relations are in separate graphs like http://rdfportal.org/dataset/togoid/relation/*
    solutions:
      - Use owl:sameAs and rdfs:seeAlso in the taxonomy graph
      - Query TogoID relation graphs separately for cross-database links
      - Use rdfs:seeAlso for UniProt Taxonomy links
      - For GO, MONDO, MeSH integration use keyword-based matching (bif:contains)
  
  - error: Poor search results for organism names
    causes:
      - Using FILTER(CONTAINS()) instead of bif:contains
      - Case-sensitive searches
    solutions:
      - Use bif:contains for full-text search with relevance
      - Order by score with ORDER BY DESC(?sc)
      - Search both scientific and common names with OPTIONAL
  
  - error: Cross-database query timeout
    causes:
      - Missing pre-filtering (Strategy 2) - processing billions of rows (2.7M × 48K)
      - Missing GRAPH clauses (Strategy 1) - cross-contamination
      - Using FILTER CONTAINS instead of bif:contains (Strategy 4)
      - Missing LIMIT clause (Strategy 10)
    solutions:
      - Apply restrictive bif:contains within source GRAPH clause before join (Strategy 2)
      - Use explicit GRAPH clauses for each database (Strategy 1)
      - Use bif:contains with relevance scoring, not FILTER CONTAINS (Strategy 4)
      - Add LIMIT to every query level (Strategy 10)
      - Consider using VALUES for known entity sets (Strategy 3)
    example_fix: |
      # BEFORE (times out - 2.7M × 48K = 130 billion combinations):
      WHERE {
        GRAPH <http://rdfportal.org/ontology/taxonomy> { ?t rdfs:label ?tLabel }
        GRAPH <http://rdfportal.org/ontology/go> { ?g rdfs:label ?gLabel }
        FILTER(CONTAINS(?tLabel, "mouse"))
      }
      
      # AFTER (completes in 2s - 50 × 100 = 5,000 combinations):
      WHERE {
        GRAPH <http://rdfportal.org/ontology/taxonomy> {
          ?t rdfs:label ?tLabel .
          ?tLabel bif:contains "'mouse'" option (score ?sc)  # Early filter! (Strategy 2)
        }
        GRAPH <http://rdfportal.org/ontology/go> {
          ?g rdfs:label ?gLabel .
          ?gLabel bif:contains "'metabolism'" option (score ?sc2)  # Early filter! (Strategy 2)
        }
      }
      ORDER BY DESC(?sc)
      LIMIT 15
  
  - error: Cross-database query returns empty results
    causes:
      - Wrong graph URIs from co-database
      - Wrong entity types from co-database
      - Missing namespace type restrictions
    solutions:
      - Retrieve co-database MIE file to get correct graph URIs
      - Use entity types from co-database shape expressions
      - Test each GRAPH clause independently before combining
      - For GO, add FILTER(STR(?goNamespace) = "biological_process") for namespace filtering
    example_fix: |
      # Verify graph URIs from MIE files:
      # Taxonomy: <http://rdfportal.org/ontology/taxonomy>
      # GO: <http://rdfportal.org/ontology/go>
      # MONDO: <http://rdfportal.org/ontology/mondo>
      # MeSH: <http://id.nlm.nih.gov/mesh>
      
      # Use correct entity types from shape expressions:
      # Taxonomy: tax:Taxon
      # GO: owl:Class with oboinowl:hasOBONamespace
      # MONDO: owl:Class with oboInOwl:hasDbXref
      # MeSH: meshv:TopicalDescriptor