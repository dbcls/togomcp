schema_info:
  title: Ensembl RDF
  description: |
    Ensembl provides genome annotations for 100+ vertebrate species. Contains genes with biotype classifications 
    (protein-coding, lncRNA, miRNA, pseudogenes), transcripts with quality flags (MANE, APPRIS, TSL), proteins, 
    and exons with FALDO genomic coordinates. Cross-referenced to UniProt, HGNC, Reactome, and OMIM.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://rdf.ebi.ac.uk/resource/ensembl/
  graphs:
    - http://rdfportal.org/dataset/ensembl
    - http://rdfportal.org/dataset/ensembl_grch37
  kw_search_tools: []
  version:
    mie_version: "2.0"
    mie_created: "2026-02-10"
    data_version: "Release 114"
    update_frequency: "Quarterly"
  license:
    data_license: "Creative Commons Attribution 4.0 International"
    license_url: "https://www.ensembl.org/info/about/legal/index.html"
  access:
    rate_limiting: "Reasonable use policy"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
  PREFIX faldo: <http://biohackathon.org/resource/faldo#>
  PREFIX so: <http://purl.obolibrary.org/obo/so#>
  PREFIX obo: <http://purl.obolibrary.org/obo/>
  PREFIX sio: <http://semanticscience.org/resource/>
  
  <EnsemblGeneShape> {
    a [ terms:EnsemblGene ] ;
    rdfs:label xsd:string ;
    dcterms:identifier xsd:string ;
    dcterms:description xsd:string ;
    terms:has_biotype IRI ;
    obo:RO_0002162 IRI ;
    so:part_of IRI + ;
    faldo:location BNode ;
    skos:altLabel xsd:string * ;
    rdfs:seeAlso IRI *
  }
  
  <EnsemblTranscriptShape> {
    a [ terms:EnsemblTranscript ] ;
    dcterms:identifier xsd:string ;
    terms:has_biotype IRI ;
    so:transcribed_from @<EnsemblGeneShape> ;
    so:translates_to @<EnsemblProteinShape> ? ;
    terms:has_transcript_flag IRI * ;
    faldo:location BNode ;
    sio:SIO_000974 @<EnsemblOrderedExonShape> +
  }
  
  <EnsemblProteinShape> {
    a [ terms:EnsemblProtein ] ;
    dcterms:identifier xsd:string ;
    so:translation_of @<EnsemblTranscriptShape> ;
    rdfs:seeAlso IRI *
  }
  
  <EnsemblExonShape> {
    a [ terms:EnsemblExon ] ;
    dcterms:identifier xsd:string ;
    faldo:location BNode
  }

sample_rdf_entries:
  - title: Human Protein-Coding Gene (BRCA1)
    description: Gene with biotype, taxonomy, genomic location, and UniProt cross-reference.
    rdf: |
      @prefix ensg: <http://rdf.ebi.ac.uk/resource/ensembl/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix faldo: <http://biohackathon.org/resource/faldo#> .
      @prefix so: <http://purl.obolibrary.org/obo/so#> .
      @prefix obo: <http://purl.obolibrary.org/obo/> .
      
      ensg:ENSG00000012048 a terms:EnsemblGene ;
        rdfs:label "BRCA1" ;
        dcterms:identifier "ENSG00000012048" ;
        dcterms:description "BRCA1 DNA repair associated [Source:HGNC Symbol;Acc:HGNC:1100]" ;
        terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
        obo:RO_0002162 <http://identifiers.org/taxonomy/9606> ;
        so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> ;
        faldo:location [
          faldo:begin [ faldo:position 43044295 ; rdf:type faldo:ReverseStrandPosition ] ;
          faldo:end [ faldo:position 43170245 ; rdf:type faldo:ReverseStrandPosition ]
        ] ;
        rdfs:seeAlso <http://purl.uniprot.org/uniprot/P38398> .

  - title: Transcript with MANE Select Flag
    description: High-quality transcript with MANE Select and canonical flags.
    rdf: |
      @prefix enst: <http://rdf.ebi.ac.uk/resource/ensembl.transcript/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix so: <http://purl.obolibrary.org/obo/so#> .
      
      enst:ENST00000468300 a terms:EnsemblTranscript ;
        dcterms:identifier "ENST00000468300" ;
        terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
        so:transcribed_from <http://rdf.ebi.ac.uk/resource/ensembl/ENSG00000012048> ;
        so:translates_to <http://rdf.ebi.ac.uk/resource/ensembl.protein/ENSP00000418960> ;
        terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000365> .

  - title: Protein with UniProt Cross-Reference
    description: Translated protein linked to UniProt database.
    rdf: |
      @prefix ensp: <http://rdf.ebi.ac.uk/resource/ensembl.protein/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix so: <http://purl.obolibrary.org/obo/so#> .
      
      ensp:ENSP00000418960 a terms:EnsemblProtein ;
        dcterms:identifier "ENSP00000418960" ;
        so:translation_of <http://rdf.ebi.ac.uk/resource/ensembl.transcript/ENST00000468300> ;
        rdfs:seeAlso <http://purl.uniprot.org/uniprot/P38398> .

  - title: Long Non-Coding RNA Gene
    description: lncRNA gene showing alternative biotype classification.
    rdf: |
      @prefix ensg: <http://rdf.ebi.ac.uk/resource/ensembl/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix obo: <http://purl.obolibrary.org/obo/> .
      
      ensg:ENSG00000290825 a terms:EnsemblGene ;
        rdfs:label "LINC02593" ;
        dcterms:identifier "ENSG00000290825" ;
        terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000028> ;
        obo:RO_0002162 <http://identifiers.org/taxonomy/9606> .

  - title: Exon with FALDO Coordinates
    description: Exon with genomic location showing start and end positions.
    rdf: |
      @prefix ense: <http://rdf.ebi.ac.uk/resource/ensembl.exon/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix faldo: <http://biohackathon.org/resource/faldo#> .
      
      ense:ENSE00003884397 a terms:EnsemblExon ;
        dcterms:identifier "ENSE00003884397" ;
        faldo:location [
          faldo:begin [ faldo:position 43170245 ] ;
          faldo:end [ faldo:position 43170403 ]
        ] .

sparql_query_examples:
  - title: Get Gene by Specific ID
    description: Direct lookup using gene identifier (IRI-based approach).
    question: What are the details of gene ENSG00000012048?
    complexity: basic
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?gene_id ?label ?description ?biotype
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                dcterms:description ?description ;
                terms:has_biotype ?biotype ;
                obo:RO_0002162 taxonomy:9606 .
          FILTER(?gene_id = "ENSG00000012048")
        }
      }
      LIMIT 10

  - title: Find Genes by Specific Biotype IRI
    description: Query protein-coding genes using specific biotype IRI (preferred over text search).
    question: What are some human protein-coding genes?
    complexity: basic
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?gene_id ?label ?description
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                dcterms:description ?description ;
                terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
                obo:RO_0002162 taxonomy:9606 .
        }
      }
      LIMIT 20

  - title: Search Gene Symbols with Full-Text
    description: Use bif:contains for gene symbol pattern matching.
    question: Find human genes starting with BRCA.
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?gene_id ?label ?description
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                dcterms:description ?description ;
                obo:RO_0002162 taxonomy:9606 .
          # Text search justified: gene symbols are free-text field
          # with no controlled vocabulary, only searchable via text
          # Virtuoso backend: use bif:contains (indexed)
          ?label bif:contains "'BRCA*'" option (score ?sc) .
        }
      }
      ORDER BY DESC(?sc)
      LIMIT 10

  - title: Get High-Quality Transcripts with Multiple IRI Filters
    description: Combine biotype, quality flag, and chromosome IRIs for precise filtering.
    question: What are MANE Select transcripts on chromosome 17?
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      PREFIX so: <http://purl.obolibrary.org/obo/so#>
      
      SELECT ?gene_id ?gene_label ?transcript_id
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          # Use specific IRIs for fast filtering
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?gene_label ;
                obo:RO_0002162 taxonomy:9606 ;
                terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
                so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> .
          
          ?transcript so:transcribed_from ?gene ;
                      dcterms:identifier ?transcript_id ;
                      terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000365> .
        }
      }
      LIMIT 20

  - title: Get Gene-Transcript-Protein Hierarchy
    description: Navigate structured relationships with UniProt cross-references.
    question: What proteins are encoded by BRCA1?
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX so: <http://purl.obolibrary.org/obo/so#>
      
      SELECT ?gene_id ?transcript_id ?protein_id ?uniprot
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label "BRCA1" .
          ?transcript so:transcribed_from ?gene ;
                      dcterms:identifier ?transcript_id ;
                      so:translates_to ?protein .
          ?protein dcterms:identifier ?protein_id ;
                   rdfs:seeAlso ?uniprot .
          FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
        }
      }
      LIMIT 20

  - title: Extract Genomic Coordinates with FALDO
    description: Retrieve chromosome, start, end, and strand using FALDO ontology.
    question: What are the genomic coordinates of BRCA1?
    complexity: advanced
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      PREFIX so: <http://purl.obolibrary.org/obo/so#>
      
      SELECT DISTINCT ?gene_id ?label ?chr ?start ?end ?strand
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                so:part_of ?chr ;
                faldo:location ?loc .
          ?loc faldo:begin/faldo:position ?start ;
               faldo:end/faldo:position ?end ;
               faldo:begin/rdf:type ?strand_type .
          BIND(IF(?strand_type = faldo:ForwardStrandPosition, "+", "-") AS ?strand)
          FILTER(?label = "BRCA1")
        }
      }
      LIMIT 10

  - title: Count Genes by Biotype Distribution
    description: Aggregate statistics showing gene type distribution in human.
    question: How many genes of each biotype are in human?
    complexity: advanced
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?biotype (COUNT(DISTINCT ?gene) as ?count)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                terms:has_biotype ?biotype ;
                obo:RO_0002162 taxonomy:9606 .
        }
      }
      GROUP BY ?biotype
      ORDER BY DESC(?count)
      LIMIT 20

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases: [chembl, chebi, reactome, amrportal]
  examples:
    - title: Link Genes to Drug Targets via UniProt
      description: |
        Integrate Ensembl genes with ChEMBL drug targets through UniProt identifiers.
        
        Linking strategy:
        - Ensembl: uses rdfs:seeAlso linking to UniProt protein IRIs
        - ChEMBL: uses cco:hasTargetComponent/skos:exactMatch linking to same UniProt IRIs
        - Direct IRI matching provides precise gene-target relationships
      databases_used: [ensembl, chembl]
      complexity: intermediate
      sparql: |
        PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        PREFIX taxonomy: <http://identifiers.org/taxonomy/>
        
        SELECT DISTINCT ?gene_id ?gene_label ?target_id ?target_label
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ensembl> {
            ?gene a terms:EnsemblGene ;
                  dcterms:identifier ?gene_id ;
                  rdfs:label ?gene_label ;
                  rdfs:seeAlso ?uniprot ;
                  obo:RO_0002162 taxonomy:9606 .
            FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    rdfs:label ?target_label ;
                    cco:chemblId ?target_id ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprot .
          }
        }
        LIMIT 100
      notes: |
        - Linking via: UniProt protein identifiers
        - Performance: ~1s (Tier 1) - simple IRI matching join
        - Pre-filtering: taxonomy:9606 reduces genes by 99%, STRSTARTS reduces to ~28% with UniProt xrefs
        - Verified: Both databases use http://purl.uniprot.org/uniprot/ namespace

    - title: Find Genes with Approved Drug Targets on Chromosome 17
      description: |
        Chromosome-specific query linking genes to marketed drugs.
        
        Linking strategy:
        - Ensembl: genes filtered by chromosome IRI (so:part_of) and UniProt xrefs (rdfs:seeAlso)
        - ChEMBL: targets linked via UniProt, molecules filtered by phase=4 (approved drugs)
        - Combines genomic location filtering with drug development stage filtering
      databases_used: [ensembl, chembl]
      complexity: intermediate
      sparql: |
        PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        PREFIX taxonomy: <http://identifiers.org/taxonomy/>
        PREFIX so: <http://purl.obolibrary.org/obo/so#>
        
        SELECT DISTINCT ?gene_id ?gene_label ?target_label (COUNT(DISTINCT ?mol) as ?drug_count)
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ensembl> {
            ?gene a terms:EnsemblGene ;
                  dcterms:identifier ?gene_id ;
                  rdfs:label ?gene_label ;
                  rdfs:seeAlso ?uniprot ;
                  so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> ;
                  obo:RO_0002162 taxonomy:9606 .
            FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    rdfs:label ?target_label ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprot .
            ?mech a cco:Mechanism ;
                  cco:hasTarget ?target ;
                  cco:hasMolecule ?mol .
            ?mol cco:highestDevelopmentPhase 4 .
          }
        }
        GROUP BY ?gene_id ?gene_label ?target_label
        ORDER BY DESC(?drug_count)
        LIMIT 20
      notes: |
        - Linking via: UniProt protein identifiers + chromosome IRIs
        - Performance: ~2-3s (Tier 2) - aggregation adds overhead
        - Pre-filtering: chr17 (87K→~1.2K genes) + UniProt xref (~28%) + phase=4 (2.4M→~8K molecules)
        - Verified: Chromosome 17 contains BRCA1, ERBB2, TP53 - key cancer genes

cross_references:
  - pattern: rdfs:seeAlso
    description: |
      External database cross-references linking to proteins (UniProt), gene nomenclature (HGNC), 
      pathways (Reactome), and clinical databases (OMIM).
    databases:
      proteins: ["UniProt: ~27.8% of human genes"]
      genes: ["HGNC: Human gene nomenclature", "NCBI Gene: Gene-centered info"]
      pathways: ["Reactome: Pathway database"]
      clinical: ["OMIM: Mendelian inheritance"]
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      
      SELECT ?xref
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier "ENSG00000012048" ;
                rdfs:seeAlso ?xref .
        }
      }
      LIMIT 50

architectural_notes:
  query_strategy:
    - "Exploratory: Use direct SPARQL (no dedicated keyword search API)"
    - "Comprehensive: Use specific biotype IRIs (ENSGLOSSARY_*) for gene classification"
    - "Species filtering: Always use obo:RO_0002162 with taxonomy IRI (e.g., taxonomy:9606 for human)"
    - "Chromosome filtering: Use exact chromosome IRIs via so:part_of (faster than string matching)"
    - "Text search: Use bif:contains for gene symbols (Virtuoso backend, indexed)"
    - "Priority: Specific IRIs (biotypes, taxonomy, flags) > Property paths > Text search"
  
  schema_design:
    - "Hierarchical: Gene → Transcript → Protein → Exons (central dogma)"
    - "FALDO ontology: Genomic coordinates with strand-aware positions"
    - "SO (Sequence Ontology): Feature relationships (transcribed_from, translates_to, part_of)"
    - "Biotype IRIs: ENSGLOSSARY_0000026 (protein-coding), ENSGLOSSARY_0000028 (lncRNA)"
    - "Quality flags: ENSGLOSSARY_0000365 (MANE Select), ENSGLOSSARY_0000023 (canonical)"
  
  performance:
    - "Always filter by species early (obo:RO_0002162) - reduces dataset by ~99%"
    - "Use specific biotype IRIs instead of text search on labels"
    - "Use exact chromosome IRIs for fastest filtering"
    - "FALDO queries: Use DISTINCT to avoid duplicates"
    - "Cross-database: Pre-filter in each GRAPH before joins (Strategy 2)"
    - "Text search: bif:contains with wildcards (*) and relevance scoring"
  
  data_integration:
    - "Genome assemblies: GRCh38 (current), GRCh37 (legacy) in separate graphs"
    - "Species: NCBI Taxonomy IRIs (taxonomy:9606 for human)"
    - "Cross-database: UniProt bridge via rdfs:seeAlso → skos:exactMatch"
    - "Coverage: ~27.8% of human genes have UniProt cross-references"
  
  data_quality:
    - "Not all transcripts encode proteins (~30% do for human)"
    - "Quality flags: MANE Select (19,338), TSL 1-5 indicate transcript quality"
    - "FALDO positions may return duplicates - use DISTINCT"
    - "UniProt xref limitation affects ChEMBL integration coverage"

data_statistics:
  total_genes: 87688
  total_transcripts: 413684
  total_proteins: 125510
  verified_date: "2026-02-10"
  verification_queries:
    human_genes: |
      SELECT (COUNT(DISTINCT ?gene) as ?count)
      WHERE { 
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ; obo:RO_0002162 taxonomy:9606 .
        }
      }
    protein_coding_genes: |
      SELECT (COUNT(DISTINCT ?gene) as ?count)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
                obo:RO_0002162 taxonomy:9606 .
        }
      }
    mane_select_transcripts: |
      SELECT (COUNT(DISTINCT ?transcript) as ?count)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?transcript a terms:EnsemblTranscript ;
                      terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000365> .
        }
      }
  
  major_species:
    human: 87688
    mouse: 744820
    rat: 143695
  
  human_biotype_distribution:
    lncRNA: 36492
    protein_coding: 23262
    processed_pseudogene: 10233
    unprocessed_pseudogene: 2805
    miRNA: 1945
  
  human_quality_metrics:
    canonical_transcripts: 87688
    mane_select: 19338
    genes_with_uniprot: 24346
  
  coverage:
    genes_with_description: "100%"
    transcripts_with_proteins: "30.3% (125,510 / 413,684 human transcripts)"
    genes_with_uniprot_xrefs: "27.8% (24,346 / 87,688 human genes)"
    verification_date: "2026-02-10"

anti_patterns:
  - title: Text Search When Specific Biotype IRI Exists
    problem: Using text search on biotype labels when specific IRIs are available.
    wrong_sparql: |
      # Slow: Text search for biotype
      ?gene terms:has_biotype ?biotype .
      ?biotype rdfs:label ?label .
      FILTER(CONTAINS(?label, "protein"))
    correct_sparql: |
      # Fast: Use specific biotype IRI
      ?gene terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> .
    explanation: "Use specific biotype IRIs directly. Common: ENSGLOSSARY_0000026 (protein-coding), ENSGLOSSARY_0000028 (lncRNA), ENSGLOSSARY_0000038 (miRNA)."

  - title: String Matching When Exact Chromosome IRI Available
    problem: Using CONTAINS for chromosome filtering when exact IRI match is faster.
    wrong_sparql: |
      # Slower: String pattern matching
      ?gene so:part_of ?chr .
      FILTER(CONTAINS(STR(?chr), "GRCh38/17"))
    correct_sparql: |
      # Faster: Exact IRI match
      ?gene so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> .
    explanation: "Direct IRI comparison is faster than string parsing. Pattern: <.../114/homo_sapiens/GRCh38/{chr}> where chr is 1-22, X, Y, or MT."

  - title: Missing Species Filter in Multi-Species Database
    problem: Querying without species filter returns mixed results from all 100+ organisms.
    wrong_sparql: |
      SELECT ?gene ?label
      WHERE {
        ?gene a terms:EnsemblGene ;
              rdfs:label ?label .
        FILTER(?label = "TP53")
      }
    correct_sparql: |
      SELECT ?gene ?label
      WHERE {
        ?gene a terms:EnsemblGene ;
              rdfs:label ?label ;
              obo:RO_0002162 taxonomy:9606 .
        FILTER(?label = "TP53")
      }
    explanation: "Always filter by species using obo:RO_0002162 with taxonomy IRI. Common: taxonomy:9606 (human), taxonomy:10090 (mouse). Reduces dataset by ~99%."

  - title: Cross-Database Query Without Pre-Filtering
    problem: Filtering after join processes millions of intermediate results causing timeouts.
    wrong_sparql: |
      # BAD: Filter after expensive join
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene rdfs:seeAlso ?uniprot .
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?target cco:hasTargetComponent/skos:exactMatch ?uniprot .
          ?mechanism cco:hasTarget ?target ;
                     cco:hasMolecule ?molecule .
          ?molecule cco:highestDevelopmentPhase ?phase .
        }
        FILTER(?phase = 4)  # Too late!
      }
    correct_sparql: |
      # GOOD: Pre-filter in each GRAPH before join
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene rdfs:seeAlso ?uniprot ;
                obo:RO_0002162 taxonomy:9606 .
          FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?target cco:hasTargetComponent/skos:exactMatch ?uniprot .
          ?mechanism cco:hasTarget ?target ;
                     cco:hasMolecule ?molecule .
          ?molecule cco:highestDevelopmentPhase 4 .  # Early filter!
        }
      }
      LIMIT 100
    explanation: "Pre-filtering: species (99% reduction) + UniProt xref filter (72% reduction) + phase=4 (99.5% reduction). Improves from timeout to 1-3s."

common_errors:
  - error: "Query timeout on broad searches"
    causes:
      - "Querying all genes without species filter (10M+ genes across all species)"
      - "Scanning FALDO locations without gene constraints"
      - "Using FILTER(CONTAINS()) instead of bif:contains"
    solutions:
      - "Always include species filter: obo:RO_0002162 taxonomy:XXXX"
      - "Use specific biotype IRIs when filtering by gene type"
      - "Use bif:contains for text searches (Virtuoso backend)"
      - "Start with specific gene ID or chromosome constraints"
      - "Add LIMIT to control result size"

  - error: "Empty results for protein queries"
    causes:
      - "Not all transcripts encode proteins (lncRNA, miRNA, pseudogenes)"
      - "Using required pattern (so:translates_to) instead of OPTIONAL"
      - "Wrong biotype filter"
    solutions:
      - "Use OPTIONAL for so:translates_to pattern"
      - "Filter by protein-coding biotype: <http://ensembl.org/glossary/ENSGLOSSARY_0000026>"
      - "Check transcript biotype before expecting proteins"
      - "Coverage: Only ~30% of human transcripts encode proteins"

  - error: "Cross-database integration fails or times out"
    causes:
      - "Missing UniProt cross-references (only 27.8% of human genes)"
      - "Missing pre-filtering in GRAPH clauses"
      - "Incorrect ChEMBL linking pattern"
    solutions:
      - "Pre-filter by species: obo:RO_0002162 taxonomy:9606"
      - "Pre-filter for UniProt xrefs: FILTER(STRSTARTS(STR(?uniprot), 'http://purl.uniprot.org/uniprot/'))"
      - "Use pattern: cco:hasTargetComponent/skos:exactMatch ?uniprot"
      - "Filter by development phase in ChEMBL GRAPH before join"
      - "Test with known examples: BRCA1, TP53, EGFR"
