schema_info:
  title: Ensembl RDF
  description: |
    Ensembl provides comprehensive genome annotations for 100+ vertebrate species. Contains genes with biotype 
    classifications (protein-coding, lncRNA, miRNA, pseudogenes), transcripts with quality flags (MANE, APPRIS, TSL), 
    translated proteins, and ordered exons with FALDO genomic coordinates. Cross-referenced to UniProt, HGNC, NCBI Gene, 
    Reactome, and OMIM for integrative genomics research.
  endpoint: https://rdfportal.org/ebi/sparql
  base_uri: http://rdf.ebi.ac.uk/resource/ensembl/
  graphs:
    - http://rdfportal.org/dataset/ensembl
    - http://rdfportal.org/dataset/ensembl_grch37
  kw_search_tools:
    - sparql
  version:
    mie_version: "2.1"
    mie_created: "2026-02-09"
    mie_updated: "2026-02-09"
    data_version: "Release 114"
    update_frequency: "Quarterly"
    platform_note: "Ensembl 116 (Q2-2026) will be last release on current platform before migration to beta.ensembl.org"
  license:
    data_license: "Creative Commons Attribution 4.0 International"
    license_url: "https://www.ensembl.org/info/about/legal/index.html"
  access:
    rate_limiting: "Reasonable use policy"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso (supports bif:contains for indexed text search)"

shape_expressions: |
  PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
  PREFIX faldo: <http://biohackathon.org/resource/faldo#>
  PREFIX so: <http://purl.obolibrary.org/obo/so#>
  PREFIX obo: <http://purl.obolibrary.org/obo/>
  PREFIX sio: <http://semanticscience.org/resource/>
  
  <EnsemblGeneShape> {
    a [ terms:EnsemblGene ] ;
    rdfs:label xsd:string ;
    dcterms:identifier xsd:string ;
    dcterms:description xsd:string ;
    terms:has_biotype IRI ;
    obo:RO_0002162 IRI ;
    so:part_of IRI + ;
    faldo:location BNode ;
    skos:altLabel xsd:string * ;
    rdfs:seeAlso IRI *
  }
  
  <EnsemblTranscriptShape> {
    a [ terms:EnsemblTranscript ] ;
    dcterms:identifier xsd:string ;
    terms:has_biotype IRI ;
    so:transcribed_from @<EnsemblGeneShape> ;
    so:translates_to @<EnsemblProteinShape> ? ;
    terms:has_transcript_flag IRI * ;
    faldo:location BNode ;
    sio:SIO_000974 @<EnsemblOrderedExonShape> +
  }
  
  <EnsemblProteinShape> {
    a [ terms:EnsemblProtein ] ;
    dcterms:identifier xsd:string ;
    so:translation_of @<EnsemblTranscriptShape> ;
    rdfs:seeAlso IRI *
  }
  
  <EnsemblExonShape> {
    a [ terms:EnsemblExon ] ;
    dcterms:identifier xsd:string ;
    faldo:location BNode
  }
  
  <EnsemblOrderedExonShape> {
    a [ terms:EnsemblOrderedExon ] ;
    sio:SIO_000628 @<EnsemblExonShape> ;
    sio:SIO_000300 xsd:integer
  }

sample_rdf_entries:
  - title: Human Protein-Coding Gene (BRCA1)
    description: Gene on chromosome 17 with biotype, taxonomy, genomic location, and cross-references.
    rdf: |
      @prefix ensg: <http://rdf.ebi.ac.uk/resource/ensembl/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix faldo: <http://biohackathon.org/resource/faldo#> .
      @prefix so: <http://purl.obolibrary.org/obo/so#> .
      @prefix obo: <http://purl.obolibrary.org/obo/> .
      
      ensg:ENSG00000012048 a terms:EnsemblGene ;
        rdfs:label "BRCA1" ;
        dcterms:identifier "ENSG00000012048" ;
        dcterms:description "BRCA1 DNA repair associated [Source:HGNC Symbol;Acc:HGNC:1100]" ;
        terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
        obo:RO_0002162 <http://identifiers.org/taxonomy/9606> ;
        so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> ;
        faldo:location [
          faldo:begin [ faldo:position 43044295 ; rdf:type faldo:ReverseStrandPosition ] ;
          faldo:end [ faldo:position 43170245 ; rdf:type faldo:ReverseStrandPosition ]
        ] ;
        skos:altLabel "FANCS", "RNF53" ;
        rdfs:seeAlso <http://purl.uniprot.org/uniprot/P38398> ,
                     <http://identifiers.org/hgnc/HGNC:1100> .

  - title: Transcript with MANE Select Flag
    description: High-quality transcript with MANE Select and canonical flags.
    rdf: |
      @prefix enst: <http://rdf.ebi.ac.uk/resource/ensembl.transcript/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix so: <http://purl.obolibrary.org/obo/so#> .
      
      enst:ENST00000468300 a terms:EnsemblTranscript ;
        dcterms:identifier "ENST00000468300" ;
        terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
        so:transcribed_from <http://rdf.ebi.ac.uk/resource/ensembl/ENSG00000012048> ;
        so:translates_to <http://rdf.ebi.ac.uk/resource/ensembl.protein/ENSP00000418960> ;
        terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000023> ;
        terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000365> .

  - title: Protein with UniProt Cross-Reference
    description: Translated protein product linked to UniProt.
    rdf: |
      @prefix ensp: <http://rdf.ebi.ac.uk/resource/ensembl.protein/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix so: <http://purl.obolibrary.org/obo/so#> .
      
      ensp:ENSP00000418960 a terms:EnsemblProtein ;
        dcterms:identifier "ENSP00000418960" ;
        so:translation_of <http://rdf.ebi.ac.uk/resource/ensembl.transcript/ENST00000468300> ;
        rdfs:seeAlso <http://purl.uniprot.org/uniprot/P38398> .

  - title: Ordered Exon with Coordinates
    description: Exon with sequential order showing transcript structure.
    rdf: |
      @prefix ense: <http://rdf.ebi.ac.uk/resource/ensembl.exon/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix sio: <http://semanticscience.org/resource/> .
      @prefix faldo: <http://biohackathon.org/resource/faldo#> .
      
      <http://rdf.ebi.ac.uk/resource/ensembl.transcript/ENST00000468300#Exon_1>
        a terms:EnsemblOrderedExon ;
        sio:SIO_000628 ense:ENSE00003884397 ;
        sio:SIO_000300 1 .
      
      ense:ENSE00003884397 a terms:EnsemblExon ;
        dcterms:identifier "ENSE00003884397" ;
        faldo:location [
          faldo:begin [ faldo:position 43170245 ] ;
          faldo:end [ faldo:position 43170403 ]
        ] .

  - title: Long Non-Coding RNA Gene
    description: lncRNA gene showing biotype classification.
    rdf: |
      @prefix ensg: <http://rdf.ebi.ac.uk/resource/ensembl/> .
      @prefix terms: <http://rdf.ebi.ac.uk/terms/ensembl/> .
      @prefix obo: <http://purl.obolibrary.org/obo/> .
      
      ensg:ENSG00000290825 a terms:EnsemblGene ;
        rdfs:label "LINC02593" ;
        dcterms:identifier "ENSG00000290825" ;
        terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000028> ;
        obo:RO_0002162 <http://identifiers.org/taxonomy/9606> .

sparql_query_examples:
  - title: Get Gene by Specific ID
    description: Direct lookup using gene identifier (IRI-based approach).
    question: What are the details of gene ENSG00000012048?
    complexity: basic
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?gene_id ?label ?description ?biotype
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                dcterms:description ?description ;
                terms:has_biotype ?biotype ;
                obo:RO_0002162 taxonomy:9606 .
          FILTER(?gene_id = "ENSG00000012048")
        }
      }

  - title: Find Genes by Specific Biotype
    description: Query protein-coding genes using specific biotype IRI (preferred over text search).
    question: What are some human protein-coding genes?
    complexity: basic
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?gene_id ?label ?description
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                dcterms:description ?description ;
                terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
                obo:RO_0002162 taxonomy:9606 .
        }
      }
      LIMIT 20

  - title: Search Gene Symbols with Full-Text
    description: Use bif:contains for gene symbol pattern matching with relevance scoring.
    question: Find human genes starting with BRCA.
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?gene_id ?label ?description
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                dcterms:description ?description ;
                obo:RO_0002162 taxonomy:9606 .
          # Text search only because searching free-text gene symbols
          # Virtuoso backend: use bif:contains (indexed)
          ?label bif:contains "'BRCA*'" option (score ?sc) .
        }
      }
      ORDER BY DESC(?sc)
      LIMIT 10

  - title: Get High-Quality Transcripts with Multiple IRI Filters
    description: Combine biotype, quality flag, and chromosome IRIs for precise filtering.
    question: What are MANE Select transcripts on chromosome 17?
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      PREFIX so: <http://purl.obolibrary.org/obo/so#>
      
      SELECT ?gene_id ?gene_label ?transcript_id
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          # Use specific IRIs for fast filtering
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?gene_label ;
                obo:RO_0002162 taxonomy:9606 ;
                terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
                so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> .
          
          ?transcript so:transcribed_from ?gene ;
                      dcterms:identifier ?transcript_id ;
                      terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000365> .
        }
      }
      LIMIT 20

  - title: Get Gene-Transcript-Protein Hierarchy
    description: Navigate structured relationships with cross-references to UniProt.
    question: What proteins are encoded by BRCA1?
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX so: <http://purl.obolibrary.org/obo/so#>
      
      SELECT ?gene_id ?transcript_id ?protein_id ?uniprot
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label "BRCA1" .
          ?transcript so:transcribed_from ?gene ;
                      dcterms:identifier ?transcript_id ;
                      so:translates_to ?protein .
          ?protein dcterms:identifier ?protein_id ;
                   rdfs:seeAlso ?uniprot .
          FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
        }
      }
      LIMIT 20

  - title: Extract Genomic Coordinates with FALDO
    description: Retrieve chromosome, start, end, and strand using FALDO ontology.
    question: What are the genomic coordinates of BRCA1?
    complexity: intermediate
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      PREFIX so: <http://purl.obolibrary.org/obo/so#>
      
      SELECT DISTINCT ?gene_id ?label ?chr ?start ?end ?strand
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier ?gene_id ;
                rdfs:label ?label ;
                so:part_of ?chr ;
                faldo:location ?loc .
          ?loc faldo:begin/faldo:position ?start ;
               faldo:end/faldo:position ?end ;
               faldo:begin/rdf:type ?strand_type .
          BIND(IF(?strand_type = faldo:ForwardStrandPosition, "+", "-") AS ?strand)
          FILTER(?label = "BRCA1")
        }
      }

  - title: Retrieve Ordered Exons for Transcript
    description: Get exons with sequential order and coordinates.
    question: What are the exons of transcript ENST00000700182 in order?
    complexity: advanced
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX sio: <http://semanticscience.org/resource/>
      PREFIX faldo: <http://biohackathon.org/resource/faldo#>
      
      SELECT ?transcript_id ?exon_id ?order ?start ?end
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?transcript a terms:EnsemblTranscript ;
                      dcterms:identifier ?transcript_id ;
                      sio:SIO_000974 ?ordered_exon .
          ?ordered_exon sio:SIO_000628 ?exon ;
                        sio:SIO_000300 ?order .
          ?exon dcterms:identifier ?exon_id ;
                faldo:location/faldo:begin/faldo:position ?start ;
                faldo:location/faldo:end/faldo:position ?end .
          FILTER(?transcript_id = "ENST00000700182")
        }
      }
      ORDER BY ?order
      LIMIT 100

  - title: Count Genes by Biotype Distribution
    description: Aggregate statistics showing gene type distribution in human.
    question: How many genes of each biotype are in human?
    complexity: advanced
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      PREFIX obo: <http://purl.obolibrary.org/obo/>
      PREFIX taxonomy: <http://identifiers.org/taxonomy/>
      
      SELECT ?biotype (COUNT(DISTINCT ?gene) as ?count)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                terms:has_biotype ?biotype ;
                obo:RO_0002162 taxonomy:9606 .
        }
      }
      GROUP BY ?biotype
      ORDER BY DESC(?count)
      LIMIT 20

cross_database_queries:
  shared_endpoint: ebi
  co_located_databases:
    - chembl
    - chebi
    - reactome
    - amrportal
  examples:
    - title: Link Genes to Drug Targets via UniProt Bridge
      description: |
        Integrate Ensembl gene annotations with ChEMBL drug target data through UniProt protein identifiers. 
        Maps genomic features to druggable targets. Uses rdfs:seeAlso from Ensembl to UniProt, which ChEMBL 
        references via skos:exactMatch on target components.
      databases_used:
        - ensembl
        - chembl
      complexity: intermediate
      sparql: |
        PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        PREFIX taxonomy: <http://identifiers.org/taxonomy/>
        
        SELECT DISTINCT ?gene_id ?gene_label ?target_id ?target_label
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ensembl> {
            ?gene a terms:EnsemblGene ;
                  dcterms:identifier ?gene_id ;
                  rdfs:label ?gene_label ;
                  rdfs:seeAlso ?uniprot ;
                  obo:RO_0002162 taxonomy:9606 .
            FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    rdfs:label ?target_label ;
                    cco:chemblId ?target_id ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprot .
          }
        }
        LIMIT 100
      notes: |
        - Optimization: Strategy 1 (GRAPH), Strategy 2 (pre-filter), Strategy 6 (property path), Strategy 10 (LIMIT)
        - Performance: ~1s (Tier 1) - simple two-database join with URI matching
        - Pre-filtering: STRSTARTS on UniProt reduces Ensembl genes to ~24K (27.8% with xrefs) before join
        - Use case: Identify genes encoding druggable protein targets
        - Coverage: Only ~27.8% of human genes have UniProt cross-references
    
    - title: Map Approved Drugs to Gene Genomic Locations
      description: |
        Comprehensive integration linking ChEMBL drug mechanisms to gene coordinates from Ensembl. Enables 
        pharmacogenomics analysis by mapping drugs and their targets to chromosomal regions. Filters for approved 
        drugs (phase 4) and includes FALDO location data.
      databases_used:
        - ensembl
        - chembl
      complexity: advanced
      sparql: |
        PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        PREFIX taxonomy: <http://identifiers.org/taxonomy/>
        PREFIX so: <http://purl.obolibrary.org/obo/so#>
        PREFIX faldo: <http://biohackathon.org/resource/faldo#>
        
        SELECT DISTINCT ?gene_id ?gene_label ?chr ?start ?end ?target_label ?molecule_label
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ensembl> {
            ?gene a terms:EnsemblGene ;
                  dcterms:identifier ?gene_id ;
                  rdfs:label ?gene_label ;
                  rdfs:seeAlso ?uniprot ;
                  so:part_of ?chr ;
                  faldo:location ?loc ;
                  obo:RO_0002162 taxonomy:9606 .
            ?loc faldo:begin/faldo:position ?start ;
                 faldo:end/faldo:position ?end .
            FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    rdfs:label ?target_label ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprot .
            ?mechanism a cco:Mechanism ;
                       cco:hasTarget ?target ;
                       cco:hasMolecule ?molecule .
            ?molecule rdfs:label ?molecule_label ;
                      cco:highestDevelopmentPhase 4 .
          }
        }
        LIMIT 50
      notes: |
        - Optimization: Strategy 1 (GRAPH), Strategy 2 (pre-filter), Strategy 6 (property paths), Strategy 10 (LIMIT)
        - Performance: ~2-3s (Tier 2) - FALDO property paths add moderate overhead
        - Pre-filtering: phase=4 reduces ChEMBL molecules from 2.4M to ~8K (99.5% reduction) before join
        - DISTINCT required due to FALDO potentially returning duplicate location entries
        - Use case: Pharmacogenomics - map genetic variants in target genes to drug response
        - Can filter specific chromosomes: FILTER(CONTAINS(STR(?chr), "GRCh38/17"))

    - title: Find Genes on Chromosome 17 with Approved Drug Targets
      description: |
        Focused query identifying chromosome 17 genes encoding proteins targeted by marketed drugs. Demonstrates 
        precise genomic region filtering with drug development phase filtering and aggregation. Useful for 
        chromosome-specific pharmacological research.
      databases_used:
        - ensembl
        - chembl
      complexity: intermediate
      sparql: |
        PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
        PREFIX cco: <http://rdf.ebi.ac.uk/terms/chembl#>
        PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
        PREFIX obo: <http://purl.obolibrary.org/obo/>
        PREFIX taxonomy: <http://identifiers.org/taxonomy/>
        PREFIX so: <http://purl.obolibrary.org/obo/so#>
        
        SELECT DISTINCT ?gene_id ?gene_label ?description ?target_label ?molecule_count
        WHERE {
          GRAPH <http://rdfportal.org/dataset/ensembl> {
            ?gene a terms:EnsemblGene ;
                  dcterms:identifier ?gene_id ;
                  rdfs:label ?gene_label ;
                  dcterms:description ?description ;
                  rdfs:seeAlso ?uniprot ;
                  so:part_of ?chr ;
                  obo:RO_0002162 taxonomy:9606 .
            FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
            FILTER(CONTAINS(STR(?chr), "GRCh38/17"))
          }
          GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
            ?target a cco:SingleProtein ;
                    rdfs:label ?target_label ;
                    cco:hasTargetComponent/skos:exactMatch ?uniprot .
            {
              SELECT ?target (COUNT(DISTINCT ?mol) as ?molecule_count)
              WHERE {
                ?mech a cco:Mechanism ;
                      cco:hasTarget ?target ;
                      cco:hasMolecule ?mol .
                ?mol cco:highestDevelopmentPhase 4 .
              }
              GROUP BY ?target
            }
          }
        }
        ORDER BY DESC(?molecule_count)
        LIMIT 20
      notes: |
        - Optimization: Strategy 1 (GRAPH), Strategy 2 (double pre-filter), Strategy 6 (property path), Strategy 10 (LIMIT)
        - Performance: ~2-4s (Tier 2) - subquery aggregation adds overhead, pre-filtering keeps it fast
        - Pre-filtering: Chromosome (87K→~1.2K genes) + UniProt xref (~28%) + phase=4 subquery (2.4M→~8K molecules)
        - Use case: Chromosome-specific drug target landscape (chr17 contains BRCA1, ERBB2, TP53)
        - Subquery counts approved drugs per target for relevance ranking
        - Results show most heavily targeted genes (e.g., SLC6A4 with 30 drugs, ACE with 15 drugs)

cross_references:
  - pattern: rdfs:seeAlso
    description: |
      External database cross-references linking to proteins (UniProt), gene nomenclature (HGNC, MGI), 
      pathways (Reactome), and clinical databases (OMIM). Critical for cross-database integration.
    databases:
      proteins:
        - "UniProt: Primary protein database (~27.8% of human genes)"
        - "UniParc: Protein archive"
      genes:
        - "HGNC: Human gene nomenclature"
        - "MGI: Mouse genome informatics"
        - "NCBI Gene: Gene-centered information"
        - "GeneCards: Gene-centered resources"
      pathways:
        - "Reactome: Pathway database"
      clinical:
        - "OMIM: Mendelian inheritance"
    sparql: |
      PREFIX terms: <http://rdf.ebi.ac.uk/terms/ensembl/>
      
      SELECT ?xref
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                dcterms:identifier "ENSG00000012048" ;
                rdfs:seeAlso ?xref .
        }
      }

architectural_notes:
  query_strategy:
    - "Exploratory: Use direct SPARQL queries (no dedicated keyword search API for Ensembl)"
    - "Comprehensive: Use specific biotype IRIs (ENSGLOSSARY_*) for gene classification queries"
    - "Species filtering: Always use obo:RO_0002162 with taxonomy IRI (e.g., taxonomy:9606 for human)"
    - "Text search: Use bif:contains for gene symbols/descriptions (Virtuoso backend supports indexed search)"
    - "Priority: Specific IRIs (biotypes, taxonomy) > Property paths (graph navigation) > Text search (bif:contains)"
    - "Cross-database: Pre-filter in each GRAPH clause before joins (Strategy 2) for 10-100x speedup"
  
  advanced_iri_filters:
    transcript_quality_flags:
      - "MANE Select (clinical standard): <http://ensembl.org/glossary/ENSGLOSSARY_0000365> (19,338 human)"
      - "Canonical (one per gene): <http://ensembl.org/glossary/ENSGLOSSARY_0000023> (87,688 human)"
      - "TSL 1 (strongest RNA-seq): <http://ensembl.org/glossary/ENSGLOSSARY_0000006> (44,722 human)"
      - "TSL 2: <http://ensembl.org/glossary/ENSGLOSSARY_0000007> (41,773 human)"
      - "TSL 3: <http://ensembl.org/glossary/ENSGLOSSARY_0000008> (35,219 human)"
      - "Usage: ?transcript terms:has_transcript_flag <IRI>"
    
    chromosome_iris:
      - "Exact match (faster than CONTAINS): ?gene so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17>"
      - "Alternative format: <http://identifiers.org/hco/17/GRCh38>"
      - "Pattern: /114/homo_sapiens/GRCh38/{1-22,X,Y,MT}"
      - "Advantage: Direct IRI comparison faster than string matching"
    
    cross_reference_patterns:
      - "UniProt: FILTER(STRSTARTS(STR(?xref), 'http://purl.uniprot.org/uniprot/'))"
      - "HGNC: FILTER(STRSTARTS(STR(?xref), 'http://identifiers.org/hgnc/'))"
      - "Reactome: FILTER(STRSTARTS(STR(?xref), 'http://identifiers.org/reactome/'))"
      - "OMIM: FILTER(STRSTARTS(STR(?xref), 'http://identifiers.org/omim/'))"
      - "Usage: Pre-filter genes by external database availability"
    
    multiple_values:
      - "RNA genes: VALUES ?biotype { <ENSGLOSSARY_0000028> <ENSGLOSSARY_0000038> <ENSGLOSSARY_0000042> }"
      - "Quality transcripts: VALUES ?flag { <ENSGLOSSARY_0000365> <ENSGLOSSARY_0000023> }"
      - "Sex chromosomes: VALUES ?chr { <.../GRCh38/X> <.../GRCh38/Y> }"
  
  schema_design:
    - "Hierarchical structure: Gene → Transcript → Protein → Exons (central dogma)"
    - "FALDO ontology: Genomic coordinates with strand-aware positions"
    - "SO (Sequence Ontology): Defines feature relationships (transcribed_from, translates_to, part_of)"
    - "SIO ontology: Enables ordered exon structures (SIO_000974, SIO_000628, SIO_000300)"
    - "Biotype IRIs: ENSGLOSSARY_0000026 (protein-coding), ENSGLOSSARY_0000028 (lncRNA), ENSGLOSSARY_0000038 (miRNA)"
  
  performance:
    - "Always filter by species early (obo:RO_0002162) - reduces dataset by ~99%"
    - "Use specific biotype IRIs instead of text search on biotype labels"
    - "Use exact chromosome IRIs for fastest filtering: so:part_of <.../GRCh38/17>"
    - "Alternative: CONTAINS(STR(?chr), 'GRCh38/X') for pattern-based filtering"
    - "FALDO queries: Use DISTINCT and filter to specific genes to avoid duplicates"
    - "Cross-database: STRSTARTS filter on UniProt URIs pre-selects genes with xrefs (~27.8% of human)"
    - "Text search: bif:contains with wildcards (*) and relevance scoring for gene symbols"
    - "Transcript quality: Filter by MANE Select or TSL 1 for highest-quality data"
  
  data_integration:
    - "Multiple genome assemblies: GRCh38 (current), GRCh37 (legacy) in separate graphs"
    - "Species: NCBI Taxonomy IRIs (taxonomy:9606 for human, taxonomy:10090 for mouse)"
    - "External IDs: identifiers.org and purl.uniprot.org for standardized URIs"
    - "Cross-database with ChEMBL: UniProt bridge via rdfs:seeAlso → skos:exactMatch pattern"
    - "Performance tiers: Tier 1 (1-3s) simple joins, Tier 2 (2-4s) with FALDO or aggregation"
  
  data_quality:
    - "Not all transcripts encode proteins (lncRNA, miRNA, pseudogenes lack translations)"
    - "Transcript quality flags: MANE Select, APPRIS, TSL (Transcript Support Level)"
    - "FALDO positions may return duplicates - always use DISTINCT"
    - "UniProt cross-references: Only ~27.8% of human genes have them (limits ChEMBL integration)"

data_statistics:
  total_genes: 10242828
  total_transcripts: 19064877
  total_proteins: 14997888
  species_coverage: "100+ vertebrate species"
  major_species:
    human: 87688
    mouse: 744820
    rat: 143695
  human_biotype_distribution:
    lncRNA: 36492
    protein_coding: 23262
    processed_pseudogene: 10233
    unprocessed_pseudogene: 2805
    miRNA: 1945
  human_transcript_quality:
    canonical: 87688
    mane_select: 19338
    tsl_1: 44722
    tsl_2: 41773
  verified_date: "2026-02-09"
  verification_queries:
    human_genes: |
      SELECT (COUNT(DISTINCT ?gene) as ?count)
      WHERE { 
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ; obo:RO_0002162 taxonomy:9606 .
        }
      }
    protein_coding_genes: |
      SELECT (COUNT(DISTINCT ?gene) as ?count)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene a terms:EnsemblGene ;
                terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> ;
                obo:RO_0002162 taxonomy:9606 .
        }
      }
    mane_select_transcripts: |
      SELECT (COUNT(DISTINCT ?transcript) as ?count)
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?transcript a terms:EnsemblTranscript ;
                      terms:has_transcript_flag <http://ensembl.org/glossary/ENSGLOSSARY_0000365> .
        }
      }
  
  coverage:
    genes_with_description_human: "100%"
    transcripts_with_proteins_human: "30.3%"
    genes_with_uniprot_xrefs_human: "27.8%"
    calculation_description: "87,688 human genes have dcterms:description"
    calculation_proteins: "125,510 / 413,684 human transcripts encode proteins"
    calculation_uniprot: "24,346 / 87,688 human genes have UniProt rdfs:seeAlso"
  
  performance_characteristics:
    - "Gene ID lookup: <1s"
    - "Biotype-filtered queries: 1-2s"
    - "Gene symbol text search: <1s"
    - "Gene-transcript-protein hierarchy: 2-5s"
    - "Exon retrieval: <1s"
    - "Cross-database (simple join): 1s (Tier 1)"
    - "Cross-database (with FALDO): 2-3s (Tier 2)"
    - "Cross-database (with aggregation): 2-4s (Tier 2)"

anti_patterns:
  - title: Text Search When Specific Biotype IRI Exists
    problem: "Using text search on biotype labels when specific IRIs are available."
    wrong_sparql: |
      # Slow: Text search for biotype
      ?gene terms:has_biotype ?biotype .
      ?biotype rdfs:label ?label .
      FILTER(CONTAINS(?label, "protein"))
    correct_sparql: |
      # Fast: Use specific biotype IRI
      ?gene terms:has_biotype <http://ensembl.org/glossary/ENSGLOSSARY_0000026> .
    explanation: |
      Use specific biotype IRIs directly. Common biotypes: ENSGLOSSARY_0000026 (protein-coding), 
      ENSGLOSSARY_0000028 (lncRNA), ENSGLOSSARY_0000038 (miRNA), ENSGLOSSARY_0000048 (pseudogene).
  
  - title: String Matching When Exact Chromosome IRI Available
    problem: "Using CONTAINS for chromosome filtering when exact IRI match is faster."
    wrong_sparql: |
      # Slower: String pattern matching
      ?gene so:part_of ?chr .
      FILTER(CONTAINS(STR(?chr), "GRCh38/17"))
    correct_sparql: |
      # Faster: Exact IRI match
      ?gene so:part_of <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/17> .
    explanation: |
      Direct IRI comparison is faster than string parsing. Use exact chromosome IRIs when targeting specific 
      chromosomes. Pattern: <http://rdf.ebi.ac.uk/resource/ensembl/114/homo_sapiens/GRCh38/{chr}> where 
      {chr} is 1-22, X, Y, or MT.
  
  - title: Missing Species Filter in Multi-Species Database
    problem: "Querying without species filter returns mixed results from all 100+ organisms."
    wrong_sparql: |
      SELECT ?gene ?label
      WHERE {
        ?gene a terms:EnsemblGene ;
              rdfs:label ?label .
        FILTER(?label = "TP53")
      }
    correct_sparql: |
      SELECT ?gene ?label
      WHERE {
        ?gene a terms:EnsemblGene ;
              rdfs:label ?label ;
              obo:RO_0002162 taxonomy:9606 .
        FILTER(?label = "TP53")
      }
    explanation: |
      Always filter by species using obo:RO_0002162 with taxonomy IRI. Common: taxonomy:9606 (human), 
      taxonomy:10090 (mouse), taxonomy:10116 (rat). This reduces dataset by ~99% and prevents mixing species.
  
  - title: Cross-Database Query Without Pre-Filtering
    problem: "Filtering after join processes millions of intermediate results causing timeouts."
    wrong_sparql: |
      # BAD: Filter after expensive join
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene rdfs:seeAlso ?uniprot .
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?target cco:hasTargetComponent/skos:exactMatch ?uniprot .
          ?mechanism cco:hasTarget ?target ;
                     cco:hasMolecule ?molecule .
          ?molecule cco:highestDevelopmentPhase ?phase .
        }
        FILTER(?phase = 4)  # Too late!
      }
    correct_sparql: |
      # GOOD: Pre-filter in each GRAPH before join
      WHERE {
        GRAPH <http://rdfportal.org/dataset/ensembl> {
          ?gene rdfs:seeAlso ?uniprot ;
                obo:RO_0002162 taxonomy:9606 .
          FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
        }
        GRAPH <http://rdf.ebi.ac.uk/dataset/chembl> {
          ?target cco:hasTargetComponent/skos:exactMatch ?uniprot .
          ?mechanism cco:hasTarget ?target ;
                     cco:hasMolecule ?molecule .
          ?molecule cco:highestDevelopmentPhase ?phase .
          FILTER(?phase = 4)  # Early filtering!
        }
      }
    explanation: |
      Pre-filtering reduces: Ensembl genes by species (99%) + UniProt xref filter (72%) + ChEMBL molecules 
      by phase (99.5% reduction: 2.4M→~8K). Performance improves from timeout to 1-3 seconds.

common_errors:
  - error: "Query timeout on broad searches"
    causes:
      - "Querying all genes without species filter (10M+ genes across all species)"
      - "Scanning all FALDO locations without gene constraints"
      - "Using FILTER(CONTAINS()) instead of bif:contains for text search"
    solutions:
      - "Always include species filter: obo:RO_0002162 taxonomy:XXXX"
      - "Use specific biotype IRIs when filtering by gene type"
      - "Use bif:contains for text searches on Virtuoso backend"
      - "Start with specific gene ID or chromosome constraints"
      - "Add LIMIT to control result size"
  
  - error: "Empty results for protein queries"
    causes:
      - "Not all transcripts encode proteins (lncRNA, miRNA, pseudogenes)"
      - "Using required pattern (so:translates_to) instead of OPTIONAL"
      - "Wrong biotype filter (querying non-protein-coding biotypes)"
    solutions:
      - "Use OPTIONAL for so:translates_to pattern"
      - "Filter by protein-coding biotype: <http://ensembl.org/glossary/ENSGLOSSARY_0000026>"
      - "Check transcript biotype before expecting proteins"
      - "Coverage: Only ~30% of human transcripts encode proteins"
  
  - error: "Cross-database integration returns no results or times out"
    causes:
      - "Missing UniProt cross-references (only 27.8% of human genes have them)"
      - "Wrong GRAPH URI from co-located database"
      - "Missing pre-filtering (processing millions of rows before join)"
      - "Incorrect ChEMBL linking pattern"
    solutions:
      - "Pre-filter by species in Ensembl GRAPH: obo:RO_0002162 taxonomy:9606"
      - "Pre-filter for UniProt xrefs: FILTER(STRSTARTS(STR(?uniprot), 'http://purl.uniprot.org/uniprot/'))"
      - "Use correct GRAPH URIs: http://rdfportal.org/dataset/ensembl, http://rdf.ebi.ac.uk/dataset/chembl"
      - "Use ChEMBL pattern: cco:hasTargetComponent/skos:exactMatch ?uniprot"
      - "Filter by development phase in ChEMBL GRAPH before join"
      - "Test with known linked examples: BRCA1, TP53, EGFR"
    example_fix: |
      # BEFORE (times out):
      WHERE {
        GRAPH <ensembl> { ?gene rdfs:seeAlso ?uniprot }
        GRAPH <chembl> {
          ?target cco:hasTargetComponent/skos:exactMatch ?uniprot .
          ?mol cco:highestDevelopmentPhase ?phase .
        }
        FILTER(?phase >= 3)
      }
      
      # AFTER (completes in 1-3s):
      WHERE {
        GRAPH <ensembl> {
          ?gene rdfs:seeAlso ?uniprot ;
                obo:RO_0002162 taxonomy:9606 .  # Early filter!
          FILTER(STRSTARTS(STR(?uniprot), "http://purl.uniprot.org/uniprot/"))
        }
        GRAPH <chembl> {
          ?target cco:hasTargetComponent/skos:exactMatch ?uniprot .
          ?mol cco:highestDevelopmentPhase ?phase .
          FILTER(?phase >= 3)  # Early filter!
        }
      }
      LIMIT 100
