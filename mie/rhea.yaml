schema_info:
  title: Rhea - Annotated Reactions Database
  description: |
    Expert-curated database of 18,071 biochemical reactions with atom-balanced chemistry, extensive cross-references, and enzyme classifications. All reactions have directional (L→R, R→L) and bidirectional representations. Covers 12,496 small molecules and 261 polymers with ChEBI links. Transport reactions (1,522) include cellular location annotations. Primary reaction resource for UniProtKB enzyme annotation.
  endpoint: https://rdfportal.org/sib/sparql
  base_uri: http://rdf.rhea-db.org/
  graphs:
    - http://rdfportal.org/dataset/rhea
  kw_search_tools:
    - search_rhea_entity
  version:
    mie_version: "2.2"
    mie_created: "2025-02-09"
    data_version: "Release 2024"
    update_frequency: "Quarterly"
  license:
    data_license: "CC BY 4.0"
    license_url: "https://www.rhea-db.org/help/license"
  access:
    rate_limiting: "No explicit rate limit"
    max_query_timeout: "60 seconds"
    backend: "Virtuoso"

shape_expressions: |
  PREFIX rhea: <http://rdf.rhea-db.org/>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  
  <ReactionShape> {
    a [ rdfs:Class ] ;
    rdfs:subClassOf [ rhea:Reaction ] ;
    rdfs:label xsd:string ;
    rhea:accession xsd:string ;
    rhea:id xsd:integer ;
    rhea:equation xsd:string ;
    rhea:htmlEquation xsd:string ;
    rhea:status IRI ;
    rhea:isChemicallyBalanced xsd:boolean ;
    rhea:isTransport xsd:boolean ;
    rhea:side IRI + ;
    rhea:directionalReaction IRI + ;
    rhea:bidirectionalReaction IRI ? ;
    rhea:ec IRI * ;
    rdfs:seeAlso IRI * ;
    rdfs:comment xsd:string ?
  }
  
  <ReactionSideShape> {
    a [ rdfs:Class ] ;
    rdfs:subClassOf [ rhea:ReactionSide ] ;
    rhea:contains IRI + ;
    rhea:contains1 IRI * ;
    rhea:contains2 IRI * ;
    rhea:contains3 IRI * ;
    rhea:containsN IRI * ;
    rhea:curatedOrder xsd:integer ;
    rhea:transformableTo IRI ?
  }
  
  <ParticipantShape> {
    a [ rdfs:Class ] ;
    rdfs:subClassOf [ rhea:ReactionParticipant ] ;
    rdfs:subClassOf IRI + ;
    rhea:compound IRI ;
    rhea:location IRI ?
  }
  
  <SmallMoleculeShape> {
    a [ rdfs:Class ] ;
    rdfs:subClassOf [ rhea:SmallMolecule ] ;
    rdfs:subClassOf IRI * ;
    rhea:id xsd:integer ;
    rhea:accession xsd:string ;
    rhea:name xsd:string ;
    rhea:htmlName xsd:string ;
    rhea:formula xsd:string ;
    rhea:charge xsd:integer ;
    rhea:chebi IRI
  }
  
  <PolymerShape> {
    a [ rdfs:Class ] ;
    rdfs:subClassOf [ rhea:Polymer ] ;
    rhea:id xsd:integer ;
    rhea:accession xsd:string ;
    rhea:name xsd:string ;
    rhea:htmlName xsd:string ;
    rhea:formula xsd:string ;
    rhea:charge xsd:string ;
    rhea:polymerizationIndex xsd:string ;
    rhea:underlyingChebi IRI ?
  }

sample_rdf_entries:
  - title: Master Reaction with EC and GO
    description: ATP hydrolysis reaction with multiple EC classifications and GO term annotation.
    rdf: |
      <http://rdf.rhea-db.org/13065> a rdfs:Class ;
        rdfs:subClassOf rhea:Reaction ;
        rdfs:label "ATP + H2O = ADP + phosphate + H(+)" ;
        rdfs:seeAlso <http://purl.obolibrary.org/obo/GO_0016887> ;
        rhea:accession "RHEA:13065" ;
        rhea:equation "ATP + H2O = ADP + phosphate + H(+)" ;
        rhea:status rhea:Approved ;
        rhea:isChemicallyBalanced 1 ;
        rhea:isTransport 0 ;
        rhea:ec <http://purl.uniprot.org/enzyme/3.6.4.10> ;
        rhea:directionalReaction <http://rdf.rhea-db.org/13066> .
  
  - title: Transport Reaction with Location
    description: Sulfate transport reaction showing cellular compartment annotations.
    rdf: |
      <http://rdf.rhea-db.org/10192> a rdfs:Class ;
        rdfs:subClassOf rhea:Reaction ;
        rdfs:label "sulfate(out) + ATP + H2O = sulfate(in) + ADP + phosphate + H(+)" ;
        rhea:accession "RHEA:10192" ;
        rhea:equation "sulfate(out) + ATP + H2O = sulfate(in) + ADP + phosphate + H(+)" ;
        rhea:status rhea:Approved ;
        rhea:isTransport 1 ;
        rhea:side <http://rdf.rhea-db.org/10192_L> .
  
  - title: Reaction Side with Stoichiometry
    description: Left side with participants, stoichiometry encoded via contains1 property.
    rdf: |
      <http://rdf.rhea-db.org/13065_L> a rdfs:Class ;
        rdfs:subClassOf rhea:ReactionSide ;
        rhea:contains <http://rdf.rhea-db.org/Participant_13065_compound_1283> ;
        rhea:contains1 <http://rdf.rhea-db.org/Participant_13065_compound_1283> ;
        rhea:curatedOrder 1 ;
        rhea:transformableTo <http://rdf.rhea-db.org/13065_R> .
  
  - title: Small Molecule with ChEBI
    description: Water molecule with chemical properties and ChEBI cross-reference.
    rdf: |
      <http://rdf.rhea-db.org/Compound_1283> a rdfs:Class ;
        rdfs:subClassOf rhea:SmallMolecule ;
        rdfs:subClassOf <http://purl.obolibrary.org/obo/CHEBI_15377> ;
        rhea:accession "CHEBI:15377" ;
        rhea:name "H2O" ;
        rhea:formula "H2O" ;
        rhea:charge 0 ;
        rhea:chebi <http://purl.obolibrary.org/obo/CHEBI_15377> .
  
  - title: Transport Participant with Location
    description: Participant in transport reaction with cellular location (inside cell).
    rdf: |
      <http://rdf.rhea-db.org/Participant_10192_compound_sulfate_in> a rdfs:Class ;
        rdfs:subClassOf rhea:ReactionParticipant ;
        rdfs:subClassOf <http://rdf.rhea-db.org/Compound_sulfate> ;
        rhea:compound <http://rdf.rhea-db.org/Compound_sulfate> ;
        rhea:location rhea:In .

sparql_query_examples:
  - title: Get Reaction by Accession
    description: Retrieve complete details for a specific reaction using its Rhea accession.
    question: What are the details of reaction RHEA:13065?
    complexity: basic
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?property ?value
      WHERE {
        ?reaction rhea:accession "RHEA:13065" ;
                  ?property ?value .
      }
      LIMIT 50
  
  - title: Find Approved Reactions
    description: Retrieve reactions with approved status using specific status IRI.
    question: What are some approved biochemical reactions?
    complexity: basic
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?reaction ?accession ?equation
      WHERE {
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:accession ?accession ;
                  rhea:equation ?equation ;
                  rhea:status <http://rdf.rhea-db.org/Approved> .
      }
      LIMIT 20
  
  - title: Find Transport Reactions with Locations
    description: Identify membrane transport reactions using typed predicate rhea:isTransport and retrieve cellular locations.
    question: Which reactions involve transport across cellular membranes?
    complexity: intermediate
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT DISTINCT ?reaction ?equation ?compound ?location
      WHERE {
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:isTransport 1 ;
                  rhea:side ?side .
        ?side rhea:contains ?participant .
        ?participant rhea:compound ?compound ;
                     rhea:location ?location .
      }
      LIMIT 30
  
  - title: Find Reactions by EC Number
    description: Retrieve reactions catalyzed by specific enzyme classes using EC number IRIs.
    question: What reactions are catalyzed by ATPases (EC 3.6.4.x)?
    complexity: intermediate
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      # Using specific EC number IRIs
      SELECT ?reaction ?equation ?ec
      WHERE {
        VALUES ?ec {
          <http://purl.uniprot.org/enzyme/3.6.4.10>
          <http://purl.uniprot.org/enzyme/3.6.4.12>
          <http://purl.uniprot.org/enzyme/3.6.4.13>
          <http://purl.uniprot.org/enzyme/3.6.4.6>
          <http://purl.uniprot.org/enzyme/3.6.4.7>
        }
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved ;
                  rhea:ec ?ec .
      }
      LIMIT 30
  
  - title: Find Reactions by Compound ChEBI IRI
    description: Retrieve reactions containing specific compounds using ChEBI IRIs for precise chemical matching.
    question: What reactions involve ATP, ADP, or glucose?
    complexity: intermediate
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX chebi: <http://purl.obolibrary.org/obo/>
      
      # Using specific ChEBI IRIs for compounds
      SELECT DISTINCT ?reaction ?equation ?compoundName
      WHERE {
        VALUES ?chebiIRI {
          chebi:CHEBI_30616  # ATP
          chebi:CHEBI_456216 # ADP
          chebi:CHEBI_17234  # D-glucose
        }
        ?compound rdfs:subClassOf rhea:SmallMolecule ;
                  rhea:chebi ?chebiIRI ;
                  rhea:name ?compoundName .
        ?participant rhea:compound ?compound .
        ?side rhea:contains ?participant .
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:side ?side ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved .
      }
      LIMIT 30
  
  - title: Navigate Directional Reaction Variants
    description: Retrieve all directional and bidirectional forms through graph navigation.
    question: What are all the directional forms of a master reaction?
    complexity: advanced
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?masterReaction ?accession ?directional ?dirLabel ?bidirectional
      WHERE {
        ?masterReaction rhea:accession "RHEA:13065" ;
                        rhea:accession ?accession .
        
        OPTIONAL {
          ?masterReaction rhea:directionalReaction ?directional .
          ?directional rdfs:subClassOf rhea:DirectionalReaction ;
                       rdfs:label ?dirLabel .
        }
        
        OPTIONAL {
          ?masterReaction rhea:bidirectionalReaction ?bidirectional .
        }
      }
  
  - title: Search Reactions by Equation Text
    description: Find reactions using full-text search on equation text when no specific compound IRIs are known.
    question: What reactions involve both glucose and phosphate compounds?
    complexity: advanced
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      # Text search used because searching unstructured equation text
      # Use when compound names are ambiguous or ChEBI IRIs unknown
      SELECT ?reaction ?equation
      WHERE {
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved .
        # Use bif:contains for indexed text search (Virtuoso backend)
        ?equation bif:contains "'glucose' AND 'phosphate'" option (score ?sc) .
      }
      ORDER BY DESC(?sc)
      LIMIT 20

cross_database_queries:
  shared_endpoint: sib
  co_located_databases:
    - uniprot
  examples:
    - title: Find Enzymes Catalyzing ATP Reactions
      description: |
        Link biochemical reactions to catalyzing enzymes using shared SIB endpoint.
        Demonstrates enzyme-reaction integration for drug target discovery and metabolic pathway analysis.
      databases_used:
        - rhea
        - uniprot
      complexity: intermediate
      sparql: |
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX rhea: <http://rdf.rhea-db.org/>
        PREFIX up: <http://purl.uniprot.org/core/>
        
        SELECT ?reaction ?equation ?enzyme ?protein ?mnemonic ?fullName
        WHERE {
          GRAPH <http://rdfportal.org/dataset/rhea> {
            ?reaction rdfs:subClassOf rhea:Reaction ;
                      rhea:equation ?equation ;
                      rhea:status rhea:Approved ;
                      rhea:ec ?enzyme .
            # Pre-filter in Rhea graph using text search
            ?equation bif:contains "'ATP'" option (score ?sc) .
          }
          GRAPH <http://sparql.uniprot.org/uniprot> {
            ?protein a up:Protein ;
                     up:reviewed 1 ;
                     up:mnemonic ?mnemonic ;
                     up:enzyme ?enzyme ;
                     up:recommendedName ?name .
            ?name up:fullName ?fullName .
          }
        }
        ORDER BY DESC(?sc)
        LIMIT 20
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filtering), 4 (bif:contains split paths), 8 (reviewed=1, approved), 10 (LIMIT)
        - Performance: ~2-3s (Tier 1)
        - bif:contains + reviewed=1 reduces search space 99.9% before join
        - MIE files referenced: rhea, uniprot
    
    - title: Human Enzymes and Reaction Chemistry
      description: |
        Identify human proteins and their catalyzed reactions with chemical details.
        Integrates curated protein data with reaction chemistry for metabolism studies.
      databases_used:
        - uniprot
        - rhea
      complexity: intermediate
      sparql: |
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX rhea: <http://rdf.rhea-db.org/>
        PREFIX up: <http://purl.uniprot.org/core/>
        
        SELECT ?protein ?mnemonic ?fullName ?reaction ?equation
        WHERE {
          GRAPH <http://sparql.uniprot.org/uniprot> {
            ?protein a up:Protein ;
                     up:reviewed 1 ;
                     up:organism <http://purl.uniprot.org/taxonomy/9606> ;
                     up:mnemonic ?mnemonic ;
                     up:enzyme ?enzyme ;
                     up:recommendedName ?name .
            ?name up:fullName ?fullName .
          }
          GRAPH <http://rdfportal.org/dataset/rhea> {
            ?reaction rdfs:subClassOf rhea:Reaction ;
                      rhea:equation ?equation ;
                      rhea:status rhea:Approved ;
                      rhea:ec ?enzyme .
          }
        }
        LIMIT 20
      notes: |
        - Strategies: 1 (GRAPH), 2 (organism pre-filter), 8 (reviewed=1, approved), 10 (LIMIT)
        - Performance: ~3-4s (Tier 1-2)
        - Organism filtering reduces dataset 95.7% before join
        - MIE files referenced: uniprot, rhea
    
    - title: Reactions with Protein GO Terms
      description: |
        Three-way integration linking reactions, enzymes, and biological process annotations.
        Provides comprehensive context for systems biology and pathway enrichment analysis.
      databases_used:
        - rhea
        - uniprot
      complexity: advanced
      sparql: |
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX rhea: <http://rdf.rhea-db.org/>
        PREFIX up: <http://purl.uniprot.org/core/>
        
        SELECT DISTINCT ?reaction ?equation ?protein ?mnemonic ?goLabel
        WHERE {
          GRAPH <http://rdfportal.org/dataset/rhea> {
            ?reaction rdfs:subClassOf rhea:Reaction ;
                      rhea:equation ?equation ;
                      rhea:status rhea:Approved ;
                      rhea:ec ?enzyme .
          }
          GRAPH <http://sparql.uniprot.org/uniprot> {
            ?protein a up:Protein ;
                     up:reviewed 1 ;
                     up:mnemonic ?mnemonic ;
                     up:enzyme ?enzyme ;
                     up:classifiedWith ?goTerm .
          }
          GRAPH <http://sparql.uniprot.org/go> {
            ?goTerm rdfs:label ?goLabel .
            FILTER(STRSTARTS(STR(?goTerm), "http://purl.obolibrary.org/obo/GO_"))
          }
        }
        LIMIT 30
      notes: |
        - Strategies: 1 (GRAPH), 2 (pre-filtering), 8 (database-specific filters), 10 (LIMIT)
        - Performance: ~4-6s (Tier 2-3)
        - Three-way join optimized through pre-filtering in each graph
        - MIE files referenced: rhea, uniprot

cross_references:
  - pattern: rdfs:seeAlso (GO Terms)
    description: |
      Reactions link to Gene Ontology molecular function terms via rdfs:seeAlso.
      GO terms provide biological context and enable functional classification of reactions.
      Use specific GO IRIs for precise filtering rather than text search.
    databases:
      Gene_Ontology:
        - "GO Molecular Function: 4,385 reactions (~24%) have GO annotations"
        - "GO terms describe enzymatic activities (kinase, ATPase, etc.)"
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX go: <http://purl.obolibrary.org/obo/>
      
      # Filter reactions by specific GO molecular function terms
      SELECT DISTINCT ?reaction ?equation ?goTerm
      WHERE {
        VALUES ?goTerm {
          go:GO_0016301  # kinase activity
          go:GO_0016887  # ATPase activity
          go:GO_0004672  # protein kinase activity
        }
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved ;
                  rdfs:seeAlso ?goTerm .
      }
      LIMIT 30

  - pattern: rdfs:seeAlso (Reactome Pathways)
    description: |
      Reactions link to Reactome pathway events via rdfs:seeAlso with identifiers.org URIs.
      Reactome IRIs enable pathway-based filtering and biological context.
      Use specific Reactome event IRIs for precise pathway filtering.
    databases:
      Metabolic_Pathways:
        - "Reactome: 758 reactions (~4%) have Reactome pathway links"
        - "Links are to specific reaction events in pathways"
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      # Filter reactions by specific Reactome pathway events
      SELECT DISTINCT ?reaction ?equation ?pathway
      WHERE {
        VALUES ?pathway {
          <http://identifiers.org/reactome/R-HSA-426240.2>
          <http://identifiers.org/reactome/R-HSA-936802.2>
        }
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved ;
                  rdfs:seeAlso ?pathway .
      }
      LIMIT 30

  - pattern: rdfs:seeAlso (BioCyc/MetaCyc Pathways)
    description: |
      Reactions link to BioCyc/MetaCyc metabolic pathways via rdfs:seeAlso with identifiers.org URIs.
      BioCyc IRIs enable metabolic pathway-based filtering and comprehensive metabolism context.
      Use specific BioCyc reaction IRIs for precise pathway filtering.
    databases:
      Metabolic_Pathways:
        - "BioCyc/MetaCyc: 396 reactions (~2%) have BioCyc pathway links"
        - "MetaCyc provides detailed metabolic pathway annotations"
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      # Filter reactions by specific BioCyc/MetaCyc pathway reactions
      SELECT DISTINCT ?reaction ?equation ?biocycPathway
      WHERE {
        VALUES ?biocycPathway {
          <http://identifiers.org/biocyc/METACYC:THIOCYANATE-ISOMERASE-RXN>
          <http://identifiers.org/biocyc/METACYC:D-TRYPTOPHAN-N-ACETYLTRANSFERASE-RXN>
        }
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved ;
                  rdfs:seeAlso ?biocycPathway .
      }
      LIMIT 30

  - pattern: rhea:chebi
    description: |
      All small molecules link to ChEBI chemical structures via rhea:chebi property.
      Enables integration with chemical databases and structure-based queries.
      This is the preferred method for finding reactions by compound rather than text search.
    databases:
      Chemical_Structures:
        - "ChEBI: 100% coverage for small molecules (12,496 compounds)"
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX chebi: <http://purl.obolibrary.org/obo/>
      
      # Example: Find reactions containing ATP
      SELECT DISTINCT ?reaction ?equation ?compoundName
      WHERE {
        ?compound rdfs:subClassOf rhea:SmallMolecule ;
                  rhea:chebi chebi:CHEBI_30616 ;
                  rhea:name ?compoundName .
        ?participant rhea:compound ?compound .
        ?side rhea:contains ?participant .
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:side ?side ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved .
      }
      LIMIT 50

  - pattern: rhea:ec
    description: |
      Reactions link to enzyme classifications via EC number IRIs.
      Enables protein-reaction integration through shared SIB endpoint with UniProt.
    databases:
      Enzyme_Classification:
        - "EC Numbers: ~45% reactions (8,100+) have EC annotations"
    sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?reaction ?equation ?ec
      WHERE {
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:ec ?ec .
      }
      LIMIT 50

architectural_notes:
  query_strategy:
    - "Exploratory: Use search_rhea_entity(query, limit) to find reactions and extract IRIs"
    - "Comprehensive: Use specific status IRIs (rhea:Approved, rhea:Preliminary, rhea:Obsolete)"
    - "Comprehensive: Use specific EC number IRIs in VALUES clauses"
    - "Comprehensive: Use specific ChEBI IRIs via rhea:chebi for compound filtering (preferred over text search)"
    - "Comprehensive: Use specific GO term IRIs via rdfs:seeAlso for functional filtering"
    - "Comprehensive: Use specific Reactome pathway IRIs via rdfs:seeAlso for pathway context"
    - "Comprehensive: Use specific BioCyc/MetaCyc IRIs via rdfs:seeAlso for metabolic pathway filtering"
    - "Comprehensive: Use typed predicates (rhea:isTransport, rhea:status, rhea:location)"
    - "Text search: bif:contains (Virtuoso) for unstructured equation text only when IRIs unknown"
    - "Priority: Specific IRIs (ChEBI, EC, GO, status, pathways) > Typed predicates > Graph navigation > Text search"
  
  iri_filtering_hierarchy:
    - "Tier 1 - Always available: Status IRIs (100%), ChEBI IRIs (100% for small molecules)"
    - "Tier 2 - High coverage: EC number IRIs (~45%), Location IRIs (8% transport reactions)"
    - "Tier 3 - Moderate coverage: GO term IRIs (~24%)"
    - "Tier 4 - Sparse coverage: Reactome IRIs (~4%), BioCyc IRIs (~2%)"
    - "For polymers: rhea:underlyingChebi provides ChEBI links (partial coverage)"
  
  schema_design:
    - "Reactions have three representations: master, directional (L→R, R→L), bidirectional"
    - "Reaction IDs form quartets: 13065 (master), 13066 (L→R), 13067 (R→L), 13068 (bidirectional)"
    - "Stoichiometry encoded in property names (contains1, contains2, contains3, containsN)"
    - "Transport reactions have participants with rhea:location (rhea:In, rhea:Out)"
    - "Compounds: SmallMolecule (with ChEBI) or Polymer (with polymerization indices)"
    - "Status IRIs: rhea:Approved, rhea:Preliminary, rhea:Obsolete"
    - "Location IRIs: rhea:In, rhea:Out for transport reactions"
    - "All small molecules have rhea:chebi property linking to ChEBI IRIs"
    - "GO terms, Reactome pathways, BioCyc pathways linked via rdfs:seeAlso"
  
  performance:
    - "Use specific status IRIs (rhea:Approved) early in queries"
    - "Use ChEBI IRIs (rhea:chebi) for compound filtering - more precise and faster than text search"
    - "Use GO term IRIs for functional filtering when biological context needed"
    - "Use pathway IRIs (Reactome, BioCyc) for pathway-based filtering"
    - "Use bif:contains for text search in equations only when IRIs unknown"
    - "Boolean operators in bif:contains: \"'glucose' AND 'phosphate'\" or \"'atp' OR 'gtp'\""
    - "Start from reactions then traverse to compounds for better performance"
    - "Always use LIMIT for relationship traversals"
    - "Cross-database: Use GRAPH clauses (Strategy 1), pre-filter within GRAPH (Strategy 2)"
    - "bif:contains with split paths (Strategy 4) provides 5-10x speedup"
  
  data_integration:
    - "ChEBI integration via rdfs:subClassOf and rhea:chebi enables compound queries"
    - "Use rhea:chebi property for precise compound matching (100% coverage for small molecules)"
    - "EC numbers link to UniProt enzyme namespace for protein function connections"
    - "GO terms provide biological function context and enable functional classification"
    - "Reactome pathway IRIs enable integration with human pathway databases"
    - "BioCyc/MetaCyc IRIs enable integration with comprehensive metabolic pathway databases"
    - "Cross-database with UniProt via shared SIB endpoint: Tier 1 (1-3s) with optimization"
    - "Linking mechanism: rhea:ec ↔ up:enzyme"
  
  data_quality:
    - "All approved reactions are chemically balanced (rhea:isChemicallyBalanced = 1)"
    - "Preliminary reactions (148) indicate ongoing curation"
    - "Obsolete reactions (288) retained for historical reference"
    - "Polymers use specialized notation (n, n-1) in formulas and charges"
    - "100% of small molecules have ChEBI cross-references via rhea:chebi"
    - "GO term annotations provide expert-curated functional context (~24% coverage)"
    - "Pathway annotations (Reactome, BioCyc) enable systems biology analysis (2-4% coverage)"

data_statistics:
  total_reactions: 18071
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(DISTINCT ?r) as ?count)
    WHERE { ?r rdfs:subClassOf rhea:Reaction }
  
  reaction_status:
    approved: 17635
    preliminary: 148
    obsolete: 288
    verified_date: "2025-02-09"
    verification_query: |
      SELECT ?status (COUNT(?r) as ?count)
      WHERE { ?r rhea:status ?status }
      GROUP BY ?status
  
  transport_reactions: 1522
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(?r) as ?transport_count)
    WHERE { ?r rhea:isTransport 1 }
  
  small_molecules: 12496
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(DISTINCT ?c) as ?count)
    WHERE { ?c rdfs:subClassOf rhea:SmallMolecule }
  
  polymers: 261
  verified_date: "2025-02-09"
  verification_query: |
    SELECT (COUNT(?p) as ?count)
    WHERE { ?p rdfs:subClassOf rhea:Polymer }
  
  coverage:
    reactions_with_ec: ~45%
    note: "Approximately 8,100+ reactions have EC number annotations"
    reactions_with_go: ~24%
    note: "4,385 reactions have GO molecular function annotations"
    reactions_with_reactome: ~4%
    note: "758 reactions have Reactome pathway links"
    reactions_with_biocyc: ~2%
    note: "396 reactions have BioCyc/MetaCyc pathway links"
    compounds_with_chebi: 100%
    note: "All 12,496 small molecules have ChEBI cross-references via rhea:chebi property"
  
  performance_characteristics:
    - "Simple lookups by ID: <1s"
    - "ChEBI IRI filtering: <1s for 30 results"
    - "EC number IRI filtering: <1s for 30 results"
    - "GO term IRI filtering: <1s for 30 results"
    - "Pathway IRI filtering (Reactome, BioCyc): <1s for 30 results"
    - "bif:contains searches: <1s for 20 results"
    - "Complex joins (reactions-participants-compounds): 2-5s with LIMIT 50"
    - "Cross-DB with UniProt: Tier 1 (1-3s) with bif:contains + pre-filtering"
    - "Cross-DB three-way joins: Tier 2-3 (3-8s)"
  
  staleness_warning: "Quarterly updates - verify current data at www.rhea-db.org for latest statistics"

anti_patterns:
  - title: "Using Text Search When ChEBI IRI Available"
    problem: "Using text search for compounds when specific ChEBI IRIs provide precise matching."
    wrong_sparql: |
      SELECT ?reaction ?equation
      WHERE {
        ?reaction rhea:equation ?equation .
        ?equation bif:contains "'ATP'"
      }
    correct_sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX chebi: <http://purl.obolibrary.org/obo/>
      
      SELECT DISTINCT ?reaction ?equation
      WHERE {
        ?compound rdfs:subClassOf rhea:SmallMolecule ;
                  rhea:chebi chebi:CHEBI_30616 .
        ?participant rhea:compound ?compound .
        ?side rhea:contains ?participant .
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:side ?side ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved .
      }
      LIMIT 20
    explanation: "Use ChEBI IRIs for precise chemical matching. Text search finds 'ATPASE' and misses variants. ChEBI IRI matches exact structure."
  
  - title: "Using Text Search for Functional Classification"
    problem: "Using text search on equation text when specific GO term IRIs are available for functional filtering."
    wrong_sparql: |
      SELECT ?reaction ?equation
      WHERE {
        ?reaction rhea:equation ?equation .
        ?equation bif:contains "'kinase'"
      }
    correct_sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX go: <http://purl.obolibrary.org/obo/>
      
      SELECT DISTINCT ?reaction ?equation
      WHERE {
        VALUES ?goTerm {
          go:GO_0016301  # kinase activity
          go:GO_0004672  # protein kinase activity
        }
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved ;
                  rdfs:seeAlso ?goTerm .
      }
      LIMIT 30
    explanation: "Use GO term IRIs for precise functional classification. Text search is ambiguous and misses functionally related reactions with different naming."
  
  - title: "Missing LIMIT on Open-Ended Queries"
    problem: "Queries without LIMIT timeout on large result sets."
    wrong_sparql: |
      SELECT ?reaction ?participant ?compound
      WHERE {
        ?reaction rhea:side ?side .
        ?side rhea:contains ?participant .
        ?participant rhea:compound ?compound .
      }
    correct_sparql: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      
      SELECT ?reaction ?participant ?compound
      WHERE {
        ?reaction rhea:side ?side .
        ?side rhea:contains ?participant .
        ?participant rhea:compound ?compound .
      }
      LIMIT 100
    explanation: "Always use LIMIT when traversing relationships to prevent timeouts."

common_errors:
  - error: "Query timeout when counting reactions"
    causes:
      - "Not using LIMIT on large aggregations"
      - "Attempting full reaction-participant-compound graph traversal"
    solutions:
      - "Add LIMIT even to COUNT queries"
      - "Break complex queries into focused subqueries"
      - "Use status filters early (rhea:Approved)"
    example_fix: |
      SELECT (COUNT(?reaction) as ?count)
      WHERE {
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:status rhea:Approved .
      }
      LIMIT 1
  
  - error: "Empty results when searching compounds"
    causes:
      - "Searching participant entities instead of compound entities"
      - "Not following reaction→side→participant→compound path"
      - "Using text search instead of ChEBI IRIs"
    solutions:
      - "Use ChEBI IRIs via rhea:chebi for precise compound matching"
      - "Use rhea:compound to link participants to compounds"
      - "Use bif:contains for text search only when ChEBI IRI unknown"
    example_fix: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX chebi: <http://purl.obolibrary.org/obo/>
      
      # Preferred: Use ChEBI IRI
      SELECT DISTINCT ?reaction ?equation
      WHERE {
        ?compound rhea:chebi chebi:CHEBI_17234 .
        ?participant rhea:compound ?compound .
        ?side rhea:contains ?participant .
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:side ?side ;
                  rhea:equation ?equation .
      }
      LIMIT 20
  
  - error: "Missing pathway or functional annotations"
    causes:
      - "Not using OPTIONAL for sparse annotations"
      - "Expecting all reactions to have GO terms or pathway links"
      - "Using wrong IRI pattern for pathway databases"
    solutions:
      - "Wrap GO term and pathway queries in OPTIONAL if not required"
      - "Check coverage statistics: GO ~24%, Reactome ~4%, BioCyc ~2%"
      - "Use correct IRI patterns: identifiers.org for pathways, purl.obolibrary.org for GO"
    example_fix: |
      PREFIX rhea: <http://rdf.rhea-db.org/>
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      
      SELECT ?reaction ?equation ?goTerm ?pathway
      WHERE {
        ?reaction rdfs:subClassOf rhea:Reaction ;
                  rhea:equation ?equation ;
                  rhea:status rhea:Approved .
        OPTIONAL {
          ?reaction rdfs:seeAlso ?goTerm .
          FILTER(STRSTARTS(STR(?goTerm), "http://purl.obolibrary.org/obo/GO_"))
        }
        OPTIONAL {
          ?reaction rdfs:seeAlso ?pathway .
          FILTER(CONTAINS(STR(?pathway), "reactome"))
        }
      }
      LIMIT 50
  
  - error: "Cross-database query timeout"
    causes:
      - "Missing GRAPH clauses - cross-contamination between databases"
      - "Missing pre-filtering before joins"
      - "Not using database-specific filters (reviewed=1, approved status)"
    solutions:
      - "Use explicit GRAPH clauses for each database"
      - "Apply restrictive filters within GRAPH blocks before joins"
      - "Use rhea:status rhea:Approved and up:reviewed 1"
      - "Add LIMIT to every query"
    example_fix: |
      WHERE {
        GRAPH <http://rdfportal.org/dataset/rhea> {
          ?reaction rhea:status rhea:Approved ;
                    rhea:ec ?enzyme .
        }
        GRAPH <http://sparql.uniprot.org/uniprot> {
          ?protein up:reviewed 1 ;
                   up:enzyme ?enzyme .
        }
      }
      LIMIT 50
